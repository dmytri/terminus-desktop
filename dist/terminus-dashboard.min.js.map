{"version":3,"sources":["webpack://TerminusDashboard/webpack/bootstrap","webpack://TerminusDashboard/./src/html/HTMLHelper.js","webpack://TerminusDashboard/../terminus-client/index.js","webpack://TerminusDashboard/../terminus-client/lib/utils.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/utils.js","webpack://TerminusDashboard/./src/Utils.js","webpack://TerminusDashboard/../terminus-client/lib/woqlRule.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/viewConfig.js","webpack://TerminusDashboard/../terminus-client/lib/frameRule.js","webpack://TerminusDashboard/../terminus-client/lib/errorMessage.js","webpack://TerminusDashboard/./src/html/TerminusViewer.js","webpack://TerminusDashboard/./src/html/query/TerminusCodeSnippet.js","webpack://TerminusDashboard/../terminus-client/lib/const.js","webpack://TerminusDashboard/./src/plugins/TerminusPlugin.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/helpers/bind.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/helpers/buildURL.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/cancel/isCancel.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/defaults.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/adapters/xhr.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/core/createError.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/core/mergeConfig.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/cancel/Cancel.js","webpack://TerminusDashboard/../terminus-client/lib/connectionCapabilities.js","webpack://TerminusDashboard/../terminus-client/lib/connectionConfig.js","webpack://TerminusDashboard/../terminus-client/lib/terminusIDParser.js","webpack://TerminusDashboard/../terminus-client/lib/woqlResult.js","webpack://TerminusDashboard/../terminus-client/lib/woql.js","webpack://TerminusDashboard/../terminus-client/lib/terminusRule.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/tableConfig.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/woqlTable.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/chooserConfig.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/woqlChooser.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/graphConfig.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/woqlGraph.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/chartConfig.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/woqlChart.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/streamConfig.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/woqlStream.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/frameConfig.js","webpack://TerminusDashboard/../terminus-client/lib/viewer/documentFrame.js","webpack://TerminusDashboard/./src/html/Datatypes.js","webpack://TerminusDashboard/./src/html/datatypes/DateHelper.js","webpack://TerminusDashboard/./src/html/datatypes/GoogleMapHelper.js","webpack://TerminusDashboard/./src/html/DatatypeRenderers.js","webpack://TerminusDashboard/./src/html/TerminusViolation.js","webpack://TerminusDashboard/./src/index.js","webpack://TerminusDashboard/./src/TerminusUI.js","webpack://TerminusDashboard/./src/ApiExplorer.js","webpack://TerminusDashboard/../terminus-client/lib/woqlClient.js","webpack://TerminusDashboard/../terminus-client/lib/dispatchRequest.js","webpack://TerminusDashboard/./node_modules/buffer/index.js","webpack://TerminusDashboard/(webpack)/buildin/global.js","webpack://TerminusDashboard/./node_modules/base64-js/index.js","webpack://TerminusDashboard/./node_modules/ieee754/index.js","webpack://TerminusDashboard/./node_modules/isarray/index.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/index.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/axios.js","webpack://TerminusDashboard/../terminus-client/node_modules/is-buffer/index.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/core/Axios.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/core/InterceptorManager.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/core/dispatchRequest.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/core/transformData.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/helpers/normalizeHeaderName.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/core/settle.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/core/enhanceError.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/helpers/parseHeaders.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/helpers/isURLSameOrigin.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/helpers/cookies.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/helpers/isAbsoluteURL.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/helpers/combineURLs.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/cancel/CancelToken.js","webpack://TerminusDashboard/../terminus-client/node_modules/axios/lib/helpers/spread.js","webpack://TerminusDashboard/../terminus-client/lib/woqlView.js","webpack://TerminusDashboard/../terminus-client/lib/objectFrame.js","webpack://TerminusDashboard/./src/plugins/codemirror.terminus.js","webpack://TerminusDashboard/./src/TerminusDB.js","webpack://TerminusDashboard/./src/html/QueryPane.js","webpack://TerminusDashboard/./src/html/ResultPane.js","webpack://TerminusDashboard/./src/html/datatypes/String.js","webpack://TerminusDashboard/./src/html/datatypes/StringEditor.js","webpack://TerminusDashboard/./src/html/datatypes/Boolean.js","webpack://TerminusDashboard/./src/html/datatypes/BooleanEditor.js","webpack://TerminusDashboard/./src/html/datatypes/Choice.js","webpack://TerminusDashboard/./src/html/datatypes/ChoiceEditor.js","webpack://TerminusDashboard/./src/html/datatypes/Coordinate.js","webpack://TerminusDashboard/./src/html/datatypes/CoordinateEditor.js","webpack://TerminusDashboard/./src/html/datatypes/Date.js","webpack://TerminusDashboard/./src/html/datatypes/DateEditor.js","webpack://TerminusDashboard/./src/html/datatypes/Entity.js","webpack://TerminusDashboard/./src/html/datatypes/EntityEditor.js","webpack://TerminusDashboard/./src/html/datatypes/Image.js","webpack://TerminusDashboard/./src/html/datatypes/ImageEditor.js","webpack://TerminusDashboard/./src/html/datatypes/Link.js","webpack://TerminusDashboard/./src/html/datatypes/Number.js","webpack://TerminusDashboard/./src/html/datatypes/Range.js","webpack://TerminusDashboard/./src/html/datatypes/RangeEditor.js","webpack://TerminusDashboard/./src/html/datatypes/GoogleMapEditor.js","webpack://TerminusDashboard/./src/html/datatypes/GoogleMapViewer.js","webpack://TerminusDashboard/./src/html/datatypes/HTMLMarkupEditor.js","webpack://TerminusDashboard/./src/html/datatypes/S2EntityEditor.js","webpack://TerminusDashboard/./src/html/table/SimpleTable.js","webpack://TerminusDashboard/./src/html/graph/SimpleGraph.js","webpack://TerminusDashboard/./src/html/graph/GraphResultsViewer.js","webpack://TerminusDashboard/./src/html/stream/SimpleStream.js","webpack://TerminusDashboard/./src/html/chooser/SimpleChooser.js","webpack://TerminusDashboard/./src/html/DocumentPane.js","webpack://TerminusDashboard/./src/html/document/SimpleFrameViewer.js","webpack://TerminusDashboard/./src/TerminusQuery.js","webpack://TerminusDashboard/./src/html/ScriptPane.js","webpack://TerminusDashboard/./src/TerminusSchema.js","webpack://TerminusDashboard/./src/TerminusServer.js","webpack://TerminusDashboard/./src/plugins/datatables.terminus.js","webpack://TerminusDashboard/./src/TerminusURL.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","TerminusClient","require","HTMLHelper","view","icon","document","createElement","setAttribute","control","type","options","selected","callback","sel","length","opt","label","createTextNode","UTILS","labelFromURL","appendChild","addEventListener","this","which","renderer","viewsDOM","setMode","getActionControl","isNew","cancel","url","window","location","href","loc","split","sh","getShorthand","bits","htmlid","prop","wrap","text","max_cell_size","max_word_size","substring","replacements","words","word","newstr","k","replace","varname","lastIndexOf","obj","scope","frame","orientation","hfeatures","features","display_options","hidden","framedom","getFrameHolderDOM","header","hd","getFrameHeaderDOM","header_style","getFrameBodyDOM","pcls","sp","css","parent","subjectClass","subject","hid","hash","index","idm","objDOM","vholder","charCodeAt","feature","args","rend","val","getInfoboxDOM","sum","getSummary","status","lab","getLabel","getComment","isClassChoice","getClassChoiceTypeSelector","range","getType","disabled","cardControlAllows","show_disabled_buttons","clone","reset","isUpdated","show","save","getViewEntryDOM","getCardinalityDOM","getAddDOM","viewers","mpropDOM","currentViewer","getSelectionControl","viewer","setViewer","viewables","getFilledPropertyList","unshift","add","goToEntry","restriction","getRestriction","min","max","help","cs","getAvailableClassChoices","mlabDOM","cls","changeClass","addClass","addables","getMissingPropertyList","addNewProperty","addNewValue","input","infoDOM","linfo","headerStyle","lval","removePrefixes","bodyStyle","style","dpropDOM","tag","button","title","node","hasChildNodes","removeChild","childNodes","scriptid","src","existingScript","getElementById","script","body","onload","id","cssid","link","rel","parentNode","WOQLClient","ConnectionCapabilities","ConnectionConfig","IDParser","ErrorMessage","WOQLResult","WOQLRule","FrameRule","View","DocumentFrame","WOQLGraph","WOQLTable","WOQLChooser","WOQLChart","WOQLStream","WOQL","Utils","rdf","rdfs","xsd","owl","tcs","xdd","v","terminus","vio","payload","encodeURIComponent","payloadArr","keys","keyElement","valueElement","push","join","prefix","standard_urls","Math","random","toString","Date","getTime","pref","full","ida","idb","unshorten","sha","shb","prefixes","validURL","str","nurl","urlFragment","charAt","toUpperCase","slice","urlStr","baseUrl","urlFirst","urlTmp","ext","vars","nvars","addNamespaceToVariable","mvar","removeNamespaceFromVariable","row","rad","TypeHelper","isStringType","stype","isDatatype","shorten","numberWithCommas","separator","parts","datatypes","parseRangeValue","dividor","vals","indexOf","DateHelper","parseXsdTime","tz","extractXsdTimezone","hour","minute","second","timezone","parseXsdDate","year","parsed","abs","month","parseInt","day","parseDate","ty","parseXsdDateTime","addXsdPadding","nparsed","xsdFromParsed","xparsed","ret","convertTimestampToXsd","a","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","datetime","ptime","isBuffer","isArray","isObject","isFunction","forEach","fn","isArrayBuffer","isFormData","FormData","isArrayBufferView","ArrayBuffer","isView","buffer","isString","isNumber","isUndefined","isDate","isFile","isBlob","isStream","pipe","isURLSearchParams","URLSearchParams","isStandardBrowserEnv","navigator","product","merge","result","assignValue","arguments","deepMerge","extend","b","thisArg","trim","Codemirror","readFile","file","XMLHttpRequest","xmlhttp","ActiveXObject","open","send","xmlDoc","responseText","getFunctionSignature","sigs","spec","descr","server_url","description","database_url","details","format","editmode","document_url","fail_on_id_denied","woql","class","term","source","target","getHeaderDom","h","innerHTML","getButton","getInfoAlertDom","msg","ald","txt","getResponse","currForm","action","response","terminator","rd","br","data","JSON","stringify","pre","stylizeCodeDisplay","showHttpResult","retHttpHeaders","headers","hdres","json","then","deleteStylizedEditor","ui","qip","pluginAvailable","cm","nextElementSibling","removeChildren","stylizeEditor","cmConfig","ar","colorizeTextArea","updateTextArea","dom","pr","colorizePre","removeSelectedNavClass","el","getElementsByClassName","classList","remove","setSelectedSubMenu","setSelected","className","par","parentElement","contains","tolggleContent","content","display","activateSelectedNav","nav","hideDocumentSubMenus","checkDocumentSubMenus","showControl","toggleVisibility","extractValueFromCell","cellValue","DOMParser","parseFromString","firstChild","displayDocumentSubMenus","showSubMenus","checkForMandatoryId","objId","background","getCurrentWoqlQueryObject","query","settings","qval","limit","pageLength","start","elementMetadata","classMetadata","getEverything","getAllDocuments","documentMetadata","and","quad","sub","propertyMetadata","console","log","trimValue","getqObjFromInput","q","qObj","eval","e","TerminusRule","pattern","WOQLPattern","TerminusPattern","constructor","setVariables","variables","addNamespacesToVariables","current_variable","varlist","edge","vs","rownum","in","list","constraints","filter","tester","matchRow","rules","matches","rule","matchCell","matchColumn","matchNode","nid","matchPair","keya","keyb","matchEdge","prettyPrint","literal","unpack","numberMatch","testVariableConstraints","testBasics","testVariableConstraint","testValue","setPattern","ViewConfig","WOQLViewRule","render","func","view_render","view_renderer","getRulesJSON","jr","getBasicJSON","loadBasicJSON","getBasicprettyPrint","color","size","border","click","hover","mjson","onClick","onHover","FramePattern","testRules","onmatch","matched_rules","patternMatchesFrame","checkFrame","frame_type","depth","children","kid","rtype","getRendererType","illegalRuleType","checkFrameType","checkLabel","checkSubject","checkSubjectClass","checkProperty","checkDepth","checkRange","checkValue","checkType","checkLiteral","checkParent","checkChildren","checkIndex","checkStatus","frameType","kids","rsubj","IDsMatch","found","properties","j","values","propertyIDsMatch","Array","isDatatypeProperty","valuesMatch","rangeIDsMatch","rcls","classIDsMatch","ftype","Error","stringMatch","isProperty","isData","renderer_type","getErrorAsMessage","api","err","formatErrorMessage","method","nmsg","getAPIErrorMessage","getAccessDeniedMessage","accessDenied","db","server","getInvalidURIMessage","parseAPIError","error","redirected","QueryPane","DocumentPane","TerminusViewer","client","getDocumentPane","docid","docConfig","docPaneConfig","dp","defaultPaneView","getDocument","docJSON","getNewDocumentPane","getQueryPane","resultConfigs","results","resultPaneConfigs","queryPaneConfig","qp","defaultQueryView","rpc","defaultResultView","addView","getResult","resultConfig","TerminusCodeSnippet","language","width","height","placeholder","formats","snippet","setQuery","refreshContents","serialise","undefined","parseText","nw","parse","loadConfig","getInputElement","readInput","getAsDOM","with_buttons","scont","snpc","getFormatButtons","serial","ssb","actbtn","getSubmitButton","changeRuleView","nview","submit","getIconsDOM","bsp","view_types","isp","self","cursor","f","btn","qobj","alert","removeCodeMirror","nextSibling","removeElement","stylizeSnippet","freeze","CONNECT","GET_SCHEMA","UPDATE_SCHEMA","UPDATE_DOCUMENT","CLASS_FRAME","WOQL_SELECT","GET_DOCUMENT","DELETE_DATABASE","DELETE_DOCUMENT","CREATE_DATABASE","CREATE_DOCUMENT","WOQL_UPDATE","TerminusPluginManager","preloaded","loaded","loading","precluded","plugins","css_base","js","requires","setPluginOptions","opts","init","calculatePreloaded","toload","calculateRequiredInitPlugins","loadPlugins","pins","pid","getDefaultPlugins","needed_pins","loading_order","getAvailablePlugins","pl","plugin","version_check","pluginmeta","version","jQuery","slider","Quill","JSONEditor","CodeMirror","fontAwesomeCheck","dataTable","select2","google","maps","ol","Map","d3","element","span","insertBefore","getComputedStyle","getPropertyValue","ticker","cback","loadPlugin","pug","loadDynamicCSS","scripts","sid","splice","loadDynamicScript","loadPluginScripts","loadPageCSS","cssfid","cssdom","cssurl","pluginLoadable","pluginLoadedOrLoading","getPluginDOM","plugid","cl","cbox","checked","clab","togglePlugin","redraw","unloadPlugin","drawPlugins","num","dm","clh","showPlugins","apply","utils","encode","params","paramsSerializer","serializedParams","toISOString","hashmarkIndex","__CANCEL__","normalizeHeaderName","DEFAULT_CONTENT_TYPE","setContentTypeIfUnset","adapter","defaults","process","transformRequest","transformResponse","timeout","xsrfCookieName","xsrfHeaderName","maxContentLength","validateStatus","common","settle","buildURL","parseHeaders","isURLSameOrigin","createError","config","Promise","resolve","reject","requestData","requestHeaders","request","auth","username","password","Authorization","btoa","onreadystatechange","readyState","responseURL","responseHeaders","getAllResponseHeaders","responseType","statusText","onabort","onerror","ontimeout","cookies","xsrfValue","withCredentials","read","toLowerCase","setRequestHeader","onDownloadProgress","onUploadProgress","upload","cancelToken","promise","abort","enhanceError","message","code","config1","config2","Cancel","CONST","connectionConfig","connection","setClientKey","getClientKey","serverURL","curl","addConnection","capabilities","capabilitiesKeys","pred","auths","actions","actionsArr","map","item","nrec","serverConnected","getServerRecord","srvr","connectionObj","okeys","oid","getDBRecord","dbid","dbCapabilityID","getServerDBRecords","dbrecs","removeDB","dbidCap","capabilitiesPermit","rec","newParams","setServer","setDB","doc","setDocument","include_key","inputStr","context","parser","parseServerURL","parseDBID","dbURL","setSchemaURL","parseSchemaURL","schemaURL","setQueryURL","parseQueryURL","queryURL","setClassFrameURL","parseClassFrameURL","frameURL","parseDocumentURL","docURL","includeKey","setContext","validPrefixedURL","expandPrefixed","validIDString","stripOptionalPath","bit","bindings","no_compress","compress","getContext","nprop","nval","hasBindings","count","getBindings","getVariableList","first","last","next","res","prev","sort","asc_or_desc","compareValues","WOQLQuery","chain_ended","contains_update","paging_transitive_properties","vocab","loadDefaultVocabulary","tripleBuilder","nspaces","spaces","TripleBuilder","g","when","Query","Update","from","dburl","into","select","or","queries","not","triple","isa","eq","delete","JSON_or_IRI","delete_triple","S","P","O","delete_quad","G","add_triple","add_quad","cols","as","vari","remote","order_by","gvarlist","asc","varlist_or_var","desc","group_by","groupedvar","groupquery","output","update","Q","concat","lower","u","pad","len","unique","idgen","typecast","vara","varb","cast","re","test","less","v1","v2","greater","arith","plus","minus","times","divide","exp","div","comment","arg","var1","star","add_class","classid","graph","add_property","propid","delete_class","delete_property","nodeid","insert","Node","Type","Graph","cleanType","doctype","arr1","arr2","buildAsClauses","clauses","va","vb","ordering","advanceCursor","sq","nlist","nvalue","upd","nquery","cleanSubject","cleanPredicate","cleanObject","chainable","cleanGraph","cleanClass","last_index","abstract","lastUpdate","Subject","Predicate","Object_or_Literal","chainableUpdate","adding_class","asArray","card","cardinality","domain","addPO","lang","pn","entity","relationship","nwoql","GraphIRI","Subj","Pred","Obj","concreteDocumentClasses","getDataOfClass","chosen","getDataOfProperty","documentProperties","getDocumentConnections","getAllDocumentConnections","getInstanceMeta","simpleGraphQuery","loadVocabulary","execute","spl","setVocabulary","getVocabulary","getLimit","getPagingProperty","setLimit","setPagingProperty","isPaged","getPage","psize","hasStart","getStart","setPage","pagenum","pstart","setStart","addStart","nextPage","firstPage","previousPage","npage","setPageSize","hasSelect","getSelectVariables","nq","defaultContext","DB_IRI","def","scm","subj","pageprop","nc","indent","show_context","fluent","newlining_operators","operator","getWOQLPrelude","isChainable","uncleanArguments","hasShortcut","inline","lastArg","getShortcut","argIsSubQuery","myas","lhs","rhs","uncleanArgument","allArgs","unclean","cstr","oval","uncleanObjectArgument","nstr","part","suff","printLine","ttype","evstr","unit","addEntry","getO","clause","os","od","cardcls","tb","tf","njson","dt","constraint","vundertest","arr","nonstring","compareIDs","vala","valb","RegExp","Config","WOQLTableConfig","WOQLTableRule","conf","column_order","pagesize","pager","page","changesize","loadJSON","nr","x","trenderer","order","show_pager","change_pagesize","show_pagesize","show_pagenumber","column","hdr","DataValue","datavalue","datatype","setResult","canAdvancePage","canChangePage","canRetreatPage","getPageSize","getColumnsToRender","hasColumnOrder","getColumnOrder","col","getColumnHeaderContents","colid","hr","nresult","notify","hasDefinedEvent","getDefinedEvent","getRowClick","getCellClick","getRowHover","getCellHover","hasCellClick","hasRowClick","hasCellHover","hasRowHover","getRenderer","getSpecificRender","getRendererForDatatype","createRenderer","renderValue","dv","WOQLChooserConfig","WOQLChooserRule","getBasicPrettyPrint","change","show_empty","labels","titles","direction","onChange","value_variable","label_variable","title_variable","sort_variable","sort_direction","set","ch","choices","rows","includeRow","rowToChoice","choice","getRowID","getLabelFromBinding","getTitleFromBinding","getSelectedFromBinding","rval","getSpecialRenderer","renderSpecial","setRenderer","WOQLGraphConfig","WOQLGraphRule","literals","show_literals","source_variable","fontfamily","fontfam","show_force","force","fix_nodes","fixed","explode_out","explode","selected_grows","bigsel","gwidth","gheight","edges","nedges","show_edges","estrs","charge","collisionRadius","arrow","distance","symmetric","weight","w","nodes","calculateVariableTypes","extractFromBinding","combineEdges","combineNodes","lits","includeNode","includeLiteralNode","genBNID","getLiteralOwner","addAdornedNode","addAdornedEdge","createEdgesFromIDs","ndid","ks","kt","radius","getConfigValue","nodetype","es","getEdges","nnodes","nodes_referenced_by_edges","fedges","k2","getNodes","WOQLChartConfig","WOQLChartRule","margin","layout","_title","_description","_layout","marginObj","_margin","xAxis","woqlRule","bar","line","point","area","legendType","fill","stroke","strokeWidth","dot","isVisible","labelRotate","angle","axisDomain","domainArr","barSize","WOQLStreamConfig","WOQLStreamRule","wqt","template","mtemplate","wqrs","FrameConfig","DocumentRule","load_schema","json_rules","get_schema","show_all","all","show_parts","fp","setFrameDisplayOptions","showDisabledButtons","collapse","setFrameFeatures","headerFeatures","header_features","showEmpty","dataviewer","setFrameArgs","existing","fresh","got","fkey","rep","props","compare","hf","feats","applyFeatureProperty","nfeats","nfeat","unpackFeatures","extensions","fstr","fid","ObjectFrame","FrameHelper","load","loadComplete","loadDocument","loadSchema","encoding","loadDataFrames","ncls","getClassFrame","loadSchemaFrames","loadDocumentSchema","clsid","dataframes","classframes","loadClassFrames","subjid","newDoc","fillFromSchema","applyRules","mymatch","HTMLStringViewer","HTMLStringEditor","HTMLBooleanViewer","HTMLBooleanEditor","HTMLChoiceViewer","HTMLChoiceEditor","HTMLCoordinateViewer","HTMLCoordinateEditor","HTMLDateViewer","HTMLDateEditor","HTMLEntityViewer","HTMLEntityEditor","HTMLImageViewer","HTMLImageEditor","HTMLLinkViewer","HTMLNumberViewer","HTMLRangeViewer","HTMLRangeEditor","GoogleMapEditor","GoogleMapViewer","HTMLMarkupEditor","S2EntityEditor","initialiseDataRenderers","RenderingMap","registerViewerForTypes","registerEditorForTypes","hevopts","universalEditor","universalViewer","addPlugins","createDataRenderer","registerEditorForFrameType","HTMLDateHelper","months","getMonthName","GoogleMapHelper","polygon","polyline","markers","mapLat","mapLong","zoom","opacity","destroy","clear","translatePolygonToArray","vertices","getPath","seenValue","getLength","xy","getAt","lat","lng","translateArrayToPolygon","array","jsonified","latlong","createPolygon","coords","Polygon","paths","strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","setMap","createPolyline","Polyline","clearMarkers","addMarker","position","marker","Marker","addListener","getCoordsFromMarkers","initMap","mapContainer","center","parseFloat","setPath","event","trigger","DatatypeRenderers","registeredDataViewers","registeredDataEditors","defaultViewers","defaultEditors","specials","editor","getValidDataViewerList","valids","getValidDataEditorList","nftypes","getEditorForDataFrame","getViewerForDataFrame","record","types","getEditor","TerminusViolations","vios","nvios","TerminusViolation","context_msg","vdom","vioHeading","getPropertyAsDOM","pdom","ldom","mval","TerminusUI","ApiExplorer","TerminusDBsdk","TerminusQueryViewer","TerminusSchemaViewer","TerminusServersdk","TerminusURLLoader","controls","setOptions","connect","showBusy","clearBusy","connectToDB","showView","showDocumentPage","schema","showSchemaPage","showQueryPage","explorer","showExplorer","showDBMainPage","showServerMainPage","showError","createDatabase","dbdets","getBadArguments","dbdoc","generateNewDatabaseDocument","refreshDBList","crec","getCrashString","showMessage","deleteDatabase","delrec","lid","dbn","dets","fname","getConnectionEndpoint","clearServer","addURLPrefix","clearDB","TerminusServerViewer","redrawMainPage","showCollaboratePage","showLoadURLPage","TerminusDBViewer","showCreateDBPage","TerminusDBCreator","durl","showCreateDocument","TerminusDocumentViewer","getDocCreatorOptions","loadCreateDocument","mainDOM","deleteDBPermitted","getDeleteDBButton","confirm","showResult","showWarning","clearMessages","messages","clearMainPage","main","setMessageDOM","setbuttonControls","buttons","setControllerDOM","controller","setExplorerDOM","setPluginsDOM","setViewerDOM","draw","comps","slocation","redrawControls","toggleDashboardWidget","widget","toggleControl","drawControls","loadControls","ncontrol","nd","drawExplorer","ae","sc","TerminusServerController","TerminusDBController","show_controls","pseudoCapability","show_views","busy","getBusyLoader","bsyDom","pd","pbc","pbsa","pbia","md","msgHolder","showViolations","cmsg","views","document_options","schema_options","piman","getDocViewerOptions","getClassFrameOptions","viewdoc_options","apiNavConfig","mainNav","navText","defaultSelected","database","subNav","getSchema","updateSchema","getClassFrames","viewDocument","createDocument","updateDocument","deleteDocument","use_fetch","return_full_response","pman","aec","getApiNav","getApiExplorerDom","setSelectedNavMenu","navOnSelect","createNavs","navConfig","ul","navDom","cont","apiCont","getConnectExplorer","getDatabaseExplorer","getSchemaApi","getDocumentApi","getQueryApi","changeSubApiDom","curSubMenu","getDatabaseDom","getShowApiDom","getQueryApiDom","subNavOnSelect","subMenuConfig","createSubNavs","getSignature","getForm","getServerForm","form","fd","inpLabel","cd","inpId","keyLabel","resd","gatherips","curApi","urlPlaceholder","formDoc","urlLabel","inpUrl","docUrlLabel","inpDocUrl","inpKey","docLabel","inpDoc","inp","docUrl","getApiSendButton","getApiForm","enc","schurl","buttonSelf","connected_mode","gtxtar","txtar","dcurl","schemaUrlDom","htmlEditor","getValue","sg","ic","sig","DispatchRequest","URIError","dispatch","makeDocumentConsistentWithURL","addOptionsToDocument","docurl","qurl","addOptionsToWOQL","cfurl","pdoc","_","addKeyToPayload","dispatchFetch","redirect","referrer","hdrs","URIEncodePayload","cache","Headers","fetch","ok","axios","btoaImplementation","Buffer","catch","post","base64","ieee754","kMaxLength","TYPED_ARRAY_SUPPORT","createBuffer","that","RangeError","Uint8Array","__proto__","encodingOrOffset","allocUnsafe","TypeError","byteOffset","byteLength","fromArrayLike","fromArrayBuffer","string","isEncoding","actual","write","fromString","copy","fromObject","assertSize","loweredCase","utf8ToBytes","base64ToBytes","slowToString","end","hexSlice","utf8Slice","asciiSlice","latin1Slice","base64Slice","utf16leSlice","swap","bidirectionalIndexOf","dir","isNaN","arrayIndexOf","indexSize","arrLength","valLength","String","buf","readUInt16BE","foundIndex","hexWrite","offset","Number","remaining","strLen","substr","utf8Write","blitBuffer","asciiWrite","byteArray","asciiToBytes","latin1Write","base64Write","ucs2Write","units","hi","lo","utf16leToBytes","fromByteArray","secondByte","thirdByte","fourthByte","tempCodePoint","firstByte","codePoint","bytesPerSequence","codePoints","MAX_ARGUMENTS_LENGTH","fromCharCode","decodeCodePointsArray","SlowBuffer","alloc","INSPECT_MAX_BYTES","global","foo","subarray","typedArraySupport","poolSize","_augment","species","configurable","allocUnsafeSlow","_isBuffer","y","pos","swap16","swap32","swap64","equals","inspect","match","thisStart","thisEnd","thisCopy","targetCopy","includes","isFinite","toJSON","_arr","out","toHex","bytes","checkOffset","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","writeDouble","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt8","readUInt16LE","readUInt32LE","readUInt32BE","readIntLE","pow","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","writeUIntBE","writeUInt8","floor","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","INVALID_BASE64_RE","Infinity","leadSurrogate","toByteArray","stringtrim","base64clean","dst","Function","b64","lens","getLens","validLen","placeHoldersLen","tmp","Arr","_byteLength","curByte","revLookup","uint8","extraBytes","len2","encodeChunk","lookup","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","rt","LN2","Axios","mergeConfig","createInstance","defaultConfig","instance","instanceConfig","CancelToken","isCancel","promises","spread","default","InterceptorManager","dispatchRequest","interceptors","chain","interceptor","fulfilled","rejected","shift","getUri","handlers","use","eject","transformData","isAbsoluteURL","combineURLs","throwIfCancellationRequested","throwIfRequested","baseURL","reason","fns","normalizedName","isAxiosError","number","fileName","lineNumber","columnNumber","stack","ignoreDuplicateOf","originURL","msie","userAgent","urlParsingNode","resolveURL","protocol","host","search","hostname","port","pathname","requestURL","expires","path","secure","cookie","toGMTString","decodeURIComponent","now","relativeURL","executor","resolvePromise","token","table","chooser","chart","stream","parentframe","empty","originalFrames","PropertyFrame","cframe","predicate","DataFrame","ClassFrame","Restriction","loadRestriction","jsonld_context","cf","isValid","hasSchema","frames","domainValue","getPropertyClassFrame","getChosenClassFrame","isLogic","getChosenFrame","addFrame","getAsFrame","ff","getAsFrames","restrictions","getProperties","filled","missing","nmissing","newb","newid","pf","cloned","getChild","childid","pframe","getProperty","addProperty","ndata","createEmpty","createEmptyChoice","clss","getClassChoices","addValueFrame","addPropertyValue","addValue","removeProperty","removePropertyValue","removeValue","extract","extracts","extracted","extractJSONLD","parentObject","root","renderProperties","sortProperties","nprops","unsorted","standardCompare","hasRestriction","rest","currentnum","propcount","long","df","oframe","nframe","updated","childUpdated","hasCardinalityRestriction","deletePropertyValue","gets","cvalues","fs","renderValues","sortedVals","sortValues","rangeValue","originalValue","nrend","setNew","isValidType","hasCardRestriction","isObjectProperty","isRestriction","isDocument","isChoice","getStdURL","getChoiceOptions","elements","option","getTypeShorthand","contents","normalizer","objlit","loadFromObjectFrame","child","getChosenClassFrames","objframe","operands","dataframe","cloneDataFrame","other","domcls","operand","maxCardinality","minCardinality","nrest","textdom","objectIsEmpty","darkMode","jsonldCheck","dimensions","fromTextArea","firstLineNumber","lineNumbers","styleActiveLine","lineWrapping","smartIndent","indentWithTabs","newlineAndIndent","autoCloseBrackets","matchBrackets","afterCursor","extraKeys","foldCode","getCursor","refresh","foldGutter","gutters","Pos","setCodemirrorSize","defaultCharWidth","setOption","setSize","setTimeout","on","runMode","innerText","theme","tv","container","pages","getDatabaseDocumentConfig","property_style","label_style","value_style","getDocumentsQueryPane","docs","docClasses","getCreateDataPaneConfig","showQuery","editQuery","getCreateDocumentConfig","getShowDocumentConfig","getDocumentsGraphConfig","showDocumentGraph","insertDOM","dloader","getLoaderDOM","graph_query_pane","showDocumentConnections","targetDOM","introdom","intro","createFullDocumentPane","result_options","dpoptions","q2","result2","bdom","getBodyAsDOM","getDocumentsDOM","getHomeDOM","showHappyBox","mydb","insertDocument","dchooser","getCreateDataChooser","delw","getDeleteDatabaseWidget","mactions","getDocumentsMenu","tableDOM","graphDOM","document_table","dcDOM","getNavigationDOM","dx","loadCreateDocumentPage","documentLoader","getShowDocumentControl","setClassLoader","page_actions","show_doc_action","tgtd","getToggleGraphTableDOM","redrawDocumentPage","docview","tisp","gisp","ticon","gicon","hov","del","di","icss","dbrec","dbdel","delbut","styleCreateDocumentChooser","pholder","happy","hbox","sets","nm","ispan","htit","pp","pop","nuke","scd","dcip","nbut","is","preventDefault","keyCode","sct","mfd","dht","sci","slab","idip","titip","descip","butfield","cancbut","loadbut","dbc","stopPropagation","getControlHTML","ResultPane","showConfig","editConfig","repl","updateResult","fireDefaultQueries","qcres","classMetaDataRes","qpres","propertyMetaDataRes","showHeader","addViews","getSection","sName","clearSubMenus","smenus","getResults","sampleQueryDOM","AddEvents","aval","choosen","getQueryMenu","qName","getSubDataMenu","getSchemaSection","section","checkIfDataMenuOpen","isOpen","showDataOfTypeEvent","subPar","showPropertyOfTypeEvent","addCheveronIcon","getDataSection","bd","fireDocumentEvent","getEnterDocumentIdDOM","getDocumentSection","getQueryMenuBlock","getSampleQueriesDOM","showQueryConfig","configspan","ipdom","qicon","sqd","hideQueryConfig","querySnippet","createInput","showingQuery","resultDOM","getAddViewControl","getResultPaneHeader","closable","savePaneButton","closePaneButton","collapsePaneButton","submitQuery","updateQuery","refreshViews","nrp","showNoBindings","nor","delta","vd","newView","selector","nv","Datatypes","SimpleTable","SimpleGraph","SimpleStream","SimpleChooser","querypane","changeViewType","renderers","getResultDOM","getViewConfigIconClass","cvicons","getViewTypeIconDOM","prepend","getDefaultViewerIcon","getIconForViewer","changeViewerType","updateView","wres","html_renderer","show_types","renderFrame","wrapShortenedText","big","isBigType","getTypeSize","vallab","elt","foptions","inputs","parseValue","lldom","getInputDOMs","latdom","longdom","getLatLongDOM","firstcol","updateValueFromForm","op","lldoms","butspan","addbut","ipdoms","allowbce","date_spacer","time_spacer","datetime_separator","helper","datepart","getDateComponentDOM","timepart","getTimeComponentDOM","hdom","mdom","mlab","sdom","dadom","ydom","ddom","tdom","opdom","onclick","holder","showValue","getEntityViewHTML","internalLink","getController","getEntityLabel","nspan","il","getVariableValueFromBinding","tit","img","commas","delimiter","rvals","svals","useCommas","tnode","getRangeSymbolDOM","x2","t2node","data1","data2","firstip","secondip","showing_range","but","changeHandler","mapcontainer","ghelper","latLng","coo","inner","quill","ctl","getClient","d2ch","TerminusDocumentChooser","woqltable","ctls","getControlsDOM","tab","getTableDOM","ctrls","paging","getPaging","columns","thead","getTableHeader","tbody","getTableBody","thr","th","getColumnHeader","tr","getHTMLRow","td","getCell","rc","getCellData","psdom","getFirst","getPrev","getPageNumber","getNext","showPaging","chunk","clabel","pval","GraphResultsViewer","wgraph","getGraphDOM","gviz","gdom","setData","initDOM","svg","visid","chars","randomString","currentDate","link_elements","node_elements","loadedNodes","focusNodes","links","selected_id","setConfigOptions","initD3","d3DOM","loadNewData","updateGraph","updateSimulation","dqr","updateData","setFocusNodeFromResult","reload","getFocusNode","setFilter","simulation","stop","wake","hibernate","no_animate","getNodesAndFringes","snode","nnode","fx","fy","getLinks","scale_factor","setWidth","setHeight","clientWidth","clientHeight","jqid","append","attr","forceSimulation","forceLink","getLinkDistance","forceManyBody","strength","getCharge","forceCollide","getCollisionRadius","forceCenter","drag_drop","drag","restart","zoomed","link_group","classed","node_group","current_transform","transform","follow_node_wrapper","graph_node","nodeSelected","selectAll","exit","node_enter","enter","getRadius","isFringe","getNodeIconUnicode","styleNodeElements","link_enter","styleLinkElements","alpha","each","getNodeColour","getNodeText","getNodeIconWeight","getNodeIconSize","getNodeIconColour","getLineWidth","getEdgeArrow","getEdgeColour","getLinkText","getEdgeDirection","reference","getArrowWidth","getArrowHeight","selected_node","selection_grows","getScaleTransform","scale","min_ratio","new_mol_width","new_mol_height","y_trans","x_trans","transition","duration","scaleToFit","min_x","min_y","max_x","max_y","mol_width","mol_height","width_ratio","height_ratio","recentre","translated","dcx","dcy","text_elements","unicode","faclass","getMultiplier","mult","colrad","linkDistance","getNodeIcon","isNeighbourLink","added","upgraded","ccdom","ccsel","getEmptyOption","createOptionFromChoice","SimpleFrameViewer","owner","filterFrame","loadRenderer","fframe","loadClass","cloader","classLoader","queryPane","pane","showDocConfig","ndom","hideDocConfig","showingConfig","renderResult","fpt","rendname","termframe","evalstr","applyRulesToDocument","tdv","setDatatypes","getScope","setDatatypeViewers","getDatatypeViewer","getFeaturesDOM","orient","getFrameDOM","replaceWith","flist","featuresToCSS","getFeatureDOM","ScriptPane","panes","new_pane","new_pane_type","meta","newPaneOptions","defaultResultOptions","getNewQueryPane","addQueryPane","qpane","addScriptPane","addScriptPaneDOM","addNewPaneDOM","addQueryPaneDOM","setNewDocumentPaneDOM","qdom","qhdr","getPaneHeader","paneDOM","getPanesDOM","controlDOM","newPaneButton","panesDOM","npd","nqhdr","getNewPaneHeader","headerDOM","removePane","showPane","hidePane","isnew","newScriptButton","newDocButton","executeScript","showOKMessage","confirm_before_update","classes","views_dom","current_view","retrieveViews","getClassesPane","getPropertiesPane","refreshPanes","getOWLView","controldom","getTabsDOM","pagedom","owldom","updateOWLContents","getSchemaEditButton","getSchemaViewDOM","getSchemaSaveButtons","getSchemaEditDOM","getTabDOM","switchView","toggleTabs","msgtype","getCancelButton","getSaveButton","is_import","getSchemaButton","schema_edit_dom","schema_edit_dom_name","np","getSchemaNameInputDOM","ipval","Datatables","rsc","getServerLabelDOM","srec","getServerDetailsDOM","csbut","crbut","getDBListDOM","scl","wrapTableLinkCell","tdElement","sec","th1","th2","th3","th4","th5","th6","fullid","td1","td2","td3","td4","td5","td6","CspDatatables","wResViewer","qPage","wrViewer","wQuery","currDTSettings","convertToDatatable","DataTable","searching","lengthMenu","initComplete","oInstance","$","html","columnDefs","targets","createdRow","find","cell","dbInfo","parents","dbId","dtResult","executeQuery","pageInfo","formatResultsForDatatableDisplay","generateNewQueryOnPageChange","qTextDom","queryMode","getCallbackSettings","dtAPIChangeSettings","_iDisplayLength","_iDisplayStart","iDraw","chosenValue","setUp","dtdom","updateCurrDTSettings","getNewDataOnChange","drawnTab","aSettings","getDataFromServer","serverSide","processing","autoWidth","ajax","entries","scrollX","showDocument","selectDocumentNavBar","url_input","key_input","getLabelDOM","getFormFieldDOM","ip","ltxt","loadbuts"],"mappings":"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","file":"terminus-dashboard.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 44);\n","const TerminusClient = require('@terminusdb/terminus-client');\r\nlet HTMLHelper = {};\r\n\r\nHTMLHelper.getSettingsControl = function(view){\r\n\tvar icon = document.createElement('icon');\r\n\tif(view == 'property') icon.setAttribute('class', 'fa fa-cog terminus-pointer');\r\n\telse if(view == 'data') icon.setAttribute('class', 'fa fa-edit terminus-pointer');\r\n\ticon.setAttribute('style', 'margin: 10px;')\r\n\treturn icon;\r\n}\r\n\r\nHTMLHelper.getControlIcon = function(control){\r\n\tvar icon;\r\n\tswitch(control){\r\n\t\tcase 'delete':\r\n\t\t\ticon = '-alt-delete';\r\n\t\tbreak;\r\n\t\tcase 'add':\r\n\t\t\ticon = '-plus';\r\n\t\tbreak;\r\n\t\tcase 'reset':\r\n\t\t\ticon = '-undo';\r\n\t\tbreak;\r\n\t\tcase 'save':\r\n\t\t\ticon = '-save';\r\n\t\tbreak;\r\n\t\tcase 'hide':\r\n\t\t\ticon = '-eye-slash';\r\n\t\tbreak;\r\n\t}\r\n\treturn icon;\r\n}\r\n\r\nHTMLHelper.getSelectionControl = function(type, options, selected, callback){\r\n\tvar sel = document.createElement(\"select\");\r\n\tsel.setAttribute(\"class\", \"terminus-frame-selector frame-control-selection \" + type);\r\n\tfor(var i = 0; i < options.length; i++){\r\n\t\tvar opt = document.createElement(\"option\");\r\n\t\tif(typeof options[i] == \"object\"){\r\n\t\t\topt.value = options[i].value;\r\n\t\t\tvar label = (options[i].label ?  document.createTextNode(options[i].label) : document.createTextNode(TerminusClient.UTILS.labelFromURL(options[i].value)));\r\n\t\t\topt.appendChild(label);\r\n\t\t}\r\n\t\telse {\r\n\t\t\topt.value = options[i];\r\n\t\t\tlabel = TerminusClient.UTILS.labelFromURL(opt.value);\r\n\t\t\topt.appendChild(document.createTextNode(label));\r\n\t\t}\r\n\t\tif(selected == opt.value){\r\n\t\t\topt.setAttribute(\"selected\", \"selected\");\r\n\t\t}\r\n\t\tsel.appendChild(opt);\r\n\t}\r\n\tsel.addEventListener(\"change\", function(){\r\n\t\tcallback(this.value);\r\n\t});\r\n\treturn sel;\r\n}\r\n\r\nHTMLHelper.getModeSelectorDOM = function(which, renderer){\r\n\tvar viewsDOM = document.createElement(\"span\");\r\n\tviewsDOM.setAttribute(\"class\", \"terminus-mode terminus-\"+which+\"-mode\");\r\n\tif(renderer.mode == \"view\"){\r\n\t\tvar callback = function(){ renderer.setMode(\"edit\");}\r\n\t\tviewsDOM.appendChild(HTMLHelper.getActionControl(\"terminus-mode terminus-\"+which+\"-mode\", \"edit\", \" Edit \", callback));\r\n\t}\r\n\telse if(renderer.isNew()){\r\n\t\treturn false;\r\n\t}\r\n\telse {\r\n\t\tvar callback = function(){ renderer.cancel();}\r\n\t\tviewsDOM.appendChild(HTMLHelper.getActionControl(which, \"cancel\", \"Cancel\", callback));\r\n\t}\r\n\treturn viewsDOM;\r\n}\r\n\r\nHTMLHelper.goToName = function(s, p, i){\r\n\tvar url = window.location.href;\r\n\tif(url){\r\n\t\tvar wbits = url.split(\"#\");\r\n\t\tvar loc = wbits[0];\r\n\t\tvar sh = TerminusClient.UTILS.getShorthand(s);\r\n\t    if(!sh) sh = s;\r\n\t\tvar bits = sh.split(\":\");\r\n\t\tif(bits.length > 1) sh = bits[1];\r\n\t\tvar htmlid = sh;\r\n\t\tif(p){\r\n\t\t\tvar prop = TerminusClient.UTILS.getShorthand(p);\r\n\t\t\tif(!prop ) prop = p;\r\n\t\t\tvar bits = prop.split(\":\");\r\n\t\t\tif(bits.length > 1) prop = bits[1];\r\n\t\t\thtmlid += \"_\" + prop;\r\n\t\t\tif(i){\r\n\t\t\t\thtmlid += \"_\" + i;\r\n\t\t\t}\r\n\t\t}\r\n\t\twindow.location = loc + \"#\" + htmlid;\r\n\t}\r\n}\r\n\r\nHTMLHelper.wrapShortenedText = function(wrap, text, max_cell_size, max_word_size){\r\n\tif(max_cell_size && (text.length > max_cell_size)){\r\n\t\twrap.setAttribute(\"title\", text);\r\n\t\ttext = text.substring(0, max_cell_size) + \"...\";\r\n\t}\r\n\tif(text && text.length > max_word_size){\r\n\t\tconst replacements = {}\r\n\t\tconst words = text.split(\" \");\r\n\t\tfor(var i = 0; i < words.length; i++){\r\n\t\t\tvar word = words[i];\r\n\t\t\tif(word.length > max_word_size){\r\n\t\t\t\twrap.setAttribute(\"title\", text);\r\n\t\t\t\tvar newstr = word.substring(0, max_word_size) + \"...\";\r\n\t\t\t\treplacements[word] = newstr;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(var k in replacements){\r\n\t\t\ttext = text.replace(k, replacements[k]);\r\n\t\t}\r\n\t}\r\n\twrap.appendChild(document.createTextNode(text));\r\n}\r\n\r\nHTMLHelper.getVariableValueFromBinding = function(varname, bind){\r\n\tfor(var key in bind){\r\n\t\tvar skey = key.substring(key.lastIndexOf(\"/\")+1);\r\n\t\tif(skey == varname){\r\n\t\t\tconst obj = bind[key];\r\n\t\t\tif(typeof obj == \"object\" && obj['@value']) return obj['@value'];\r\n\t\t\treturn obj;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n\r\n\r\n/*\r\n * HTML drawing function for document rendering \r\n */\r\n\r\nHTMLHelper.getFrameDOM = function(scope, frame, orientation, hfeatures, features){\r\n\tif(frame.display_options.hidden) return false;\r\n\tvar framedom = HTMLHelper.getFrameHolderDOM(scope, frame, orientation);\r\n\tif(typeof frame.display_options.header == \"function\"){\r\n\t\tvar hd = frame.display_options.header(hfeatures);\r\n\t\tframedom.appendChild(hd);\r\n\t}\r\n\telse {\r\n\t\tvar hd = HTMLHelper.getFrameHeaderDOM(scope, frame, orientation, hfeatures);\r\n\t\tif(typeof frame.display_options.header_style != \"undefined\"){\r\n\t\t\thd.setAttribute(\"style\", frame.display_options.header_style);\r\n\t\t}\r\n\t\tframedom.appendChild(hd);\r\n\t}\r\n\tframedom.appendChild(HTMLHelper.getFrameBodyDOM(scope, frame, orientation, features));\r\n\treturn framedom;\r\n}\r\n\r\nHTMLHelper.getFrameHolderDOM = function(scope, frame, orientation){\r\n\tvar pcls = \"terminus-\" + scope + \"-frame\";\r\n\tif(orientation == \"page\"){\r\n\t\tvar sp = document.createElement(\"div\");\r\n\t}\r\n\telse {\r\n\t\tvar sp = document.createElement(\"span\");\r\n\t}\r\n\tvar css = pcls + \" \" + pcls + \"-\" + orientation + \r\n\t\t(scope == \"object\" && frame.parent ? \"\" : \" terminus-root-frame\") \r\n\t\t+ \" \" + pcls + \"-\" + frame.display_options.mode;\r\n\tsp.setAttribute(\"class\", css);\r\n\tif(scope == \"object\"){\r\n\t\tsp.setAttribute(\"data-class\", frame.subjectClass());\r\n\t\tsp.setAttribute(\"data-id\", frame.subject());\t\t\r\n\t\tvar hid = this.hash(frame.subject());\r\n\t}\r\n\telse if(scope == \"property\"){\r\n\t\tsp.setAttribute('data-property', frame.property());\t\r\n\t\tvar hid = this.hash(frame.subject()+frame.property());\r\n\t}\r\n\telse if(scope == \"data\"){\r\n\t\tsp.setAttribute('data-value', frame.get());\r\n\t\tvar hid = this.hash(frame.subject() + frame.property() + frame.index);\r\n\t}\r\n\tvar idm = document.createElement(\"a\");\r\n\tidm.setAttribute(\"class\", \"terminus-\" + scope + \"-idmarker\");\r\n\tidm.setAttribute(\"name\", hid);\t\t\t\t\r\n\tsp.appendChild(idm);\r\n\treturn sp;\r\n}\r\n\r\nHTMLHelper.getFrameHeaderDOM = function(scope, frame, orientation, features){\r\n\tvar css = \"terminus-\" + scope + \"-header\";\r\n\tif(orientation == \"page\"){\r\n\t\tvar objDOM = document.createElement(\"div\");\r\n\t}\r\n\telse {\r\n\t\tvar objDOM = document.createElement(\"span\");\r\n\t}\r\n\tobjDOM.setAttribute(\"class\", css + \" \" + css + \"-\" + orientation);\r\n\tif(features) objDOM.appendChild(features);\r\n\treturn objDOM;\r\n}\r\n\r\nHTMLHelper.getFrameBodyDOM = function(scope, frame, orientation, features){\r\n\tvar css = \"terminus-\" + scope + \"-properties\";\r\n\tif(orientation == \"page\"){\r\n\t\tvar vholder = document.createElement(\"div\");\r\n\t}\r\n\telse {\r\n\t\tvar vholder = document.createElement(\"span\");\r\n\t}\r\n    vholder.setAttribute('class', css + \" \" + css + \"-\" + orientation);\r\n    if(features) vholder.appendChild(features);\r\n    return vholder;\r\n}\r\n\r\nHTMLHelper.hash = function(s) {\r\n\tvar hash = 0, i, chr;\r\n\tif (s.length === 0) return hash;\r\n\tfor (i = 0; i < s.length; i++) {\r\n\t    chr   = s.charCodeAt(i);\r\n\t    hash  = ((hash << 5) - hash) + chr;\r\n\t    hash |= 0; // Convert to 32bit integer\r\n\t}\r\n\treturn hash;\r\n};\r\n\r\nHTMLHelper.getFeatureDOM = function(frame, feature, scope, mode, args, rend){\r\n\r\n\tif(feature == \"id\"){\t\r\n\t\tif(scope == \"object\") var val = frame.subject();\r\n\t\telse if(scope == \"property\") var val = frame.property();\r\n\t\tif(val == \"_:\") var val = \"New Document\";\r\n\t\treturn HTMLHelper.getInfoboxDOM(\"object-id\", \"ID\", val, \"The ID that identifies this document\", mode, args, rend);\r\n\t}\r\n\telse if(feature == \"summary\"){\r\n\t\tvar sum = frame.getSummary();\r\n\t\treturn HTMLHelper.getInfoboxDOM(scope + \"-summary\", false, sum.long, sum.status, mode, args);\r\n\t}\r\n\telse if(feature == \"label\"){\r\n\t\tvar lab = frame.getLabel();\r\n\t\tif(lab){\r\n\t\t\treturn HTMLHelper.getInfoboxDOM(scope + \"-type\", false, lab, false, mode, args);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\telse if(feature == \"status\"){\r\n\t\tvar sum = frame.getSummary();\r\n\t\treturn HTMLHelper.getInfoboxDOM(scope + \"-status-\"+sum.status, false, sum.status, sum.status, mode, args);\r\n\t}\r\n\telse if(feature == \"comment\"){\r\n\t\tvar lab = frame.getComment();\r\n\t\treturn HTMLHelper.getInfoboxDOM(\"property-comment\", false, lab, false, mode, args);\r\n\t}\r\n\telse if(feature == \"type\"){\r\n\t\tif(scope == \"property\" && mode == \"edit\" && frame.parent && frame.parent.isClassChoice() && frame.isNew()){\r\n\t\t\treturn this.getClassChoiceTypeSelector(frame, mode, args);\r\n\t\t}\r\n\t\tif(scope == \"object\") var lab = frame.subjectClass();\r\n\t\telse if(scope == \"property\") var lab = frame.range();\r\n\t\telse if(scope == \"data\") var lab = frame.getType();\r\n\t\tif(lab){\r\n\t\t\treturn HTMLHelper.getInfoboxDOM(scope + \"-type\", \"Type\", lab, false, mode, args);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\telse if(feature == \"delete\"){\r\n\t\tvar callback = function(){frame.delete()};\r\n\t\tvar disabled = false;\r\n\t\tif(!frame.cardControlAllows(\"delete\", scope)){\r\n\t\t\tif(!frame.display_options.show_disabled_buttons){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tdisabled = \"Cardinality rules prevent deleting this element\";\r\n\t\t}\r\n\t\treturn HTMLHelper.getActionControl(scope, \"delete\", \"Delete\", callback, disabled, mode, args);\r\n\t}\r\n\telse if(feature == \"clone\"){\r\n\t\tvar callback = function(){frame.clone()};\r\n\t\tvar disabled = false;\r\n\t\tif(!frame.cardControlAllows(\"clone\", scope)){\r\n\t\t\tif(!frame.display_options.show_disabled_buttons){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tdisabled = \"Cardinality rules prevent cloning this element\";\r\n\t\t}\r\n\t\treturn HTMLHelper.getActionControl(scope, \"clone\", \"Clone\", callback, disabled, mode, args);\r\n\t}\r\n\telse if(feature == \"reset\"){\r\n\t\tvar callback = function(){frame.reset()};\r\n\t\tvar disabled = false;\r\n\t\tif(!frame.isUpdated()){\r\n\t\t\tif(!frame.display_options.show_disabled_buttons){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tdisabled = \"No changes have been made to this element\";\r\n\t\t}\r\n\t\treturn HTMLHelper.getActionControl(scope, \"reset\", \"Reset\", callback, disabled, mode, args);\r\n\t}\r\n\telse if(feature == \"mode\"){\r\n\t\tvar callback = function(){frame.mode(\"edit\")};\r\n\t\treturn HTMLHelper.getActionControl(scope, \"mode\", \"Edit\", callback, mode, args);\r\n\t}\r\n\telse if(feature == \"hide\"){\r\n\t\tvar callback = function(){frame.show()};\r\n\t\treturn HTMLHelper.getActionControl(scope, \"hide\", \"Hide\", callback, mode, args);\r\n\t}\r\n\telse if(feature == \"update\"){\r\n\t\tvar callback = function(){frame.save()};\r\n\t\tif(!frame.isUpdated() && !frame.display_options.show_disabled_buttons, mode, args){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar disabled = frame.isUpdated() ? false : \"No changes have been made to this element\";\r\n\t\treturn HTMLHelper.getActionControl(scope, \"save\", \"Save\", callback, disabled, mode, args);\r\n\t}\r\n\telse if(feature == \"viewer\"){\r\n\t\treturn false;//this.getViewerSelectorDOM(scope, frame, mode, args);\r\n\t}\r\n\telse if(feature == \"view\"){\r\n\t\treturn this.getViewEntryDOM(scope, frame, mode, args);\r\n\t}\r\n\telse if(feature == \"cardinality\"){\r\n\t\treturn this.getCardinalityDOM(scope, frame, mode, args);\r\n\t}\r\n\telse if(feature == \"add\"){\r\n\t\treturn this.getAddDOM(scope, frame, mode, args);\r\n\t}\r\n}\r\n\r\nHTMLHelper.getViewerSelectorDOM = function(scope, frame, mode, args){\r\n\t//var viewers = frame.datatypes.getAvailableViewers();\r\n\t//var r = frame.datatypes.getRenderer(t);\r\n\r\n\tif(viewers && viewers.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-\" + scope + \"-viewer\");\r\n\t\tvar callback = function(viewer){\r\n\t\t\tif(viewer){\r\n\t\t\t\tframe.setViewer(viewer);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar selected = frame.currentViewer();\r\n\t\tvar sel = HTMLHelper.getSelectionControl(scope + '-viewer', viewers, selected, callback, mode, args);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n\r\n/* needs html viewer context for goto */\r\nHTMLHelper.getViewEntryDOM = function(scope, frame, mode, args){\r\n\tif(scope == \"object\"){\r\n\t\tvar viewables = frame.getFilledPropertyList();\r\n\t}\r\n\telse if(scope == \"property\"){\r\n\t\t\r\n\t}\r\n\tvar self = this;\r\n\tif(viewables && viewables.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-\"+scope + \"-view-entry\");\r\n\t\tviewables.unshift({ value: \"\", label: \"View \" + scope});\r\n\t\tvar callback = function(add){\r\n\t\t\tif(add){\r\n\t\t\t\tframe.goToEntry(add);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar sel = HTMLHelper.getSelectionControl(scope + \"-view-entry\", viewables, \"\", callback, mode, args);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n\t\r\n}\r\n\r\nHTMLHelper.getCardinalityDOM = function(scope, frame, mode, args){\r\n\tvar restriction = frame.getRestriction();\r\n\tif(restriction.min && restriction.max){\r\n\t\tif(restriction.min == restriction.max){\r\n\t\t\tvar lab = restriction.min;\r\n\t\t\tvar help = \"Cardinality: \" + restriction.min;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar lab = restriction.min + \"-\" + restriction.max;\r\n\t\t\tvar help = \"Minimum Cardinality: \" + restriction.min;\r\n\t\t\thelp += \", Maximum Cardinality: \" + restriction.max;\r\n\t\t}\r\n\t}\r\n\telse if(restriction.min){\r\n\t\tvar lab = \">\"+(restriction.min-1);\r\n\t\tvar help = \"Minimum Cardinality: \" + restriction.min;\r\n\t}\r\n\telse if(restriction.max){\r\n\t\tvar lab = \"<\"+(restriction.max+1);\r\n\t\tvar help = \"Maximum Cardinality: \" + restriction.max;\r\n\t}\r\n\telse {\r\n\t\treturn false;\r\n\t}\r\n\treturn HTMLHelper.getInfoboxDOM(\"property-cardinality\", \"Cardinality\", lab, help, mode, args);\r\n}\r\n\r\nHTMLHelper.getClassChoiceTypeSelector = function(frame, mode, args){\r\n\tvar cs = frame.parent.getAvailableClassChoices();\r\n\tif(cs && cs.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-property-change-class\");\r\n\t\tvar mlabDOM = document.createElement(\"span\");\r\n\t\tmlabDOM.setAttribute(\"class\", \"terminus-property-change-label\");\r\n\t\tmlabDOM.appendChild(document.createTextNode(\"Type\"));\r\n\t\tmpropDOM.appendChild(mlabDOM);\r\n\t\tvar callback = function(cls){\r\n\t\t\tif(cls){\r\n\t\t\t\tframe.changeClass(cls);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar sel = HTMLHelper.getSelectionControl(\"change-class\", cs, frame.subjectClass(), callback, mode, args);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLHelper.getAddDOM = function(scope, frame, mode, args){\r\n\tif(scope == \"property\"){\r\n\t\tif(frame.isClassChoice()){\r\n\t\t\tvar cs = frame.getAvailableClassChoices();\r\n\t\t\tif(cs && cs.length){\r\n\t\t\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\t\t\tmpropDOM.setAttribute(\"class\", \"terminus-property-add-class\");\r\n\t\t\t\tcs.unshift({ value: \"\", label: \"Add Type\"});\r\n\t\t\t\tvar callback = function(cls){\r\n\t\t\t\t\tif(cls){\r\n\t\t\t\t\t\tframe.addClass(cls);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar sel = HTMLHelper.getSelectionControl(\"add-property\", cs, \"\", callback, mode, args);\r\n\t\t\t\tmpropDOM.appendChild(sel);\r\n\t\t\t\treturn mpropDOM;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(frame.cardControlAllows(\"add\") || frame.display_options.show_disabled_buttons){\r\n\t\t\tvar callback = function(){frame.add(\"edit\")};\r\n\t\t\tvar disabled = (frame.cardControlAllows(\"add\") ? false : \"Cardinality Rules Forbid Add\");\r\n\t\t\treturn HTMLHelper.getActionControl(scope + \"-add-entry\", \"add\", \"Add\", callback, disabled, mode, args);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tvar addables = frame.getMissingPropertyList();\r\n\t\tif(addables && addables.length){\r\n\t\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\t\tmpropDOM.setAttribute(\"class\", \"terminus-\" + scope + \"-add-entry\");\r\n\t\t\taddables.unshift({ value: \"\", label: \"Add new \" + scope});\r\n\t\t\tvar callback = function(add){\r\n\t\t\t\tif(add){\r\n\t\t\t\t\tif(scope == \"object\") frame.addNewProperty(add);\r\n\t\t\t\t\telse if(scope == \"property\") frame.addNewValue(add);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(frame.cardControlAllows(\"add\") || frame.display_options.show_disabled_buttons){\r\n\t\t\t\tvar disabled = (frame.cardControlAllows(\"add\") ? false : \"Cardinality rules forbid adding element\");\r\n\t\t\t\tvar sel = HTMLHelper.getSelectionControl(scope + \"-add-entry\", addables, \"\", callback, disabled, mode, args);\r\n\t\t\t\tmpropDOM.appendChild(sel);\r\n\t\t\t\treturn mpropDOM;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLHelper.getInfoboxDOM = function(type, label, value, help, mode, args, input){\r\n\t/*var frow = this.getFrameRow();\r\n\tvar fgroup = this.getFrameGroup(frow);*/\r\n\tvar infoDOM = document.createElement(\"span\");\r\n\tinfoDOM.setAttribute(\"class\", \"terminus-frame-infobox-box \" + \"terminus-\" +type );\r\n\t//fgroup.appendChild(infoDOM);\r\n\tif(help){\r\n\t\tinfoDOM.setAttribute(\"title\", help);\r\n\t}\r\n\tif(args && typeof args.label != \"undefined\") label = args.label;\r\n\tif(label !== false){\r\n\t\tlabel = (args && args.label ? args.label : label);\r\n\t\tvar linfo = document.createElement(\"span\");\r\n\t\tlinfo.setAttribute(\"class\", \"terminus-frame-infobox-label \" + \"terminus-\" +type + \"-label\");\r\n\t\tlinfo.appendChild(document.createTextNode(label));\r\n\t\tif(args && args.headerStyle){\r\n\t\t\tlinfo.setAttribute(\"style\", args.headerStyle);\t\t\t\r\n\t\t}\r\n\t\tinfoDOM.appendChild(linfo);\r\n\t}\r\n\tvar lval = document.createElement(\"span\");\r\n\tlval.setAttribute(\"class\", \"terminus-frame-infobox-value \" + \"terminus-\" +type + \"-value\");\r\n\tif(input){\r\n\t\tinput.value = value;\r\n\t\tlval.appendChild(input);\r\n\t}\r\n\telse if(args && args.removePrefixes && value && value.split(\":\").length == 2) {\r\n\t\tvar bits = value.split(\":\");\r\n\t\tsh = bits[1];\r\n\t\tlval.setAttribute(\"title\", value);\r\n\t\tlval.appendChild(document.createTextNode(sh));\r\n\t}\r\n\telse {\r\n\t\tlval.appendChild(document.createTextNode(value));\r\n\t}\r\n\tif(args && args.bodyStyle){\r\n\t\tlval.setAttribute(\"style\", args.bodyStyle);\r\n\t}\r\n\tinfoDOM.appendChild(lval);\r\n\tif(args && args.style){\r\n\t\tinfoDOM.setAttribute(\"style\", args.style)\r\n\t}\r\n\treturn infoDOM;\r\n}\r\n\r\n\r\nHTMLHelper.getActionControl = function(type, control, label, callback, disabled, mode, args){\r\n\t//var pman = new TerminusPluginManager();\r\n\tvar dpropDOM = document.createElement(\"span\");\r\n\t//dpropDOM.setAttribute(\"class\", \"terminus-action-control terminus-save-btn \" + type + \"-\" + control);\r\n\tlabel = (args && typeof args.label != \"undefined\" ? args.label : label);\r\n\ticon = (args && args.icon ? args.icon : false);\r\n\tif(icon){\r\n\t\tvar i = document.createElement(\"i\");\r\n\t\ti.setAttribute(\"class\", \"fa \" + icon);\r\n\t\ticon = i;\r\n\t}\r\n\tvar tag = (args && args.tag ? args.tag : \"button\");\r\n\tvar button = document.createElement(tag);\r\n\tif(icon){\r\n\t\tbutton.appendChild(icon);\r\n\t}\r\n\tif(label) button.appendChild(document.createTextNode(\" \" + label + \" \"));\r\n\tif(args && args.title){\r\n\t\tbutton.setAttribute(\"title\", args.title);\r\n\t}\r\n\tif(disabled){\r\n\t\t//button.setAttribute(\"class\", \"terminus-frame-control terminus-frame-btn frame-control-action action-disabled \" + type + \"-\" + control + \"-disabled\");\r\n\t\tbutton.setAttribute(\"title\", disabled);\r\n\t}\r\n\telse {\r\n\t\t//button.setAttribute(\"class\", \"terminus-frame-control terminus-frame-btn frame-control-action \" + type + \"-\" + control);\r\n\t\t\r\n\t}\r\n\tdpropDOM.appendChild(button);\r\n\treturn dpropDOM;\r\n}\r\n\r\nHTMLHelper.removeChildren = function (node) {\r\n\tif (node) {\r\n\t\twhile (node.hasChildNodes()) {\r\n\t\t\tnode.removeChild(node.childNodes[0]);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nHTMLHelper.loadDynamicScript = function (scriptid, src, callback) {\r\n\tconst existingScript = document.getElementById(scriptid);\r\n\tif (!existingScript) {\r\n\t\tconst script = document.createElement('script');\r\n\t\tscript.src = src; // URL for the third-party library being loaded.\r\n\t\tdocument.body.appendChild(script);\r\n\t\tscript.onload = function () {\r\n\t\t\tscript.id = scriptid; // do it here so it doesn't trigger the callback below on multiple calls\r\n\t\t\tif (callback) callback(scriptid);\r\n\t\t};\r\n\t}\r\n\tif (existingScript && callback) {\r\n\t\tcallback(scriptid);\r\n\t}\r\n};\r\n\r\nHTMLHelper.loadDynamicCSS = function (cssid, src, callback) {\r\n\tconst existingScript = document.getElementById(cssid);\r\n\tif (!existingScript) {\r\n\t\tconst link = document.createElement('link');\r\n\t\tlink.href = src; // URL for the third-party library being loaded.\r\n\t\tlink.id = cssid; // e.g., googleMaps or stripe\r\n\t\tlink.rel = 'stylesheet';\r\n\t\tdocument.body.appendChild(link);\r\n\t\tlink.onload = function () {\r\n\t\t\tif (callback) callback(cssid);\r\n\t\t};\r\n\t}\r\n\tif (existingScript && callback) callback(cssid);\r\n};\r\n\r\n\r\nHTMLHelper.removeElement = function (node) {\r\n\tif (node) {\r\n\t\t\tnode.parentNode.removeChild(node);\r\n\t}\r\n}\r\n\r\nmodule.exports=HTMLHelper\r\n","module.exports = {\r\n\t         WOQLClient:require('./lib/woqlClient'),\r\n                 ConnectionCapabilities:require('./lib/connectionCapabilities'),\r\n                 ConnectionConfig:require('./lib/connectionConfig'),\r\n                 IDParser:require('./lib/terminusIDParser'),\r\n                 ErrorMessage:require('./lib/errorMessage'),\r\n                 UTILS:require('./lib/utils'),\r\n                 WOQLResult:require('./lib/woqlResult'),\r\n                 WOQLRule:require('./lib/woqlRule'),\r\n                 FrameRule:require('./lib/frameRule'),\r\n                 View:require('./lib/woqlView'),\r\n                 DocumentFrame:require('./lib/viewer/documentFrame'),\r\n                 WOQLGraph:require('./lib/viewer/woqlGraph'),\r\n                 WOQLTable:require('./lib/viewer/woqlTable'),\r\n                 WOQLChooser:require('./lib/viewer/woqlChooser'),\r\n                 WOQLChart:require('./lib/viewer/woqlChart'),\r\n                 WOQLStream:require('./lib/viewer/woqlStream'),\r\n                 WOQL:require('./lib/woql')};","/**\r\n * @file Terminus Client Utility Functions\r\n * @license Apache Version 2\r\n * @summary Object for bunding up common Terminus Utility Functions \r\n */\r\nconst Utils = {}\r\n\r\n\r\n/**\r\n * default set of prefixes that will be used for URL compression\r\n */\r\nUtils.standard_urls = {\r\n\trdf: 'http://www.w3.org/1999/02/22-rdf-syntax-ns#',\r\n\trdfs: 'http://www.w3.org/2000/01/rdf-schema#',\r\n\txsd: 'http://www.w3.org/2001/XMLSchema#',\r\n\towl: 'http://www.w3.org/2002/07/owl#',\r\n\ttcs: 'http://terminusdb.com/schema/tcs#',\r\n\txdd: 'http://terminusdb.com/schema/xdd#',\r\n\tv: 'http://terminusdb.com/woql/variable/',\r\n\tterminus: 'http://terminusdb.com/schema/terminus#',\r\n\tvio: 'http://terminusdb.com/schema/vio#'\r\n}\r\n\r\n/**\r\n * @summary Encode document payload for GET  \r\n */\r\nUtils.URIEncodePayload = function(payload) {\r\n\tif (typeof payload === 'string') return encodeURIComponent(payload);\r\n\tconst payloadArr = [];\r\n\tfor (const key of Object.keys(payload)) {\r\n\t\tif (typeof payload[key] === 'object') {\r\n\t\t\tfor (const keyElement of Object.keys(payload[key])) {\r\n\t\t\t\t const valueElement = payload[key][keyElement];\r\n\t\t\t\t payloadArr.push(`${encodeURIComponent(keyElement)}=${encodeURIComponent(valueElement)}`);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tpayloadArr.push(`${encodeURIComponent(key)}=${encodeURIComponent(payload[key])}`);\r\n\t\t}\r\n\t}\r\n\treturn payloadArr.join('&');\r\n}\r\n\r\n\r\n\r\n/**\r\n * @summary Adds an entry to the list of known standard URL prefixes \r\n */\r\nUtils.addURLPrefix = function (prefix, url) {\r\n\tthis.standard_urls[prefix] = url;\r\n};\r\n\r\n\r\n/**\r\n * is the object empty? \r\n * returns true if the json object is empty \r\n */\r\nUtils.empty = function (obj) {\r\n\t   // null and undefined are \"empty\"\r\n\tif (!obj) return true;\r\n\t// Assume if it has a length property with a non-zero value\r\n\t// that that property is correct.\r\n\tif (obj.length > 0) return false;\r\n\tif (obj.length === 0) return true;\r\n\t// Otherwise, does it have any properties of its own?\r\n\t// Note that this doesn't handle\r\n\t// toString and valueOf enumeration bugs in IE < 9\r\n\t// for (const key in obj) {\r\n\tif (typeof obj === 'object') {\r\n\t\tfor (const key of Object.keys(obj)) {\r\n\t\t\tif (Object.prototype.hasOwnProperty.call(obj, key)) return false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n};\r\n\r\n/**\r\n * Generates a unique blank node id \r\n */\r\nUtils.genBNID = function () {\r\n\tconst r = Math.random().toString(36).substring(7);\r\n\tconst d = new Date();\r\n\tconst bnid = `_:${r}${d.getTime()}`;\r\n\treturn bnid;\r\n};\r\n\r\n/**\r\n * Returns the shorthand version (compressed to prefix:id ) of a url or false if there is none known for that URL\r\n */\r\nUtils.getShorthand = function (link) {\r\n\tif (typeof link === 'object' && link.length) link = link[0];\r\n\tif (link && typeof link === 'string') {\r\n\t\tfor (const pref of Object.keys(this.standard_urls)) {\r\n\t\t\tconst full = this.standard_urls[pref];\r\n\t\t\tif (link.substring(0, full.length) === full) {\r\n\t\t\t\tconst sh = `${pref}:${link.substring(full.length)}`;\r\n\t\t\t\treturn sh;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * Compares 2 IRIs for equality by checking compressed and expanded versions of both sides\r\n */\r\nUtils.compareIDs = function (ida, idb) {\r\n\tif (ida === idb) return true;\r\n\tif (this.unshorten(ida) === idb) return true;\r\n\tif (this.unshorten(ida) === this.unshorten(idb)) return true;\r\n\tconst sha = this.getShorthand(ida);\r\n\tconst shb = this.getShorthand(idb);\r\n\tif (sha && ((sha === idb) || (sha === shb))) return true;\r\n\tif (shb && shb === ida) return true;\r\n\treturn false;\r\n};\r\n\r\n\r\n/**\r\n * Shortens a URL to its compressed format - returns the full URL if not possible\r\n */\r\nUtils.shorten = function (url, prefixes) {\r\n\tprefixes = prefixes || this.standard_urls;\r\n\tfor (const pref in prefixes) {\r\n\t\tif (prefixes[pref] == url.substring(0, prefixes[pref].length)) {\r\n\t\t\treturn (`${pref}:${url.substring(prefixes[pref].length)}`);\r\n\t\t}\r\n\t}\r\n\treturn url;\r\n};\r\n\r\n/**\r\n * Expands a URL to its full URL format - returns the passed string if not possible to expand\r\n */\r\nUtils.unshorten = function (url) {\r\n\tif (this.validURL(url)) return url;\r\n\tif (!url) return url;\r\n\tconst bits = url.split(':');\r\n\tif (bits[1]) {\r\n\t\tif (this.standard_urls[bits[0]]) {\r\n\t\t\treturn this.standard_urls[bits[0]] + bits[1];\r\n\t\t}\r\n\t}\r\n\treturn url;\r\n};\r\n\r\n/**\r\n * Tests a string to see if it is a valid URL - \r\n * Valid URLs are those that start with http:// or https://\r\n */\r\nUtils.validURL = function (str) {\r\n\tif (str && (str.substring(0, 7) === 'http://' || str.substring(0, 8) === 'https://')) return true;\r\n\treturn false;\r\n};\r\n\r\n\r\n/**\r\n * Generates a text label from a URL\r\n */\r\nUtils.labelFromURL = function (url) {\r\n\tlet nurl = this.urlFragment(url);\r\n\tnurl = (nurl || url);\r\n\tif (nurl.lastIndexOf('/') < nurl.length - 1) {\r\n\t\tnurl = nurl.substring(nurl.lastIndexOf('/') + 1);\r\n\t}\r\n\tnurl = nurl.replace(/_/g, ' ');\r\n\treturn nurl.charAt(0).toUpperCase() + nurl.slice(1);\r\n};\r\n\r\n/**\r\n * returns the fragment part of a URL (whether compressed or not)\r\n */\r\nUtils.urlFragment = function (url) {\r\n\turl = (typeof url !== 'string') ? window.location.href : url;\r\n\tlet bits = url.split('#');\r\n\tif (bits.length <= 1) {\r\n\t\tif (!this.validURL(url)) {\r\n\t\t\tbits = url.split(':');\r\n\t\t}\r\n\t}\r\n\tif (bits.length >= 1) {\r\n\t\tconst [, urlStr] = bits;\r\n\r\n\t\tif (urlStr) {\r\n\t\t\tconst [baseUrl] = urlStr.split('?');\r\n\t\t\turl = baseUrl;\r\n\t\t}\r\n\t}\r\n\treturn url;\r\n};\r\n\r\n/**\r\n * returns the last part of a URL after the last /\r\n */\r\nUtils.lastURLBit = function (url) {\r\n\turl = (typeof url === 'undefined') ? window.location.href : url;\r\n\tconst [urlFirst] = url.split('#');\r\n\tconst [urlTmp] = urlFirst.split('?');\r\n\turl = urlTmp.substring(url.lastIndexOf('/') + 1);\r\n\treturn url;\r\n};\r\n\r\n/**\r\n * returns the a standard URL associated with a given prefix and extension\r\n */\r\nUtils.getStdURL = function (pref, ext, url) {\r\n\tif (this.standard_urls[pref]) {\r\n\t\tif (url) {\r\n\t\t\tif (url === this.standard_urls[pref] + ext) return url;\r\n\t\t} else {\r\n\t\t\treturn this.standard_urls[pref] + ext;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/*\r\n * Utility function adds v: to variables...\r\n */\r\nUtils.addNamespacesToVariables = function(vars){\r\n\tvar nvars = [];\r\n\tfor(var i = 0; i<vars.length; i++){\r\n\t\tif(vars[i]) nvars.push(this.addNamespaceToVariable(vars[i]));\t\t\r\n\t}\r\n\treturn nvars;\r\n}\r\n\r\nUtils.addNamespaceToVariable = function(v){\r\n\tif(typeof v == \"string\" && v.substring(0, 2) != \"v:\") return \"v:\" + v;\r\n\treturn v;\r\n}\r\n\r\n/*\r\n * Utility function removes v: prefix from a variable...\r\n */\r\nUtils.removeNamespaceFromVariable = function(mvar){\r\n\tif(mvar.substring(0, 2) == \"v:\") return mvar.substring(2)\r\n\treturn mvar;\r\n}\r\n\r\n/*\r\n * Utility function removes v: prefix from an array of variables\r\n */\r\nUtils.removeNamespacesFromVariables = function(vars){\r\n\tvar nvars = [];\r\n\tfor(var i = 0; i<vars.length; i++){\r\n\t\tnvars.push(this.removeNamespaceFromVariable(vars[i]));\r\n\t}\r\n\treturn nvars;\r\n}\r\n\r\n/*\r\n * Utility function to extract a value from a config rule - if the value is a variable, take the value of that variable instead\r\n */\r\nUtils.getConfigValue = function(val, row){\r\n    if(typeof val == \"string\" && val.substring(0, 2) == \"v:\"){\r\n\t    var rad = row[val];\r\n\t    if(rad && rad['@value']) return rad['@value'];\r\n\t    return rad;\r\n   }\r\n   else {\r\n\t   return val;\r\n   }\r\n}\r\n\r\n\r\n/**\r\n * TypeHelper bundles together utility functions dealing with datatypes\r\n */\r\nUtils.TypeHelper = {};\r\n\r\n/**\r\n * Returns true if the passed type is an xsd:string (compressed or not)\r\n */\r\nUtils.TypeHelper.isStringType = function (stype) {\r\n\tif (stype === 'http://www.w3.org/2001/XMLSchema#string') return true;\r\n\tif (stype === 'xsd:string') return true;\r\n\treturn false;\r\n};\r\n\r\nUtils.TypeHelper.isDatatype = function (stype) {\r\n\tvar sh = Utils.shorten(stype);\r\n\tif(sh.substring(0, 4) == \"xsd:\" || sh.substring(0, 4) == \"xdd:\") return true;\r\n\treturn false;\r\n};\r\n\r\n/** \r\n * Adds 3 order magnitude separators ( default ,) into big numbers for legibility\r\n */\r\nUtils.TypeHelper.numberWithCommas = function (value, separator) {\r\n\tseparator = separator || \",\";\r\n\tif (value >= 1000 || value <= -1000) {\r\n\t    const parts = value.toString().split('.');\r\n\t    if (value <= -1000) parts[0] = parts[0].substring(1);\r\n\t    parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, separator);\r\n\t    if (value <= -1000) value = `-${parts.join('.')}`;\r\n\t    else value = parts.join('.');\r\n\t}\r\n\treturn value;\r\n};\r\n\r\n/**\r\n * List of supported datatypes\r\n */\r\nUtils.TypeHelper.datatypes = [\r\n\t'xdd:coordinate', 'xdd:coordinatePolyline',\r\n\t'xdd:coordinatePolygon', 'xdd:dateRange', 'xdd:gYearRange', 'xdd:integerRange',\r\n\t'xdd:decimalRange', 'xdd:cc', 'xdd:email', 'xdd:html', 'xdd:url', 'xsd:anySimpleType',\r\n\t'xsd:string', 'xsd:boolean', 'xsd:decimal', 'xsd:double', 'xsd:float', 'xsd:time', 'xsd:date',\r\n\t'xsd:dateTime', 'xsd:dateTimeStamp', 'xsd:gYear', 'xsd:gMonth', 'xsd:gDay', 'xsd:gYearMonth',\r\n\t'xsd:gMonthDay', 'xsd:duration', 'xsd:yearMonthDuration', 'xsd:dayTimeDuration',\r\n\t'xsd:byte', 'xsd:short', 'xsd:integer', 'xsd:long', 'xsd:unsignedByte',\t'xsd:unsignedInt',\r\n\t'xsd:unsignedLong',\t'xsd:nonNegativeInteger', 'xsd:positiveInteger', 'xsd:negativeInteger',\r\n\t'xsd:nonPositiveInteger', 'xsd:base64Binary', 'xsd:anyURI', 'xsd:language', 'xsd:normalizedString',\r\n\t'xsd:token', 'xsd:NMTOKEN',\t'xsd:Name',\t'xsd:NCName', 'xsd:NOTATION', 'xsd:QName', 'xsd:ID',\r\n\t'xsd:IDREF', 'xsd:ENTITY', 'rdf:XMLLiteral', 'rdf:PlainLiteral', 'rdfs:Literal', 'xdd:json'\r\n];\r\n\r\nUtils.TypeHelper.parseRangeValue = function (val, dividor) {\r\n\tdividor = (dividor || ',');\r\n\tlet vals = [];\r\n\tif (typeof val === 'object' && val.length) {\r\n\t\tvals = val;\r\n\t} else if (val) {\r\n\t\tif (typeof val !== 'string') {\r\n\t\t\tval = `${val}`;\r\n\t\t}\r\n\t\tif (val.length && (val.charAt(0) === '[') && val.charAt(val.length - 1) === ']') {\r\n\t\t\tvals.push(val.substring(1, val.indexOf(dividor)));\r\n\t\t\tvals.push(val.substring(val.indexOf(dividor) + 1, val.length - 1));\r\n\t\t} else {\r\n\t\t\tvals.push(val);\r\n\t\t}\r\n\t}\r\n\treturn vals;\r\n};\r\n\r\n/**\r\n * DateHelper bundles together utility functions dealing with xsd date types\r\n */\r\nUtils.DateHelper = {};\r\n\r\n/**\r\n * Takes an xsd time string and returns a structure {hour: HH, minute: MM, second ss.ssssss, timezone: tz}\r\n */\r\nUtils.DateHelper.parseXsdTime = function (val) {\r\n\tif (!val) return {};\r\n\tconst tz = this.extractXsdTimezone(val);\r\n\tif (tz) {\r\n\t\tval = val.substring(0, val.length - tz.length);\r\n\t}\r\n\tconst parsed = {\r\n\t\thour: val.substring(0, 2),\r\n\t\tminute: val.substring(3, 5),\r\n\t\tsecond: val.substring(6),\r\n\t\ttimezone: tz\r\n\t};\r\n\treturn parsed;\r\n};\r\n\r\n/**\r\n * Takes an xsd time string and returns a structure {year: [-]YYYY, month: MM, day: dd}\r\n */\r\nUtils.DateHelper.parseXsdDate = function (val) {\r\n\tconst tz = this.extractXsdTimezone(val);\r\n\tif (tz) {\r\n\t\tval = val.substring(0, val.length - tz.length);\r\n\t}\r\n\tlet year;\r\n\tif (val.substring(0, 1) === '-') {\r\n\t\tyear = val.substring(0, 5);\r\n\t} else {\r\n\t\tyear = val.substring(0, 4);\r\n\t}\r\n\tlet parsed;\r\n\tif (year && Math.abs(year) < 10000) {\r\n\t\tlet month = val.substring(year.length + 1, year.length + 3);\r\n\t\tif (month) { month = parseInt(month, 10); } else return false;\r\n\t\tlet day = val.substring(year.length + 4);\r\n\t\tif (day) day = parseInt(day, 10);\r\n\t\telse return false;\r\n\t\tparsed = {\r\n\t\t\tyear,\r\n\t\t\t   month,\r\n\t\t\t   day,\r\n\t\t\t   timezone: tz\r\n\t\t};\r\n\t}\r\n\treturn parsed;\r\n};\r\n\r\n/**\r\n * Parses a date string of type ty\r\n */\r\nUtils.DateHelper.parseDate = function (ty, value) {\r\n\tlet parsed;\r\n\tif (ty === 'xsd:date') {\r\n\t\tparsed = this.parseXsdDate(value);\r\n\t} else if (ty === 'xsd:time') {\r\n\t\tparsed = this.parseXsdTime(value);\r\n\t} else if (ty === 'xsd:dateTime') {\r\n\t\tparsed = this.parseXsdDateTime(value);\r\n\t} else if (ty === 'xsd:gYear') {\r\n\t\tparsed = { year: value };\r\n\t} else if (ty === 'xsd:gYearRange') {\r\n\t\tparsed = { year: value };\r\n\t} else if (ty === 'xsd:gMonth') {\r\n\t\tparsed = { month: value.substring(2) };\r\n\t} else if (ty === 'xsd:gDay') {\r\n\t\tparsed = { day: value };\r\n\t} else if (ty === 'xsd:gYearMonth') {\r\n\t\tconst bits = value.split('-');\r\n\t\twhile (bits.length < 2) bits.push('');\r\n\t\tparsed = { year: bits[0], month: bits[1] };\r\n\t} else if (ty === 'xsd:gMonthDay') {\r\n\t\tconst bits = value.split('-');\r\n\t\twhile (bits.length < 2) bits.push('');\r\n\t\tparsed = { month: bits[0], day: bits[1] };\r\n\t} else if (ty === 'xsd:dateTimeStamp') {\r\n\t\tparsed = this.parseXsdDateTime(value);\r\n\t}\r\n\treturn parsed;\r\n};\r\n\r\n/**\r\n * adds appropriate padding to date type for xsd rules\r\n */\r\nUtils.DateHelper.addXsdPadding = function (parsed) {\r\n\tconst nparsed = {};\r\n\tif (typeof parsed.year !== 'undefined' && parsed.year !== false && parsed.year < 1000) {\r\n\t\tif (Math.abs(parsed.year) < 10) nparsed.year = (parsed.year < 0 ? `-000${Math.abs(parsed.year)}` : `000${parsed.year}`);\r\n\t\telse if (Math.abs(parsed.year) < 100) nparsed.year = (parsed.year < 0 ? `-00${Math.abs(parsed.year)}` : `00${parsed.year}`);\r\n\t\telse nparsed.year = (parsed.year < 0 ? `-0${Math.abs(parsed.year)}` : `0${parsed.year}`);\r\n\t} else if (parsed.year) {\r\n\t\tnparsed.year = parsed.year;\r\n\t}\r\n\tif (typeof parsed.month !== 'undefined' && parsed.month !== false && parsed.month < 10) {\r\n\t\tnparsed.month = `0${parsed.month}`;\r\n\t} else if (parsed.month) {\r\n\t\tnparsed.month = parsed.month;\r\n\t}\r\n\tif (typeof parsed.day !== 'undefined' && parsed.day !== false && parsed.day < 10) {\r\n\t\tnparsed.day = `0${parsed.day}`;\r\n\t} else if (parsed.day) {\r\n\t\tnparsed.day = parsed.day;\r\n\t}\r\n\tif (typeof parsed.hour !== 'undefined' && parsed.hour !== false && parsed.hour < 10) {\r\n\t\tnparsed.hour = `0${parsed.hour}`;\r\n\t} else if (parsed.hour) {\r\n\t\tnparsed.hour = parsed.hour;\r\n\t}\r\n\tif (typeof parsed.minute !== 'undefined' && parsed.minute !== false && parsed.minute < 10) {\r\n\t\tnparsed.minute = `0${parsed.minute}`;\r\n\t} else if (parsed.minute) {\r\n\t\tnparsed.minute = parsed.minute;\r\n\t}\r\n\tif (typeof parsed.second !== 'undefined' && parsed.second !== false && parsed.second < 10) {\r\n\t\tnparsed.second = `0${parsed.second}`;\r\n\t} else if (parsed.second) {\r\n\t\tnparsed.second = parsed.second;\r\n\t}\r\n\treturn nparsed;\r\n};\r\n\r\n/**\r\n * generates an xsd string of type ty for the passed parsed structure (year, month, day, hour, minute, second, timezone)\r\n */\r\nUtils.DateHelper.xsdFromParsed = function (parsed, ty) {\r\n\tconst xparsed = this.addXsdPadding(parsed);\r\n\tlet ret;\r\n\tif (ty === 'xsd:gYear') {\r\n\t\tret = (xparsed.year ? xparsed.year : false);\r\n\t} else if (ty === 'xsd:time') {\r\n\t\treturn (xparsed.hour && xparsed.minute && xparsed.second) ? `${xparsed.hour}:${xparsed.minute}:${xparsed.second}` : false;\r\n\t} else if (ty === 'xsd:date') {\r\n\t\treturn (xparsed.year && xparsed.month && xparsed.day) ? `${xparsed.year}-${xparsed.month}-${xparsed.day}` : false;\r\n\t} else if (ty === 'xsd:dateTime' || ty === 'xsd:dateTimeStamp') {\r\n\t\tret = (xparsed.year && xparsed.month && xparsed.day) ? `${xparsed.year}-${xparsed.month}-${xparsed.day}T` : false;\r\n\t\tif (ret) ret += `${xparsed.hour ? xparsed.hour : '12'}:${xparsed.minute ? xparsed.minute : '00'}:${xparsed.second ? xparsed.second : '00'}`;\r\n\t} else if (ty === 'xsd:gMonth') {\r\n\t\tret = (xparsed.month ? `--${xparsed.month}` : false);\r\n\t} else if (ty === 'xsd:gDay') {\r\n\t\tret = (xparsed.day ? `---${xparsed.day}` : false);\r\n\t} else if (ty === 'xsd:gYearMonth') {\r\n\t\tret = (xparsed.year && xparsed.month) ? `${xparsed.year}-${xparsed.month}` : false;\r\n\t} else if (ty === 'xsd:gMonthDay') {\r\n\t\tret = (xparsed.day && xparsed.month) ? `--${xparsed.month}-${xparsed.day}` : false;\r\n\t}\r\n\tif (xparsed.timezone) {\r\n\t\tret += xparsed.timezone;\r\n\t}\r\n\treturn ret;\r\n};\r\n\r\n/**\r\n * Converts between a unix timestamp and a parsed structure \r\n */\r\nUtils.DateHelper.convertTimestampToXsd = function (val) {\r\n\t  const a = new Date(val * 1000);\r\n\t  const parsed = {\r\n\t\tyear: a.getFullYear(),\r\n\t\tmonth: a.getMonth() + 1,\r\n\t\tday: a.getDate(),\r\n\t\thour: a.getHours(),\r\n\t\tminute: a.getMinutes(),\r\n\t\tsecond: a.getSeconds()\r\n\t  };\r\n\t  return parsed;\r\n};\r\n\r\n/**\r\n * Parses an xsd date time into a structure\r\n */\r\nUtils.DateHelper.parseXsdDateTime = function (val) {\r\n\tif (!val) return {};\r\n\tif (typeof val === 'number') {\r\n\t\treturn this.convertTimestampToXsd(val);\r\n\t}\r\n\tconst tz = this.extractXsdTimezone(val);\r\n\tif (tz) {\r\n\t\tval = val.substring(0, val.length - tz.length);\r\n\t}\r\n\tconst datetime = this.parseXsdDate(val);\r\n\tconst ptime = this.parseXsdTime(val.substring(val.indexOf('T') + 1));\r\n\r\n\tfor (const i of Object.keys(ptime)) {\r\n\t\tdatetime[i] = ptime[i];\r\n\t}\r\n\tdatetime.timezone = tz;\r\n\treturn datetime;\r\n};\r\n\r\n/**\r\n * Extracts the timezone data from an xsd date string\r\n */\r\nUtils.DateHelper.extractXsdTimezone = function (val) {\r\n\tif (val && val.charAt(val.length - 1) === 'Z') {\r\n\t\treturn 'Z';\r\n\t}\r\n\tif (val && (val.charAt(val.length - 6) === '+' || val.charAt(val.length - 6) === '-')) {\r\n\t\tval.substring(val.length - 6);\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nmodule.exports = Utils;\r\n\r\n\r\n","'use strict';\n\nvar bind = require('./helpers/bind');\nvar isBuffer = require('is-buffer');\n\n/*global toString:true*/\n\n// utils is a library of generic helper functions non-specific to axios\n\nvar toString = Object.prototype.toString;\n\n/**\n * Determine if a value is an Array\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is an Array, otherwise false\n */\nfunction isArray(val) {\n  return toString.call(val) === '[object Array]';\n}\n\n/**\n * Determine if a value is an ArrayBuffer\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is an ArrayBuffer, otherwise false\n */\nfunction isArrayBuffer(val) {\n  return toString.call(val) === '[object ArrayBuffer]';\n}\n\n/**\n * Determine if a value is a FormData\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is an FormData, otherwise false\n */\nfunction isFormData(val) {\n  return (typeof FormData !== 'undefined') && (val instanceof FormData);\n}\n\n/**\n * Determine if a value is a view on an ArrayBuffer\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is a view on an ArrayBuffer, otherwise false\n */\nfunction isArrayBufferView(val) {\n  var result;\n  if ((typeof ArrayBuffer !== 'undefined') && (ArrayBuffer.isView)) {\n    result = ArrayBuffer.isView(val);\n  } else {\n    result = (val) && (val.buffer) && (val.buffer instanceof ArrayBuffer);\n  }\n  return result;\n}\n\n/**\n * Determine if a value is a String\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is a String, otherwise false\n */\nfunction isString(val) {\n  return typeof val === 'string';\n}\n\n/**\n * Determine if a value is a Number\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is a Number, otherwise false\n */\nfunction isNumber(val) {\n  return typeof val === 'number';\n}\n\n/**\n * Determine if a value is undefined\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if the value is undefined, otherwise false\n */\nfunction isUndefined(val) {\n  return typeof val === 'undefined';\n}\n\n/**\n * Determine if a value is an Object\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is an Object, otherwise false\n */\nfunction isObject(val) {\n  return val !== null && typeof val === 'object';\n}\n\n/**\n * Determine if a value is a Date\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is a Date, otherwise false\n */\nfunction isDate(val) {\n  return toString.call(val) === '[object Date]';\n}\n\n/**\n * Determine if a value is a File\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is a File, otherwise false\n */\nfunction isFile(val) {\n  return toString.call(val) === '[object File]';\n}\n\n/**\n * Determine if a value is a Blob\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is a Blob, otherwise false\n */\nfunction isBlob(val) {\n  return toString.call(val) === '[object Blob]';\n}\n\n/**\n * Determine if a value is a Function\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is a Function, otherwise false\n */\nfunction isFunction(val) {\n  return toString.call(val) === '[object Function]';\n}\n\n/**\n * Determine if a value is a Stream\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is a Stream, otherwise false\n */\nfunction isStream(val) {\n  return isObject(val) && isFunction(val.pipe);\n}\n\n/**\n * Determine if a value is a URLSearchParams object\n *\n * @param {Object} val The value to test\n * @returns {boolean} True if value is a URLSearchParams object, otherwise false\n */\nfunction isURLSearchParams(val) {\n  return typeof URLSearchParams !== 'undefined' && val instanceof URLSearchParams;\n}\n\n/**\n * Trim excess whitespace off the beginning and end of a string\n *\n * @param {String} str The String to trim\n * @returns {String} The String freed of excess whitespace\n */\nfunction trim(str) {\n  return str.replace(/^\\s*/, '').replace(/\\s*$/, '');\n}\n\n/**\n * Determine if we're running in a standard browser environment\n *\n * This allows axios to run in a web worker, and react-native.\n * Both environments support XMLHttpRequest, but not fully standard globals.\n *\n * web workers:\n *  typeof window -> undefined\n *  typeof document -> undefined\n *\n * react-native:\n *  navigator.product -> 'ReactNative'\n * nativescript\n *  navigator.product -> 'NativeScript' or 'NS'\n */\nfunction isStandardBrowserEnv() {\n  if (typeof navigator !== 'undefined' && (navigator.product === 'ReactNative' ||\n                                           navigator.product === 'NativeScript' ||\n                                           navigator.product === 'NS')) {\n    return false;\n  }\n  return (\n    typeof window !== 'undefined' &&\n    typeof document !== 'undefined'\n  );\n}\n\n/**\n * Iterate over an Array or an Object invoking a function for each item.\n *\n * If `obj` is an Array callback will be called passing\n * the value, index, and complete array for each item.\n *\n * If 'obj' is an Object callback will be called passing\n * the value, key, and complete object for each property.\n *\n * @param {Object|Array} obj The object to iterate\n * @param {Function} fn The callback to invoke for each item\n */\nfunction forEach(obj, fn) {\n  // Don't bother if no value provided\n  if (obj === null || typeof obj === 'undefined') {\n    return;\n  }\n\n  // Force an array if not already something iterable\n  if (typeof obj !== 'object') {\n    /*eslint no-param-reassign:0*/\n    obj = [obj];\n  }\n\n  if (isArray(obj)) {\n    // Iterate over array values\n    for (var i = 0, l = obj.length; i < l; i++) {\n      fn.call(null, obj[i], i, obj);\n    }\n  } else {\n    // Iterate over object keys\n    for (var key in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        fn.call(null, obj[key], key, obj);\n      }\n    }\n  }\n}\n\n/**\n * Accepts varargs expecting each argument to be an object, then\n * immutably merges the properties of each object and returns result.\n *\n * When multiple objects contain the same key the later object in\n * the arguments list will take precedence.\n *\n * Example:\n *\n * ```js\n * var result = merge({foo: 123}, {foo: 456});\n * console.log(result.foo); // outputs 456\n * ```\n *\n * @param {Object} obj1 Object to merge\n * @returns {Object} Result of all merge properties\n */\nfunction merge(/* obj1, obj2, obj3, ... */) {\n  var result = {};\n  function assignValue(val, key) {\n    if (typeof result[key] === 'object' && typeof val === 'object') {\n      result[key] = merge(result[key], val);\n    } else {\n      result[key] = val;\n    }\n  }\n\n  for (var i = 0, l = arguments.length; i < l; i++) {\n    forEach(arguments[i], assignValue);\n  }\n  return result;\n}\n\n/**\n * Function equal to merge with the difference being that no reference\n * to original objects is kept.\n *\n * @see merge\n * @param {Object} obj1 Object to merge\n * @returns {Object} Result of all merge properties\n */\nfunction deepMerge(/* obj1, obj2, obj3, ... */) {\n  var result = {};\n  function assignValue(val, key) {\n    if (typeof result[key] === 'object' && typeof val === 'object') {\n      result[key] = deepMerge(result[key], val);\n    } else if (typeof val === 'object') {\n      result[key] = deepMerge({}, val);\n    } else {\n      result[key] = val;\n    }\n  }\n\n  for (var i = 0, l = arguments.length; i < l; i++) {\n    forEach(arguments[i], assignValue);\n  }\n  return result;\n}\n\n/**\n * Extends object a by mutably adding to it the properties of object b.\n *\n * @param {Object} a The object to be extended\n * @param {Object} b The object to copy properties from\n * @param {Object} thisArg The object to bind function to\n * @return {Object} The resulting value of object a\n */\nfunction extend(a, b, thisArg) {\n  forEach(b, function assignValue(val, key) {\n    if (thisArg && typeof val === 'function') {\n      a[key] = bind(val, thisArg);\n    } else {\n      a[key] = val;\n    }\n  });\n  return a;\n}\n\nmodule.exports = {\n  isArray: isArray,\n  isArrayBuffer: isArrayBuffer,\n  isBuffer: isBuffer,\n  isFormData: isFormData,\n  isArrayBufferView: isArrayBufferView,\n  isString: isString,\n  isNumber: isNumber,\n  isObject: isObject,\n  isUndefined: isUndefined,\n  isDate: isDate,\n  isFile: isFile,\n  isBlob: isBlob,\n  isFunction: isFunction,\n  isStream: isStream,\n  isURLSearchParams: isURLSearchParams,\n  isStandardBrowserEnv: isStandardBrowserEnv,\n  forEach: forEach,\n  merge: merge,\n  deepMerge: deepMerge,\n  extend: extend,\n  trim: trim\n};\n","/**\r\n * @file Javascript Api explorer tool\r\n * @author Kitty Jose\r\n * @license Copyright 2018-2019 Data Chemist Limited, All Rights Reserved. See LICENSE file for more\r\n *\r\n * @summary Set of functions used across scripts\r\n */\r\nconst Codemirror= require('./plugins/codemirror.terminus');\r\nconst TerminusClient = require('@terminusdb/terminus-client');\r\nconst HTMLHelper = require('./html/HTMLHelper');\r\n\r\n// function to read Files\r\nfunction readFile(file){\r\n    if (window.XMLHttpRequest){\r\n        // code for IE7+, Firefox, Chrome, Opera, Safari\r\n        xmlhttp=new XMLHttpRequest();\r\n    }\r\n    else{\r\n        // code for IE6, IE5\r\n        xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n    }\r\n    xmlhttp.open(\"GET\",file,false);\r\n    xmlhttp.send();\r\n    xmlDoc=xmlhttp.responseText;\r\n    return xmlDoc;\r\n} // readFile()\r\n\r\n// function to write api call signatures from woql client\r\nfunction getFunctionSignature(which){\r\n  var sigs = {};\r\n  sigs.connect = {\r\n    spec   : \"WOQLClient.connect(surl, key)\",\r\n    descr  : \"\\n\\nConnect to a Terminus server at the given URI with an API key\"\r\n                + \"Stores the terminus:ServerCapability document returned in the connection register\"\r\n                + \"which stores, the url, key, capabilities, and database meta-data for the connected server\"\r\n                + \"If the curl argument is false or null, the this.server will be used if present,\"\r\n                + \" or the promise will be rejected.\"\r\n                + \"\\n1)The first (surl) argument: {string} argument it is the Server Url\"\r\n                + \"\\n2)The second(key) argument: {string} argument contains an API key\",\r\n    result : \"HTTP 200 on success, 409 for already existing database, otherwise error code\",\r\n    args   : {server_url : 'url', key: 'Api key'},\r\n    options: { title: \"\", description: \"\" }\r\n  };\r\n  sigs.create = {\r\n    spec    : \"WOQLClient.createDatabase(dburl, details, key)\",\r\n    descr   : \"\\n\\nCreate a Terminus Database\"\r\n                + \"\\n1)The first (dburl) argument:{string}, it is a terminusDB Url or a terminusDB Id \"\r\n                + \"\\n2)The second(details) argument:{object}, details which is the payload\"\r\n                + \"\\n which included information of the new database to be created\"\r\n                +  \"\\n3)The third (key) argument:{string}, contains an API key \",\r\n    result : \"HTTP 200 on success, 409 for already existing database, otherwise error code\",\r\n    args   : {database_url : 'url', details: '', key: ' Api key'},\r\n    options: { title: \"\", description: \"\" }\r\n  };\r\n  sigs.delete = {\r\n      spec  : \"WOQLClient.deleteDatabase(dburl, key)\",\r\n      descr : \"\\n\\nDeletes a Database\"\r\n                + \"\\n1)The first (dburl) argument: {string}, it is a terminusDB Url or a terminusDB Id \"\r\n                + \"\\n2)The second(key) argument: {string}, contains an API key\",\r\n      result: \"HTTP 200 on success, otherwise error code\",\r\n  };\r\n  sigs.getSchema = {\r\n    spec   : \"WOQLClient.getSchema(surl, options)\",\r\n    descr  : \"\\n\\nGets the schema of a database.\"\r\n             +\"\\n1)The first (surl) argument: {string}, it is a dbUrl/schema\"\r\n             + \"\\n2)The second(key) argument: {string}, contains an API key\",\r\n    result : \"Ontology Document on success (HTTP 200), 409 for already existing database, otherwise error code\",\r\n    options: { format: \"turtle\" }\r\n  };\r\n  sigs.getClassFrames = {\r\n    spec   : \"WOQLClient.getClassFrame = function(cfurl, cls, opts)\",\r\n    descr  : \"\\n\\nRetrieves a WOQL query on the specified database which updates the state and returns the results\"\r\n              +  \"\\nThe first (cfurl) argument can be\"\r\n              + \"\\n1) a valid URL of a terminus database or\"\r\n              +  \"\\n2) omitted - the current database will be used\"\r\n              +  \"\\nthe second argument (cls) is the URL / ID of a document class that exists in the database schema\"\r\n              +  \"\\nthe third argument (opts) is an options json - opts.key is an optional API key\",\r\n    result : \"Ontology Document on success (HTTP 200), 409 for already existing database, otherwise error code\",\r\n    options: { format: \"turtle\" }\r\n  };\r\n  sigs.updateSchema = {\r\n    spec    : \"WOQLClient.updateSchema(schurl, docs, options)\",\r\n    descr   : \"\\n\\nUpdates the Schema of the specified database\"\r\n                +\"\\n1)The first (surl) argument :{string}, is a dbUrl/schema\"\r\n                + \"\\n2)The second(docs) argument:{object}, is a valid owl ontology (new schema to be updated) in turtle format\"\r\n                + \"\\n3)The third (key) argument:{string}, contains an API key\",\r\n    result : \"Ontology Document on success (HTTP 200), 409 for already existing database, otherwise error code\",\r\n    args   : {document : 'doc'},\r\n    options: { format: \"turtle\", editmode: \"replace\"}\r\n  };\r\n  sigs.createDocument = {\r\n    spec   : \"WOQLClient.createDocument(docurl, document, options)\",\r\n    descr  : \"\\n\\nCreates a new document in the specified database\"\r\n              + \"\\n1)The first (docurl) argument: {string}, is a dbUrl/document/document_id\"\r\n              + \"\\n2)The second(document) argument: {object}, is a valid document in json-ld\"\r\n              + \"\\n3)The third (key) argument:{string}, contains an API key\",\r\n    result : \"Created Document on success (HTTP 200), Violation Report Otherwise (HTTP 400+)\",\r\n    args   : {document_url : 'url', document: \"doc\"},\r\n    options: { format: \"turtle\", fail_on_id_denied: false}\r\n  };\r\n  sigs.viewDocument = {\r\n    spec    : \"WOQLClient.getDocument(docurl, options)\",\r\n    descr   : \"\\n\\nRetrieves a document from the specified database\"\r\n              + \"\\n1)The first (docurl) argument: {string}, is a dbUrl/document/document_id\"\r\n              + \"\\n2)The second (key) argument: {string}, contains an API key\",\r\n    result : \"Document (HTTP 200), Violation Report Otherwise (HTTP 400+)\",\r\n    args   : {document_url : 'url'},\r\n    options: { format: \"turtle\"}\r\n  };\r\n  sigs.updateDocument = {\r\n    spec   : \"WOQLClient.updateDocument(docurl, document, options)\",\r\n    descr  : \"\\n\\nUpdates a document in the specified database with a new version\"\r\n                + \"\\n1)The first (docurl) argument: {string}, is a dbUrl/document/document_id\"\r\n                + \"\\n2)The second(document) argument: {object}, is a valid document in json-ld\"\r\n                + \"\\n3)The third (key) argument:{string} argument contains an API key\",\r\n    result : \"Ontology Document on success (HTTP 200), 409 for already existing database, otherwise error code\",\r\n    args   : {document_url : 'url', document: \"doc\"},\r\n    options: { format: \"turtle\", editmode: \"replace\"}\r\n  };\r\n  sigs.deleteDocument = {\r\n    spec  : \"WOQLClient.deleteDocument(docurl, key)\",\r\n    descr : \"\\n\\nDeletes a document from the specified database\"\r\n            + \"\\n1)The first (docurl) argument: {string},is a dbUrl/document/document_id\"\r\n            + \"\\n2)The second (key) argument: {string}, contains an API key\",\r\n    result: \"Ontology Document on success (HTTP 200), 409 for already existing database, otherwise error code\",\r\n    args  : {document_url : 'url'},\r\n  };\r\n  sigs.select = {\r\n    spec: \"WOQLClient.select(dburl, query, options)\",\r\n    descr: \"\\n\\nExecutes a read-only WOQL query on the specified database and returns the results\"\r\n              + \"\\n1)The first (docurl) argument: {string}, is a terminusDB Url or a terminusDB Id\"\r\n              + \"\\n2)The second (query) argument: {object}, a valid query in json-ld format \"\r\n              + \"\\n3)The third (key) argument:{string}, contains an API key\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {woql: 'woql'},\r\n  };\r\n  sigs.update = {\r\n    spec  : \"WOQLClient.update(dburl, query, options)\",\r\n    descr : \"\\n\\nExecutes a WOQL query on the specified database which updates the state and returns the results\"\r\n              + \"\\n1)The first (dburl) argument: {string}, is a terminusDB Url or a terminusDB Id\"\r\n              + \"\\n2)The second (query) argument: {object}, a valid query in json-ld format \"\r\n              + \"\\n3)The third (key) argument:{string}, contains an API key\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args  : {woql: 'woql'},\r\n  };\r\n  sigs.lookup = {\r\n    spec: \"WOQLClient.lookup(database_url, woql, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {class: 'url', term: 'string'},\r\n  };\r\n  sigs.map = {\r\n    spec: \"WOQLClient.lookup(source, target, woql, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {source: 'json', target: \"json\", woql: 'json'},\r\n  };\r\n  sigs.getClassFrame = {\r\n    spec: \"WOQLClient.getClassFrame(class, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {class: 'url'},\r\n  };\r\n  sigs.getPropertyFrame = {\r\n    spec: \"WOQLClient.getPropertyFrame(class, property, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {class: 'url', property: 'url'},\r\n  };\r\n  sigs.getFilledPropertyFrame = {\r\n    spec: \"WOQLClient.getPropertyFrame(document_url, property, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {document_url: 'url', property: 'url'},\r\n  };\r\n  sigs.getSubClasses = {\r\n    spec: \"WOQLClient.getSubClasses(class, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {class: 'url'},\r\n  };\r\n  return sigs[which];\r\n}//getFunctionSignature\r\n\r\n// returns dom element for header text\r\nfunction getHeaderDom(text){\r\n  var hd = document.createElement('div');\r\n  hd.setAttribute('class', 'terminus-module-head');\r\n  var h = document.createElement('h3');\r\n  h.innerHTML = text;\r\n  hd.appendChild(h);\r\n  return hd;\r\n} // getHeaderTextDom\r\n\r\nfunction getButton(text){\r\n  var button = document.createElement('button');\r\n  button.setAttribute('class', 'terminus-btn');\r\n  button.setAttribute('value', text);\r\n  button.appendChild(document.createTextNode(text));\r\n  return button;\r\n}\r\n\r\n// returns dom for alert banner\r\nfunction getInfoAlertDom(type, label, msg){\r\n  var ald = document.createElement('div');\r\n  if(type == 'info') ald.setAttribute('class', 'terminus-alert terminus-alert-success');\r\n  else ald.setAttribute('class', 'alert');\r\n  var str = document.createElement('STRONG');\r\n  str.innerHTML = label;\r\n  ald.appendChild(str);\r\n  var txt = document.createTextNode(msg);\r\n  ald.appendChild(txt);\r\n  return ald;\r\n} // getInfoAlertDom()\r\n\r\n// formats response results from platform\r\nfunction getResponse(currForm, action, response, terminator){\r\n\r\n  var rd = document.createElement('div');\r\n\r\n  // get header result\r\n  rd.appendChild(getHeaderDom('Result'));\r\n  var br = document.createElement('BR');\r\n  rd.appendChild(br);\r\n\r\n  var data = JSON.stringify(response, 0, 4);\r\n\r\n  var pre = document.createElement('pre');\r\n  pre.setAttribute('class', 'terminus-api-view terminus-scheme-pre');\r\n  pre.innerHTML = data;\r\n\r\n  var cm = stylizeCodeDisplay(terminator, pre, rd, 'javascript');\r\n  if(!cm) rd.appendChild(pre);\r\n\r\n  var br = document.createElement('BR');\r\n  rd.appendChild(br);\r\n\r\n  currForm.appendChild(rd);\r\n\r\n  return currForm;\r\n}\r\n\r\n// formats the response from fetch call and spits out Http header and result\r\nfunction showHttpResult(response, action, currForm, terminator){\r\n    //var currForm = document.createElement('div');\r\n\r\n    var br = document.createElement('BR');\r\n    currForm.appendChild(br);\r\n    var br = document.createElement('BR');\r\n    currForm.appendChild(br);\r\n\r\n    // get header result\r\n    currForm.appendChild(getHeaderDom('HTTP Header'));\r\n\r\n    var br = document.createElement('BR');\r\n    currForm.appendChild(br);\r\n\r\n     var retHttpHeaders  = '';\r\n\r\n     // iterate over all headers\r\n     for (let [key, value] of response.headers) {\r\n       retHttpHeaders = retHttpHeaders +  `${key} = ${value}` + '\\n';\r\n     }\r\n\r\n    // http header result\r\n    var hdres = document.createElement('pre');\r\n    hdres.setAttribute('class', 'terminus-api-signature-pre');\r\n    var txt = document.createTextNode(retHttpHeaders);\r\n    hdres.appendChild(txt);\r\n\r\n    var cm = stylizeCodeDisplay(terminator, hdres, currForm, 'message/http');\r\n    if(!cm) currForm.appendChild(hdres);\r\n\r\n    return response.json()\r\n    .then(function(response){\r\n      getResponse(currForm, action, response, terminator); // get return response\r\n    })\r\n\r\n} // UTILS.showHttpResult()\r\n\r\n\r\nfunction deleteStylizedEditor(ui, qip){\r\n    if(ui.pluginAvailable(\"codemirror\")){\r\n\t\tvar cm = qip.nextElementSibling;\r\n\t\tcm.setAttribute('class', 'terminus-hide');\r\n\t\tHTMLHelper.removeChildren(cm);\r\n\t}\r\n}\r\n\r\n/* ui: terminus ui reference\r\n   txt: text area to be stylized\r\n   view: defines the size of editor to appear in pages (schema/ query)\r\n   mode: format to be displayed in\r\n*/\r\nfunction stylizeEditor(ui, txt, view, mode){\r\n  if(ui){\r\n      var cmConfig = ui.pluginAvailable(\"codemirror\");\r\n      if(!(cmConfig)) return;\r\n      var cm = new Codemirror(txt, mode, cmConfig);\r\n  }\r\n  else{\r\n      var cm = new Codemirror(txt, mode, {});\r\n  }\r\n\tvar ar = cm.colorizeTextArea(view);\r\n\tcm.updateTextArea(ar);\r\n}\r\n\r\n/* ui: terminus ui reference\r\n   txt: text area to be stylized\r\n   dom: stylized pre area is appended to dom\r\n   mode: format to be displayed in\r\n*/\r\nfunction stylizeCodeDisplay(ui, txt, dom, mode){\r\n    if(ui){\r\n        var cmConfig = ui.pluginAvailable(\"codemirror\");\r\n        if(!(cmConfig)) return false;\r\n        var cm = new Codemirror(txt, mode, cmConfig);\r\n    }\r\n    else var cm = new Codemirror(txt, mode, {});\r\n    var pr = cm.colorizePre();\r\n    if(dom) dom.appendChild(pr);\r\n    return true;\r\n}\r\n\r\n/* name: classname to find and remove classes from elements\r\n*/\r\nfunction removeSelectedNavClass(name){\r\n    var el = document.getElementsByClassName(name);\r\n    if (el.length < 1) return;\r\n    for(var i=0; i<(el.length + 1); i++){\r\n        el[i].classList.remove(name);\r\n    }\r\n}\r\n\r\nfunction setSelectedSubMenu(a){\r\n    removeSelectedNavClass(\"terminus-submenu-selected\");\r\n    a.classList.add(\"terminus-submenu-selected\");\r\n}\r\n\r\nfunction setSelected(el, className){\r\n    var par = el.parentElement;\r\n    for(var i=0; i<par.childNodes.length; i++){\r\n        if(par.childNodes[i].classList.contains(className))\r\n            par.childNodes[i].classList.remove(className);\r\n    }\r\n    el.classList.add(className);\r\n}\r\n\r\n// toggles between contents\r\nfunction tolggleContent(icon, content){\r\n    if (content.style.display === \"block\"){\r\n        removeSelectedNavClass(\"fa-chevron-up\");\r\n        icon.classList.add(\"fa-chevron-down\");\r\n        content.style.display = \"none\";\r\n    }\r\n    else{\r\n        removeSelectedNavClass(\"fa-chevron-down\");\r\n        icon.classList.add(\"fa-chevron-up\");\r\n        content.style.display = \"block\";\r\n    }\r\n}\r\n\r\n// controls current selected nav bar\r\nfunction activateSelectedNav(nav, terminator){\r\n    removeSelectedNavClass(\"terminus-selected\");\r\n\t//checkDocumentSubMenus(terminator);\r\n\tnav.classList.add(\"terminus-selected\");\r\n}\r\n\r\nfunction hideDocumentSubMenus(el){\r\n\tif(el.classList.contains('terminus-display')){\r\n\t\tel.classList.remove('terminus-display');\r\n\t\tel.classList.add('terminus-hide');\r\n\t}\r\n}\r\n\r\nfunction checkDocumentSubMenus(terminator){\r\n\tif(terminator.ui.showControl(\"get_document\")) {\r\n\t\tvar gd = document.getElementsByClassName('terminus-get-doc');\r\n\t\thideDocumentSubMenus(gd[0]);\r\n\t}\r\n\tif(terminator.ui.showControl(\"create_document\")) {\r\n\t\tvar cd = document.getElementsByClassName('terminus-create-doc');\r\n\t\thideDocumentSubMenus(cd[0]);\r\n\t}\r\n}\r\n\r\nfunction toggleVisibility(el){\r\n\tif(el.classList.contains('terminus-display')){\r\n\t\tel.classList.remove('terminus-display');\r\n\t\tel.classList.add('terminus-hide');\r\n\t}\r\n    else if(el.classList.contains('terminus-hide')){\r\n        el.classList.remove('terminus-hide');\r\n\t\tel.classList.add('terminus-display');\r\n\t}\r\n}\r\n\r\nfunction extractValueFromCell(cellValue){\r\n    var ihtml = new DOMParser().parseFromString(cellValue, \"text/xml\");\r\n    return ihtml.firstChild.innerHTML;\r\n}\r\n\r\nfunction displayDocumentSubMenus(ui) {\r\n\t//display submenus on click of documents\r\n\tif(ui.showControl(\"get_document\")) {\r\n\t\tvar gd = document.getElementsByClassName('terminus-get-doc');\r\n\t\tshowSubMenus(gd[0]);\r\n\t}\r\n\tif(ui.showControl(\"create_document\")) {\r\n\t\tvar cd = document.getElementsByClassName('terminus-create-doc');\r\n\t\tshowSubMenus(cd[0]);\r\n\t}\r\n}\r\n\r\nfunction checkForMandatoryId(){\r\n    var objId = document.getElementsByClassName('terminus-object-id-input');\r\n    if(objId.length>0){\r\n        if(!objId[0].value){\r\n            objId[0].setAttribute('placeholder', 'Required field');\r\n            objId[0].style.background = '#f8d7da';\r\n            return false;\r\n        }\r\n        else return true;\r\n    }\r\n}\r\n\r\nfunction showSubMenus (el){\r\n\tel.classList.remove('terminus-hide');\r\n\tel.classList.add('terminus-display');\r\n}\r\n\r\n// function which generates query based on current settings from different screens of dashboard\r\nfunction getCurrentWoqlQueryObject(query, settings){\r\n\tvar qval;\r\n    if(!query) query = settings.query;\r\n\tswitch(query){\r\n\t\tcase 'Show_All_Schema_Elements':\r\n\t\t\tqval = TerminusClient.WOQL.limit(settings.pageLength)\r\n                        .start(settings.start)\r\n                        .elementMetadata();\r\n\t\tbreak;\r\n\t\tcase 'Show_All_Classes':\r\n\t\t\tqval = TerminusClient.WOQL.limit(settings.pageLength)\r\n                        .start(settings.start)\r\n                        .classMetadata();\r\n\t\tbreak;\r\n\t\tcase 'Show_All_Data':\r\n\t\t\tqval = TerminusClient.WOQL.limit(settings.pageLength)\r\n                        .start(settings.start)\r\n                        .getEverything();\r\n\t\tbreak;\r\n\t\tcase 'Show_All_Documents':\r\n\t\t\tqval = TerminusClient.WOQL.limit(settings.pageLength)\r\n                        .start(settings.start)\r\n                        .getAllDocuments();\r\n\t\tbreak;\r\n        case 'Show_All_Document_classes':\r\n            qval = TerminusClient.WOQL.limit(settings.pageLength)\r\n                        .start(settings.start)\r\n                        .documentMetadata();\r\n        break;\r\n        case 'Show_Document_Classes':\r\n            qval = TerminusClient.WOQL.limit(settings.pageLength)\r\n                        .start(settings.start).and(\r\n                        TerminusClient.WOQL.quad(\"v:Element\", \"rdf:type\", \"owl:Class\", \"db:schema\"),\r\n                        TerminusClient.WOQL.abstract(\"v:Element\"),\r\n                        TerminusClient.WOQL.sub(\"v:Element\", \"tcs:Document\"),\r\n                        TerminusClient.WOQL.opt().quad(\"v:Element\", \"rdfs:label\", \"v:Label\", \"db:schema\"),\r\n                        TerminusClient.WOQL.opt().quad(\"v:Element\", \"rdfs:comment\", \"v:Comment\", \"db:schema\"));\r\n        break;\r\n        case 'Show_All_Properties':\r\n            qval = TerminusClient.WOQL.limit(settings.pageLength)\r\n                        .start(settings.start)\r\n                        .propertyMetadata();\r\n        break;\r\n\t\tdefault:\r\n\t\t\tconsole.log('Invalid query ' + query + ' passed in WOQLTextboxGenerator');\r\n\t\tbreak;\r\n\t}\r\n\treturn qval;\r\n}\r\n\r\n// removes spaces\r\nfunction trimValue(text){\r\n    (text).replace(/[\\s\\t\\r\\n\\f]/g,'');\r\n    return text;\r\n}\r\n\r\n// query string\r\nfunction getqObjFromInput(q){\r\n    const WOQL = TerminusClient.WOQL ;\r\n    //var query = 'WOQL.' + q;\r\n    var query = q;\r\n    try {\r\n        var qObj = eval(query);\r\n        this.qObj = qObj;\r\n        return qObj;\r\n    }\r\n    catch(e){\r\n        console.log('Error in getting woql object ',e.toString());\r\n    }\r\n}\r\n\r\nmodule.exports={tolggleContent,\r\n               removeSelectedNavClass,\r\n               stylizeCodeDisplay,\r\n               stylizeEditor,\r\n               deleteStylizedEditor,\r\n               showHttpResult,\r\n               getHeaderDom,\r\n               getInfoAlertDom,\r\n               getFunctionSignature,\r\n               toggleVisibility,\r\n               extractValueFromCell,\r\n               displayDocumentSubMenus,\r\n               setSelectedSubMenu,\r\n               checkForMandatoryId,\r\n               activateSelectedNav,\r\n               getCurrentWoqlQueryObject,\r\n               getButton,\r\n               trimValue,\r\n               setSelected,\r\n               getqObjFromInput}\r\n","/**\r\n * @file WOQL Rules \r\n * @license Apache Version 2\r\n * @summary WOQL Rules support pattern matching on results of WOQL Queries \r\n */\r\nconst TerminusRule = require('./terminusRule.js');\r\nconst UTILS = require('./utils.js');\r\n\r\nfunction WOQLRule(){\r\n\tTerminusRule.TerminusRule.call(this); \r\n\tthis.pattern = new WOQLPattern();\r\n}\r\nWOQLRule.prototype = Object.create(TerminusRule.TerminusRule.prototype);\r\nWOQLRule.prototype.constructor = TerminusRule.TerminusRule;\r\n\r\n/** \r\n * Specifies that the rule only applies to specific variables returned by the WOQL query\r\n * @param {[String]} - array of strings, each representing a variable name, variable prefixes (\"v:\") are added automatically if absent\r\n */\r\nWOQLRule.prototype.setVariables = function(vars){\r\n\tif(vars && vars.length){\r\n\t\tthis.pattern.variables = UTILS.addNamespacesToVariables(vars);\r\n\t\tthis.current_variable = this.pattern.variables[this.pattern.variables.length - 1];\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Shorthand to the above using spread operator\r\n */\r\nWOQLRule.prototype.vars = function(...varlist){\r\n\treturn this.setVariables(varlist);\r\n}\r\n\r\n/**\r\n * Specifies that the rule applies to a specific variable, variable prefix (\"v:\") is added automatically if absent\r\n */\r\nWOQLRule.prototype.v = function(v){\r\n\tif(v){\r\n\t\tthis.current_variable = UTILS.addNamespaceToVariable(v);\r\n\t\treturn this;\r\n\t}\r\n\treturn this.current_variable;\r\n}\r\n\r\n\r\n/**\r\n * Specifies that the rule applies to a specific edge, a source -> target pair of variables\r\n */\r\nWOQLRule.prototype.edge = function(source, target){\r\n\tthis.scope(\"edge\");\r\n\tif(source){\r\n\t\tlet vs = UTILS.addNamespaceToVariable(source);\r\n\t\tthis.setVariables([vs]);\r\n\t\tthis.pattern.source = vs;\r\n\t} \r\n\tif(target){\r\n\t\tlet vs = UTILS.addNamespaceToVariable(target);\r\n\t\tif(!source) this.setVariables([vs]);\r\n\t\tthis.pattern.target = vs;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Specifies that the rule applies to a specific edge, a source -> target pair of variables\r\n */\r\nWOQLRule.prototype.rownum = function(rownum){\r\n\tif(typeof rownum == \"undefined\") return this.pattern.rownum; \r\n\tthis.pattern.rownum = rownum;\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Specifies that the value of a variable must be one of the values contained in the list\r\n * @param {[String|Number]} list - parameters are any atomic value (string | number) - the rule will match only cells that have one of these values\r\n */\r\nWOQLRule.prototype.in = function(...list){\r\n\tif(this.current_variable){\r\n\t\tif(!this.pattern.constraints) this.pattern.constraints = {};\r\n\t\tif(!this.pattern.constraints[this.current_variable]) this.pattern.constraints[this.current_variable] = [];\r\n\t\tthis.pattern.constraints[this.current_variable].push(list);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Specifies a filter function to apply to each element - only those values that return true when this filter is invoked will be matched\r\n * @param {function} tester - test function that will be used to filter values\r\n */\r\nWOQLRule.prototype.filter = function(tester){\r\n\tif(this.current_variable){\r\n\t\tif(!this.pattern.constraints) this.pattern.constraints = {};\r\n\t\tif(!this.pattern.constraints[this.current_variable]) this.pattern.constraints[this.current_variable] = [];\r\n\t\tthis.pattern.constraints[this.current_variable].push(tester);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLRule.prototype.matchRow = function(rules, row, rownum, action){\r\n\tvar matches = [];\r\n\tfor(var i = 0; i<rules.length; i++){\r\n\t\tif(action && this.rule && typeof this.rule[action] == \"undefined\") continue;\r\n\t\tif(rules[i].pattern.matchRow(row, rownum)){\r\n\t\t\tmatches.push(rules[i]);\r\n\t\t}\r\n\t}\r\n\treturn matches;\r\n}\r\n\r\nWOQLRule.prototype.matchCell = function(rules, row, key, rownum, action){\r\n\tvar matches = [];\r\n\tfor(var i = 0; i<rules.length; i++){\r\n\t\tif(action && this.rule && typeof this.rule[action] == \"undefined\") continue;\r\n\t\tif(rules[i].pattern.matchCell(row, key, rownum)){\r\n\t\t\tmatches.push(rules[i]);\r\n\t\t}\r\n\t}\r\n\treturn matches;\r\n}\r\n\r\nWOQLRule.prototype.matchColumn = function(rules, key, action){\r\n\tvar matches = [];\r\n\tfor(var i = 0; i<rules.length; i++){\r\n\t\tif(action && this.rule && typeof this.rule[action] == \"undefined\") continue;\r\n\t\tif(rules[i].pattern.matchColumn(key)){\r\n\t\t\tmatches.push(rules[i]);\r\n\t\t}\r\n\t}\r\n\treturn matches;   \r\n}\r\n\r\nWOQLRule.prototype.matchNode = function(rules, row, key, nid, action){\r\n\tvar matches = [];\r\n\tfor(var i = 0; i<rules.length; i++){\r\n\t\tif(action && this.rule && typeof this.rule[action] == \"undefined\") continue;\r\n\t\tif(rules[i].pattern.matchNode(row, key, nid)){\r\n\t\t\tmatches.push(rules[i]);\r\n\t\t}\r\n\t}\r\n\treturn matches;\r\n}\r\n\r\nWOQLRule.prototype.matchPair = function(rules, row, keya, keyb, action){\r\n\tvar matches = [];\r\n\tfor(var i = 0; i<rules.length; i++){\r\n\t\tif(action && this.rule && typeof this.rule[action] == \"undefined\") continue;\r\n\t\tif(rules[i].pattern.matchPair(row, keya, keyb)){\r\n\t\t\tmatches.push(rules[i]);\r\n\t\t}\r\n\t}\r\n\treturn matches;\r\n}\r\n\r\n//alias\r\nWOQLRule.prototype.matchEdge = WOQLRule.prototype.matchPair;\r\n\r\n\r\n/**\r\n * Object to encapsulate the matching of woql result patterns - inherits from TerminusRule\r\n * @param {Object} pattern \r\n */\r\nfunction WOQLPattern(pattern){\r\n\tTerminusRule.TerminusPattern.call(this,pattern); \r\n};\r\nWOQLPattern.prototype = Object.create(TerminusRule.TerminusPattern.prototype);\r\nWOQLPattern.prototype.constructor = TerminusRule.TerminusPattern;\r\n\r\nWOQLPattern.prototype.prettyPrint = function(type){\r\n\t//starts with obj. ...\r\n\tvar str = this.scope + \"('\";\r\n\tif(this.variables){\r\n\t\tstr += this.variables.join(\"', '\");\r\n\t }\r\n\t str += \"')\";\r\n\tif(typeof this.literal != \"undefined\"){\r\n\t\tstr += \".literal(\" + this.literal + \")\";\r\n\t}\r\n\tif(typeof this.type != \"undefined\"){\r\n\t\tstr += \".type(\" + this.unpack(this.type) + \")\";\r\n\t}\r\n\tif(typeof this.value != \"undefined\"){\r\n\t\tstr += \".value(\" + this.unpack(this.value, true) + \")\";\r\n\t}\r\n\tfor(var v in this.constraints){\r\n\t\tstr += \".v('\" + v + \"')\";\r\n\t\tfor(var i = 0; i<this.constraints[v].length; i++){\r\n\t\t\tif(typeof(this.constraints[v][i]) == \"function\"){\r\n\t\t\t\tstr += \".filter(\" + this.constraints[v][i] + \")\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tstr += \".in(\" + json.unpack(this.constraints[v][i]) + \")\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn str;\r\n}\r\n\r\n/**\r\n * @param {String|Object} data\r\n * @param {String|[String, String]} [key] - a variable or an array of two variables (in the case of edge scope) which constitutes the key being tested\r\n * @param {String} [scope] - the scope in which the test is being carried out (row, column, cell)\r\n */\r\n\r\nWOQLPattern.prototype.matchRow = function(row, rownum){\r\n\tif(typeof this.rownum != \"undefined\" && typeof rownum != \"undefined\"){\r\n\t\tif(!this.numberMatch(this.rownum, rownum)) return false;\r\n\t}\r\n\tif(this.scope && this.scope != \"row\") return false;\r\n\tif(!this.testVariableConstraints(row)) return false;\r\n\treturn true;\r\n}\r\n\r\nWOQLPattern.prototype.matchCell = function(row, key, rownum){\r\n\tif(typeof this.rownum != \"undefined\" && typeof rownum != \"undefined\"){\r\n\t\tif(!this.numberMatch(this.rownum, rownum)) return false;\r\n\t}\r\n\tif(!this.testBasics(\"column\", row[key])) return false;\r\n\tif(this.variables && this.variables.length && this.variables.indexOf(key) == -1) return false;\r\n\tif(!this.testVariableConstraints(row)) return false;\r\n\treturn true;\t\r\n}\r\n\r\nWOQLPattern.prototype.matchNode = function(row, key, nid){\r\n\tif(!this.testBasics(\"node\", row[key])) return false;\r\n\tif(this.variables && this.variables.length && this.variables.indexOf(key) == -1) return false;\r\n\tif(!this.testVariableConstraints(row)) return false;\r\n\treturn true;\t\r\n}\r\n\r\nWOQLPattern.prototype.matchColumn = function(key){\r\n\tif(this.scope && this.scope != \"column\") return false;\t\r\n\tif(this.variables && this.variables.length && this.variables.indexOf(key) == -1) return false;\r\n\treturn true;\r\n}\r\n\r\nWOQLPattern.prototype.matchPair = function(row, keya, keyb){\r\n\tif(this.scope && this.scope != \"edge\") return false;\t\r\n\tif(this.source && this.source != keya) return false;\r\n\tif(this.target && this.target != keyb) return false;\r\n\tif(!this.testVariableConstraints(row)) return false;\r\n\treturn true;\r\n}\r\n\r\nWOQLPattern.prototype.testVariableConstraints = function(row){\r\n\tfor(var k in this.constraints){\r\n\t\tif(!this.testVariableConstraint(k, row[k])) return false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nWOQLPattern.prototype.testVariableConstraint = function(name, val){\r\n\tif(!this.constraints[name]) return true;\r\n\tfor(var i = 0; i<this.constraints[name].length; i++){\r\n\t\tif(!this.testValue(val, this.constraints[name][i])){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nWOQLPattern.prototype.setPattern = function(pattern){\r\n\tfor(var key in pattern){\r\n\t\tthis[key] = pattern[key];\r\n\t}\r\n}\r\n\r\nWOQLPattern.prototype.json = function(){\r\n\tvar json = {};\r\n\tif(this.scope){\r\n\t\tjson.scope = this.scope;\r\n\t}\r\n\tif(this.value){\r\n\t\tjson.value = this.value;\r\n\t}\r\n\tif(this.rownum) json.rownum = this.rownum;\r\n\tif(this.variables) json.variables = this.variables;\r\n\tif(this.literal) json.literal = this.literal;\r\n\tif(this.type) json.type = this.type;\r\n\tif(this.constraints) json.constraints = this.constraints;\r\n\tif(this.source) json.source = this.source;\r\n\tif(this.target) json.target = this.target;\r\n\treturn json;\r\n}\r\n\r\n\r\nmodule.exports = WOQLRule ;\r\n","\r\nconst WOQLRule = require(\"../woqlRule\");\r\n\r\n/**\r\n * Generic functions / configs that are available to all config types\r\n */\r\nfunction ViewConfig(){\r\n    this.rules = [];\r\n}\r\n\r\nViewConfig.prototype.render = function(func){\r\n\tif(func) this.view_render = func;\r\n\treturn this.view_render;\r\n}\r\n\r\nViewConfig.prototype.renderer = function(val){\r\n\tif(val) this.view_renderer = val;\r\n\treturn this.view_renderer;\r\n}\r\n\r\nViewConfig.prototype.getRulesJSON = function(){\r\n\tlet jr = [];\r\n\tfor(var i = 0; i<this.rules.length; i++){\r\n\t\tjr.push(this.rules[i].json());\r\n\t}\r\n\treturn jr;\r\n}\r\n\r\nViewConfig.prototype.getBasicJSON = function(){\r\n\tlet jr = {};\r\n\tif(this.view_render) jr.render = this.view_render;\r\n\tif(this.view_renderer) jr.renderer = this.view_renderer;\r\n\treturn jr;\r\n}\r\n\r\nViewConfig.prototype.loadBasicJSON = function(json){\r\n\tif(json.render) this.view_render = json.view_render;\r\n\tif(json.renderer) this.view_renderer = json.view_renderer;\r\n}\r\n\r\nViewConfig.prototype.getBasicprettyPrint = function(){\r\n\tlet str = \"\";\r\n\tif(typeof this.render() != \"undefined\"){\r\n\t\tstr += \"view.render(\" + this.render() + \")\\n\";\r\n\t}\r\n\tif(typeof this.renderer() != \"undefined\"){\r\n\t\tstr += \"view.renderer('\" + this.renderer() + \"')\\n\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\n\r\nfunction WOQLViewRule(){\r\n\tWOQLRule.call(this);\r\n\tthis.rule = {}; \r\n};\r\n\t\r\nWOQLViewRule.prototype = Object.create(WOQLRule.prototype);\r\nWOQLViewRule.prototype.constructor = WOQLRule;\r\n\r\nWOQLViewRule.prototype.prettyPrint = function(type){\r\n\tlet str = \"\";\r\n\tif(this.pattern){\r\n\t\tstr = this.pattern.prettyPrint(type);\r\n\t}\r\n\tif(typeof this.color() != \"undefined\"){\r\n\t\tstr += \".color([\" + this.color().join(\",\") + \"])\";\r\n\t}\r\n\tif(typeof this.hidden() != \"undefined\"){\r\n\t\tstr += \".hidden(\" + this.hidden() + \")\";\r\n\t}\r\n\tif(typeof this.size() != \"undefined\"){\r\n\t\tstr += \".size('\" + this.size() + \"')\";\r\n\t}\r\n\tif(typeof this.icon() != \"undefined\"){\r\n\t\tstr += \".icon(\" + JSON.stringify(this.icon()) + \")\";\r\n\t}\r\n\tif(typeof this.text() != \"undefined\"){\r\n\t\tstr += \".text(\" + JSON.stringify(this.text()) + \")\";\r\n\t}\r\n\tif(typeof this.border() != \"undefined\"){\r\n\t\tstr += \".border(\" + JSON.stringify(this.border()) + \")\";\r\n\t}\r\n\tif(typeof this.args() != \"undefined\"){\r\n\t\tstr += \".args(\" + JSON.stringify(this.args()) + \")\";\r\n\t}\r\n\tif(typeof this.renderer() != \"undefined\"){\r\n\t\tstr += \".renderer('\" + this.renderer() + \"')\";\r\n\t}\r\n\tif(typeof this.render() != \"undefined\"){\r\n\t\tstr += \".render(\" + this.render() + \")\";\r\n\t}\r\n\tif(typeof this.click() != \"undefined\"){\r\n\t\tstr += \".click(\" + this.click() + \")\";\r\n\t}\r\n\tif(typeof this.hover() != \"undefined\"){\r\n\t\tstr += \".hover(\" + this.hover() + \")\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nWOQLViewRule.prototype.json = function(mjson){\r\n\tif(!mjson) {\r\n\t\tvar json = { }\r\n\t\tif(this.pattern) json.pattern = this.pattern.json();\r\n\t\tjson.rule = this.rule;\r\n\t    return json;\r\n\t}\r\n\tthis.rule = mjson.rule || {};\r\n\tif(mjson.pattern) this.pattern.setPattern(mjson.pattern);\r\n\treturn this;\r\n}\r\n\r\n\r\nWOQLViewRule.prototype.size = function(size){\r\n\tif(typeof size == \"undefined\"){\r\n\t\treturn this.rule.size;\r\n\t}\r\n\tthis.rule.size = size;\r\n\treturn this;\r\n}\r\n\r\nWOQLViewRule.prototype.color = function(color){\r\n\tif(typeof color == \"undefined\"){\r\n\t\treturn this.rule.color;\r\n\t}\r\n\tthis.rule.color = color;\r\n\treturn this;\r\n}\r\n\r\nWOQLViewRule.prototype.icon = function(json){\r\n\tif(json){\r\n\t\tthis.rule.icon = json;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.icon;\r\n}\r\n\r\nWOQLViewRule.prototype.text = function(json){\r\n\tif(json){\r\n\t\tthis.rule.text = json;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.text;\r\n}\r\n\r\nWOQLViewRule.prototype.border = function(json){\r\n\tif(json){\r\n\t\tthis.rule.border = json;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.border;\r\n}\r\n\r\nWOQLViewRule.prototype.renderer = function(rend){\r\n\tif(typeof rend == \"undefined\"){\r\n\t\treturn this.rule.renderer;\r\n\t}\r\n\tthis.rule.renderer = rend;\r\n\treturn this;\r\n}\r\n\r\n\r\nWOQLViewRule.prototype.render = function(func){\r\n\tif(typeof func == \"undefined\"){\r\n\t\treturn this.rule.render;\r\n\t}\r\n\tthis.rule.render = func;\r\n\treturn this;\r\n}\r\n\r\nWOQLViewRule.prototype.click = function(onClick){\r\n\tif(onClick){\r\n\t\tthis.rule.click = onClick;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.click;\r\n}\r\n\r\nWOQLViewRule.prototype.hover = function(onHover){\r\n\tif(onHover){\r\n\t\tthis.rule.hover = onHover;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.hover;\r\n}\r\n\r\nWOQLViewRule.prototype.hidden = function(hidden){\r\n\tif(typeof hidden == \"undefined\"){\r\n\t\treturn this.rule.hidden;\r\n\t}\r\n\tthis.rule.hidden = hidden;\r\n\treturn this;\r\n}\r\n\r\nWOQLViewRule.prototype.args = function(args){\r\n\tif(typeof args == \"undefined\"){\r\n\t\treturn this.rule.args;\r\n\t}\r\n\tthis.rule.args = args;\r\n\treturn this;\r\n}\r\n\r\nmodule.exports = {WOQLViewRule, ViewConfig}\r\n\r\n","const TerminusRule = require('./terminusRule.js');\r\n\r\nfunction FrameRule(){\r\n\tTerminusRule.TerminusRule.call(this); \r\n\tthis.pattern = new FramePattern();\r\n}\r\nFrameRule.prototype = Object.create(TerminusRule.TerminusRule.prototype);\r\nFrameRule.prototype.constructor = TerminusRule.TerminusRule;\r\n\r\n/**\r\n * Returns an array of rules that match the paased frame\r\n * @param {[FrameRule]} rules - array of rules to be tested\r\n * @param {Frame} frame - object frame, property frame or data from to be tested\r\n * @param {function} [onmatch] - optional function to be called with args (frame, rule) on each match \r\n */\r\nFrameRule.prototype.testRules = function(rules, frame, onmatch){\r\n\tvar matched_rules = [];\r\n\tif(rules && rules.length){\r\n\t\tfor(var i = 0; i<rules.length; i++){\r\n\t\t\tvar match = (!rules[i].pattern || this.patternMatchesFrame(rules[i].pattern, frame));\r\n\t\t\tif(match){\r\n\t\t\t\tmatched_rules.push(rules[i]);\r\n\t\t\t\tif(onmatch && typeof onmatch == \"function\"){\r\n\t\t\t\t\tonmatch(frame, rules[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn matched_rules;\r\n}\r\n\r\n/**\r\n * Determines whether a given pattern matches a given frame\r\n */\r\nFrameRule.prototype.patternMatchesFrame = function(pattern, frame){\r\n\tif(pattern.checkFrame) {\r\n\t\treturn pattern.checkFrame(frame);\r\n\t}\r\n\telse {\r\n\t\tvar fp = new FramePattern().setPattern(pattern);\r\n\t\treturn fp.checkFrame(frame);\r\n\t}\r\n}\r\n\r\n/**\r\n * Specifies that only one from among the list of properties will match \r\n */\r\nFrameRule.prototype.property = function(...prop){\r\n    if(!prop || prop.length == 0) return this.pattern.property;\r\n    this.pattern.property = prop;\r\n    return this;\r\n}\r\n\r\n/**\r\n * Specifies that only one from among the list of frame_types will match\r\n * frame_types are: data, oneOf, document, object? \r\n */\r\nFrameRule.prototype.frame_type = function(...frame_type){\r\n    if(!frame_type || frame_type.length == 0) return this.pattern.frame_type;\r\n    this.pattern.frame_type = frame_type;\r\n    return this;\r\n}\r\n\r\n/**\r\n * Specifies that only one from among the list of labels will match\r\n */\r\nFrameRule.prototype.label = function(...prop){\r\n    if(!prop || prop.length == 0) return this.pattern.label;\r\n    this.pattern.label = prop;\r\n    return this;\r\n}\r\n\r\n/**\r\n * Specifies that only one from among the list of subject ids will match\r\n */\r\nFrameRule.prototype.subject = function(...prop){\r\n    if(!prop|| prop.length == 0) return this.pattern.subject;\r\n    this.pattern.subject = prop;\r\n    return this;\r\n}\r\n\r\n/**\r\n * Specifies that only one from among the list of subject classes will match\r\n */\r\nFrameRule.prototype.subjectClass = function(...prop){\r\n    if(!prop || prop.length == 0) return this.pattern.subjectClass;\r\n    this.pattern.subjectClass = prop;\r\n    return this;\r\n}\r\n\r\n/**\r\n * Specifies that only one from among the list of range types will match\r\n */\r\nFrameRule.prototype.range = function(...prop){\r\n    if(!prop || prop.length == 0) return this.pattern.range;\r\n    this.pattern.range = prop;\r\n    return this;\r\n}\r\n\r\n/**\r\n * Specifies that only frames of the specified depth will match the rule\r\n */\r\nFrameRule.prototype.depth = function(depth){\r\n    if(typeof depth == \"undefined\") return this.pattern.depth;\r\n    this.pattern.depth=depth;\r\n    return this;\r\n}\r\n\r\n/**\r\n * Specifies that only frames of the specified index will match the rule (index is the order of a value in the property frame)\r\n */\r\nFrameRule.prototype.index = function(...index){\r\n    if(!index || index.length == 0) return this.pattern.index;\r\n    this.pattern.index=index;\r\n    return this;\r\n}\r\n\r\n/**\r\n * Specifies that only frames with the given statuses will match the rule\r\n */\r\nFrameRule.prototype.status = function(...status){\r\n    if(!status || status.length == 0) return this.pattern.status;\r\n    this.pattern.status=status;\r\n    return this;\r\n}\r\n\r\n/**\r\n * Specifies that the frame will only match if its parent matches the pattern passed as par\r\n */\r\nFrameRule.prototype.parent = function(par){\r\n    if(!par) return this.pattern.parent;\r\n    this.pattern.parent = par;\r\n    return this;\r\n}\r\n\r\nFrameRule.prototype.children = function(...children){\r\n\tif(typeof children == \"undefined\" || children.length == 0) return this.pattern.children;\r\n\tif(typeof this.pattern.children == \"undefined\"){\r\n\t\tthis.pattern.children = [];\r\n\t}\r\n\tfor (let i = 0; i < children.length; i++) {\r\n\t\tthis.pattern.children.push(children[i]);\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nfunction FramePattern(){\r\n\tTerminusRule.TerminusPattern.call(this); \r\n};\r\n\r\nFramePattern.prototype = Object.create(TerminusRule.TerminusPattern.prototype);\r\nFramePattern.prototype.constructor = TerminusRule.TerminusPattern;\r\n\r\n/**\r\n * A frame pattern can have the following variables\r\n * scope : object, property, data, * - matches a specific part of the frame\r\n * label : matches the label of a property\r\n * frame_type: object, data, document, id, oneOf\r\n * subject: id of the subject\r\n * subjectClass: class of the subject\r\n * range: type of a property (applies to property and data)\r\n * property: property id or list of property ids (parent property if it is an object or data)\r\n * value: value of the property\r\n * parent: a pattern relating to the parent of this frame\r\n * children: patterns for matching on the children of a frame\r\n * depth: how deep are we in the document? starts from 0\r\n * index: the index of a value in an array\r\n * status: updated, error, new, ok,\r\n */\r\n\r\nFramePattern.prototype.setPattern = function(pattern){\r\n\tif(pattern.scope) this.scope = pattern.scope;\r\n\tif(typeof pattern.literal != \"undefined\") this.literal = pattern.literal;\r\n\tif(typeof pattern.type != \"undefined\") this.type = pattern.type;\r\n\tif(typeof pattern.label != \"undefined\") this.label = pattern.label;\r\n\tif(typeof pattern.frame_type != \"undefined\") this.frame_type = pattern.frame_type ;\r\n\tif(typeof pattern.subject != \"undefined\") this.subject = pattern.subject;\r\n\tif(typeof pattern.subjectClass != \"undefined\") this.subjectClass = pattern.subjectClass;\r\n\tif(typeof pattern.range != \"undefined\") this.range = pattern.range;\r\n\tif(typeof pattern.property != \"undefined\") this.property = pattern.property;\r\n\tif(typeof pattern.value != \"undefined\") this.value = pattern.value;\r\n\tif(typeof pattern.parent != \"undefined\"){\r\n\t\tlet parent = pattern.parent;\r\n\t\tif(typeof parent.json != \"function\"){ \r\n\t\t\tparent = new FramePattern().setPattern(parent);\r\n\t\t}\r\n\t\tthis.parent = parent;\r\n\t} \r\n\tif (pattern.children) {\r\n\t\tthis.children = [];\r\n\t\tfor (let i = 0; i < pattern.children.length; i++) {\r\n\t\t\tvar kid = pattern.children[i];\r\n\t\t\tif(typeof kid.json != \"function\"){ \r\n\t\t\t\tkid = new FramePattern().setPattern(kid);\r\n\t\t\t}\r\n\t\t\tthis.children.push(kid);\r\n\t\t}\r\n\t}\r\n\tif(typeof pattern.depth != \"undefined\") this.depth = pattern.depth;\r\n\tif(typeof pattern.index != \"undefined\") this.index = pattern.index;\r\n\tif(typeof pattern.status != \"undefined\") this.status = pattern.status;\r\n}\r\n\r\nFramePattern.prototype.json = function(){\r\n    var json = {};\r\n\tif(typeof this.literal != \"undefined\") json.literal = this.literal;\r\n\tif(this.type) json.type = this.type;\r\n    if(this.scope) json.scope = this.scope;\r\n    if(typeof this.value != \"undefined\") json.value = this.value;\r\n    if(typeof this.label != \"undefined\") json.label = this.label;\r\n    if(typeof this.frame_type != \"undefined\") json.frame_type = this.frame_type;\r\n    if(typeof this.subject != \"undefined\") json.subject = this.subject;\r\n    if(typeof this.subjectClass != \"undefined\") json.subjectClass = this.subjectClass;\r\n    if(typeof this.range != \"undefined\") json.range = this.range;\r\n    if(typeof this.property != \"undefined\") json.property = this.property;\r\n    if(typeof this.parent != \"undefined\") json.parent = (this.parent.json ? this.parent.json() : this.parent);\r\n    if(typeof this.children != \"undefined\") {\r\n\t\tjson.children = [];\r\n\t\tfor(var i = 0; i<this.children.length; i++){\r\n\t\t\tjson.children.push((this.children[i].json ? this.children[i].json() : this.children[i]));\r\n\t\t}\r\n\t}\r\n    if(typeof this.depth != \"undefined\") json.depth = this.depth;\r\n    if(typeof this.index != \"undefined\") json.index = this.index;\r\n    if(typeof this.status != \"undefined\") json.status = this.status;\r\n    return json;\r\n}\r\n\r\nFramePattern.prototype.checkFrame = function(frame){\r\n\tvar rtype = this.getRendererType(frame);\r\n\tif(!rtype) return false;\r\n\tif(this.scope && (this.scope != rtype) && (this.scope != \"*\" )) return false;\r\n\tif(this.illegalRuleType(rtype)) return false;\r\n\tif(this.frame_type && !this.checkFrameType(rtype, frame)) return false;\r\n\tif(this.label && !this.checkLabel(rtype, frame)) return false;\r\n\tif(this.subject && !this.checkSubject(rtype, frame)) return false;\r\n\tif(this.subjectClass && !this.checkSubjectClass(rtype, frame)) return false;\r\n\tif(this.property && !this.checkProperty(rtype, frame)) return false;\r\n\tif(typeof this.depth !== \"undefined\" && !this.checkDepth(rtype, frame)) return false;\r\n\tif(this.range && !this.checkRange(rtype, frame)) return false;\r\n\tif(typeof this.value != \"undefined\" && !this.checkValue(rtype, frame)) return false;\r\n\tif(this.type && !this.checkType(rtype, frame)) return false;\r\n\tif(typeof this.literal != \"undefined\" && !this.checkLiteral(rtype, frame)) return false;\r\n\tif(this.parent && !this.checkParent(rtype, frame)) return false;\r\n\tif(this.children && this.children.length && !this.checkChildren(rtype, frame)) return false;\r\n\tif(this.index && !this.checkIndex(rtype, frame)) return false;\r\n\tif(this.status && !this.checkStatus(rtype, frame)) return false;\r\n\treturn true;\r\n};\r\n\r\nFramePattern.prototype.prettyPrint = function(type){\r\n\t//starts with obj. ...\r\n\tif(this.scope == \"*\"){\r\n\t\tvar str = \"all()\";\r\n\t}\r\n\telse {\r\n\t\tvar str = this.scope + \"()\";\r\n    }\r\n    if(typeof this.literal != \"undefined\"){\r\n\t\tstr += \".literal(\" + this.literal + \")\";\r\n\t}\r\n\tif(typeof this.type != \"undefined\"){\r\n\t\tstr += \".type(\" + this.unpack(this.type) + \")\";\r\n\t}\r\n\tif(typeof this.range != \"undefined\"){\r\n\t\tstr += \".range(\" + this.unpack(this.range) + \")\";\r\n\t}\r\n\tif(typeof this.frame_type != \"undefined\"){\r\n\t\tstr += \".frame_type(\" + this.unpack(this.frameType) + \")\";\r\n\t}\r\n\tif(typeof this.label != \"undefined\"){\r\n\t\tstr += \".label(\" + this.unpack(this.label) + \")\";\r\n\t}\r\n\tif(typeof this.subject != \"undefined\"){\r\n\t\tstr += \".subject(\" + this.unpack(this.subject) + \")\";\r\n\t}\r\n\tif(typeof this.subjectClass != \"undefined\"){\r\n\t\tstr += \".subjectClass(\" + this.unpack(this.subjectClass) + \")\";\r\n\t}\r\n\tif(typeof this.property != \"undefined\"){\r\n\t\tstr += \".property(\" + this.unpack(this.property) + \")\";\r\n\t}\r\n\tif(typeof this.value != \"undefined\"){\r\n\t\tstr += \".value(\" + this.unpack(this.value, true) + \")\";\r\n\t}\r\n\tif(typeof this.children != \"undefined\" && this.children.length > 0){\r\n\t\tstr += \".children(\\n\";\r\n\t\tvar kids = this.children;\r\n\t\tfor(var i = 0; i< kids.length; i++){\r\n\t\t\tstr += \"View.pattern().\" + kids[i].prettyPrint();\r\n\t\t\tif(i < kids.length-1) str += \",\";\r\n\t\t\tstr += \"\\n\";\r\n\t\t}\r\n\t\tstr += \")\";\r\n\t}\r\n\tif(typeof this.parent != \"undefined\"){\r\n\t\tstr += \".parent(View.pattern().\" + this.parent.prettyPrint() + \")\";\r\n\t}\r\n\tif(typeof this.depth != \"undefined\"){\r\n\t\tstr += \".depth(\" + this.unpack(this.depth, true) + \")\";\r\n\t}\r\n\tif(typeof this.index != \"undefined\"){\r\n\t\tstr += \".index(\" + this.unpack(this.index, true) + \")\";\r\n\t}\r\n\tif(typeof this.status != \"undefined\"){\r\n\t\tstr += \".status(\" + this.unpack(this.status) + \")\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nFramePattern.prototype.illegalRuleType = function (rtype) {\r\n\t// data frames have no children\r\n\tif (rtype == 'data' && this.children && this.children.length) return true;\r\n\t// object frames have no range\r\n\tif (rtype == 'object' && this.range) return true;\r\n\treturn false;\r\n};\r\n\r\n/* subject is an id or an array of ids,\r\n/* match is positive if the renderer's subject appears in the array or is the id\r\n */\r\nFramePattern.prototype.checkSubject = function (subject, frame) {\r\n\tif (typeof this.subject !== 'object' || !this.subject.length) this.subject = [this.subject];\r\n\tconst rsubj = frame.subject();\r\n\tfor (let i = 0; i < this.subject.length; i++) {\r\n\t\tif (this.IDsMatch(subject[i], rsubj)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n// at least one child must match all child rules\r\nFramePattern.prototype.checkChildren = function (rtype, frame) {\r\n\tfor (let i = 0; i < this.children.length; i++) {\r\n\t\tlet found = false;\r\n\t\tif (rtype == 'object') {\r\n\t\t\tfor (const prop in frame.properties) {\r\n\t\t\t\tif (this.children[i].checkFrame(frame.properties[prop])) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (rtype == 'property') {\r\n\t\t\tfor (let j = 0; j <= renderer.values.length; j++) {\r\n\t\t\t\tif (this.children[j].checkFrame(frame.values[j])) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!found) return false;\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nFramePattern.prototype.checkStatus = function (rtype, frame) {\r\n\tif (typeof this.status !== 'object' || this.status.length == 0) this.status = [this.status];\r\n\tfor (let i = 0; i < this.status.length; i++) {\r\n\t\tif (this.status[i] == 'updated' && !frame.isUpdated()) return false;\r\n\t\tif (this.status[i] == 'new' && !frame.isNew()) return false;\r\n\t\tif (this.status[i] == 'unchanged' && frame.isUpdated()) return false;\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nFramePattern.prototype.checkDepth = function (rtype, frame) {\r\n\treturn this.numberMatch(this.depth, frame.depth());\r\n};\r\n\r\nFramePattern.prototype.checkParent = function (rtype, frame) {\r\n\treturn this.parent.checkFrame(frame.parent);\r\n};\r\n\r\nFramePattern.prototype.checkIndex = function (rtype, frame) {\r\n\tif (rtype == 'data') {\r\n\t\treturn this.index == frame.index;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nFramePattern.prototype.checkProperty = function (rtype, frame) {\r\n\tif (typeof this.property !== 'object' || !this.property.length) this.property = [this.property];\r\n\tfor (let i = 0; i < this.property.length; i++) {\r\n\t\tif (this.propertyIDsMatch(frame.property(), this.property[i])) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n\r\n/**\r\n * Checks to make sure the frame is among the specified types \r\n */\r\nFramePattern.prototype.checkType = function (rtype, frame) {\r\n\tif(rtype == \"object\") var vs = frame.subjectClass();\r\n\telse var vs = frame.range();\r\n\tif(!Array.isArray(this.type)) this.type = [this.type];\r\n\tif(this.type.indexOf(vs) === -1) return false;\r\n\treturn true;\r\n}\r\n\r\nFramePattern.prototype.checkLiteral = function (rtype, frame) {\r\n\tif(rtype == \"object\") return false;\r\n\tif(rtype == \"property\") return false;\r\n\tif(rtype == \"data\") return frame.isDatatypeProperty();\r\n\treturn true;\r\n}\r\n\r\n\r\n// returns true if any of the values are found\r\nFramePattern.prototype.checkValue = function (rtype, frame) {\r\n\tif (typeof this.value !== 'object' || !this.value.length) this.value = [this.value];\r\n\tfor (let i = 0; i < this.value.length; i++) {\r\n\t\tif (rtype == 'data') {\r\n\t\t\tif (this.valuesMatch(frame.value(), this.value[i])) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else if (rtype == 'property') {\r\n\t\t\tfor (let j = 0; j <= frame.values.length; j++) {\r\n\t\t\t\tif (this.getRendererType(frame.values[i]) == 'data'\r\n\t\t\t\t\t\t&& this.valuesMatch(frame.values[i].get(), this.value[i])) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (rtype == 'object') {\r\n\t\t\tfor (const prop in frame.properties) {\r\n\t\t\t\tif (this.checkValue(this.getRendererType(frame.properties[prop]), frame.properties[prop])) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nFramePattern.prototype.checkRange = function (rtype, frame) {\r\n\tif (typeof this.range !== 'object' || !this.range.length) this.range = [this.range];\r\n\tfor (let i = 0; i < this.range.length; i++) {\r\n\t\tif (this.rangeIDsMatch(frame.range(), this.range[i])) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nFramePattern.prototype.checkSubjectClass = function (rtype, frame) {\r\n\tif (typeof this.subjectClass !== 'object' || !this.subjectClass.length) this.subjectClass = [this.subjectClass];\r\n\tconst rcls = frame.subjectClass();\r\n\tfor (let i = 0; i < this.subjectClass.length; i++) {\r\n\t\tif (this.classIDsMatch(this.subjectClass[i], rcls)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nFramePattern.prototype.checkFrameType = function (rtype, frame) {\r\n\tif (rtype == 'object') return (this.frame_type.indexOf('object') != -1);\r\n\tif (rtype == 'data') {\r\n\t\tif (frame.frame) {\r\n\t\t\treturn (this.frame_type.indexOf(frame.frame.ftype()) != -1);\r\n\t\t}\r\n\t}\r\n\tif (rtype == 'property') return false;\r\n};\r\n\r\nFramePattern.prototype.checkLabel = function (rtype, frame) {\r\n\tif (typeof frame.getLabel !== 'function') {\r\n\t\tconsole.log(new Error('Rule passed to check label with broken renderer object - no getLabel'));\r\n\t\treturn false;\r\n\t}\r\n\tfor (let i = 0; i < this.label.length; i++) {\r\n\t\tif(this.stringMatch(this.label[i], frame.getLabel())) return true;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n\r\nFramePattern.prototype.getRendererType = function (frame) {\r\n\tif (frame.isProperty()) return 'property';\r\n\tif (frame.isObject()) return 'object';\r\n\tif (frame.isData()) return 'data';\r\n\tif (frame.renderer_type) return frame.renderer_type;\r\n\tconsole.log(new Error(`frame configuration passed non-renderer type ${frame.constructor.name}`));\r\n\tconsole.log(renderer);\r\n\treturn false;\r\n};\r\n\r\nmodule.exports = FrameRule;","function getErrorAsMessage(url, api, err) {\r\n\tlet str = '';\r\n\tif (err.response) {\r\n\t\terr = err.response;\r\n\t\tif (err.data) str += `${formatErrorMessage(err.data)}`;\r\n\t} else if (err.body) str += `${formatErrorMessage(err.body)}`;\r\n\turl = url.split(\"?\")[0];\r\n\r\n\tif (err.status) str += `Code: ${err.status}`;\r\n\tif (err.action) str += ` Action: ${err.action}`;\r\n\tif (err.type) str += ` Type: ${err.type}`;\r\n\tif (url) str += ` url: ${url}`;\r\n\tif (api && api.method) str += ` method: ${api.method}`;\r\n\treturn str;\r\n}\r\n\r\nfunction formatErrorMessage(msg) {\r\n\tif (typeof msg === 'object') {\r\n\t\tlet nmsg = '';\r\n\t\tfor (const key of Object.keys(msg)) {\r\n\t\t\tif(msg[key] && typeof msg[key] != \"object\")\r\n\t\t\tnmsg += `${key} ${msg[key]} `;\r\n\t\t}\r\n\t\treturn nmsg;\r\n\t}\r\n\treturn msg;\r\n}\r\n\r\nfunction accessDenied(action, db, server) {\r\n\tconst err = {};\r\n\terr.status = 403;\r\n\terr.url = (server || '') + (db || '');\r\n\terr.type = 'client';\r\n\terr.action = action;\r\n\terr.body = `${err.action} not permitted for ${err.url}`;\r\n\treturn err;\r\n}\r\n\r\nfunction getAPIErrorMessage(url, api, err) {\r\n\treturn `API Error ${getErrorAsMessage(url, api, err)}`;\r\n}\r\n\r\nfunction getAccessDeniedMessage(url, api, err) {\r\n\treturn `Access Denied ${getErrorAsMessage(url, api, err)}`;\r\n}\r\n\r\nfunction getInvalidURIMessage(url, call) {\r\n\tconst str = `Invalid argument to\r\n            ${call}. \r\n            ${url}\r\n            is not a valid Terminus DB API endpoint`;\r\n\treturn str;\r\n}\r\n\r\n/**\r\n * Utility functions for generating and retrieving error messages\r\n * and storing error state\r\n */\r\n\r\nfunction parseAPIError(response) {\r\n\tconst err = {};\r\n\terr.status = response.status;\r\n\terr.type = response.type;\r\n\tif (response.data && typeof response.data === 'object') {\r\n\t\tlet msg;\r\n\t\ttry {\r\n\t\t\tmsg = response.text();\r\n\t\t} catch (e) {\r\n\t\t\ttry {\r\n\t\t\t\tmsg = response.json();\r\n\t\t\t} catch (error) {\r\n\t\t\t\tmsg = response.toString();\r\n\t\t\t}\r\n\t\t}\r\n\t\terr.body = msg;\r\n\t} else if (response.data) err.body = response.data;\r\n\terr.url = response.url;\r\n\terr.headers = response.headers;\r\n\terr.redirected = response.redirected;\r\n\treturn err;\r\n}\r\n\r\n\r\nmodule.exports = {\r\n\tgetErrorAsMessage,\r\n\tgetAPIErrorMessage,\r\n\tgetAccessDeniedMessage,\r\n\taccessDenied,\r\n\tgetInvalidURIMessage,\r\n\tparseAPIError\r\n};\r\n","const QueryPane = require(\"./QueryPane\");\r\nconst DocumentPane = require(\"./DocumentPane\");\r\nconst TerminusClient = require('@terminusdb/terminus-client');\r\n\r\nfunction TerminusViewer(client){\r\n    this.client = client;\r\n}\r\n\r\nTerminusViewer.prototype.TerminusClient = function(){\r\n    return TerminusClient;\r\n}\r\n\r\nTerminusViewer.prototype.getDocumentPane = function(docid, docConfig, docPaneConfig){\r\n    var dp = new DocumentPane(this.client, docid);\r\n    dp.view = docConfig;\r\n    if(docPaneConfig) dp.options(docPaneConfig);\r\n    else dp.options(dp.defaultPaneView);\r\n    return dp;   \r\n}\r\n\r\nTerminusViewer.prototype.getDocument = function(docid, docConfig, docJSON){\r\n    return this.getDocumentPane(docid, docConfig);\r\n}\r\n\r\nTerminusViewer.prototype.getNewDocumentPane = function(cls, docConfig, docPaneConfig){\r\n    var dp = new DocumentPane(this.client, false, cls);\r\n    dp.view = docConfig;\r\n    if(docPaneConfig) dp.options(docPaneConfig);\r\n    else dp.options(dp.defaultPaneView);\r\n    return dp;   \r\n}\r\n\r\n\r\nTerminusViewer.prototype.getQueryPane = function(query, resultConfigs, results, resultPaneConfigs, queryPaneConfig){\r\n    var qp = new QueryPane(this.client, query, results);\r\n    if(queryPaneConfig) qp.options(queryPaneConfig);\r\n    else qp.options(qp.defaultQueryView);\r\n    if(resultConfigs && resultConfigs.length){\r\n        for(var i = 0 ; i < resultConfigs.length; i++){\r\n            var rpc = (resultPaneConfigs && resultPaneConfigs[i] ? resultPaneConfigs[i] : qp.defaultResultView);\r\n            qp.addView(resultConfigs[i], rpc);\r\n        }\r\n    }\r\n    return qp;\r\n}\r\n\r\nTerminusViewer.prototype.getResult = function(query, resultConfig, results){\r\n    return this.getQueryPane(query, [resultConfig], results);\r\n}\r\n\r\nmodule.exports = TerminusViewer;","const TerminusClient = require('@terminusdb/terminus-client');\r\nconst UTILS = require('../../Utils');\r\nconst HTMLHelper = require(\"../HTMLHelper\")\r\n/*\r\nqObj: WOQL object\r\nwidth: width of snippet in px\r\nheight: height of snippet in px\r\n*/\r\nfunction TerminusCodeSnippet(language, mode, format, width, height, placeholder){\r\n\tthis.language = (language ? language : \"woql\");//woql / rule\r\n\tthis.mode = (mode ? mode : \"view\");\r\n    this.width = (width ? width : 1200);\r\n\tthis.height = (height ? height : 300);\r\n\tthis.placeholder = (placeholder ? placeholder : \"\");\r\n    this.format = (format ? format : \"js\");\r\n    this.formats = {'js': \"WOQL.js\", 'jsonld': \"JSON-LD\"};\r\n    if(this.mode == 'view')\r\n        this.snippet = document.createElement('pre');\r\n    else {\r\n    \tthis.snippet = document.createElement('textarea');\r\n    \tthis.snippet.setAttribute(\"spellcheck\", \"false\");\r\n\t\tthis.snippet.setAttribute(\"class\", \"terminus-code-snippet\");\r\n    }\r\n}\r\n\r\nTerminusCodeSnippet.prototype.setQuery = function(q){\r\n\tthis.qObj = q;\r\n\tthis.refreshContents();\r\n}\r\n\r\nTerminusCodeSnippet.prototype.serialise = function(query, format){\r\n\tif(format == \"js\"){\r\n\t\treturn query.prettyPrint(4);\r\n\t}\r\n\telse {\r\n\t\treturn JSON.stringify(query.json(), undefined, 2);\r\n\t}\r\n}\r\n\r\n//parses a string encoding a woql in either json or js notation\r\nTerminusCodeSnippet.prototype.parseText = function(text, format){\r\n\ttry {\r\n\t\tvar WOQL = TerminusClient.WOQL;\r\n\t\tvar View = TerminusClient.View;\r\n\t\tif(format == \"js\"){\r\n\t\t\tvar nw = eval(text);\r\n\t\t\tif(this.language == \"rule\"){\r\n\t\t\t\tthis.view = view;\r\n\t\t\t\treturn view;\r\n\t\t\t}\r\n\t\t\treturn nw;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar qval = JSON.parse(text);\r\n\t\t\tif(this.language == \"woql\"){\r\n\t\t\t\treturn WOQL.json(qval);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn View.loadConfig(qval);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tcatch(e){\r\n\t\tthis.error = \"Failed to parse Query \" + e.toString() + \" \" + text;\r\n\t\treturn this.error;\r\n\t\t//return false;\r\n\t}\r\n}\r\n\r\nTerminusCodeSnippet.prototype.getInputElement = function(){\r\n\treturn this.snippet;\r\n}\r\n\r\nTerminusCodeSnippet.prototype.readInput = function(){\r\n\tif(this.mode == \"edit\") {\r\n\t\tthis.qObj = this.parseText(this.snippet.value, this.format);\r\n\t\treturn this.qObj;\r\n\t}\r\n\treturn this.qObj;\r\n}\r\n\r\nTerminusCodeSnippet.prototype.get = function(){\r\n\treturn this.readInput();\r\n}\r\n\r\nTerminusCodeSnippet.prototype.getAsDOM = function(with_buttons){\r\n    var scont = document.createElement('div');\r\n\tscont.setAttribute('class', 'terminus-snippet-container')\r\n    // query\r\n    var snpc = document.createElement('div');\r\n    if(this.placeholder){\r\n\t\tthis.snippet.setAttribute(\"placeholder\", this.placeholder);\r\n\t}\r\n    snpc.appendChild(this.getFormatButtons());\r\n    if(this.qObj){\r\n    \tvar serial = this.serialise(this.qObj, this.format);\r\n\t\tif(this.mode == \"edit\"){\r\n    \t\tthis.snippet.value = serial;\r\n    \t}\r\n    \telse {\r\n    \t\tthis.snippet.appendChild(document.createTextNode(serial));\r\n    \t}\r\n\t}\r\n\telse {\r\n\t\tthis.snippet.value = \"\";\r\n\t}\r\n    snpc.appendChild(this.snippet);\r\n    if(this.mode == \"edit\"){\r\n\t\tvar ssb = document.createElement(\"span\");\r\n\t\tssb.setAttribute(\"class\", \"terminus-query-submit-buttons\");\r\n\t\tvar actbtn = this.getSubmitButton();\r\n\t\tssb.appendChild(actbtn);\r\n    \tsnpc.appendChild(ssb);\r\n    }\r\n    scont.appendChild(snpc);\r\n    return scont;\r\n}\r\n\r\nTerminusCodeSnippet.prototype.changeRuleView = function(nview){\r\n\tthis.snippet.value = \"view = WOQL.\"+ nview + \"()\";\r\n\tthis.readInput();\r\n\tthis.submit(this.qObj);\r\n}\r\n\r\n\r\nTerminusCodeSnippet.prototype.getIconsDOM = function(){\r\n    var bsp = document.createElement('span');\r\n    bsp.setAttribute('class', 'terminus-snippet-icons');\r\n    for(var i = 0; i<this.view_types.length; i++){\r\n\t\tvar isp = document.createElement('span');\r\n\t\tvar icon = document.createElement(\"i\");\r\n\t\ticon.title = this.view_types[i].label;\r\n\t\ticon.setAttribute(\"class\", this.view_types[i].icon);\r\n\t\tisp.appendChild(icon);\r\n\t\tisp.name = this.view_types[i].id;\r\n\t\tvar self = this;\r\n\t\tisp.addEventListener('click', function(){\r\n\t\t\tif(!(self.view && self.view.type == this.name)){\r\n\t\t\t\tself.changeRuleView(this.name);\r\n\t\t\t}\r\n\t\t});\r\n\t\tisp.addEventListener('mouseover', function(){\r\n\t\t\tif(!(self.view && self.view.type == this.name)){\r\n\t\t\t\tthis.style.cursor = \"pointer\";\r\n\t\t\t}\r\n\t\t});\r\n\t\tbsp.appendChild(isp);\r\n    }\r\n    return bsp;\r\n}\r\n\r\nTerminusCodeSnippet.prototype.getFormatButtons = function(){\r\n    var bsp = document.createElement('span');\r\n    bsp.setAttribute('class', 'terminus-snippet-panel');\r\n    //if(this.width) bsp.setAttribute(\"style\", \"width: \"+ this.width +\"px;\");\r\n    for(f in this.formats){\r\n        var btn = document.createElement('button');\r\n        btn.setAttribute('value', f);\r\n        btn.setAttribute('class', 'terminus-snippet-button');\r\n\t\tif(f == 'js') btn.classList.add('terminus-snippet-format-selected');\r\n        btn.appendChild(document.createTextNode(this.formats[f]));\r\n        var self = this;\r\n        btn.addEventListener('click', function(){\r\n\t\t\tUTILS.setSelected(this, 'terminus-snippet-format-selected');\r\n\t\t\tvar qobj = self.parseText(self.snippet.value, self.format);\r\n\t\t\tself.format = this.value;\r\n\t\t\tif(qobj) self.qObj = qobj;\r\n\t\t\tself.refreshContents();\r\n        })\r\n        bsp.appendChild(btn);\r\n    }\r\n    return bsp;\r\n}\r\n\r\nTerminusCodeSnippet.prototype.getSubmitButton = function(){\r\n    var actbtn = document.createElement('button');\r\n    actbtn.setAttribute('class', 'terminus-btn');\r\n\tactbtn.setAttribute('type', 'submit');\r\n\tvar txt = \"Submit\";\r\n\tif(this.language == \"WOQL\"){\r\n\t\ttxt = \"Submit Query\";\r\n\t}\r\n\telse if(this.language == \"rule\") {\r\n\t\ttxt = \"Update View\";\r\n\t}\r\n\telse if(this.language == \"code\"){\r\n\t\ttxt = \"Run Script\";\r\n\t}\r\n    actbtn.appendChild(document.createTextNode(txt));\r\n    actbtn.addEventListener('click', () => {\r\n\t\tthis.readInput();\r\n\t\tthis.submit(this.qObj);\r\n    });\r\n    return actbtn;\r\n}\r\n\r\nTerminusCodeSnippet.prototype.submit = function(){\r\n\talert(\"Submitted \" + JSON.stringify(this.qObj));\r\n}\r\n\r\nTerminusCodeSnippet.prototype.removeCodeMirror = function(){\r\n\tvar cm = this.snippet.nextSibling;\r\n\tif(!cm) return;\r\n\tif(cm.classList.contains('CodeMirror')) // remove code mirror\r\n\tHTMLHelper.removeElement(cm);\r\n}\r\n\r\nTerminusCodeSnippet.prototype.stylizeSnippet = function(){\r\n\tvar dimensions = \"query\";\r\n\t//dimensions.width = \"1000\";//this.width;\r\n\t//dimensions.height = \"1000\";//this.height;\r\n\r\n\tthis.removeCodeMirror();\r\n\tif(this.mode == 'view')\r\n\t\tUTILS.stylizeCodeDisplay(null, this.snippet, null, 'javascript');\r\n\telse UTILS.stylizeEditor(null, this.snippet, dimensions, 'javascript'); // default view is js\r\n}\r\n\r\nTerminusCodeSnippet.prototype.refreshContents = function(qObj){\r\n\tqObj = qObj ? qObj : this.qObj;\r\n\tHTMLHelper.removeChildren(this.snippet);\r\n\tif(this.mode == \"edit\") this.snippet.value == \"\";\r\n\tif(!qObj) return;\r\n\tvar serial = this.serialise(this.qObj, this.format);\r\n\tif(this.mode == \"edit\"){\r\n\t\tthis.snippet.value = serial;\r\n\t\tif(this.snippet.nextSibling){\r\n\t\t\tthis.removeCodeMirror();\r\n\t\t\tif(this.format == 'js') var mode = 'javascript';\r\n\t\t\telse var mode = 'application/ld+json';\r\n\t\t\tUTILS.stylizeEditor(null,\r\n\t\t\t\t\t\t\t\tthis.snippet,\r\n\t\t\t\t\t\t\t\t{width: this.width, height: this.height},\r\n\t\t\t\t\t\t\t\tmode);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis.snippet.appendChild(document.createTextNode(serial));\r\n\t\tUTILS.stylizeCodeDisplay(null, this.snippet, null, mode);\r\n\t}\r\n}\r\n\r\nmodule.exports = TerminusCodeSnippet;\r\n","/**\r\n * @file Terminus Constants\r\n * @license Apache Version 2\r\n * @summary Constants representing API actions\r\n */\r\n\r\nmodule.exports = Object.freeze({\r\n\tCONNECT: 'connect',\r\n\tGET_SCHEMA: 'get_schema',\r\n\tUPDATE_SCHEMA: 'update_schema',\r\n\tUPDATE_DOCUMENT: 'update_document',\r\n\tCLASS_FRAME: 'class_frame',\r\n\tWOQL_SELECT: 'woql_select',\r\n\tGET_DOCUMENT: 'get_document',\r\n\tDELETE_DATABASE: 'delete_database',\r\n\tDELETE_DOCUMENT: 'delete_document',\r\n\tCREATE_DATABASE: 'create_database',\r\n\tCREATE_DOCUMENT: 'create_document',\r\n\tWOQL_UPDATE: 'woql_update'\r\n});\r\n","const HTMLHelper = require('../html/HTMLHelper');\r\n\r\nfunction TerminusPluginManager(){\r\n\tthis.preloaded = [];\r\n\tthis.loaded = [];\r\n\tthis.loading = [];\r\n\tthis.precluded = [];\r\n\tthis.plugins = {};\r\n\tthis.css_base = \"\";//\"https://terminusdb.github.io/terminus-dashboard/dist/\";\r\n\tthis.plugins[\"font-awesome\"] = {\r\n\t\tlabel: \"Font Awesome\",\r\n\t\tcss: [\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0-11/css/all.css\"]\r\n\t};\r\n\tthis.plugins[\"quill\"] = {\r\n\t\tlabel: \"Quill\",\r\n\t\tjs: [\"https://cdn.quilljs.com/1.3.6/quill.min.js\"],\r\n\t\tcss: [\"https://cdn.quilljs.com/1.3.6/quill.snow.css\"],\r\n\t};\r\n\tthis.plugins[\"codemirror\"] = {\r\n\t\tlabel : \"Code Mirror\",\r\n\t\tjs: [\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/codemirror.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/mode/xml/xml.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/mode/css/css.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/mode/turtle/turtle.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/mode/javascript/javascript.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/addon/hint/anyword-hint.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/addon/hint/show-hint.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/runmode/runmode.js\",\r\n\t\t  \t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/mode/http/http.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/edit/closebrackets.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/edit/matchbrackets.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/display/placeholder.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/fold/foldgutter.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/fold/foldcode.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/fold/indent-fold.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/fold/markdown-fold.js\"\r\n\r\n\r\n\r\n\t  ],\r\n\t\tcss: [\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/codemirror.css\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/addon/hint/show-hint.css\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/theme/neo.css\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/theme/erlang-dark.css\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/fold/foldgutter.css\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/theme/eclipse.css\"\r\n\t\t]\r\n\t};\r\n\tthis.plugins[\"jquery\"] = {\r\n\t\tlabel: \"jQuery\",\r\n\t\tjs: [\"https://code.jquery.com/jquery-2.2.4.min.js\"]\r\n\t};\r\n\tthis.plugins[\"jqueryui\"] = {\r\n\t\tlabel: \"jQuery UI\",\r\n\t\tcss: [\"https://code.jquery.com/ui/1.12.0/themes/smoothness/jquery-ui.css\"],\r\n\t\tjs: [\"https://code.jquery.com/ui/1.12.0/jquery-ui.js\"],\r\n\t\trequires: ['jquery']\r\n\t};\r\n\tthis.plugins[\"datatables\"] = {\r\n\t\tlabel: \"Data Tables\",\r\n\t\tjs: [\"https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js\",\r\n\t\t\t \"https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-html5-1.5.1/datatables.min.js\"],\r\n\t\tcss: [\"https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css\"],\r\n\t\trequires: ['jquery']\r\n\t};\r\n\t/*this.plugins[\"prettify\"] = {\r\n\t\tlabel: \"Prettify\",\r\n\t\tjs: [\"https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js\"],\r\n\t\tcss: [\"https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.css\"],\r\n\t\trequires: ['jquery']\r\n\t};*/\r\n\tthis.plugins[\"gmaps\"] = {\r\n\t\tlabel: \"Google Maps\",\r\n\t\tjs: [\"https://maps.googleapis.com/maps/api/js\"],\r\n\t\t//plugin: \"gmaps.terminus.js\"\r\n\t};\r\n\tthis.plugins[\"d3\"] = {\r\n\t\tlabel: \"d3\",\r\n\t\tjs: [\"https://code.jquery.com/jquery-2.2.4.min.js\"],\r\n\t\trequires: ['jquery']\r\n\t};\r\n\tthis.plugins[\"select2\"] = {\r\n\t\tlabel: \"Select 2\",\r\n\t\tjs: [\"https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js\"],\r\n\t\tcss: [\"https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css\"],\r\n\t\trequires: ['jquery']\r\n\t};\r\n\t/*this.plugins[\"jsoneditor\"] = {\r\n\t\tlabel: \"JSON Editor\",\r\n\t\tjs: [\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/7.0.4/jsoneditor.min.js\"],\r\n\t\tcss: [\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/7.0.4/jsoneditor.min.css\"],\r\n\t\t//plugin: \"jsoneditor.terminus.js\"\r\n\t};\r\n\tthis.plugins[\"bootstrap\"] = {\r\n\t\tlabel: \"Bootstrap\",\r\n\t\tjs: [\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js\"],\r\n\t\tcss: [\"https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.2.2/css/bootstrap.min.css\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.2.2/css/bootstrap-responsive.min.css\"]\r\n\t};\r\n\tthis.plugins[\"flot\"] = {\r\n\t\tlabel: \"Flot\",\r\n\t\tjs: [\"https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.min.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.resize.min.js\"],\r\n\t\trequires: [\"jquery\"]\r\n\t};*/\r\n}\r\n\r\nTerminusPluginManager.prototype.setPluginOptions = function(opts){\r\n\tfor(var p in opts){\r\n\t\tif(!this.plugins[p]) continue;\r\n\t\tfor(var k in opts[p]){\r\n\t\t\tthis.plugins[p][k] = opts[p][k];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.init = function(opts, then){\r\n\tif(opts) this.setPluginOptions(opts);\r\n\tthis.calculatePreloaded();\r\n\tvar toload = this.calculateRequiredInitPlugins(opts);\r\n\tif(toload && toload[0].length) {\r\n\t\tif(toload[1].length){\r\n\t\t\tvar self = this;\r\n\t\t\tvar nthen = function(){\r\n\t\t\t\tself.loadPlugins(toload[1], then);\r\n\t\t\t}\r\n\t\t\tthis.loadPlugins(toload[0], nthen);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.loadPlugins(toload[0], then);\r\n\t\t}\r\n\t}\r\n\telse if(then){\r\n\t\tthen();\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.calculateRequiredInitPlugins = function(opts){\r\n\tif(opts){\r\n\t\tvar pins = [];\r\n\t\tfor(var pid in opts){\r\n\t\t\tif(opts[pid] && pins.indexOf(pid) == -1){\r\n\t\t\t\tif(typeof opts[pid] != \"object\" && opts[pid]){\r\n\t\t\t\t\tpins.push(pid);\r\n\t\t\t\t}\r\n\t\t\t\telse if(typeof opts[pid] == \"object\"){\r\n\t\t\t\t\tif(!(typeof opts[pid].loaded != \"undefined\" && !opts[pid].loaded)){\r\n\t\t\t\t\t\tpins.push(pid);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tvar pins = this.getDefaultPlugins();\r\n\t}\r\n\tvar needed_pins = [];\r\n\tfor(var i = 0; i<pins.length; i++){\r\n\t\tif(this.loaded.indexOf(pins[i]) == -1 && this.preloaded.indexOf(pins[i]) == -1 ){\r\n\t\t\tneeded_pins.push(pins[i])\r\n\t\t}\r\n\t}\r\n\tvar loading_order = [[], []];\r\n\tfor(var i = 0; i<needed_pins.length; i++){\r\n\t\tif(this.plugins[needed_pins[i]]){\r\n\t\t\tif(this.plugins[needed_pins[i]].requires && this.plugins[needed_pins[i]].requires.length){\r\n\t\t\t\tloading_order[1].push(needed_pins[i]);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tloading_order[0].push(needed_pins[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn loading_order;\r\n}\r\n\r\nTerminusPluginManager.prototype.getAvailablePlugins = function(){\r\n\treturn this.plugins;\r\n}\r\n\r\nTerminusPluginManager.prototype.calculatePreloaded = function(){\r\n\tfor(var pl in this.plugins){\r\n\t\tif(this.pluginAvailable(pl)){\r\n\t\t\tthis.preloaded.push(pl);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.pluginAvailable = function(plugin, version_check){\r\n\tif(typeof this.plugins[plugin] == \"object\"){\r\n\t\tvar pluginmeta = this.plugins[plugin];\r\n\t\tif(pluginmeta.requires && pluginmeta.requires.length){\r\n\t\t\tfor(var i =0 ; i < pluginmeta.requires.length; i++){\r\n\t\t\t\tif(!this.pluginAvailable(pluginmeta.requires[i], version_check)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar required_version = (pluginmeta.version ? pluginmeta.version : false);\r\n\t\tswitch(plugin){\r\n\t\t\tcase \"jquery\": {\r\n\t\t\t\tif(typeof jQuery == \"undefined\") return false;\r\n\t\t\t\tif(version_check && required_version){}\r\n\t\t\t\treturn true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase \"jqueryui\": {\r\n\t\t\t\ttry{\r\n\t\t\t\t\tif(typeof jQuery != \"undefined\" && jQuery.isFunction( jQuery.fn.slider )) return true;\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e){}\r\n\t\t\t\treturn false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase \"quill\": {\r\n\t\t\t\tif(typeof Quill == \"undefined\") return false;\r\n\t\t\t\treturn true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase \"jsoneditor\": {\r\n\t\t\t\tif(typeof JSONEditor == \"undefined\") return false;\r\n\t\t\t\treturn true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase \"codemirror\": {\r\n\t\t\t\tif(typeof CodeMirror == \"undefined\") return false;\r\n\t\t\t\treturn this.plugins[plugin];  // sent plugin config with darkmode true/ false\r\n\t\t\t}\r\n\t\t\tcase \"font-awesome\": {\r\n\t\t\t\t//if(typeof CodeMirror != \"undefined\") return true;\r\n\t\t\t\treturn this.fontAwesomeCheck();\r\n\t\t\t}\r\n\t\t\tcase \"datatables\": {\r\n\t\t\t\t if(typeof jQuery != \"undefined\" && jQuery.isFunction( jQuery.fn.dataTable)) return true;\r\n\t\t\t\t return false;\r\n\t\t\t}\r\n\t\t\tcase \"select2\": {\r\n\t\t\t\t if(typeof jQuery != \"undefined\" && jQuery.isFunction( jQuery.fn.select2 )) return true;\r\n\t\t\t\t return false;\r\n\t\t\t}\r\n\t\t\tcase \"gmaps\": {\r\n\t\t\t\tif(typeof google == \"undefined\" || typeof google.maps == \"undefined\") return false;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tcase \"openlayers\": {\r\n\t\t\t\tif(typeof ol == \"undefined\" || typeof ol.Map == \"undefined\") return false;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tcase \"d3\": {\r\n\t\t\t\tif(typeof d3 == \"undefined\") return false;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tconsole.log(new Error(plugin + \" is not a supported plugin ID\"));\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nTerminusPluginManager.prototype.fontAwesomeCheck = function(){\r\n\tvar span = document.createElement('span');\r\n\tspan.className = 'fa';\r\n\tspan.style.display = 'none';\r\n\tif(document.body){\r\n\t\tdocument.body.insertBefore(span, document.body.firstChild);\r\n\t\tfunction css(element, property) {\r\n\t\t  return window.getComputedStyle(element, null).getPropertyValue(property);\r\n\t\t}\r\n\t\tvar loaded = false;\r\n\t\tvar fontAwsm = css(span, 'font-family');\r\n\t\tif (fontAwsm.replace(/\"/g, \"\") == 'Font Awesome 5 Free') { // remove double quotes\r\n\t\t\tloaded = true;\r\n\t\t}\r\n\t\tdocument.body.removeChild(span);\r\n\t\treturn loaded;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusPluginManager.prototype.getDefaultPlugins = function(){\r\n\tvar defplugs = [\"font-awesome\"];\r\n\treturn defplugs;\r\n}\r\n\r\nTerminusPluginManager.prototype.loadPlugins = function(plugins, then){\r\n\tvar ticker = plugins.length;\r\n\tvar cback = function(){\r\n\t\tif(--ticker <= 1 && then){\r\n\t\t\tthen();\r\n\t\t}\r\n\t};\r\n\tfor(var i = 0; i < plugins.length; i++){\r\n\t\tthis.loadPlugin(plugins[i], cback);\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.loadPlugin = function(plugin, then){\r\n\tvar pug = this.plugins[plugin];\r\n\tif(pug.css){\r\n\t\tfor(var i=0; i<pug.css.length; i++){\r\n\t\t\tvar cssid = plugin + \"_css_\" + i;\r\n\t\t\tHTMLHelper.loadDynamicCSS(cssid, pug.css[i]);\r\n\t\t}\r\n\t}\r\n\tvar scripts = (pug.js ? pug.js : []);\r\n\tif(plugin == \"gmaps\" && pug.key){\r\n\t\tscripts[0] += \"?key=\" + pug.key;\r\n\t}\r\n\tif(pug.plugin){\r\n\t\t//scripts.push(\"plugins/\" + pug.plugin);\r\n\t}\r\n\tif(plugin == \"codemirror\"){\r\n\t\tvar cm = scripts[0];\r\n\t\tvar sid = plugin + \"_js_\" + (scripts.length -1);\r\n\t\tscripts.splice(0, 1);\r\n\t\tvar self = this;\r\n\t\tvar cback = function(){\r\n\t\t\tself.loadPluginScripts(plugin, scripts, then);\r\n\t\t}\r\n\t\tHTMLHelper.loadDynamicScript(sid, cm, cback);\r\n\t}\r\n\telse {\r\n\t\tthis.loadPluginScripts(plugin, scripts, then);\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.loadPluginScripts = function(plugin, scripts, then){\r\n\tvar ticker = scripts.length - 1;\r\n\tvar self = this;\r\n\tvar cback = function(){\r\n\t\tif(ticker == 0) {\r\n\t\t\tif(self.loaded.indexOf(plugin) == -1){\r\n\t\t\t\tself.loaded.push(plugin);\r\n\t\t\t}\r\n\t\t\tif(self.loading.indexOf(plugin) != -1){\r\n\t\t\t\tself.loading.splice(self.loading.indexOf(plugin), 1);\r\n\t\t\t}\r\n\t\t\tthen();\r\n\t\t}\r\n\t\tticker--;\r\n\t};\r\n\tif(scripts.length == 0){\r\n\t\tthis.loaded.push(plugin);\r\n\t}\r\n\telse {\r\n\t\tthis.loading.push(plugin);\r\n\t}\r\n\tfor(var i = 0; i<scripts.length; i++){\r\n\t\tvar sid = plugin + \"_js_\" + i;\r\n\t\tHTMLHelper.loadDynamicScript(sid, scripts[i], cback);\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.loadPageCSS = function(css){\r\n\tcssfid = \"terminus_client_css\";\r\n\tvar cssdom = document.getElementById(cssfid);\r\n\tif(cssdom){\r\n\t\tcssdom.parentNode.removeChild(cssdom);\r\n\t}\r\n\tif(css){\r\n\t\tcssurl = this.css_base + \"css/\" + css + \".css\";\r\n\t\tHTMLHelper.loadDynamicCSS(cssfid, cssurl);\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.pluginLoadable = function(pid){\r\n\treturn (this.precluded.indexOf(pid) !== -1 || this.pluginLoadedOrLoading(pid));\r\n}\r\n\r\nTerminusPluginManager.prototype.pluginLoadedOrLoading = function(pid){\r\n\tif(this.loaded.indexOf(pid) != -1) return true;\r\n\tif(this.preloaded.indexOf(pid) != -1) return true;\r\n\tif(this.loading.indexOf(pid) != -1) return true;\r\n\treturn false;\r\n}\r\n\r\nTerminusPluginManager.prototype.disabled = function(pid, obj){\r\n\tif(this.precluded.indexOf(pid) != -1) return true;\r\n\tif(obj.requires){\r\n\t\tfor(var i = 0; i<obj.requires.length; i++){\r\n\t\t\tif(!this.pluginLoadedOrLoading(obj.requires[i])) return true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusPluginManager.prototype.getPluginDOM = function(plugid, obj, ui){\r\n\tvar a = document.createElement(\"a\");\r\n\tvar cl = document.createElement(\"span\");\r\n\ta.appendChild(cl);\r\n\tcl.setAttribute(\"class\", \"terminus-plugin-control\");\r\n\tvar cbox = document.createElement(\"input\");\r\n\tcbox.id = \"terminus-plugin-control-\" + plugid;\r\n\tcbox.type = \"checkbox\";\r\n\tif(this.preloaded.indexOf(plugid) != -1){\r\n\t\tcbox.checked = true;\r\n\t\tcbox.disabled = true;\r\n\t}\r\n\telse if(this.loaded.indexOf(plugid) != -1){\r\n\t\tcbox.checked = true;\r\n\t}\r\n\telse if(this.loading.indexOf(plugid) != -1){\r\n\t\tcbox.checked = true;\r\n\t}\r\n\telse if(this.disabled(plugid, obj)){\r\n\t\tcbox.disabled = true;\r\n\t}\r\n\tvar clab = document.createElement(\"label\");\r\n\tclab.setAttribute(\"class\", \"terminus-plugin-label terminus-pointer\");\r\n\tclab.setAttribute(\"for\", cbox.id);\r\n\tclab.appendChild(document.createTextNode(obj.label));\r\n\tcl.appendChild(clab);\r\n\tcl.appendChild(cbox);\r\n\tvar self = this;\r\n\tcbox.addEventListener(\"change\", function(){\r\n\t\tself.togglePlugin(plugid, ui);\r\n\t});\r\n\treturn a;\r\n}\r\n\r\nTerminusPluginManager.prototype.togglePlugin = function(plugid, ui){\r\n\tif(this.loaded.indexOf(plugid) == -1){\r\n\t\tvar then = function(){\r\n\t\t\tui.redraw();\r\n\t\t}\r\n\t\tthis.loadPlugin(plugid, then);\r\n\t}\r\n\telse {\r\n\t\tthis.unloadPlugin(plugid);\r\n\t}\r\n\tHTMLHelper.removeChildren(ui.plugins);\r\n\tui.drawPlugins();\r\n}\r\n\r\nTerminusPluginManager.prototype.unloadPlugin = function(plugid){\r\n\tif(!this.plugins[plugid] || this.loaded.indexOf(plugid) == -1) {\r\n\t\tconsole.log(new Error(plugid + \" plugin unload request when it is not loaded\"));\r\n\t\treturn false;\r\n\t}\r\n\tvar pug = this.plugins[plugid];\r\n\tvar num = (pug.js) ? pug.js.length : 0;\r\n\tif(pug.plugin) num++;\r\n\tfor(var i=0; i< num; i++){\r\n\t\tvar cssfid = plugid + \"_js_\" + i;\r\n\t\tvar cssdom = document.getElementById(cssfid);\r\n\t\tif(cssdom){\r\n\t\t\tcssdom.parentNode.removeChild(cssdom);\r\n\t\t}\r\n\t}\r\n\tnum = (pug.css ? pug.css.length : 0);\r\n\tfor(var i=0; i< num; i++){\r\n\t\tvar cssfid = plugid + \"_css_\" + i;\r\n\t\tvar cssdom = document.getElementById(cssfid);\r\n\t\tif(cssdom){\r\n\t\t\tcssdom.parentNode.removeChild(cssdom);\r\n\t\t}\r\n\t}\r\n\tthis.loaded.splice(this.loaded.indexOf(plugid), 1);\r\n}\r\n\r\nTerminusPluginManager.prototype.getAsDOM = function(ui){\r\n\tvar dm = document.createElement(\"span\");\r\n\tdm.setAttribute(\"class\", \"terminus-plugin-manager\");\r\n\tvar clh = document.createElement(\"span\");\r\n\tclh.setAttribute(\"class\", \"terminus-plugin-control-header terminus-plugin-nav terminus-pointer\");\r\n\tclh.appendChild(document.createTextNode(\"Plugins\"));\r\n\tdm.appendChild(clh);\r\n\tvar a = document.createElement('a');\r\n\tthis.showPlugins(a, ui);\r\n\tclh.appendChild(a);\r\n\ta.style.display = 'none';\r\n\tclh.addEventListener('click', function(){\r\n\t\tif(a.style.display == 'none')\r\n\t\t\ta.style.display = 'block';\r\n\t\telse a.style.display = 'none';\r\n\t})\r\n\treturn dm;\r\n}\r\n\r\nTerminusPluginManager.prototype.showPlugins = function(a, ui){\r\n\ta.setAttribute('style', 'background-color: #111;');\r\n\tfor(var pid in this.plugins){\r\n\t\ta.appendChild(this.getPluginDOM(pid, this.plugins[pid], ui));\r\n\t}\r\n}\r\n\r\nmodule.exports=TerminusPluginManager\r\n","'use strict';\n\nmodule.exports = function bind(fn, thisArg) {\n  return function wrap() {\n    var args = new Array(arguments.length);\n    for (var i = 0; i < args.length; i++) {\n      args[i] = arguments[i];\n    }\n    return fn.apply(thisArg, args);\n  };\n};\n","'use strict';\n\nvar utils = require('./../utils');\n\nfunction encode(val) {\n  return encodeURIComponent(val).\n    replace(/%40/gi, '@').\n    replace(/%3A/gi, ':').\n    replace(/%24/g, '$').\n    replace(/%2C/gi, ',').\n    replace(/%20/g, '+').\n    replace(/%5B/gi, '[').\n    replace(/%5D/gi, ']');\n}\n\n/**\n * Build a URL by appending params to the end\n *\n * @param {string} url The base of the url (e.g., http://www.google.com)\n * @param {object} [params] The params to be appended\n * @returns {string} The formatted url\n */\nmodule.exports = function buildURL(url, params, paramsSerializer) {\n  /*eslint no-param-reassign:0*/\n  if (!params) {\n    return url;\n  }\n\n  var serializedParams;\n  if (paramsSerializer) {\n    serializedParams = paramsSerializer(params);\n  } else if (utils.isURLSearchParams(params)) {\n    serializedParams = params.toString();\n  } else {\n    var parts = [];\n\n    utils.forEach(params, function serialize(val, key) {\n      if (val === null || typeof val === 'undefined') {\n        return;\n      }\n\n      if (utils.isArray(val)) {\n        key = key + '[]';\n      } else {\n        val = [val];\n      }\n\n      utils.forEach(val, function parseValue(v) {\n        if (utils.isDate(v)) {\n          v = v.toISOString();\n        } else if (utils.isObject(v)) {\n          v = JSON.stringify(v);\n        }\n        parts.push(encode(key) + '=' + encode(v));\n      });\n    });\n\n    serializedParams = parts.join('&');\n  }\n\n  if (serializedParams) {\n    var hashmarkIndex = url.indexOf('#');\n    if (hashmarkIndex !== -1) {\n      url = url.slice(0, hashmarkIndex);\n    }\n\n    url += (url.indexOf('?') === -1 ? '?' : '&') + serializedParams;\n  }\n\n  return url;\n};\n","'use strict';\n\nmodule.exports = function isCancel(value) {\n  return !!(value && value.__CANCEL__);\n};\n","'use strict';\n\nvar utils = require('./utils');\nvar normalizeHeaderName = require('./helpers/normalizeHeaderName');\n\nvar DEFAULT_CONTENT_TYPE = {\n  'Content-Type': 'application/x-www-form-urlencoded'\n};\n\nfunction setContentTypeIfUnset(headers, value) {\n  if (!utils.isUndefined(headers) && utils.isUndefined(headers['Content-Type'])) {\n    headers['Content-Type'] = value;\n  }\n}\n\nfunction getDefaultAdapter() {\n  var adapter;\n  // Only Node.JS has a process variable that is of [[Class]] process\n  if (typeof process !== 'undefined' && Object.prototype.toString.call(process) === '[object process]') {\n    // For node use HTTP adapter\n    adapter = require('./adapters/http');\n  } else if (typeof XMLHttpRequest !== 'undefined') {\n    // For browsers use XHR adapter\n    adapter = require('./adapters/xhr');\n  }\n  return adapter;\n}\n\nvar defaults = {\n  adapter: getDefaultAdapter(),\n\n  transformRequest: [function transformRequest(data, headers) {\n    normalizeHeaderName(headers, 'Accept');\n    normalizeHeaderName(headers, 'Content-Type');\n    if (utils.isFormData(data) ||\n      utils.isArrayBuffer(data) ||\n      utils.isBuffer(data) ||\n      utils.isStream(data) ||\n      utils.isFile(data) ||\n      utils.isBlob(data)\n    ) {\n      return data;\n    }\n    if (utils.isArrayBufferView(data)) {\n      return data.buffer;\n    }\n    if (utils.isURLSearchParams(data)) {\n      setContentTypeIfUnset(headers, 'application/x-www-form-urlencoded;charset=utf-8');\n      return data.toString();\n    }\n    if (utils.isObject(data)) {\n      setContentTypeIfUnset(headers, 'application/json;charset=utf-8');\n      return JSON.stringify(data);\n    }\n    return data;\n  }],\n\n  transformResponse: [function transformResponse(data) {\n    /*eslint no-param-reassign:0*/\n    if (typeof data === 'string') {\n      try {\n        data = JSON.parse(data);\n      } catch (e) { /* Ignore */ }\n    }\n    return data;\n  }],\n\n  /**\n   * A timeout in milliseconds to abort a request. If set to 0 (default) a\n   * timeout is not created.\n   */\n  timeout: 0,\n\n  xsrfCookieName: 'XSRF-TOKEN',\n  xsrfHeaderName: 'X-XSRF-TOKEN',\n\n  maxContentLength: -1,\n\n  validateStatus: function validateStatus(status) {\n    return status >= 200 && status < 300;\n  }\n};\n\ndefaults.headers = {\n  common: {\n    'Accept': 'application/json, text/plain, */*'\n  }\n};\n\nutils.forEach(['delete', 'get', 'head'], function forEachMethodNoData(method) {\n  defaults.headers[method] = {};\n});\n\nutils.forEach(['post', 'put', 'patch'], function forEachMethodWithData(method) {\n  defaults.headers[method] = utils.merge(DEFAULT_CONTENT_TYPE);\n});\n\nmodule.exports = defaults;\n","'use strict';\n\nvar utils = require('./../utils');\nvar settle = require('./../core/settle');\nvar buildURL = require('./../helpers/buildURL');\nvar parseHeaders = require('./../helpers/parseHeaders');\nvar isURLSameOrigin = require('./../helpers/isURLSameOrigin');\nvar createError = require('../core/createError');\n\nmodule.exports = function xhrAdapter(config) {\n  return new Promise(function dispatchXhrRequest(resolve, reject) {\n    var requestData = config.data;\n    var requestHeaders = config.headers;\n\n    if (utils.isFormData(requestData)) {\n      delete requestHeaders['Content-Type']; // Let the browser set it\n    }\n\n    var request = new XMLHttpRequest();\n\n    // HTTP basic authentication\n    if (config.auth) {\n      var username = config.auth.username || '';\n      var password = config.auth.password || '';\n      requestHeaders.Authorization = 'Basic ' + btoa(username + ':' + password);\n    }\n\n    request.open(config.method.toUpperCase(), buildURL(config.url, config.params, config.paramsSerializer), true);\n\n    // Set the request timeout in MS\n    request.timeout = config.timeout;\n\n    // Listen for ready state\n    request.onreadystatechange = function handleLoad() {\n      if (!request || request.readyState !== 4) {\n        return;\n      }\n\n      // The request errored out and we didn't get a response, this will be\n      // handled by onerror instead\n      // With one exception: request that using file: protocol, most browsers\n      // will return status as 0 even though it's a successful request\n      if (request.status === 0 && !(request.responseURL && request.responseURL.indexOf('file:') === 0)) {\n        return;\n      }\n\n      // Prepare the response\n      var responseHeaders = 'getAllResponseHeaders' in request ? parseHeaders(request.getAllResponseHeaders()) : null;\n      var responseData = !config.responseType || config.responseType === 'text' ? request.responseText : request.response;\n      var response = {\n        data: responseData,\n        status: request.status,\n        statusText: request.statusText,\n        headers: responseHeaders,\n        config: config,\n        request: request\n      };\n\n      settle(resolve, reject, response);\n\n      // Clean up request\n      request = null;\n    };\n\n    // Handle browser request cancellation (as opposed to a manual cancellation)\n    request.onabort = function handleAbort() {\n      if (!request) {\n        return;\n      }\n\n      reject(createError('Request aborted', config, 'ECONNABORTED', request));\n\n      // Clean up request\n      request = null;\n    };\n\n    // Handle low level network errors\n    request.onerror = function handleError() {\n      // Real errors are hidden from us by the browser\n      // onerror should only fire if it's a network error\n      reject(createError('Network Error', config, null, request));\n\n      // Clean up request\n      request = null;\n    };\n\n    // Handle timeout\n    request.ontimeout = function handleTimeout() {\n      reject(createError('timeout of ' + config.timeout + 'ms exceeded', config, 'ECONNABORTED',\n        request));\n\n      // Clean up request\n      request = null;\n    };\n\n    // Add xsrf header\n    // This is only done if running in a standard browser environment.\n    // Specifically not if we're in a web worker, or react-native.\n    if (utils.isStandardBrowserEnv()) {\n      var cookies = require('./../helpers/cookies');\n\n      // Add xsrf header\n      var xsrfValue = (config.withCredentials || isURLSameOrigin(config.url)) && config.xsrfCookieName ?\n        cookies.read(config.xsrfCookieName) :\n        undefined;\n\n      if (xsrfValue) {\n        requestHeaders[config.xsrfHeaderName] = xsrfValue;\n      }\n    }\n\n    // Add headers to the request\n    if ('setRequestHeader' in request) {\n      utils.forEach(requestHeaders, function setRequestHeader(val, key) {\n        if (typeof requestData === 'undefined' && key.toLowerCase() === 'content-type') {\n          // Remove Content-Type if data is undefined\n          delete requestHeaders[key];\n        } else {\n          // Otherwise add header to the request\n          request.setRequestHeader(key, val);\n        }\n      });\n    }\n\n    // Add withCredentials to request if needed\n    if (config.withCredentials) {\n      request.withCredentials = true;\n    }\n\n    // Add responseType to request if needed\n    if (config.responseType) {\n      try {\n        request.responseType = config.responseType;\n      } catch (e) {\n        // Expected DOMException thrown by browsers not compatible XMLHttpRequest Level 2.\n        // But, this can be suppressed for 'json' type as it can be parsed by default 'transformResponse' function.\n        if (config.responseType !== 'json') {\n          throw e;\n        }\n      }\n    }\n\n    // Handle progress if needed\n    if (typeof config.onDownloadProgress === 'function') {\n      request.addEventListener('progress', config.onDownloadProgress);\n    }\n\n    // Not all browsers support upload events\n    if (typeof config.onUploadProgress === 'function' && request.upload) {\n      request.upload.addEventListener('progress', config.onUploadProgress);\n    }\n\n    if (config.cancelToken) {\n      // Handle cancellation\n      config.cancelToken.promise.then(function onCanceled(cancel) {\n        if (!request) {\n          return;\n        }\n\n        request.abort();\n        reject(cancel);\n        // Clean up request\n        request = null;\n      });\n    }\n\n    if (requestData === undefined) {\n      requestData = null;\n    }\n\n    // Send the request\n    request.send(requestData);\n  });\n};\n","'use strict';\n\nvar enhanceError = require('./enhanceError');\n\n/**\n * Create an Error with the specified message, config, error code, request and response.\n *\n * @param {string} message The error message.\n * @param {Object} config The config.\n * @param {string} [code] The error code (for example, 'ECONNABORTED').\n * @param {Object} [request] The request.\n * @param {Object} [response] The response.\n * @returns {Error} The created error.\n */\nmodule.exports = function createError(message, config, code, request, response) {\n  var error = new Error(message);\n  return enhanceError(error, config, code, request, response);\n};\n","'use strict';\n\nvar utils = require('../utils');\n\n/**\n * Config-specific merge-function which creates a new config-object\n * by merging two configuration objects together.\n *\n * @param {Object} config1\n * @param {Object} config2\n * @returns {Object} New object resulting from merging config2 to config1\n */\nmodule.exports = function mergeConfig(config1, config2) {\n  // eslint-disable-next-line no-param-reassign\n  config2 = config2 || {};\n  var config = {};\n\n  utils.forEach(['url', 'method', 'params', 'data'], function valueFromConfig2(prop) {\n    if (typeof config2[prop] !== 'undefined') {\n      config[prop] = config2[prop];\n    }\n  });\n\n  utils.forEach(['headers', 'auth', 'proxy'], function mergeDeepProperties(prop) {\n    if (utils.isObject(config2[prop])) {\n      config[prop] = utils.deepMerge(config1[prop], config2[prop]);\n    } else if (typeof config2[prop] !== 'undefined') {\n      config[prop] = config2[prop];\n    } else if (utils.isObject(config1[prop])) {\n      config[prop] = utils.deepMerge(config1[prop]);\n    } else if (typeof config1[prop] !== 'undefined') {\n      config[prop] = config1[prop];\n    }\n  });\n\n  utils.forEach([\n    'baseURL', 'transformRequest', 'transformResponse', 'paramsSerializer',\n    'timeout', 'withCredentials', 'adapter', 'responseType', 'xsrfCookieName',\n    'xsrfHeaderName', 'onUploadProgress', 'onDownloadProgress', 'maxContentLength',\n    'validateStatus', 'maxRedirects', 'httpAgent', 'httpsAgent', 'cancelToken',\n    'socketPath'\n  ], function defaultToConfig2(prop) {\n    if (typeof config2[prop] !== 'undefined') {\n      config[prop] = config2[prop];\n    } else if (typeof config1[prop] !== 'undefined') {\n      config[prop] = config1[prop];\n    }\n  });\n\n  return config;\n};\n","'use strict';\n\n/**\n * A `Cancel` is an object that is thrown when an operation is canceled.\n *\n * @class\n * @param {string=} message The message.\n */\nfunction Cancel(message) {\n  this.message = message;\n}\n\nCancel.prototype.toString = function toString() {\n  return 'Cancel' + (this.message ? ': ' + this.message : '');\n};\n\nCancel.prototype.__CANCEL__ = true;\n\nmodule.exports = Cancel;\n","/**\r\n * @file Connection Capabilities\r\n * @license Apache Version 2\r\n * @summary Object which helps manage the capabilities available for a given TerminusDB connection\r\n * Creates an entry in the connection registry for the server\r\n * and all the databases that the client has access to\r\n * maps the input authorties to a per-db array for internal storage and easy\r\n * access control checks\r\n */\r\nconst CONST = require('./const.js');\r\nconst ErrorMessage = require('./errorMessage');\r\n\r\n/**\r\n * @constructor \r\n * @param {connectionConfig} connectionConfig connectionConfig object containing the connection parameters \r\n * @param {String} key API key\r\n */\r\nfunction ConnectionCapabilities(connectionConfig, key) {\r\n\tthis.connection = {};\r\n\tthis.connectionConfig = connectionConfig;\r\n\tif (this.connectionConfig.server && key) {\r\n\t\tthis.setClientKey(this.connectionConfig.server, key);\r\n\t}\r\n}\r\n\r\n/**\r\n * @summary Retrieves the API key for the given TerminusDB Server\r\n * @param {String} serverURL optional - URL of TerminusDB - if ommited the current server URL is used\r\n */\r\nConnectionCapabilities.prototype.getClientKey = function (serverURL) {\r\n\tif (!serverURL) serverURL = this.connectionConfig.serverURL();\r\n\tif (serverURL && this.connection[serverURL]) return this.connection[serverURL].key;\r\n\treturn false;\r\n};\r\n\r\n\r\n/*\r\n * Utility functions for changing the state of connections with Terminus servers\r\n */\r\n\r\n/**\r\n * @summary sets the api key for the given url\r\n * @param {String} curl a valid terminusDB server URL\r\n * @param {String} key an optional API key\r\n */\r\nConnectionCapabilities.prototype.setClientKey = function (curl, key) {\r\n\tif (typeof key === 'string' && key.trim()) {\r\n\t\tif (typeof this.connection[curl] === 'undefined') {\r\n\t\t\tthis.connection[curl] = {};\r\n\t\t}\r\n\t\tthis.connection[curl].key = key.trim();\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * @param {string} curl a valid terminusDB server URL\r\n * @param {object} capabilities the JSON object returned by the connect API call \r\n */\r\nConnectionCapabilities.prototype.addConnection = function (curl, capabilities) {\r\n\tif (typeof this.connection[curl] === 'undefined') {\r\n\t\tthis.connection[curl] = {};\r\n\t}\r\n\tconst capabilitiesKeys = capabilities ? Object.keys(capabilities) : [];\r\n\r\n\tfor (const pred of capabilitiesKeys) {\r\n\t    if (pred === 'terminus:authority' && capabilities[pred]) {\r\n\t      const auths = Array.isArray(capabilities[pred]) === true\r\n\t        ? capabilities[pred]\r\n\t        : [capabilities[pred]];\r\n\r\n\t      for (let i = 0; i < auths.length; i += 1) {\r\n\t        let scope = auths[i]['terminus:authority_scope'];\r\n\t        const actions = auths[i]['terminus:action'];\r\n\r\n\t\t\tif (Array.isArray(scope) === false) scope = [scope];\r\n\t\t\tconst actionsArr = ((Array.isArray(actions)) ? actions.map(item => item['@id']) : [] );\r\n\t        for (let j = 0; j < scope.length; j += 1) {\r\n\t          const nrec = scope[j];\r\n\t          if (typeof this.connection[curl][nrec['@id']] === 'undefined') {\r\n\t            this.connection[curl][nrec['@id']] = nrec;\r\n\t          }\r\n\t          this.connection[curl][nrec['@id']]['terminus:authority'] = actionsArr;\r\n\t        }\r\n\t      }\r\n\t    } else {\r\n\t      this.connection[curl][pred] = capabilities[pred];\r\n\t    }\r\n\t}\r\n};\r\n\r\n/**\r\n * @summary returns true if the client is currently connected to a server\r\n * @returns {Boolean}\r\n */\r\nConnectionCapabilities.prototype.serverConnected = function () {\r\n\treturn typeof this.connection[this.connectionConfig.server] !== 'undefined';\r\n};\r\n\r\n\r\n/**\r\n * @summary retrieves the meta-data record returned by connect for a particular server\r\n * @param {String} [srvr] optional server URL - if omitted current connection config will be used\r\n * @returns {terminus:Server} JSON server record as returned by WOQLClient.connect\r\n */\r\nConnectionCapabilities.prototype.getServerRecord = function (srvr) {\r\n\tconst url = (srvr || this.connectionConfig.server);\r\n\tconst connectionObj = this.connection[url] || {};\r\n\tconst okeys = Object.keys(connectionObj);\r\n\r\n\tfor (const oid of okeys) {\r\n\t\tif (this.connection[url][oid]['@type'] === 'terminus:Server') {\r\n\t\t\treturn this.connection[url][oid];\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * @summary retrieves the meta-data record returned by connect for a particular database\r\n * @param {String} [dbid] optional database id - if omitted current connection config db will be used\r\n * @param {String} [srvr] optional server URL - if omitted current connection config server will be used\r\n * @returns {terminus:Database} terminus:Database JSON document as returned by WOQLClient.connect\r\n */\r\nConnectionCapabilities.prototype.getDBRecord = function (dbid, srvr) {\r\n\tconst url = (srvr || this.connectionConfig.server);\r\n\tdbid = (dbid || this.connectionConfig.dbid);\r\n\tif (typeof this.connection[url] !== 'object') {\r\n\t\treturn false;\r\n\t}\r\n\tif (typeof this.connection[url][dbid] !== 'undefined') { return this.connection[url][dbid]; }\r\n\r\n\tdbid = this.dbCapabilityID(dbid);\r\n\r\n\tif (typeof this.connection[url][dbid] !== 'undefined') { return this.connection[url][dbid]; }\r\n\r\n\treturn undefined;\r\n};\r\n\r\n/**\r\n * @summary retrieves all the db meta-data records returned by connect for a particular server\r\n * @param {String} [srvr] optional server URL - if omitted current connection config server will be used\r\n * @returns {[terminus:Database]} array of terminus:Database JSON documents as returned by WOQLClient.connect\r\n */\r\nConnectionCapabilities.prototype.getServerDBRecords = function (srvr) {\r\n\tconst url = (srvr || this.connectionConfig.server);\r\n\tconst dbrecs = {};\r\n\tconst connectionObj = this.connection[url] || {};\r\n\r\n\tfor (const oid of Object.keys(connectionObj)) {\r\n\t\tif (this.connection[url][oid]['@type'] === 'terminus:Database') {\r\n\t\t\tdbrecs[oid] = this.connection[url][oid];\r\n\t\t}\r\n\t}\r\n\treturn dbrecs;\r\n};\r\n\r\n/**\r\n * @summary removes a database record from the connection registry (after deletion, for example)\r\n * @param {String} [dbid] optional DB ID - if omitted current connection config db will be used\r\n * @param {String} [srvr] optional server URL - if omitted current connection config server will be used\r\n * @returns {[terminus:Database]} array of terminus:Database JSON documents as returned by WOQLClient.connect\r\n */\r\nConnectionCapabilities.prototype.removeDB = function (dbid, srvr) {\r\n\tdbid = dbid || this.connectionConfig.dbid;\r\n\r\n\tif (dbid && this.connectionConfig.dbid && this.connectionConfig.dbid === dbid) {\r\n\t\tthis.connectionConfig.dbid = false;\r\n\t}\r\n\r\n\tconst url = srvr || this.connectionConfig.server;\r\n\tconst dbidCap = this.dbCapabilityID(dbid);\r\n\tif (dbidCap && this.connection[url] && this.connection[url][dbidCap]) {\r\n\t\tdelete this.connection[url][dbidCap];\r\n\t}\t\r\n};\r\n\r\n/**\r\n * @param {String} dbid local id of database\r\n * @returns {String} the id of the terminus:Document describing the DB\r\n * @summary Generates the ID of the terminus:Database document from the database ID\r\n */\r\nConnectionCapabilities.prototype.dbCapabilityID = function (dbid) {\r\n\treturn `doc:${dbid}`;\r\n};\r\n\r\n/**\r\n * @param {String} action - the action that will be carried out\r\n * @param {String} [dbid] optional DB ID - if omitted current connection config db will be used\r\n * @param {String} [srvr] optional server URL - if omitted current connection config server will be used\r\n * @returns {Boolean} true if the client's capabilities allow the action on the given server / db\r\n * @summary supports client side access control checks (in addition to server side)\r\n */\r\nConnectionCapabilities.prototype.capabilitiesPermit = function (action, dbid, server) {\r\n\tserver = server || this.connectionConfig.server;\r\n\tdbid = dbid || this.connectionConfig.dbid;\r\n\r\n\tlet rec;\r\n\r\n\tif (action === CONST.CREATE_DATABASE) {\r\n\t\trec = this.getServerRecord(server);\r\n\t} else if (dbid) rec = this.getDBRecord(dbid);\r\n\telse console.log('no dbid provided in capabilities check ', server, dbid);\r\n\tif (rec) {\r\n\t\tconst auths = rec['terminus:authority'];\r\n\t\tif (auths && auths.indexOf(`terminus:${action}`) !== -1) return true;\r\n\t} else {\r\n\t\tconsole.log('No record found for connection: ', this.connection, action, server, dbid);\r\n\t}\r\n\tthis.error = ErrorMessage.accessDenied(action, dbid, server);\r\n\treturn false;\r\n};\r\n\r\n\r\nmodule.exports = ConnectionCapabilities;\r\n","/**\r\n * @file Terminus DB connection configuration\r\n * @license Apache Version 2\r\n * @summary Object representing the state of a connection to a terminus db - server url, current dbid, document id\r\n * along with some configuration information (key, connected mode, client_side_access_control)\r\n * provides methods for getting and setting connection parameters\r\n */\r\nconst IDParser = require('./terminusIDParser');\r\n\r\nfunction ConnectionConfig(params) {\r\n\tconst newParams = params || {};\r\n\tthis.server = false;\r\n\tthis.dbid = false;\r\n\tthis.docid = false;\r\n\tif (newParams.server) this.setServer(newParams.server);\r\n\tif (newParams.db) this.setDB(newParams.db);\r\n\tif (newParams.doc) this.setDocument(newParams.doc);\r\n\t/*\r\n     * client configuration options - connected_mode = connected\r\n     * tells the client to first connect to the server before invoking other services\r\n     */\r\n\r\n\t// include a terminus:user_key API key in the calls\r\n\tthis.include_key = newParams.include_key || true;\r\n}\r\n\r\n/**\r\n * Server URL will always end in a / character - automatically appended if missing\r\n */\r\nConnectionConfig.prototype.setServer = function (inputStr, context) {\r\n\tconst parser = new IDParser(context);\r\n\tif (parser.parseServerURL(inputStr)) {\r\n\t\tthis.server = parser.server();\r\n\t\tthis.dbid = false;\r\n\t\tthis.docid = false;\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n\r\nConnectionConfig.prototype.serverURL = function () {\r\n\treturn this.server;\r\n};\r\n\r\n/**\r\n * Database URL does not have a trailing slash \"/\" character and it will be chopped if it is passed in at the end of the input string\r\n * @param {String} inputStr - URL of DB or local id of DB\r\n */\r\nConnectionConfig.prototype.setDB = function (inputStr, context) {\r\n\tconst parser = new IDParser(context);\r\n\tif (parser.parseDBID(inputStr)) {\r\n\t\tif (parser.server()) this.server = parser.server();\r\n\t\tthis.dbid = parser.dbid();\r\n\t\tthis.docid = false;\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nConnectionConfig.prototype.dbURL = function () {\r\n\treturn this.server + this.dbid;\r\n};\r\n\r\n\r\n/**\r\n * @summary sets the connection to point at the schema api URL\r\n */\r\nConnectionConfig.prototype.setSchemaURL = function (inputStr, context) {\r\n\tconst parser = new IDParser(context);\r\n\tif (parser.parseSchemaURL(inputStr)) {\r\n\t\tif (parser.server()) this.server = parser.server();\r\n\t\tthis.dbid = parser.dbid();\r\n\t\tthis.docid = false;\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nConnectionConfig.prototype.schemaURL = function () {\r\n\treturn `${this.dbURL()}/schema`;\r\n};\r\n\r\n/**\r\n * @param {String} inputStr - the URL of a Terminus DB base install or schema endpoint\r\n * @param {Object} [context] optional json-ld context \r\n * @summary sets the connection to point at the query api URL\r\n */\r\nConnectionConfig.prototype.setQueryURL = function (inputStr, context) {\r\n\tconst parser = new IDParser(context);\r\n\tif (parser.parseQueryURL(inputStr)) {\r\n\t\tif (parser.server()) this.server = parser.server();\r\n\t\tthis.dbid = parser.dbid();\r\n\t\tthis.docid = false;\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nConnectionConfig.prototype.queryURL = function () {\r\n\treturn `${this.dbURL()}/woql`;\r\n};\r\n\r\n/**\r\n * @param {String} inputStr - the URL of a Terminus DB base install or frame endpoint\r\n * @param {Object} [context] optional json-ld context \r\n * @summary sets the connection to point at the class frame api URL\r\n */\r\nConnectionConfig.prototype.setClassFrameURL = function (inputStr, context) {\r\n\tconst parser = new IDParser(context);\r\n\tif (parser.parseClassFrameURL(inputStr)) {\r\n\t\tif (parser.server()) this.server = parser.server();\r\n\t\tthis.dbid = parser.dbid();\r\n\t\tthis.docid = false;\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nConnectionConfig.prototype.frameURL = function () {\r\n\treturn `${this.dbURL()}/frame`;\r\n};\r\n\r\n/**\r\n * @param {String} inputStr - the URL of a Terminus DB base install or document endpoint\r\n * @param {Object} [context] optional json-ld context \r\n * @summary sets the connection to point at the document api URL\r\n */\r\nConnectionConfig.prototype.setDocument = function (inputStr, context) {\r\n\tconst parser = new IDParser(context);\r\n\tif (parser.parseDocumentURL(inputStr)) {\r\n\t\tif (parser.server()) this.server = parser.server();\r\n\t\tif (parser.dbid()) this.dbid = parser.dbid();\r\n\t\tif (parser.docid()) this.docid = parser.docid();\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nConnectionConfig.prototype.docURL = function () {\r\n\treturn `${this.dbURL()}/document/${this.docid ? this.docid : ''}`;\r\n};\r\n\r\n/**\r\n * will a key be used in this connnection?\r\n */\r\nConnectionConfig.prototype.includeKey = function () {\r\n\treturn this.include_key === true;\r\n};\r\n\r\nmodule.exports = ConnectionConfig;\r\n","/**\r\n * @file Terminus ID Parser\r\n * @license Apache Version 2\r\n * @summary Object representing a terminus ID / URL \r\n * Helper methods for parsing and decomposing Terminus URLs \r\n * and dealing with namespace prefixed URLs\r\n */\r\n\r\n/**\r\n * \r\n * @param {Object} context JSON-LD context to be used for prefixes\r\n */\r\n function IDParser(context) {\r\n\tthis.context = context;\r\n\tthis.server_url = false;\r\n\tthis.db = false;\r\n\tthis.doc = false;\r\n}\r\n\r\nIDParser.prototype.server = function () {\r\n\treturn this.server_url;\r\n};\r\n\r\nIDParser.prototype.dbid = function () {\r\n\treturn this.db;\r\n};\r\n\r\nIDParser.prototype.docid = function () {\r\n\treturn this.doc;\r\n};\r\n\r\nIDParser.prototype.setContext = function (context) {\r\n\tthis.context = context;\r\n};\r\n\r\n/**\r\n * parses a Terminus Server URL and appends a trailing slash if not present\r\n */\r\nIDParser.prototype.parseServerURL = function (str) {\r\n\tthis.server_url = false;\r\n\r\n\tif (this.validURL(str)) {\r\n\t\tthis.server_url = str;\r\n\t} else if (this.context && this.validPrefixedURL(str, this.context)) {\r\n\t\tthis.server_url = this.expandPrefixed(str, this.context);\r\n\t}\r\n\r\n\tif (this.server_url && this.server_url.lastIndexOf('/') !== this.server_url.length - 1\r\n\t) {\r\n\t\tthis.server_url += '/';\r\n\t}\r\n\treturn this.server_url;\r\n};\r\n\r\nIDParser.prototype.parseDBID = function (str) {\r\n\tthis.db = false;\r\n\tif (this.context && this.validPrefixedURL(str, this.context)) {\r\n\t\tstr = this.expandPrefixed(str, this.context);\r\n\t}\r\n\tif (this.validURL(str)) {\r\n\t\tif (str.lastIndexOf('/') === str.length - 1) {\r\n\t\t\t// trim trailing slash\r\n\t\t\tstr = str.substring(0, str.length - 1);\r\n\t\t}\r\n\t\tconst index = str.lastIndexOf('/');\r\n\r\n\t\tconst serverURL = str.substring(0, index);\r\n\t\t// only dbNamer\r\n\t\tstr = str.substring(index + 1);\r\n\r\n\t\tif (this.parseServerURL(serverURL) === false) return false;\r\n\t}\r\n\r\n\tif (this.validIDString(str)) {\r\n\t\tthis.db = str;\r\n\t}\r\n\treturn this.db;\r\n};\r\n\r\nIDParser.prototype.parseDocumentURL = function (str) {\r\n\tthis.doc = false;\r\n\tif (this.context && this.validPrefixedURL(str, this.context)) {\r\n\t\tstr = this.expandPrefixed(str, this.context);\r\n\t}\r\n\r\n\tif (this.validURL(str)) {\r\n\t\tlet dbURL = str;\r\n\t\tif (str.lastIndexOf('/document/') !== -1) {\r\n\t\t\t// get dbURL\r\n\t\t\tdbURL = str.substring(0, str.lastIndexOf('/document/'));\r\n\t\t\tstr = str.substring(str.lastIndexOf('/document/') + 10);\r\n\t\t}\r\n\t\tif (this.parseDBID(dbURL) === false) return false;\r\n\t}\r\n\tif (str.substring(0, 4) === 'doc:') str = str.substring(4);\r\n\t// check if the document's name hasn't space or '/'\r\n\tif (this.validIDString(str)) {\r\n\t\tthis.doc = str;\r\n\t}\r\n\treturn this.doc;\r\n};\r\n\r\nIDParser.prototype.parseSchemaURL = function (str) {\r\n\tif (this.context && this.validPrefixedURL(str, this.context)) {\r\n\t\tstr = this.expandPrefixed(str, this.context);\r\n\t}\r\n\tif (this.validURL(str)) {\r\n\t\tstr = this.stripOptionalPath(str, 'schema');\r\n\t}\r\n\treturn this.parseDBID(str);\r\n};\r\n\r\nIDParser.prototype.parseQueryURL = function (str) {\r\n\tif (this.context && this.validPrefixedURL(str, this.context)) {\r\n\t\tstr = this.expandPrefixed(str, this.context);\r\n\t}\r\n\tif (this.validURL(str)) {\r\n\t\tstr = this.stripOptionalPath(str, 'woql');\r\n\t\tstr = this.stripOptionalPath(str, 'query');\r\n\t}\r\n\treturn this.parseDBID(str);\r\n};\r\n\r\nIDParser.prototype.stripOptionalPath = function (str, bit) {\r\n\tif (str.indexOf(`/${bit}`) !== -1) str = str.substring(0, str.indexOf(`/${bit}`));\r\n\treturn str;\r\n};\r\n\r\nIDParser.prototype.parseClassFrameURL = function (str) {\r\n\tif (this.context && this.validPrefixedURL(str, this.context)) {\r\n\t\tstr = this.expandPrefixed(str, this.context);\r\n\t}\r\n\tif (this.validURL(str)) {\r\n\t\tstr = this.stripOptionalPath(str, 'frame');\r\n\t}\r\n\treturn this.parseDBID(str);\r\n};\r\n\r\n// Valid URLs are those that start with http:// or https://\r\nIDParser.prototype.validURL = function (str) {\r\n\tif (str.substring(0, 7) === 'http://' || str.substring(0, 8) === 'https://') return true;\r\n\treturn false;\r\n};\r\n\r\nIDParser.prototype.validPrefixedURL = function (str, context) {\r\n\tif (typeof str !== 'string' || typeof context !== 'object') return false;\r\n\tconst parts = str.split(':');\r\n\tif (parts.length !== 2) return false;\r\n\tif (parts[0].length < 1 || parts[1].length < 1) return false;\r\n\tif (context && context[parts[0]] && this.validIDString(parts[1])) return true;\r\n\treturn false;\r\n};\r\n\r\nIDParser.prototype.validIDString = function (str) {\r\n\tif (typeof str !== 'string') return false;\r\n\tif (str.indexOf(':') !== -1 || str.indexOf(' ') !== -1 || str.indexOf('/') !== -1) return false;\r\n\treturn true;\r\n};\r\n\r\nIDParser.prototype.expandPrefixed = function (str, context) {\r\n\tconst parts = str.split(':');\r\n\treturn context[parts[0]] + parts[1];\r\n};\r\n\r\nmodule.exports = IDParser;\r\n","/**\r\n * @file WOQL Result Object\r\n * @license Apache Version 2\r\n * @summary Object representing the result of a WOQL Query\r\n */\r\nconst UTILS = require('./utils.js');\r\nconst WOQL = require('./woql.js');\r\n\r\n/**\r\n * \r\n * @param {Object} results result JSON object as returned by WOQL query\r\n * @param {WOQLQuery} query the query object that generated the result\r\n * @param {Object} [config] optional result configuration options object\r\n *                 [config.no_compress] by default all URLs are compressed where possible (v:X rather than http://.../variable/x) set to true to return non-compressed values \r\n *                 [config.context] specify the JSON-LD context to use for compressing results - by default the query context will be used\r\n */\r\nfunction WOQLResult(results, query, config) {\r\n\tthis.bindings = (results ? results.bindings : []);\r\n\tthis.query = (query ? query : WOQL.query());\r\n\tthis.cursor = 0;\r\n\tif (!(config && config.no_compress)) {\r\n\t\tconst context = (config && config.context ? config.context : false);\r\n\t\tthis.compress(context);\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {Object} [context] optional context to use for compression - if ommitted query context is used\r\n */\r\nWOQLResult.prototype.compress = function (context) {\r\n\tcontext = (context || this.query.getContext());\r\n\tfor (let i = 0; i < this.bindings.length; i++) {\r\n\t\tfor (const prop of Object.keys(this.bindings[i])) {\r\n\t\t\tconst nprop = UTILS.shorten(prop, context);\r\n\t\t\tconst nval = ((typeof this.bindings[i][prop] === 'string')\r\n\t\t\t\t? UTILS.shorten(this.bindings[i][prop], context)\r\n\t\t\t\t: this.bindings[i][prop]\r\n\t\t\t);\r\n\t\t\tdelete (this.bindings[i][prop]);\r\n\t\t\tthis.bindings[i][nprop] = nval;\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Returns true if there are any results \r\n */\r\nWOQLResult.prototype.hasBindings = function () {\r\n\tif(this.bindings && this.count()) return true;\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * Returns original array of bindings returned by API\r\n */\r\nWOQLResult.prototype.getBindings = function () {\r\n\treturn this.bindings;\r\n};\r\n\r\n/**\r\n * Returns list of variables returned in bindings from API\r\n */\r\nWOQLResult.prototype.getVariableList = function () {\r\n\tif (this.bindings && this.bindings[0]) {\r\n\t\treturn Object.keys(this.bindings[0]);\r\n\t}\r\n\treturn [];\r\n};\r\n\r\n/**\r\n * Number of rows in bound results\r\n */\r\nWOQLResult.prototype.count = function () {\r\n\treturn this.bindings.length;\r\n};\r\n\r\n/**\r\n * Result set navigation\r\n */\r\nWOQLResult.prototype.first = function () {\r\n\tthis.cursor = 0;\r\n\treturn this.bindings[0];\r\n};\r\n\r\nWOQLResult.prototype.last = function(){\r\n\tthis.cursor = this.bindings.length-1;\r\n\treturn this.bindings[this.bindings.length-1];\r\n}\r\n\r\nWOQLResult.prototype.next = function () {\r\n\tif(this.cursor >= this.bindings.length) return false;\r\n\tconst res = this.bindings[this.cursor];\t\r\n\tthis.cursor++;\r\n\treturn res;\r\n};\r\n\r\nWOQLResult.prototype.prev = function () {\r\n\tif (this.cursor > 0) {\r\n\t\tthis.cursor--;\r\n\t\treturn this.bindings[this.cursor];\r\n\t}\r\n};\r\n\r\n/**\r\n * Normally sorting of results is the job of the query - this is just in case you want to resort results according to some key (variable)\r\n */\r\nWOQLResult.prototype.sort = function(key, asc_or_desc){\r\n\tthis.bindings.sort((a, b) => {\r\n\t\treturn this.compareValues(a[key], b[key], asc_or_desc);\r\n\t});\r\n\tthis;\r\n}\r\n\r\n/**\r\n * Compares results a, b according to \"asc\" or \"desc\" order\r\n */\r\nWOQLResult.prototype.compareValues = function(a, b, asc_or_desc=\"asc\"){\r\n\tif(!a || !b) return 0;\r\n\tif(typeof a['@value'] != \"undefined\" && typeof b['@value'] != \"undefined\"){\r\n\t\ta = a['@value'];\r\n\t\tb = b['@value'];\r\n\t}\r\n\tif (a > b) {\r\n\t\treturn (asc_or_desc && asc_or_desc == 'asc' ? 1 : -1);\r\n\t}\r\n\tif (b > a) {\r\n\t\treturn (asc_or_desc && asc_or_desc == 'asc' ? -1 : 1);\r\n\t}\r\n};\r\n\r\nmodule.exports = WOQLResult;\r\n","/**\r\n * The WOQL object is a wrapper around the WOQLQuery object\r\n * Syntactic sugar to allow writing WOQL.triple()... instead of new WOQLQuery().triple()\r\n * Every function matches one of the public api functions of the woql query object\r\n */\r\nconst UTILS = require('./utils');\r\nconst WOQLRule = require('./woqlRule');\r\nconst FrameRule = require('./frameRule');\r\n\r\nconst WOQL = {};\r\n\r\n/*\r\n * We expose all the real woql predicates via the WOQL object,\r\n * for ease of typing all return a WOQL query object\r\n */\r\nWOQL.when = function(Query, Update){ return new WOQLQuery().when(Query, Update);}\r\nWOQL.opt = function(query){ return new WOQLQuery().opt(query); }\r\nWOQL.from = function(dburl, query){ return new WOQLQuery().from(dburl, query); }\r\nWOQL.into = function(dburl, query){ return new WOQLQuery().into(dburl, query); }\r\nWOQL.limit = function(limit, query){ return new WOQLQuery().limit(limit, query); }\r\nWOQL.start = function(start, query){ return new WOQLQuery().start(start, query); }\r\nWOQL.select = function(...list){ return new WOQLQuery().select(...list); }\r\nWOQL.or = function(...queries){\treturn new WOQLQuery().or(...queries); }\r\nWOQL.and = function(...queries){ return new WOQLQuery().and(...queries); }\r\nWOQL.not = function(query){ return new WOQLQuery().not(query); }\r\nWOQL.triple = function(a, b, c){ return new WOQLQuery().triple(a, b, c); }\r\nWOQL.quad = function(a, b, c, d){ return new WOQLQuery().quad(a, b, c, d); }\r\nWOQL.sub = function(a, b){ return new WOQLQuery().sub(a, b); }\r\nWOQL.isa = function(a, b){\treturn new WOQLQuery().isa(a, b);\t}\r\nWOQL.eq = function(a, b){ return new WOQLQuery().eq(a, b);}\r\nWOQL.trim = function(a, b){\treturn new WOQLQuery().trim(a, b);\t}\r\nWOQL.delete = function(JSON_or_IRI){ return new WOQLQuery().delete(JSON_or_IRI);\t}\r\nWOQL.delete_triple = function( S, P, O ){ return new WOQLQuery().delete_triple (S, P, O);\t}\r\nWOQL.delete_quad = function( S, P, O, G ){ return new WOQLQuery().delete_quad (S, P, O, G); }\r\nWOQL.add_triple = function( S, P, O ){ return new WOQLQuery().add_triple (S, P, O); }\r\nWOQL.add_quad = function( S, P, O, G ){ \treturn new WOQLQuery().add_quad (S, P, O, G);}\r\nWOQL.get = function(vars, cols, target){\treturn new WOQLQuery().get(vars, cols, target); }\r\nWOQL.as = function(map, vari){\treturn new WOQLQuery().as(map, vari); }\r\nWOQL.remote = function(url){\treturn new WOQLQuery().remote(url); }\r\nWOQL.file = function(url){\treturn new WOQLQuery().file(url); }\r\nWOQL.list = function(...vars){\treturn new WOQLQuery().list(...vars); }\r\nWOQL.order_by = function(gvarlist, query){\treturn new WOQLQuery().order_by(gvarlist, query); }\r\nWOQL.asc = function(varlist_or_var){\treturn new WOQLQuery().asc(varlist_or_var); }\r\nWOQL.desc = function(varlist_or_var){\treturn new WOQLQuery().desc(varlist_or_var); }\r\nWOQL.group_by = function(gvarlist, groupedvar, groupquery, output){\treturn new WOQLQuery().group_by(gvarlist, groupedvar, groupquery, output); }\r\nWOQL.update = function(Q){\treturn new WOQLQuery().update(Q); }\r\n\r\n/* String and other processing functions */\r\nWOQL.concat = function(list, v){\treturn new WOQLQuery().concat(list, v); }\r\nWOQL.lower = function(u, l){\treturn new WOQLQuery().lower(u, l); }\r\nWOQL.pad = function(input, pad, len, output){\treturn new WOQLQuery().pad(input, pad, len, output); }\r\nWOQL.join = function(...list){\treturn new WOQLQuery().join(...list); }\r\nWOQL.unique = function(prefix, vari, type){\treturn new WOQLQuery().unique(prefix, vari, type); }\r\nWOQL.idgen = function(prefix, vari, type, output){\treturn new WOQLQuery().idgen(prefix, vari, type, output); }\r\nWOQL.typecast = function(vara, type, varb){\treturn new WOQLQuery().typecast(vara, type, varb); }\r\nWOQL.cast = WOQL.typecast;\r\nWOQL.re = function(pattern, test, matches){\treturn new WOQLQuery().re(pattern, test, matches); }\r\n\r\nWOQL.less = function(v1, v2){\treturn new WOQLQuery().less(v1, v2); }\r\nWOQL.greater = function(v1, v2){\treturn new WOQLQuery().greater(v1, v2); }\r\n\r\n\r\n/* Mathematical Processing */\r\nWOQL.eval = function(arith, v){\treturn new WOQLQuery().eval(arith, v);}\r\nWOQL.plus = function(...args){\treturn new WOQLQuery().plus(...args);}\r\nWOQL.minus = function(...args){\treturn new WOQLQuery().minus(...args); }\r\nWOQL.times = function(...args){\treturn new WOQLQuery().times(...args); }\r\nWOQL.divide = function(...args){ return new WOQLQuery().divide(...args); }\r\nWOQL.exp = function(a, b){\treturn new WOQLQuery().exp(a, b); }\r\nWOQL.div = function(...args){\treturn new WOQLQuery().div(...args); }\r\nWOQL.comment = function(arg){\treturn new WOQLQuery().comment(arg); }\r\nWOQL.length = function(var1, res){\treturn new WOQLQuery().length(var1, res);}\r\n\r\n\r\n//language extensions that can be chained after 'grounded' stuff (clauses with a specific subject) sub, isa, delete_triple, add_triple, delete_quad, add_quad, node\r\n//WOQL.value = function(vars){\treturn new WOQLQuery().list(vars); }\r\n//These ones are special ones for dealing with the schema only...\r\nWOQL.star = function(G, S, P, O){\treturn new WOQLQuery().star(G, S, P, O); }\r\nWOQL.add_class = function(classid, graph){\treturn new WOQLQuery().add_class(classid, graph); }\r\nWOQL.add_property = function(propid, type, graph){\treturn new WOQLQuery().add_property(propid, type, graph); }\r\nWOQL.delete_class = function(classid, graph){\treturn new WOQLQuery().delete_class(classid, graph); }\r\nWOQL.delete_property = function(propid, type, graph){\treturn new WOQLQuery().delete_property(propid, type, graph); }\r\nWOQL.node = function(nodeid, type){\treturn new WOQLQuery().node(nodeid, type); }\r\n\r\nWOQL.insert = function(Node, Type, Graph){\r\n\tvar q = new WOQLQuery();\r\n\tif(Graph){\r\n\t\treturn q.add_quad(Node, \"rdf:type\", q.cleanType(Type), Graph);\r\n\t}\r\n\telse {\r\n\t\treturn q.add_triple(Node, \"rdf:type\", q.cleanType(Type));\r\n\t}\r\n}\r\n\r\nWOQL.doctype = function(Type, Graph){\r\n\treturn new WOQLQuery().add_class(Type, Graph).parent(\"Document\");\r\n}\r\n\r\n\r\n/*\r\n * Beneath here are pseudo predicates - they belong to the javascript object\r\n * but not to the WOQL language\r\n */\r\n//returns empty query object\r\nWOQL.query = function(){\treturn new WOQLQuery(); }\r\n//loads query from json\r\nWOQL.json = function(json){\treturn new WOQLQuery().json(json); }\r\n\r\n\r\n\r\n\r\n/**\r\n * The WOQL Query object implements the WOQL language via the fluent style\r\n * @param query - json version of query\r\n * @returns WOQLQuery object\r\n */\r\nfunction WOQLQuery(query){\r\n\tthis.query = (query ? query : {});\r\n\tthis.cursor = this.query;\r\n\tthis.chain_ended = false;\r\n\tthis.contains_update = false;\r\n\t// operators which preserve global paging\r\n\tthis.paging_transitive_properties = ['select', 'from', 'start', 'when', 'opt', 'limit'];\r\n\tthis.vocab = this.loadDefaultVocabulary();\r\n\t//object used to accumulate triples from fragments to support usage like node(\"x\").label(\"y\");\r\n\tthis.tripleBuilder = false;\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Takes an array of variables, an optional array of column names\r\n */\r\nWOQLQuery.prototype.get = function(arr1, arr2, target){\r\n\tif(arr1.json){\r\n\t\tvar map = arr1.json();\r\n\t\ttarget = arr2;\r\n\t}\r\n\telse {\r\n\t\tvar map = this.buildAsClauses(arr1, arr2);\r\n\t}\r\n\tif(target){\r\n\t\tif(target.json) target = target.json();\r\n\t\tthis.cursor['get'] = [map, target];\r\n\t}\r\n\telse {\r\n\t\tthis.cursor['get'] = [map, {}];\r\n\t\tthis.cursor = this.cursor[\"get\"][1];\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.buildAsClauses = function(vars, cols){\r\n\tvar clauses = [];\r\n\tif(vars && typeof vars == \"object\" && vars.length){\r\n\t\tfor(var i = 0; i<vars.length; i++){\r\n\t\t\tvar v = vars[i];\r\n\t\t\tif(cols && typeof cols == \"object\" && cols.length){\r\n\t\t\t\tvar c = cols[i];\r\n\t\t\t\tif(typeof c == \"string\"){\r\n\t\t\t\t\tc = {\"@value\": c};\r\n\t\t\t\t}\r\n\t\t\t\tclauses.push({as: [c, v]});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tv.as ? clauses.push(v) : clauses.push({as: [v]});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn clauses;\r\n}\r\n\r\nWOQLQuery.prototype.typecast = function(va, type, vb){\r\n\tthis.cursor['typecast'] = [va, type, vb];\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Shorthand of above\r\n */\r\nWOQLQuery.prototype.cast = WOQLQuery.prototype.typecast;\r\n\r\n\r\nWOQLQuery.prototype.length = function(va, vb){\r\n\tthis.cursor['length'] = [va, vb];\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.re = function(p, s, m){\r\n\tthis.cursor['re'] = [p, s, m];\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.remote = function(json){\r\n\tthis.cursor['remote'] = [json];\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.file = function(json){\r\n\tthis.cursor['file'] = [json];\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.order_by = function(gvarlist, asc_or_desc, query){\r\n\tlet ordering = gvarlist;\r\n\tif(gvarlist.json) {\r\n\t\tordering = gvarlist.json();\r\n\t}\r\n\tif(typeof ordering != \"object\"){\r\n\t\tordering = [ordering];\r\n\t}\r\n\tif(Array.isArray(ordering)){\r\n\t\tconst vars = UTILS.addNamespacesToVariables(ordering);\r\n\t\tasc_or_desc = asc_or_desc || \"asc\";\r\n\t\tordering = {};\r\n\t\tordering[asc_or_desc] = vars;\r\n\t}\r\n\tthis.advanceCursor(\"order_by\", ordering);\r\n\tif(query){\r\n\t\tthis.cursor = (query.json ? query.json() : query);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.asc = function(varlist_or_var){\r\n\tif(!Array.isArray(varlist_or_var)){\r\n\t\tvarlist_or_var = [varlist_or_var];\r\n\t}\r\n\tthis.cursor[\"asc\"] = varlist_or_var;\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.desc = function(varlist_or_var){\r\n\tif(!Array.isArray(varlist_or_var)){\r\n\t\tvarlist_or_var = [varlist_or_var];\r\n\t}\r\n\tthis.cursor[\"desc\"] = varlist_or_var;\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.group_by = function(gvarlist, groupedvar, groupquery, output){\r\n\tvar args = [];\r\n\tthis.cursor['group_by'] = args;\r\n\tif(gvarlist.json){\r\n\t\targs.push(gvarlist.json());\r\n\t}\r\n\tif(gvarlist['list']){\r\n\t\targs.push(gvarlist);\r\n\t}\r\n\telse {\r\n\t\targs.push({'list': gvarlist});\r\n\t}\r\n\tif(typeof groupedvar == \"object\" && Array.isArray(groupedvar)){\r\n\t\tconst ng = UTILS.addNamespacesToVariables(groupedvar);\r\n\t\tgroupedvar = {\"list\": ng};\r\n\t}\r\n\telse if(typeof groupedvar == \"string\"){\r\n\t\tgroupedvar = UTILS.addNamespacesToVariables(groupedvar);\r\n\t}\r\n\targs.push(groupedvar);\r\n\tif(output){\r\n\t\tgroupquery = groupquery.json ? groupquery.json() : groupquery;\r\n\t\targs.push(groupquery);\r\n\t}\r\n\telse {\r\n\t\toutput = groupquery;\r\n\t\tvar sq = {};\r\n\t\tthis.cursor = sq;\r\n\t\targs.push(sq);\r\n\t}\r\n\targs.push(UTILS.addNamespaceToVariable(output));\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.idgen = function(prefix, vari, type, mode){\r\n\tthis.cursor['idgen'] = [prefix];\r\n\tif(vari.json){\r\n\t\tthis.cursor['idgen'].push(vari.json());\r\n\t}\r\n\telse if(vari.list){\r\n\t\tthis.cursor['idgen'].push(vari);\r\n\t}\r\n\telse {\r\n\t\tthis.cursor['idgen'].push({\"list\": vari})\r\n\t}\r\n\tif(mode){\r\n\t\tthis.cursor['idgen'].push(mode);\r\n\t}\r\n\tthis.cursor['idgen'].push(type);\r\n\treturn this;\r\n}\r\n\r\n\r\nWOQLQuery.prototype.unique = function(prefix, vari, type){\r\n\tthis.cursor['unique'] = [prefix];\r\n\tif(vari.json){\r\n\t\tthis.cursor['unique'].push(vari.json());\r\n\t}\r\n\telse if(vari.list){\r\n\t\tthis.cursor['unique'].push(vari);\r\n\t}\r\n\telse {\r\n\t\tthis.cursor['unique'].push({\"list\": vari})\r\n\t}\r\n\tthis.cursor['unique'].push(type);\r\n\treturn this;\r\n}\r\n\r\n\r\nWOQLQuery.prototype.concat = function(list, v){\r\n\tif(typeof list == \"string\"){\r\n\t\tvar nlist = list.split(/(v:[\\w_]+)\\b/);\r\n\t\tfor(var i = 1; i<nlist.length; i++){\r\n\t\t\tif(nlist[i-1].substring(nlist[i-1].length-1) == \"v\" && nlist[i].substring(0, 1) == \":\"){\r\n\t\t\t\tnlist[i-1] = nlist[i-1].substring(0, nlist[i-1].length-1);\r\n\t\t\t\tnlist[i] = nlist[i].substring(1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse if(list.list){\r\n\t\tvar nlist = list.list;\r\n\t}\r\n\telse if(typeof list == \"object\"){\r\n\t\tvar nlist = list;\r\n\t}\r\n\tvar args = [];\r\n\tfor(var i = 0; i<nlist.length; i++){\r\n\t\tif(!nlist[i]) continue;\r\n\t\tif(typeof nlist[i] == \"string\"){\r\n\t\t\tif(nlist[i].substring(0, 2) == \"v:\"){\r\n\t\t\t\targs.push(nlist[i]);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar nvalue = {\"@value\": nlist[i], \"@type\": \"xsd:string\"};\r\n\t\t\t\targs.push(nvalue);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(nlist[i]){\r\n\t\t\targs.push(nlist[i]);\r\n\t\t}\r\n\t}\r\n\tif(v.indexOf(\":\") == -1) v = \"v:\" + v;\r\n\tthis.cursor['concat'] = [{\"list\": args}, v];\r\n\treturn this;\r\n};\r\n\r\nWOQLQuery.prototype.lower = function(u, l){\r\n\tthis.cursor['lower'] = [u, l];\r\n\treturn this;\r\n};\r\n\r\nWOQLQuery.prototype.pad = function(input, pad, len, output){\r\n\tthis.cursor['pad'] = [input, pad, len, output];\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.join = function(...list){\r\n\tthis.cursor['join'] = list;\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.less = function(v1, v2){\r\n\tthis.cursor['less'] = [v1, v2];\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.greater = function(v1, v2){\r\n\tthis.cursor['greater'] = [v1, v2];\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.list  = function(...vars){\r\n\tthis.cursor['list'] = vars;\r\n\treturn this;\r\n}\r\n\r\n\r\n/*\r\n * json version of query for passing to api\r\n */\r\nWOQLQuery.prototype.json = function(json){\r\n\tif(json){\r\n\t\tthis.query = json;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.query;\r\n}\r\n\r\n/*\r\n * Functions which take a query as an argument advance the cursor to make the chaining of queries fall\r\n * into the corrent place in the encompassing json\r\n */\r\nWOQLQuery.prototype.when = function(Query, Update){\r\n\tif(typeof Query == 'boolean'){\r\n\t\tif(Query){\r\n\t\t\tthis.cursor[\"when\"] = [{\"true\": []}, {}];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.cursor[\"when\"] = [{\"false\": []}, {}];\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tvar q = (Query.json ? Query.json() : Query);\r\n\t\tthis.cursor['when'] = [q, {}];\r\n\t}\r\n\tif(Update){\r\n\t\tvar upd = (Update.json ? Update.json() : Update);\r\n\t\tthis.cursor[\"when\"][1] = upd;\r\n\t}\r\n\tthis.cursor = this.cursor[\"when\"][1];\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.opt = function(query){\r\n\tif(query){\r\n\t\tvar q = ((typeof query.json == \"function\") ? query.json() : query);\r\n\t\tthis.cursor[\"opt\"] = [q];\r\n\t}\r\n\telse {\r\n\t\tthis.cursor['opt'] = [{}];\r\n\t\tthis.cursor = this.cursor[\"opt\"][0];\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nWOQLQuery.prototype.from = function(dburl, query){\r\n\tthis.advanceCursor(\"from\", dburl);\r\n\tif(query){\r\n\t\tthis.cursor = (query.json ? query.json() : query);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.into = function(dburl, query){\r\n\tthis.advanceCursor(\"into\", dburl);\r\n\tif(query){\r\n\t\tthis.cursor = (query.json ? query.json() : query);\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nWOQLQuery.prototype.limit = function(limit, query){\r\n\tthis.advanceCursor(\"limit\", limit);\r\n\tif(query){\r\n\t\tthis.cursor = (query.json ? query.json() : query);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.start = function(start, query){\r\n\tthis.advanceCursor(\"start\", start);\r\n\tif(query){\r\n\t\tthis.cursor = query.json();\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nWOQLQuery.prototype.select = function (...list) {\r\n\tthis.cursor.select = list;\r\n\tconst index = list.length;\r\n\tif (typeof this.cursor.select[index - 1] === 'object') {\r\n\t\tthis.cursor.select[index - 1] = this.cursor.select[index - 1].json();\r\n\t} else {\r\n\t\tthis.cursor.select[index] = {};\r\n\t\tthis.cursor = this.cursor.select[index];\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nWOQLQuery.prototype.and = function (...queries) {\r\n\tthis.cursor.and = [];\r\n\tfor (let i = 0; i < queries.length; i++) {\r\n\t\tif (queries[i].contains_update) this.contains_update = true;\r\n\t\tvar nquery = (queries[i].json ? queries[i].json() : queries[i]);\r\n\t\tif(nquery['and']){\r\n\t\t\tthis.cursor.and = this.cursor.and.concat(nquery['and']);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.cursor.and.push(nquery);\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nWOQLQuery.prototype.or = function (...queries) {\r\n\tthis.cursor.or = [];\r\n\tfor (let i = 0; i < queries.length; i++) {\r\n\t\tif (queries[i].contains_update) this.contains_update = true;\r\n\t\tvar nquery = (queries[i].json ? queries[i].json() : queries[i]);\r\n\t\tthis.cursor.or.push(nquery);\r\n\t}\r\n\treturn this;\r\n};\r\n\r\n/**\r\n * Negation of passed or chained query\r\n */\r\nWOQLQuery.prototype.not = function (query) {\r\n\tif (query) {\r\n\t\tif (query.contains_update) this.contains_update = true;\r\n\t\tif(query.json) query = query.json();\r\n\t\tthis.cursor.not = [query];\r\n\t} else {\r\n\t\tthis.cursor.not = [{}];\r\n\t\tthis.cursor = this.cursor.not[0];\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nWOQLQuery.prototype.triple = function(a, b, c){\r\n\tthis.cursor[\"triple\"] = [this.cleanSubject(a),this.cleanPredicate(b),this.cleanObject(c)];\r\n\treturn this.chainable(\"triple\", this.cleanSubject(a));\r\n}\r\n\r\nWOQLQuery.prototype.quad = function(a, b, c, g){\r\n\tthis.cursor[\"quad\"] = [this.cleanSubject(a),this.cleanPredicate(b),this.cleanObject(c),this.cleanGraph(g)];\r\n\treturn this.chainable(\"quad\", this.cleanSubject(a));\r\n}\r\n\r\nWOQLQuery.prototype.eq = function(a, b){\r\n\tthis.cursor[\"eq\"] = [this.cleanObject(a),this.cleanObject(b)];\r\n\treturn this.last();\r\n};\r\n\r\nWOQLQuery.prototype.sub = function(a, b){\r\n\tif(!b && this.tripleBuilder){\r\n\t\tthis.tripleBuilder.sub(this.cleanClass(a));\r\n\t\treturn this;\r\n\t}\r\n\tthis.cursor[\"sub\"] = [this.cleanClass(a),this.cleanClass(b)];\r\n\treturn this.last(\"sub\", a);\r\n}\r\n\r\nWOQLQuery.prototype.comment = function(val){\r\n\tif(val && val.json){\r\n\t\tthis.cursor['comment'] = [val.json()];\r\n\t}\r\n\telse if(typeof val == \"string\"){\r\n\t\tthis.cursor['comment'] = [{\"@value\": val, \"@language\": \"en\"}];\r\n\t}\r\n\telse if(typeof val == \"object\"){\r\n\t\tif(val.length) this.cursor['comment'] = val;\r\n\t\telse this.cursor['comment'] = [val];\r\n\t}\r\n\telse {\r\n\t\tthis.cursor['comment'] = [];\r\n\t}\r\n\tvar last_index = this.cursor['comment'].length;\r\n\tthis.cursor['comment'][last_index] = {};\r\n\tthis.cursor = this.cursor['comment'][last_index];\r\n\treturn this;\r\n}\r\n\r\n\r\nWOQLQuery.prototype.abstract = function(varname){\r\n\tif(varname){\r\n\t\treturn this.quad(varname, \"tcs:tag\", \"tcs:abstract\", \"db:schema\");\r\n\t}\r\n\telse if(this.tripleBuilder){\r\n\t\tthis.tripleBuilder.abstract();\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.isa = function(a, b){\r\n\tif(!b && this.tripleBuilder){\r\n\t\tthis.tripleBuilder.isa(this.cleanClass(a));\r\n\t\treturn this;\r\n\t}\r\n\tif(b){\r\n\t\tthis.cursor[\"isa\"] = [this.cleanClass(a),this.cleanClass(b)];\r\n\t\treturn this.chainable(\"isa\", a);\r\n\t}\r\n}\r\n\r\nWOQLQuery.prototype.trim = function(a, b){\r\n\tthis.cursor['trim'] = [a, b];\r\n\treturn this.chainable('trim', b);\r\n}\r\n\r\nWOQLQuery.prototype.eval = function(arith, v){\r\n\tarith = arith.json ? arith.json() : arith;\r\n\tthis.cursor['eval'] = [arith, v];\r\n\treturn this.chainable('eval', v);\r\n}\r\n\r\nWOQLQuery.prototype.plus = function (...args) {\r\n\tthis.cursor.plus = [];\r\n\tfor(var i = 0; i < args.length; i++){\r\n\t\tthis.cursor.plus.push(args[i].json ? args[i].json() : args[i]);\r\n\t}\r\n\treturn this.last();\r\n};\r\n\r\nWOQLQuery.prototype.minus = function (...args) {\r\n\tthis.cursor.minus = [];\r\n\tfor(var i = 0; i < args.length; i++){\r\n\t\tthis.cursor.minus.push(args[i].json ? args[i].json() : args[i]);\r\n\t}\r\n\treturn this.last();\r\n};\r\n\r\nWOQLQuery.prototype.times = function (...args) {\r\n\tthis.cursor.times = [];\r\n\tfor(var i = 0; i < args.length; i++){\r\n\t\tthis.cursor.times.push(args[i].json ? args[i].json() : args[i]);\r\n\t}\r\n\treturn this.last();\r\n};\r\n\r\nWOQLQuery.prototype.divide = function (...args) {\r\n\tthis.cursor.divide = [];\r\n\tfor(var i = 0; i < args.length; i++){\r\n\t\tthis.cursor.divide.push(args[i].json ? args[i].json() : args[i]);\r\n\t}\r\n\treturn this.last();\r\n};\r\n\r\nWOQLQuery.prototype.div = function (...args) {\r\n\tthis.cursor.div = [];\r\n\tfor(var i = 0; i < args.length; i++){\r\n\t\tthis.cursor.div.push(args[i].json ? args[i].json() : args[i]);\r\n\t}\r\n\treturn this.last();\r\n};\r\n\r\nWOQLQuery.prototype.exp = function (a, b) {\r\n\ta = (a.json ? a.json() : a);\r\n\tb = (b.json ? b.json() : b);\r\n\tthis.cursor.exp = [a, b];\r\n\treturn this.last();\r\n};\r\n\r\nWOQLQuery.prototype.delete = function (JSON_or_IRI) {\r\n\tthis.cursor.delete = [JSON_or_IRI];\r\n\treturn this.lastUpdate();\r\n};\r\n\r\nWOQLQuery.prototype.delete_triple = function( Subject, Predicate, Object_or_Literal ){\r\n\tthis.cursor['delete_triple'] = [this.cleanSubject(Subject),this.cleanPredicate(Predicate),this.cleanObject(Object_or_Literal)];\r\n\treturn this.chainableUpdate('delete_triple', Subject);\r\n}\r\n\r\nWOQLQuery.prototype.add_triple = function( Subject, Predicate, Object_or_Literal ){\r\n\tthis.cursor['add_triple'] =[this.cleanSubject(Subject),this.cleanPredicate(Predicate),this.cleanObject(Object_or_Literal)];\r\n\treturn this.chainableUpdate('add_triple', Subject);\r\n}\r\n\r\nWOQLQuery.prototype.delete_quad = function( Subject, Predicate, Object_or_Literal, Graph ){\r\n\tthis.cursor['delete_quad'] =[this.cleanSubject(Subject),this.cleanPredicate(Predicate),this.cleanObject(Object_or_Literal),this.cleanGraph(Graph)];\r\n\treturn this.chainableUpdate('delete_quad', Subject);\r\n}\r\n\r\nWOQLQuery.prototype.add_quad = function( Subject, Predicate, Object_or_Literal, Graph){\r\n\tthis.cursor['add_quad'] = [this.cleanSubject(Subject),this.cleanPredicate(Predicate),this.cleanObject(Object_or_Literal),this.cleanGraph(Graph)];\r\n\treturn this.chainableUpdate(\"add_quad\", Subject);\r\n}\r\n\r\nWOQLQuery.prototype.update = function(woql){\r\n\tthis.cursor['update'] = [ woql.json() ];\r\n\treturn this.lastUpdate();\r\n}\r\n\r\n/**\r\n * Schema manipulation shorthand\r\n */\r\nWOQLQuery.prototype.add_class = function(c, graph){\r\n\tif(c){\r\n\t\tgraph = (graph ? this.cleanGraph(graph) : \"db:schema\");\r\n\t\tc = (c.indexOf(\":\") == -1) ? \"scm:\" + c : c;\r\n\t\tthis.adding_class = c;\r\n\t\tthis.add_quad(c,\"rdf:type\",\"owl:Class\",graph);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.add_property = function(p, t, g){\r\n\tt = (t ? t : \"xsd:string\");\r\n\tif(p){\r\n\t\tvar graph = (g ? this.cleanGraph(g) : \"db:schema\");\r\n\t\tp = (p.indexOf(\":\") == -1) ?  \"scm:\" + p : p;\r\n\t\tt = (t.indexOf(\":\") == -1) ? this.cleanType(t) : t ;\r\n\t\tvar tc = this.cursor;\r\n\t\tvar pref = t.split(\":\");\r\n\t\tif(pref[0] && (pref[0] == \"xdd\" || pref[0] == \"xsd\")) {\r\n\t\t    this.and(\r\n\t\t\t\tWOQL.add_quad(p, \"rdf:type\", \"owl:DatatypeProperty\", graph),\r\n\t\t\t\tWOQL.add_quad(p, \"rdfs:range\", t, graph)\r\n\t\t\t);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.and(\r\n\t\t\t\tWOQL.add_quad(p, \"rdf:type\", \"owl:ObjectProperty\", graph),\r\n\t\t\t\tWOQL.add_quad(p, \"rdfs:range\", t, graph)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\treturn this.chainableUpdate(\"add_quad\", p);\r\n}\r\n\r\nWOQLQuery.prototype.delete_class = function(c, graph){\r\n\tif(c){\r\n\t\tgraph = (graph ? this.cleanGraph(graph) : \"db:schema\");\r\n\t\tc = (c.indexOf(\":\") == -1) ?  \"scm:\" + c : c;\r\n\t\treturn this.and(\r\n\t\t\tWOQL.delete_quad(c, \"v:All\", \"v:Al2\", graph),\r\n\t\t\tWOQL.opt().delete_quad(\"v:Al3\", \"v:Al4\", c, graph)\r\n\t\t);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.delete_property = function(p, graph){\r\n\tif(p){\r\n\t\tgraph = (graph ? this.cleanGraph(graph) : \"db:schema\");\r\n\t\tp = (p.indexOf(\":\") == -1) ? \"scm:\" + p : p;\r\n\t\treturn this.and(\r\n\t\t\tWOQL.delete_quad(p, \"v:All\", \"v:Al2\", graph),\r\n\t\t\tWOQL.delete_quad(\"v:Al3\", \"v:Al4\", p, graph)\r\n\t\t);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Language elements that cannot be invoked from the top level and therefore are not exposed in the WOQL api\r\n */\r\nWOQLQuery.prototype.as = function(a, b){\r\n\tif(!a || !b) return;\r\n\tif(!this.asArray){\r\n\t\tthis.asArray = true;\r\n\t\tthis.query = [];\r\n\t}\r\n\tb = (b.indexOf(\":\") == -1 ? \"v:\" + b : b);\r\n\tvar val = (typeof a == \"object\" ? a : { \"@value\" : a});\r\n\tthis.query.push({as: [val, b]});\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * WOQL API\r\n */\r\n\r\nWOQLQuery.prototype.node = function(node, type){\r\n\ttype = (type ? type : \"triple\");\r\n\tthis.tripleBuilder = new TripleBuilder(type, this.cursor, node);\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.max = function(m){\r\n\tif(this.tripleBuilder) this.tripleBuilder.card(m, \"max\");\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.cardinality = function(m){\r\n\tif(this.tripleBuilder) this.tripleBuilder.card(m, \"cardinality\");\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.min = function(m){\r\n\tif(this.tripleBuilder) this.tripleBuilder.card(m, \"min\");\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.graph = function(g){\r\n\tg = this.cleanGraph(g);\r\n\tvar t = (this.type == \"triple\") ? \"quad\" : false;\r\n\tif(this.type == \"add_triple\") t = \"add_quad\";\r\n\tif(this.type == \"delete_triple\") t = \"delete_quad\";\r\n\tif(!this.tripleBuilder){\r\n\t\tthis.tripleBuilder = new TripleBuilder(t, this.cursor);\r\n\t}\r\n\tthis.tripleBuilder.graph(g);\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.domain = function(d){\r\n\td = this.cleanClass(d);\r\n\tif(this.tripleBuilder) this.tripleBuilder.addPO('rdfs:domain',d);\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.label = function(l, lang){\r\n\tif(this.tripleBuilder) this.tripleBuilder.label(l, lang);\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.description = function(c, lang){\r\n\tif(this.tripleBuilder) this.tripleBuilder.description(c, lang);\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.parent = function(...p){\r\n\tif(this.tripleBuilder){\r\n\t\tfor(var i = 0 ; i<p.length; i++){\r\n\t\t\tvar pn = this.cleanClass(p[i]);\r\n\t\t\tthis.tripleBuilder.addPO('rdfs:subClassOf', pn);\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.entity = function(...p){\r\n\treturn this.parent(\"tcs:Entity\");\r\n}\r\n\r\nWOQLQuery.prototype.relationship = function(...p){\r\n\treturn this.parent(\"tcs:Entity\");\r\n}\r\n\r\nWOQLQuery.prototype.property = function(p,val){\r\n\tif(this.tripleBuilder) {\r\n\t\tif(this.adding_class){\r\n\t\t\tvar nwoql = WOQL.add_property(p, val).domain(this.adding_class);\r\n\t\t\tnwoql.query.and.push(this.json());\r\n\t\t\tnwoql.adding_class = this.adding_class;\r\n\t\t\treturn nwoql;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tp = this.cleanPredicate(p);\r\n\t\t\tthis.tripleBuilder.addPO(p, val);\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.star = function(GraphIRI, Subj, Pred, Obj){\r\n\tSubj = (Subj ? this.cleanSubject(Subj) : \"v:Subject\");\r\n\tPred = (Pred ? this.cleanPredicate(Pred) : \"v:Predicate\");\r\n\tObj = (Obj  ? this.cleanObject(Obj) : \"v:Object\");\r\n\tGraphIRI = (GraphIRI ? this.cleanGraph(GraphIRI) : false);\r\n\tif(GraphIRI){\r\n\t\treturn this.quad(Subj, Pred, Obj, GraphIRI);\r\n\t}\r\n\telse {\r\n\t\t//console.log(Subj, Pred, Obj);\r\n\t\treturn this.triple(Subj, Pred, Obj);\r\n\t}\r\n}\r\n\r\n/**\r\n * These are composite functions, the above are primitives\r\n */\r\nWOQLQuery.prototype.getEverything = function(GraphIRI){\r\n\tif(GraphIRI){\r\n\t\tGraphIRI = this.cleanGraph(GraphIRI);\r\n\t\treturn this.quad(\"v:Subject\", \"v:Predicate\", \"v:Object\", GraphIRI);\r\n\t}\r\n\telse {\r\n\t\treturn this.triple(\"v:Subject\", \"v:Predicate\", \"v:Object\");\r\n\t}\r\n}\r\n\r\nWOQLQuery.prototype.getAllDocuments = function(){\r\n\treturn this.and(\r\n\t\tWOQL.triple(\"v:Subject\", \"rdf:type\", \"v:Type\"),\r\n\t\tWOQL.sub(\"v:Type\", \"tcs:Document\")\r\n\t);\r\n}\r\n\r\nWOQLQuery.prototype.documentMetadata = function(){\r\n\treturn this.and(\r\n\t\tWOQL.triple(\"v:ID\", \"rdf:type\", \"v:Class\"),\r\n\t\tWOQL.sub(\"v:Class\", \"tcs:Document\"),\r\n\t\tWOQL.opt().triple(\"v:ID\", \"rdfs:label\", \"v:Label\"),\r\n\t\tWOQL.opt().triple(\"v:ID\", \"rdfs:comment\", \"v:Comment\"),\r\n\t\tWOQL.opt().quad(\"v:Class\", \"rdfs:label\", \"v:Type\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Class\", \"rdfs:comment\", \"v:Type_Comment\", \"db:schema\")\r\n\t);\r\n}\r\n\r\nWOQLQuery.prototype.concreteDocumentClasses = function(){\r\n\treturn this.and(\r\n\t\tWOQL.sub(\"v:Class\", \"tcs:Document\"),\r\n\t\tWOQL.not().abstract(\"v:Class\"),\r\n\t\tWOQL.opt().quad(\"v:Class\", \"rdfs:label\", \"v:Label\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Class\", \"rdfs:comment\", \"v:Comment\", \"db:schema\")\r\n\t);\r\n}\r\n\r\nWOQLQuery.prototype.propertyMetadata = function(){\r\n\treturn this.and(\r\n\t\tWOQL.or(\r\n\t\t\tWOQL.quad(\"v:Property\", \"rdf:type\", \"owl:DatatypeProperty\", \"db:schema\"),\r\n\t\t\tWOQL.quad(\"v:Property\", \"rdf:type\", \"owl:ObjectProperty\", \"db:schema\")\r\n\t\t),\r\n\t\tWOQL.opt().quad(\"v:Property\", \"rdfs:range\", \"v:Range\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Property\", \"rdf:type\", \"v:Type\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Property\", \"rdfs:label\", \"v:Label\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Property\", \"rdfs:comment\", \"v:Comment\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Property\", \"rdfs:domain\", \"v:Domain\", \"db:schema\")\r\n\t);\r\n}\r\n\r\nWOQLQuery.prototype.elementMetadata = function(){\r\n\treturn this.and(\r\n\t\tWOQL.quad(\"v:Element\", \"rdf:type\", \"v:Type\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Element\", \"tcs:tag\", \"v:Abstract\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Element\", \"rdfs:label\", \"v:Label\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Element\", \"rdfs:comment\", \"v:Comment\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Element\", \"rdfs:subClassOf\", \"v:Parent\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Element\", \"rdfs:domain\", \"v:Domain\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Element\", \"rdfs:range\", \"v:Range\", \"db:schema\")\r\n\t);\r\n}\r\n\r\nWOQLQuery.prototype.classMetadata = function(){\r\n\treturn this.and(\r\n\t\tWOQL.quad(\"v:Element\", \"rdf:type\", \"owl:Class\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Element\", \"rdfs:label\", \"v:Label\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Element\", \"rdfs:comment\", \"v:Comment\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Element\", \"tcs:tag\", \"v:Abstract\", \"db:schema\")\r\n\t);\r\n}\r\n\r\nWOQLQuery.prototype.getDataOfClass = function(chosen){\r\n\treturn this.and(\r\n\t\tWOQL.triple(\"v:Subject\", \"rdf:type\", chosen),\r\n\t\tWOQL.opt().triple(\"v:Subject\", \"v:Property\", \"v:Value\")\r\n\t);\r\n}\r\n\r\nWOQLQuery.prototype.getDataOfProperty = function(chosen){\r\n\treturn this.and(\r\n\t\tWOQL.triple(\"v:Subject\", chosen, \"v:Value\"),\r\n\t\tWOQL.opt().triple(\"v:Subject\", \"rdfs:label\", \"v:Label\")\r\n\t);\r\n}\r\n\r\nWOQLQuery.prototype.documentProperties = function(id){\r\n\treturn this.and(\r\n\t\tWOQL.triple(id, \"v:Property\", \"v:Property_Value\"),\r\n\t\tWOQL.opt().quad(\"v:Property\", \"rdfs:label\", \"v:Property_Label\", \"db:schema\"),\r\n\t\tWOQL.opt().quad(\"v:Property\", \"rdf:type\", \"v:Property_Type\", \"db:schema\")\r\n\t);\r\n}\r\n\r\nWOQLQuery.prototype.getDocumentConnections = function(id){\r\n\treturn this.and(\r\n\t\tWOQL.eq(\"v:Docid\", id),\r\n\t\tWOQL.or(\r\n\t\t\tWOQL.triple(id, \"v:Outgoing\", \"v:Entid\"),\r\n\t\t\tWOQL.triple(\"v:Entid\", \"v:Incoming\", id)\r\n\t\t),\r\n\t\tWOQL.triple(\"v:Entid\", \"type\", \"v:Enttype\"),\r\n\t\tWOQL.sub(\"v:Enttype\", \"tcs:Document\"),\r\n\t\tWOQL.opt().triple(\"v:Entid\", \"rdfs:label\", \"v:Label\"),\r\n\t\tWOQL.opt().quad(\"v:Enttype\", \"rdfs:label\", \"v:Class_Label\", \"db:schema\")\r\n\t);\r\n}\r\n\r\nWOQLQuery.prototype.getAllDocumentConnections = function(){\r\n\treturn this.and(\r\n\t\tWOQL.sub(\"v:Enttype\", \"tcs:Document\"),\r\n\t\tWOQL.triple(\"v:doc1\", \"type\", \"v:Enttype\"),\r\n\t\tWOQL.triple(\"v:doc1\", \"v:Predicate\", \"v:doc2\"),\r\n\t\tWOQL.triple(\"v:doc2\", \"type\", \"v:Enttype2\"),\r\n\t\tWOQL.sub(\"v:Enttype2\", \"tcs:Document\"),\r\n\t\tWOQL.opt().triple(\"v:doc1\", \"rdfs:label\", \"v:Label1\"),\r\n\t\tWOQL.opt().triple(\"v:doc2\", \"rdfs:label\", \"v:Label2\"),\r\n\t\tWOQL.not().eq(\"v:doc1\", \"v:doc2\")\r\n\t);\r\n}\r\n\r\n\r\nWOQLQuery.prototype.getInstanceMeta = function(url){\r\n\treturn this.and(\r\n\t\tWOQL.triple(url, \"rdf:type\", \"v:InstanceType\"),\r\n\t\tWOQL.opt().triple(url, \"rdfs:label\", \"v:InstanceLabel\"),\r\n\t\tWOQL.opt().triple(url, \"rdfs:comment\", \"v:InstanceComment\"),\r\n\t\tWOQL.opt().quad(\"v:InstanceType\", \"rdfs:label\", \"v:ClassLabel\", \"db:schema\")\r\n\t);\r\n}\r\n\r\nWOQLQuery.prototype.simpleGraphQuery = function(){\r\n\treturn this.and(\r\n\t    WOQL.triple(\"v:Source\", \"v:Edge\", \"v:Target\"),\r\n\t    WOQL.isa(\"v:Source\", \"v:Source_Class\"),\r\n\t    WOQL.sub(\"v:Source_Class\", \"tcs:Document\"),\r\n\t    WOQL.isa(\"v:Target\", \"v:Target_Class\"),\r\n\t    WOQL.sub(\"v:Target_Class\", \"tcs:Document\"),\r\n\t    WOQL.opt().triple(\"v:Source\", \"rdfs:label\", \"v:Source_Label\"),\r\n\t    WOQL.opt().triple(\"v:Source\", \"rdfs:comment\", \"v:Source_Comment\"),\r\n\t    WOQL.opt().quad(\"v:Source_Class\", \"rdfs:label\", \"v:Source_Type\", \"db:schema\"),\r\n\t    WOQL.opt().quad(\"v:Source_Class\", \"rdfs:comment\", \"v:Source_Type_Comment\", \"db:schema\"),\r\n\t    WOQL.opt().triple(\"v:Target\", \"rdfs:label\", \"v:Target_Label\"),\r\n\t    WOQL.opt().triple(\"v:Target\", \"rdfs:comment\", \"v:Target_Comment\"),\r\n\t    WOQL.opt().quad(\"v:Target_Class\", \"rdfs:label\", \"v:Target_Type\", \"db:schema\"),\r\n\t    WOQL.opt().quad(\"v:Target_Class\", \"rdfs:comment\", \"v:Target_Type_Comment\", \"db:schema\"),\r\n\t    WOQL.opt().quad(\"v:Edge\", \"rdfs:label\", \"v:Edge_Type\", \"db:schema\"),\r\n\t    WOQL.opt().quad(\"v:Edge\", \"rdfs:comment\", \"v:Edge_Type_Comment\", \"db:schema\")\r\n\t);\r\n}\r\n\r\n\r\n/**\r\n * Queries the schema graph and loads all the ids found there as vocabulary that can be used without prefixes\r\n * ignoring blank node ids\r\n */\r\nWOQLQuery.prototype.loadVocabulary = function(client){\r\n\tvar nw = new WOQLQuery().quad(\"v:S\", \"v:P\", \"v:O\", \"db:schema\");\r\n\tnw.execute(client).then( (result) => {\r\n\t\tif(result.bindings && result.bindings.length > 0){\r\n\t\t\tfor(var i = 0; i<result.bindings.length; i++){\r\n\t\t\t\tfor(var k in result.bindings[i]){\r\n\t\t\t\t\tvar v = result.bindings[i][k]\r\n\t\t\t\t\tif(typeof v == \"string\"){\r\n\t\t\t\t\t\tvar spl = v.split(\":\");\r\n\t\t\t\t\t\tif(spl.length == 2 && spl[1] && spl[0] != \"_\"){\r\n\t\t\t\t\t\t\tthis.vocab[spl[0]] = spl[1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\n/**\r\n * Provides the query with a 'vocabulary' a list of well known predicates that can be used without prefixes mapping: id: prefix:id ...\r\n */\r\nWOQLQuery.prototype.setVocabulary = function(vocab){\r\n\tthis.vocab = vocab;\r\n}\r\n\r\nWOQLQuery.prototype.getVocabulary = function(vocab){\r\n\treturn this.vocab;\r\n}\r\n\r\nWOQLQuery.prototype.getLimit = function(){\r\n\treturn this.getPagingProperty(\"limit\");\r\n}\r\n\r\nWOQLQuery.prototype.setLimit = function(l){\r\n\treturn this.setPagingProperty(\"limit\", l);\r\n}\r\n\r\nWOQLQuery.prototype.isPaged = function(q){\r\n\tq = (q ? q : this.query);\r\n\tfor (const prop of Object.keys(q)) {\r\n\t\tif(prop == \"limit\") return true;\r\n\t\telse if(this.paging_transitive_properties.indexOf(prop) !== -1){\r\n\t\t\treturn this.isPaged(q[prop][q[prop].length-1]);\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nWOQLQuery.prototype.getPage = function(){\r\n\tif(this.isPaged()){\r\n\t\tvar psize = this.getLimit();\r\n\t\tif(this.hasStart()){\r\n\t\t\tvar s = this.getStart();\r\n\t\t\treturn (parseInt(s / psize) + 1);\r\n\t\t}\r\n\t\telse return 1;\r\n\t}\r\n\telse return false;\r\n}\r\n\r\nWOQLQuery.prototype.setPage = function(pagenum){\r\n\tvar pstart = (this.getLimit() * (pagenum - 1));\r\n\tif(this.hasStart()){\r\n\t\tthis.setStart(pstart);\r\n\t}\r\n\telse {\r\n\t\tthis.addStart(pstart);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.nextPage = function(){\r\n\treturn this.setPage(this.getPage() + 1);\r\n}\r\n\r\nWOQLQuery.prototype.firstPage = function(){\r\n\treturn this.setPage(1);\r\n}\r\n\r\nWOQLQuery.prototype.previousPage = function(){\r\n\tconst npage = this.getPage() - 1;\r\n\tif(npage > 0) this.setPage(npage);\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.setPageSize = function(size){\r\n\tthis.setPagingProperty(\"limit\", size);\r\n\tif(this.hasStart()){\r\n\t\tthis.setStart(0);\r\n\t}\r\n\telse {\r\n\t\tthis.addStart(0);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLQuery.prototype.hasSelect = function(){\r\n\treturn (this.getPagingProperty(\"select\") ? true : false);\r\n}\r\n\r\nWOQLQuery.prototype.getSelectVariables = function(q){\r\n\tq = (q ? q : this.query);\r\n\tfor (const prop of Object.keys(q)) {\r\n\t\tif(prop == \"select\") {\r\n\t\t\tvar vars = q[prop].slice(0, q[prop].length - 1);\r\n\t\t\treturn vars;\r\n\t\t}\r\n\t\telse if(this.paging_transitive_properties.indexOf(prop) !== -1){\r\n\t\t\tvar val = this.getSelectVariables(q[prop][q[prop].length-1]);\r\n\t\t\tif(typeof val != \"undefined\"){\r\n\t\t\t\treturn val;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nWOQLQuery.prototype.hasStart = function(){\r\n\treturn (typeof this.getPagingProperty(\"start\") != \"undefined\");\r\n}\r\n\r\nWOQLQuery.prototype.getStart = function(){\r\n\treturn this.getPagingProperty(\"start\");\r\n}\r\n\r\nWOQLQuery.prototype.setStart = function(start){\r\n\treturn this.setPagingProperty(\"start\", start);\r\n}\r\n\r\nWOQLQuery.prototype.addStart = function(s){\r\n\tif(this.hasStart()) this.setStart(s);\r\n\telse {\r\n\t\tvar nq = {'start': [s, this.query]};\r\n\t\tthis.query = nq;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n\r\n/**\r\n * Executes the query using the passed client to connect to a server\r\n */\r\nWOQLQuery.prototype.execute = function(client){\r\n\tif(!this.query[\"@context\"]){\r\n\t\tthis.query['@context'] = this.defaultContext(client.connectionConfig.dbURL());\r\n\t\tvar json = this.json();\r\n\t}\r\n\telse {\r\n\t\tvar json = this.json();\r\n\t}\r\n\tif(this.contains_update){\r\n\t\treturn client.select(false, json);\r\n\t\t//return client.update(false, json);\r\n\t}\r\n\telse {\r\n\t\treturn client.select(false, json);\r\n\t}\r\n}\r\n\r\n/*\r\n * Internal State Control Functions\r\n * Not part of public API -\r\n */\r\n\r\n /**\r\n * Advances internal cursor to support chaining of calls: limit(50).start(50). rather than (limit, [50, (start, [50, (lisp-style (encapsulation)))))\r\n */\r\nWOQLQuery.prototype.advanceCursor = function(action, value){\r\n\tthis.cursor[action] = [value];\r\n\tthis.cursor[action][1] = {};\r\n\tthis.cursor = this.cursor[action][1];\r\n}\r\n\r\nWOQLQuery.prototype.loadDefaultVocabulary = function(){\r\n\tvar vocab = {};\r\n\tvocab.type = \"rdf:type\";\r\n\tvocab.label = \"rdfs:label\";\r\n\tvocab.Class = \"owl:Class\";\r\n\tvocab.DatatypeProperty = \"owl:DatatypeProperty\";\r\n\tvocab.ObjectProperty = \"owl:ObjectProperty\";\r\n\tvocab.Entity = \"tcs:Entity\";\r\n\tvocab.Document = \"tcs:Document\";\r\n\tvocab.Relationship = \"tcs:Relationship\";\r\n\tvocab.temporality = \"tcs:temporality\";\r\n\tvocab.geotemporality = \"tcs:geotemporality\";\r\n\tvocab.geography = \"tcs:geography\";\r\n\tvocab.abstract = \"tcs:abstract\";\r\n\tvocab.comment = \"rdfs:comment\";\r\n\tvocab.range = \"rdfs:range\";\r\n\tvocab.domain = \"rdfs:domain\";\r\n\tvocab.subClassOf = \"rdfs:subClassOf\";\r\n\tvocab.string = \"xsd:string\";\r\n\tvocab.integer = \"xsd:integer\";\r\n\tvocab.decimal = \"xsd:decimal\";\r\n\tvocab.email = \"xdd:email\";\r\n\tvocab.json = \"xdd:json\";\r\n\tvocab.dateTime = \"xsd:dateTime\";\r\n\tvocab.date = \"xsd:date\";\r\n\tvocab.coordinate = \"xdd:coordinate\";\r\n\tvocab.line = \"xdd:coordinatePolyline\";\r\n\tvocab.polygon = \"xdd:coordinatePolygon\";\r\n\treturn vocab;\r\n}\r\n\r\nWOQLQuery.prototype.defaultContext = function(DB_IRI){\r\n\tlet def = {}\r\n\tfor(var pref in UTILS.standard_urls){\r\n\t\tdef[pref] = UTILS.standard_urls[pref];\r\n\t}\r\n\tdef.scm = DB_IRI + \"/schema#\"\r\n\tdef.doc = DB_IRI + \"/document/\"\r\n\tdef.db = DB_IRI + \"/\";\r\n\treturn def;\r\n}\r\n\r\n\r\n\r\n/**\r\n * Called to indicate that this is the last call in constructing a complete woql query object\r\n *\r\n */\r\nWOQLQuery.prototype.last = function(){\r\n\tthis.chain_ended = true;\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Called to inidicate that this is the last call in constructing a complete WOQL update query\r\n */\r\nWOQLQuery.prototype.lastUpdate = function(){\r\n\tthis.contains_update = true;\r\n\tthis.last();\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Called to indicate internally that this is a chainable update - by setting the subject and call of the Triple Builder object which is used to build further triples\r\n */\r\nWOQLQuery.prototype.chainable = function(call, subj){\r\n\tthis.tripleBuilder = new TripleBuilder(call, this.cursor, this.cleanSubject(subj));\r\n\tthis.last();\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Called to indicate internally that this is a chainable update - by setting the subject and call of the Triple Builder object which is used to build further triples\r\n */\r\nWOQLQuery.prototype.chainableUpdate = function(call, subj){\r\n\tthis.tripleBuilder = new TripleBuilder(call, this.cursor, this.cleanSubject(subj));\r\n\treturn this.lastUpdate();\r\n}\r\n\r\n\r\n/**\r\n * Returns the value of one of the 'paging' related properties (limit, start,...)\r\n */\r\nWOQLQuery.prototype.getPagingProperty = function(pageprop, q){\r\n\tq = (q ? q : this.query);\r\n\tfor (const prop of Object.keys(q)) {\r\n\t\tif(prop == pageprop) return q[prop][0];\r\n\t\telse if(this.paging_transitive_properties.indexOf(prop) !== -1){\r\n\t\t\tvar val = this.getPagingProperty(pageprop, q[prop][q[prop].length-1]);\r\n\t\t\tif(typeof val != \"undefined\"){\r\n\t\t\t\treturn val;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Sets the value of one of the paging_transitive_properties properties\r\n */\r\nWOQLQuery.prototype.setPagingProperty = function(pageprop, val, q){\r\n\tq = (q ? q : this.query);\r\n\tfor (const prop of Object.keys(q)) {\r\n\t\tif(prop == pageprop) {\r\n\t\t\tq[prop][0] = val;\r\n\t\t}\r\n\t\telse if(this.paging_transitive_properties.indexOf(prop) !== -1){\r\n\t\t\tthis.setPagingProperty(pageprop, val, q[prop][q[prop].length-1]);\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Retrieves the value of the current json-ld context\r\n */\r\nWOQLQuery.prototype.getContext = function(q){\r\n\tq = (q ? q : this.query);\r\n\tfor (const prop of Object.keys(q)) {\r\n\t\tif(prop == \"@context\") return q[prop];\r\n\t\tif(this.paging_transitive_properties.indexOf(prop) !== -1){\r\n\t\t\tvar nq = q[prop][1];\r\n\t\t\tvar nc = this.getContext(nq);\r\n\t\t\tif(nc) return nc;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * Retrieves the value of the current json-ld context\r\n */\r\nWOQLQuery.prototype.context = function(c){\r\n\tthis.cursor['@context'] = c;\r\n}\r\n\r\n\r\n/*\r\n* Transforms from internal json representation to human writable WOQL.js format\r\n*/\r\nWOQLQuery.prototype.prettyPrint = function(indent, show_context, q, fluent){\r\n\tif(!this.indent) this.indent = indent;\r\n\tq = (q ? q : this.query);\r\n\tvar str = \"\";\r\n\tconst newlining_operators = [\"get\", \"from\", \"into\"];\r\n\tfor(var operator in q){\r\n\t\t//ignore context in pretty print\r\n\t\tif(operator == \"@context\") {\r\n\t\t\tif( show_context){\r\n\t\t\t\tvar c = this.getContext();\r\n\t\t\t\tif(c) str += \"@context: \" + JSON.stringify(c) + \"\\n\";\r\n\t\t\t}\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\t//statement starts differently depending on indent and whether it is fluent style or regular function style\r\n\t\tstr += this.getWOQLPrelude(operator, fluent, indent - this.indent);\r\n\t\tvar val = q[operator];\r\n\t\tif(this.isChainable(operator, val[val.length-1])){\r\n\t\t\t//all arguments up until the last are regular function arguments\r\n\t\t\tstr += this.uncleanArguments(operator,  val.slice(0, val.length-1), indent, show_context);\r\n\t\t\tif(newlining_operators.indexOf(operator) !== -1){\r\n\t\t\t\t//some fluent function calls demand a linebreak..\r\n\t\t\t\tstr += \"\\n\" + nspaces(indent-this.indent);\r\n\t\t\t}\r\n\t\t\t//recursive call to query included in tail\r\n\t\t\tstr += this.prettyPrint(indent, show_context, val[val.length-1], true);\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//non chainable operators all live inside the function call parameters\r\n\t\t\tif(!this.hasShortcut(operator, val, indent)){\r\n\t\t\t\tstr += this.uncleanArguments(operator,  val, indent, show_context);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//remove any trailing dots in the chain (only exist in incompletely specified queries)\r\n\tif(str.substring(str.length-1) == \".\"){\r\n\t\tstr = str.substring(0, str.length-1);\r\n\t}\r\n\treturn str;\r\n}\r\n\r\n/**\r\n * Gets the starting characters for a WOQL query - varies depending on how the query is invoked and how indented it is\r\n */\r\nWOQLQuery.prototype.getWOQLPrelude = function(operator, fluent, inline){\r\n\tif(operator === \"true\" || operator === \"false\"){\r\n\t\treturn operator;\r\n\t}\r\n\tif(fluent){\r\n\t\treturn \".\" + operator;\r\n\t}\r\n\treturn (inline ? \"\\n\" + nspaces(inline) : \"\") + \"WOQL.\" + operator;\r\n}\r\n\r\n/**\r\n * Determines whether a given operator can have a chained query as its last argument\r\n */\r\nWOQLQuery.prototype.isChainable = function(operator, lastArg){\r\n\tconst non_chaining_operators = [\"and\", \"or\"];\r\n\tif(lastArg && typeof lastArg == \"object\" && typeof lastArg['@value'] == \"undefined\"  && typeof lastArg['@type'] == \"undefined\"  && typeof lastArg['value'] == \"undefined\" && non_chaining_operators.indexOf(operator) == -1){\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n/**\r\n * Transforms arguments to WOQL functions from the internal (clean) version, to the WOQL.js human-friendly version\r\n */\r\nWOQLQuery.prototype.uncleanArguments = function(operator, args, indent, show_context){\r\n\tif(this.hasShortcut(operator, args)){\r\n\t\treturn this.getShortcut(operator, args, indent);\r\n\t}\r\n\tlet str = '(';\r\n\tfor(var i = 0; i<args.length; i++){\r\n\t\tif(this.argIsSubQuery(operator, args[i], i)){\r\n\t\t\tstr += this.prettyPrint(indent + this.indent, show_context, args[i], false);\r\n\t\t}\r\n\t\telse if(operator == \"get\" && i == 0){ // weird one, needs special casing\r\n\t\t\tstr += \"\\n\" + nspaces(indent-this.indent) + \"WOQL\";\r\n\t\t\tfor(var j = 0; j < args[0].length; j++){\r\n\t\t\t\tvar myas = (args[0][j].as ? args[0][j].as : args[0][j]);\r\n\t\t\t\tvar lhs = myas[0];\r\n\t\t\t\tvar rhs = myas[1];\r\n\t\t\t\tif(typeof lhs == \"object\" && lhs['@value']){\r\n\t\t\t\t\tlhs = lhs['@value'];\r\n\t\t\t\t}\r\n\t\t\t\tif(typeof lhs == \"object\") {\r\n\t\t\t\t\tlhs = JSON.stringify(lhs);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlhs = '\"' + lhs + '\"'\r\n\t\t\t\t}\r\n\t\t\t\tstr += '.as(' + lhs;\r\n\t\t\t\tif(rhs) str += ', \"' + rhs + '\"';\r\n\t\t\t\tstr += \")\";\r\n\t\t\t\tstr += \"\\n\" + nspaces(indent);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstr += this.uncleanArgument(operator, args[i], i, args);\r\n\t\t}\r\n\t\tif(i < args.length -1) str +=  ',';\r\n\t}\r\n\tconst args_take_newlines = [\"and\", \"or\"];\r\n\tif(args_take_newlines.indexOf(operator) != -1){\r\n\t\tstr += \"\\n\" + nspaces(indent-this.indent);\r\n\t}\r\n\tstr += \")\";\r\n\treturn str;\r\n}\r\n\r\n\r\n/**\r\n * Passed as arguments: 1) the operator (and, triple, not, opt, etc)\r\n * 2) the value of the argument\r\n * 3) the index (position) of the argument.\r\n */\r\nWOQLQuery.prototype.uncleanArgument = function(operator, val, index, allArgs){\r\n\t//numeric values go out untouched...\r\n\tconst numeric_operators = [\"limit\", \"start\", \"eval\", \"plus\", \"minus\", \"times\", \"divide\", \"exp\", \"div\"];\r\n\tif(operator == \"isa\"){\r\n\t\tval = (index == 0 ? this.unclean(val, 'subject') : this.unclean(val, 'class'));\r\n\t}\r\n\telse if(operator == \"sub\"){\r\n\t\tval = this.unclean(val, 'class');\r\n\t}\r\n\telse if([\"select\"].indexOf(operator) != -1){\r\n\t\tif(val.substring(0, 2) == \"v:\") val = val.substring(2);\r\n\t}\r\n\telse if([\"quad\", \"add_quad\", \"delete_quad\", \"add_triple\", \"delete_triple\", \"triple\"].indexOf(operator) != -1){\r\n\t\tswitch(index){\r\n\t\t\tcase 0: val = this.unclean(val, \"subject\"); break;\r\n\t\t\tcase 1: val = this.unclean(val, \"predicate\"); break;\r\n\t\t\tcase 2: val = this.unclean(val, \"object\"); break;\r\n\t\t\tcase 3: val = this.unclean(val, \"graph\"); break;\r\n\t\t}\r\n\t}\r\n\tif(typeof val == \"object\"){\r\n\t\tif(operator == \"concat\" && index == 0){\r\n\t\t\tvar cstr = \"\";\r\n\t\t\tif(val.list){\r\n\t\t\t\tfor(var i = 0 ; i<val.list.length; i++){\r\n\t\t\t\t\tif(val.list[i]['@value']) cstr += val.list[i]['@value'];\r\n\t\t\t\t\telse cstr += val.list[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar oval = '\"' + cstr + '\"';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar oval = this.uncleanObjectArgument(operator, val, index);\r\n\t\t}\r\n\t\treturn oval;\r\n\t}\r\n\t//else if(numeric_operators.indexOf(operator) !== -1){\r\n\t//\treturn val;\r\n\t//}\r\n\tif(typeof val == \"string\"){\r\n\t\treturn '\"' + val + '\"';\r\n\t}\r\n\treturn val;\r\n}\r\n\r\n\r\n\r\nWOQLQuery.prototype.uncleanObjectArgument = function(operator, val, index){\r\n\tif(val['@value'] && (val['@language'] || (val['@type'] && val['@type'] == \"xsd:string\"))) return '\"' + val['@value'] + '\"';\r\n\tif(val['@value'] && (val['@type'] && val['@type'] == \"xsd:integer\")) return val['@value'];\r\n\tif(val['list']) {\r\n\t\tvar nstr = \"[\";\r\n\t\tfor(var i = 0 ; i<val['list'].length; i++){\r\n\t\t\tif(typeof val['list'][i] == \"object\"){\r\n\t\t\t\tnstr += this.uncleanObjectArgument(\"list\", val['list'][i], i);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnstr += '\"' + val['list'][i] + '\"';\r\n\t\t\t}\r\n\t\t\tif(i < val['list'].length-1){\r\n\t\t\t\tnstr += \",\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tnstr += \"]\";\r\n\t\treturn nstr;\r\n\t}\r\n\treturn JSON.stringify(val);\r\n}\r\n\r\nWOQLQuery.prototype.argIsSubQuery = function(operator, arg, index){\r\n\tconst squery_operators = [\"and\", \"or\", \"when\", \"not\", \"opt\", \"exp\", \"minus\", \"div\", \"divide\", \"plus\", \"multiply\"];\r\n\tif(squery_operators.indexOf(operator) !== -1){\r\n\t\tif(arg && typeof arg != \"object\") return false;\r\n\t\treturn true;\r\n\t}\r\n\tif(operator == \"group_by\" && index == 2) return true;\r\n\telse return false;\r\n}\r\n\r\n/**\r\n * Goes from the properly prefixed clean internal version of a variable to the WOQL.js unprefixed form\r\n */\r\nWOQLQuery.prototype.unclean = function(s, part){\r\n\tif(typeof s != \"string\") return s;\r\n\tif(s.indexOf(\":\") == -1) return s;\r\n\tif(s.substring(0,4) == \"http\") return s;\r\n\tvar suff = s.split(\":\")[1];\r\n\tif(this.vocab && this.vocab[suff] && this.vocab[suff] == s){\r\n\t\treturn suff;\r\n\t}\r\n\tif(!part) return s;\r\n\tif(part == \"subject\" && (s.split(\":\")[0] == \"doc\")) return suff;\r\n\tif(part == \"class\" && (s.split(\":\")[0] == \"scm\")) return suff;\r\n\tif(part == \"predicate\" && (s.split(\":\")[0] == \"scm\")) return suff;\r\n\tif(part == \"type\" && (s.split(\":\")[0] == \"scm\")) return suff;\r\n\tif(part == \"graph\" && (s.split(\":\")[0] == \"db\")) return suff;\r\n\treturn s;\r\n}\r\n\r\nWOQLQuery.prototype.hasShortcut = function(operator, args, indent){\r\n\tif(operator == \"true\") return true;\r\n\treturn false;\r\n}\r\n\r\nWOQLQuery.prototype.getShortcut = function(operator, args, indent){\r\n\tif(operator == \"true\") return true;\r\n}\r\n\r\nfunction nspaces(n){\r\n\tlet spaces = \"\";\r\n\tfor(var i = 0; i<n; i++){\r\n\t\tspaces += \" \";\r\n\t}\r\n\treturn spaces;\r\n}\r\n\r\nWOQLQuery.prototype.printLine = function(indent, clauses){\r\n\treturn \"(\\n\" + nspaces(indent) + \"WOQL.\" + clauses.join(\",\\n\"+ nspaces(indent) + \"WOQL.\") + \"\\n\" + nspaces(indent - this.indent) + \")\";\r\n}\r\n\r\nWOQLQuery.prototype.cleanSubject = function(s){\r\n\tif(typeof s != \"string\") return s;\r\n\tif(s.indexOf(\":\") != -1) return s;\r\n\tif(this.vocab && this.vocab[s]) return this.vocab[s];\r\n\treturn \"doc:\" + s;\r\n}\r\n\r\nWOQLQuery.prototype.cleanPredicate = function(p){\r\n\tif(p.indexOf(\":\") != -1) return p;\r\n\tif(this.vocab && this.vocab[p]) return this.vocab[p];\r\n\treturn \"scm:\" + p;\r\n}\r\nWOQLQuery.prototype.cleanType = function(t){\r\n\tif(t.indexOf(\":\") != -1) return t;\r\n\tif(this.vocab && this.vocab[t]) return this.vocab[t];\r\n\treturn \"scm:\" + t;\r\n}\r\n\r\nWOQLQuery.prototype.cleanObject = function(o){\r\n\tif(typeof o != \"string\" || o.indexOf(\":\") != -1) return o;\r\n\tif(this.vocab && this.vocab[o]) return this.vocab[o];\r\n\treturn { \"@value\": o, \"@language\": \"en\"};\r\n}\r\n\r\nWOQLQuery.prototype.cleanGraph = function(g){\r\n\tif(g.indexOf(\":\") != -1) return g;\r\n\tif(this.vocab && this.vocab[g]) return this.vocab[g];\r\n\treturn \"db:\" + g;\r\n}\r\n\r\nWOQLQuery.prototype.cleanClass = function(c){\r\n\tif(c.indexOf(\":\") != -1) return c;\r\n\tif(this.vocab && this.vocab[c]) return this.vocab[c];\r\n\treturn \"scm:\" + c;\r\n}\r\n\r\n/*\r\n * higher level composite queries - not language or api elements\r\n */\r\n/**\r\n * Class for enabling building of triples from pieces\r\n * type is add_quad / remove_quad / add_triple / remove_triple\r\n */\r\nfunction TripleBuilder(type, cursor, s){\r\n\t//what accumulation type are we\r\n\tthis.type = type;\r\n\tthis.cursor = cursor;\r\n\tthis.subject = (s ? s : false);\r\n\tthis.g = false;\r\n}\r\n\r\nTripleBuilder.prototype.label = function(l, lang){\r\n\tlang = (lang ? lang : \"en\");\r\n\tif(l.substring(0, 2) == \"v:\"){\r\n\t\tvar d = l;//{\"value\": l, \"@language\": lang }\r\n\t}\r\n\telse {\r\n\t\tvar d = {\"@value\": l, \"@language\": lang }\r\n\t}\r\n\tvar x = this.addPO('rdfs:label', d);\r\n\treturn x;\r\n}\r\n\r\nTripleBuilder.prototype.description = function(c, lang){\r\n\tlang = (lang ? lang : \"en\");\r\n\tif(c.substring(0, 2) == \"v:\"){\r\n\t\t//var d = {\"value\": c, \"@language\": lang }\r\n\t\tvar d = c;\r\n\t}\r\n\telse {\r\n\t\tvar d = {\"@value\": c, \"@language\": lang }\r\n\t}\r\n\treturn this.addPO('rdfs:comment', d);\r\n}\r\n\r\nTripleBuilder.prototype.addPO = function(p, o, g){\r\n\tif(this.type){\r\n\t\tvar ttype = (this.type == \"isa\" || this.type == \"sub\" ? \"triple\" : this.type);\r\n\t}\r\n\telse var ttype = \"triple\";\r\n\tvar evstr = ttype + '(\"' + this.subject + '\", \"' + p + '\", ';\r\n\tif(typeof o == \"string\"){\r\n\t\tevstr += \"'\" + o + \"'\";\r\n\t}\r\n\telse if(typeof o == \"object\"){\r\n\t\tevstr += JSON.stringify(o);\r\n\t}\r\n\telse {\r\n\t\tevstr += o;\r\n\t}\r\n\tif(ttype.substring(ttype.length-4) == \"quad\" || this.g){\r\n\t\tvar g = (g ? g : (this.g ? this.g : \"db:schema\"));\r\n\t\tevstr += ', \"' + g + '\"';\r\n\t}\r\n\tevstr += \")\";\r\n\ttry {\r\n\t\tvar unit = eval(\"new WOQLQuery().\" + evstr );\r\n\t\treturn this.addEntry(unit);\r\n\t}\r\n\tcatch(e){\r\n\t\tconsole.error(e);\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nTripleBuilder.prototype.getO = function(s, p){\r\n\tif(this.cursor['and']){\r\n\t\tfor(var i = 0; i<this.cursor['and'].length; i++){\r\n\t\t\tvar clause = this.cursor['and'][i];\r\n\t\t\tvar key = Object.keys(clause)[0];\r\n\t\t\tif(clause[key][0] == s && clause[key][1] == p && clause[key][2]) return clause[key][2];\r\n\t\t}\r\n\t}\r\n\telse if(Object.keys(this.cursor)) {\r\n\t\tvar key =  Object.keys(this.cursor)[0];\r\n\t\tif(this.cursor[key][0] == s && this.cursor[key][1] == p && this.cursor[key][2])  return this.cursor[key][2];\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTripleBuilder.prototype.addEntry = function(unit){\r\n\tif(this.cursor[this.type]){\r\n\t\tvar next = {};\r\n\t\tnext[this.type] = this.cursor[this.type];\r\n\t\tthis.cursor['and'] = [next];\r\n\t\tdelete(this.cursor[this.type]);\r\n\t}\r\n\tif(this.cursor['and']){\r\n\t\tthis.cursor['and'].push(unit.json());\r\n\t}\r\n\telse {\r\n\t\tvar j = unit.json();\r\n\t\tif(j[this.type]) this.cursor[this.type] = j[this.type];\r\n\t\telse {\r\n\t\t\talert(JSON.stringify(j));\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nTripleBuilder.prototype.card = function(n, which){\r\n\tlet os = this.subject;\r\n\tthis.subject += \"_\" + which;\r\n\tthis.addPO('rdf:type', \"owl:Restriction\");\r\n\tthis.addPO(\"owl:onProperty\", os);\r\n\tswitch(which){\r\n\t\tcase \"max\": this.addPO(\"owl:maxCardinality\", {\"@value\": n, \"@type\": \"xsd:nonNegativeInteger\"});\r\n\t\t\tbreak;\r\n\t\tcase \"min\": this.addPO(\"owl:minCardinality\", {\"@value\": n, \"@type\": \"xsd:nonNegativeInteger\"});\r\n\t\t\tbreak;\r\n\t\tdefault: this.addPO(\"owl:cardinality\", {\"@value\": n, \"@type\": \"xsd:nonNegativeInteger\"});\r\n\t}\r\n\tlet od = this.getO(os, \"rdfs:domain\");\r\n\tif(od){\r\n\t\tvar cardcls = this.subject;\r\n\t\tthis.subject = od;\r\n\t\tthis.addPO(\"rdfs:subClassOf\", cardcls);\r\n\t}\r\n\tthis.subject = os;\r\n\treturn this;\r\n};\r\n\r\nTripleBuilder.prototype.isa = function(a){\r\n\tvar unit = new WOQLQuery.isa(this.subject, a);\r\n\tthis.tb.addEntry(unit);\r\n}\r\n\r\nTripleBuilder.prototype.graph = function(g){\r\n\tthis.g = g;\r\n}\r\n\r\nTripleBuilder.prototype.sub = function(s){\r\n\tvar unit = new WOQLQuery.sub(this.subject, s);\r\n\treturn this.addEntry(unit);\r\n}\r\n\r\nTripleBuilder.prototype.abstract = function(){\r\n\treturn this.addPO('tcs:tag', \"tcs:abstract\");\r\n}\r\n\r\nmodule.exports = WOQL;\r\n","/**\r\n * @file Terminus Rules\r\n * @license Apache Version 2\r\n * @summary Abstract object to support applying matching rules to result sets and documents\r\n * sub-classes are FrameRule and WOQLRule - this just has common functions\r\n */\r\n\r\nconst UTILS = require('./utils.js');\r\n\r\nfunction TerminusRule(){}\r\n\r\n/**\r\n * @param {Boolean} tf - the rule will match all literals or all non-literals\r\n */\r\nTerminusRule.prototype.literal = function(tf){\r\n\tif(typeof tf == \"undefined\"){\r\n\t\treturn this.pattern.literal;\r\n\t}\r\n\tthis.pattern.literal = tf;\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * @param {[TYPE_URLS]} list - parameters are types identified by prefixed URLS (xsd:string...)\r\n */\r\nTerminusRule.prototype.type = function(...list){\r\n\tif(typeof list == \"undefined\" || list.length == 0){\r\n\t\treturn this.pattern.type;\r\n\t}\r\n\tthis.pattern.type = list;\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Specifies the scope of a rule - row / cell / object / property / * .. what part of the result does the rule apply to \r\n */\r\nTerminusRule.prototype.scope = function(scope){\r\n\tif(typeof scope == \"undefined\"){\r\n\t\treturn this.pattern.scope;\r\n\t}\r\n\tthis.pattern.scope = scope;\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Specifies that the rule matches a specific value\r\n */\r\nTerminusRule.prototype.value = function(...val){\r\n\tif(typeof val == \"undefined\"){\r\n\t\treturn this.pattern.value;\r\n\t}\r\n\tthis.pattern.value = val;\r\n\tconsole.log(this.pattern.value);\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Produces a canonical json format to represent the rule\r\n */\r\nTerminusRule.prototype.json = function(mjson){\r\n\tif(!mjson) {\r\n\t\tvar njson = {};\r\n\t\tif(this.pattern) njson.pattern = this.pattern.json();\r\n\t\tif(this.rule) njson.rule = this.rule;\r\n\t\treturn njson;\r\n\t}\r\n\telse {\r\n\t    if(mjson.pattern) this.pattern.setPattern(mjson.pattern);\r\n\t\tif(mjson.rule) this.rule = mjson.rule;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Contained Pattern Object to encapsulate pattern matching\r\n * @param {Object} pattern \r\n */\r\nfunction TerminusPattern(pattern){};\r\n\r\nTerminusPattern.prototype.setPattern = function(pattern){\r\n\tif(typeof pattern.literal != \"undefined\") this.literal = pattern.literal;\r\n\tif(pattern.type) this.type = pattern.type;\r\n\tif(pattern.scope) this.scope = pattern.scope;\r\n\tif(pattern.value) this.value = pattern.value;\r\n}\r\n\r\nTerminusPattern.prototype.json = function(){\r\n    var json = {};\r\n\tif(typeof this.literal != \"undefined\") json.literal = this.literal;\r\n\tif(this.type) json.type = this.type;\r\n    if(this.scope) json.scope = this.scope;\r\n    if(this.value) json.value = this.value;\r\n    return json;\r\n}\r\n\r\n/**\r\n * Tests whether the passed values matches the basic pattern\r\n */\r\nTerminusPattern.prototype.testBasics = function(scope, value){\r\n\tif(this.scope && scope && this.scope != scope) return false;\r\n\tif(this.type){\r\n\t\tvar dt = value[\"@type\"];\r\n\t\tif(!dt || !this.testValue(dt, this.type)) return false; \r\n\t}\r\n\tif(typeof this.literal != \"undefined\"){\r\n\t\tif(!(this.literal == !(typeof value[\"@type\"] == \"undefined\"))) return false;\r\n\t}\r\n\tif(typeof this.value != \"undefined\"){\r\n\t   if(!this.testValue(value, this.value)) return false;\r\n\t}\r\n\treturn true;//passed all tests\r\n}\r\n\r\nTerminusPattern.prototype.testValue = function(value, constraint){\r\n\tvar vundertest = (value['@value'] ? value['@value'] : value);\r\n\tif(typeof constraint == \"function\") return constraint(vundertest);\r\n\tif(constraint && !Array.isArray(constraint)) constraint = [constraint];\r\n\tfor(var i = 0; i<constraint.length; i++){\r\n\t\tvar nc = constraint[i];\r\n\t\tif(typeof vundertest == \"string\"){\r\n\t\t\tif(this.stringMatch(nc, vundertest)) return true;\r\n\t\t}\r\n\t\telse if(typeof vundertest == \"number\"){\r\n\t\t\tif(this.numberMatch(nc, vundertest)) return true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n/**\r\n * Unpacks an array into a list of arguments\r\n * @param {Boolean} nonstring - if set, the values will be double-quoted only when they are strings, otherwise, all will be quoted as strings\r\n */\r\nTerminusPattern.prototype.unpack = function(arr, nonstring){\r\n\tvar str = \"\";\r\n\tif(nonstring){\r\n\t\tfor(var i = 0 ; i<arr.length; i++){\r\n\t\t\tif(typeof arr[i] == \"string\"){\r\n\t\t\t\tstr += '\"' + arr[i] + '\"';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tstr += arr[i];\r\n\t\t\t}\r\n\t\t\tif(i < (arr.length - 1)) str += \", \";\r\n\t\t} \r\n\t}\r\n\telse {\r\n\t\tstr = '\"' + arr.join('\",\"') + '\"';\r\n\t}\r\n\treturn str;\r\n}\r\n\r\n\r\nTerminusPattern.prototype.IDsMatch = function (ida, idb) {\r\n\treturn UTILS.compareIDs(ida, idb);\r\n};\r\n\r\nTerminusPattern.prototype.classIDsMatch = function (ida, idb) {\r\n\treturn this.IDsMatch(ida, idb);\r\n};\r\n\r\nTerminusPattern.prototype.propertyIDsMatch = function (ida, idb) {\r\n\tconst match = this.IDsMatch(ida, idb);\r\n\treturn match;\r\n};\r\n\r\nTerminusPattern.prototype.rangeIDsMatch = function (ida, idb) {\r\n\treturn this.IDsMatch(ida, idb);\r\n};\r\n\r\nTerminusPattern.prototype.valuesMatch = function (vala, valb) {\r\n\treturn vala == valb;\r\n};\r\nTerminusPattern.prototype.numberMatch = function (vala, valb) {\r\n\tif (typeof vala === 'string') {\r\n\t\ttry {\r\n\t\t\treturn eval(valb + vala);\r\n\t\t} catch (e) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn vala === valb;\r\n};\r\n\r\nTerminusPattern.prototype.stringMatch = function (vala, valb) {\r\n\tif(vala.substring(0,1) == \"/\"){\r\n\t\tconst pat = new RegExp(vala.substring(1));\r\n\t\treturn pat.test(valb);\r\n\t}\r\n\telse {\r\n\t\treturn vala === valb;\r\n\t}\r\n};\r\n\r\n\r\n module.exports = {TerminusRule, TerminusPattern};","const Config  = require('./viewConfig.js');\r\nconst WOQLTable  = require('./woqlTable.js');\r\nconst UTILS  = require('../utils.js');\r\n\r\n\r\nfunction WOQLTableConfig(){\r\n    Config.ViewConfig.call(this); \r\n    this.type = \"table\";\r\n}\r\n\r\nWOQLTableConfig.prototype = Object.create(Config.ViewConfig.prototype);\r\nWOQLTableConfig.prototype.constructor = Config.ViewConfig;\r\n\r\nWOQLTableConfig.prototype.create = function(client){\r\n\tvar wqt = new WOQLTable(client, this);\r\n\treturn wqt;\r\n}\r\n\r\nWOQLTableConfig.prototype.json = function(){\r\n\tlet jr = [];\r\n\tfor(var i = 0; i<this.rules.length; i++){\r\n\t\tjr.push(this.rules[i].json());\r\n\t}\r\n\tvar conf = {};\r\n\tif(typeof this.column_order() != \"undefined\"){\r\n\t\tconf['column_order'] = this.column_order();\r\n\t}\r\n\tif(typeof this.pagesize() != \"undefined\"){\r\n\t\tconf['pagesize'] = this.pagesize();\r\n\t}\r\n\tif(typeof this.renderer() != \"undefined\"){\r\n\t\tconf['renderer'] = this.renderer();\r\n\t}\r\n\tif(typeof this.pager() != \"undefined\"){\r\n\t\tconf['pager'] = this.pager();\r\n\t}\r\n\tif(typeof this.page() != \"undefined\"){\r\n\t\tconf['page'] = this.page();\r\n\t}\r\n\tif(typeof this.changesize() != \"undefined\"){\r\n\t\tconf['changesize'] = this.changesize();\r\n\t}\r\n\tlet mj = {\"table\" :conf, \"rules\": jr};\r\n\treturn mj;\r\n}\r\n\r\nWOQLTableConfig.prototype.loadJSON = function(config, rules){\r\n\tvar jr = [];\r\n\tfor(var i = 0; i<rules.length; i++){\r\n\t\tvar nr = new WOQLTableRule();\r\n\t\tnr.json(rules[i]);\r\n\t\tjr.push(nr);\r\n\t}\r\n\tthis.rules = jr;\r\n\tif(typeof config.column_order != \"undefined\"){\r\n\t\tthis.column_order(...config.column_order);\r\n\t}\r\n\tif(typeof config.pagesize != \"undefined\"){\r\n\t\tthis.pagesize(config.pagesize);\r\n\t}\r\n\tif(typeof config.renderer != \"undefined\"){\r\n\t\tthis.renderer(config.renderer);\r\n\t}\r\n\tif(typeof config.pager != \"undefined\"){\r\n\t\tthis.pager(config.pager);\r\n\t}\r\n\tif(typeof config.page != \"undefined\"){\r\n\t\tthis.page(config.page);\r\n\t}\r\n\tif(typeof config.changesize != \"undefined\"){\r\n\t\tthis.changesize(config.changesize);\r\n    }\r\n    return this;\r\n}\r\n\r\nWOQLTableConfig.prototype.prettyPrint = function(){\r\n\tvar str = \"view = View.table();\\n\";\r\n\tif(typeof this.column_order() != \"undefined\"){\r\n\t\tstr += \"view.column_order('\" + this.column_order() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.pagesize() != \"undefined\"){\r\n\t\tstr += \"view.pagesize(\" + this.pagesize() + \")\\n\";\r\n\t}\r\n\tif(typeof this.renderer() != \"undefined\"){\r\n\t\tstr += \"view.renderer('\" + this.renderer() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.pager() != \"undefined\"){\r\n\t\tstr += \"view.pager(\" + this.pager() + \")\\n\";\r\n\t}\r\n\tif(typeof this.page() != \"undefined\"){\r\n\t\tstr += \"view.page(\" + this.page() + \")\\n\";\r\n\t}\r\n    if(typeof this.changesize() != \"undefined\"){\r\n        str += \"view.changesize(\" + this.changesize() + \")\\n\";\r\n    }\r\n    \r\n    for(var i = 0; i<this.rules.length ; i++){\r\n\t\tlet x = this.rules[i].prettyPrint();\r\n\t\tif(x) str += \"view.\" + x + \"\\n\";\t\t\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nWOQLTableConfig.prototype.renderer = function(rend){\r\n\tif(!rend) return this.trenderer;\r\n\tthis.trenderer = rend;\r\n\treturn this;\r\n}\r\n\r\nWOQLTableConfig.prototype.column_order = function(...val){\r\n\tif(typeof val == \"undefined\" || val.length == 0){\r\n\t\treturn this.order;\r\n\t}\r\n\tthis.order = UTILS.addNamespacesToVariables(val);\r\n\treturn this;\r\n}\r\n\r\nWOQLTableConfig.prototype.pager = function(val){\r\n\tif(typeof val == \"undefined\"){\r\n\t\treturn this.show_pager;\r\n\t}\r\n\tthis.show_pager = val;\r\n\treturn this;\r\n}\r\n\r\nWOQLTableConfig.prototype.changesize = function(val){\r\n    if(typeof val == \"undefined\") return this.change_pagesize;\r\n    this.change_pagesize = val;\r\n    return this;\r\n}\r\n\r\n\r\nWOQLTableConfig.prototype.pagesize = function(val){\r\n\tif(typeof val == \"undefined\"){\r\n\t\treturn this.show_pagesize;\r\n\t}\r\n\tthis.show_pagesize = val;\r\n\treturn this;\r\n}\r\n\r\nWOQLTableConfig.prototype.page = function(val){\r\n\tif(typeof val == \"undefined\"){\r\n\t\treturn this.show_pagenumber;\r\n\t}\r\n\tthis.show_pagenumber = val;\r\n\treturn this;\r\n}\r\n\r\nWOQLTableConfig.prototype.column = function(...cols){\r\n\tlet nr = new WOQLTableRule().scope(\"column\");\r\n\tnr.setVariables(cols);\r\n\tthis.rules.push(nr);\r\n\treturn nr;\r\n}\r\n\r\nWOQLTableConfig.prototype.row = function(){\r\n\tlet nr = new WOQLTableRule().scope(\"row\");\r\n\tthis.rules.push(nr);\r\n\treturn nr;\r\n}\r\n\r\n/*\r\n * Table\r\n */\r\n\r\n \r\nfunction WOQLTableRule(){\r\n\tConfig.WOQLViewRule.call(this); \r\n};\r\n\r\nWOQLTableRule.prototype = Object.create(Config.WOQLViewRule.prototype);\r\nWOQLTableRule.prototype.constructor = Config.WOQLViewRule;\r\n\r\nWOQLTableRule.prototype.header = function(hdr){\r\n\tif(typeof hdr == \"undefined\"){\r\n\t\treturn this.rule.header;\r\n\t}\r\n\tthis.rule.header = hdr;\r\n\treturn this;\r\n}\r\n\r\nWOQLTableRule.prototype.prettyPrint = function(type){\r\n\tvar str = Config.WOQLViewRule.prototype.prettyPrint.apply(this);\r\n    if(typeof this.header() != \"undefined\"){\r\n\t    str += \".header(\" + this.header() + \")\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nmodule.exports = WOQLTableConfig;","const WOQLTableConfig = require(\"./tableConfig\");\r\nconst UTILS = require('../utils');\r\nconst WOQLRule = require('../woqlRule');\r\nconst WOQLResult = require('../woqlResult');\r\n\r\nfunction WOQLTable(client, config){\r\n\tthis.client = client;\r\n\tthis.config = (config ? config : new WOQLTableConfig());\r\n\treturn this;\r\n}\r\n\r\nWOQLTable.prototype.options = function(config){\r\n\tthis.config = config;\r\n\treturn this;\r\n}\r\n\r\nWOQLTable.prototype.setResult = function(res){\r\n\tthis.result = res;\r\n\treturn this;\r\n}\r\n\r\nWOQLTable.prototype.count = function(){\r\n\treturn this.result.count();\r\n}\r\n\r\nWOQLTable.prototype.first = function(){\r\n\treturn this.result.first();\r\n}\r\n\r\nWOQLTable.prototype.prev = function(){\r\n\treturn this.result.prev();\r\n}\r\n\r\nWOQLTable.prototype.next = function(){\r\n\treturn this.result.next();\r\n}\r\n\r\nWOQLTable.prototype.canAdvancePage = function(){\r\n\treturn (this.result.count() == this.result.query.getLimit()); \r\n}\r\n\r\nWOQLTable.prototype.canChangePage = function(){\r\n\treturn this.canAdvancePage() || this.canRetreatPage();\r\n}\r\n\r\nWOQLTable.prototype.canRetreatPage = function(){\r\n\treturn (this.result.query.getPage() > 1);\r\n}\r\n\r\nWOQLTable.prototype.getPageSize = function(){\r\n\treturn this.result.query.getLimit() ;\t\r\n}\r\n\r\nWOQLTable.prototype.setPage = function(l){\r\n\treturn this.result.query.setPage(l);\t\r\n}\r\n\r\nWOQLTable.prototype.getPage = function(){\r\n\treturn this.result.query.getPage();\t\r\n}\r\n\r\nWOQLTable.prototype.setPageSize = function(l){\r\n\treturn this.update(this.result.query.setPageSize(l));\r\n}\r\n\r\nWOQLTable.prototype.nextPage = function(){\r\n\treturn this.update(this.result.query.nextPage());\r\n}\r\n\r\nWOQLTable.prototype.firstPage = function(){\r\n\treturn this.update(this.result.query.firstPage());\r\n}\r\n\r\nWOQLTable.prototype.previousPage = function(){\r\n\treturn this.update(this.result.query.previousPage());\r\n}\r\n\r\nWOQLTable.prototype.getColumnsToRender = function(){\r\n\tif(this.hasColumnOrder()){\r\n\t\tvar cols = this.getColumnOrder();\r\n\t}\r\n\telse if(this.result.query.hasSelect()){\r\n\t\tvar cols = this.result.query.getSelectVariables();\r\n\t}\r\n\telse {\r\n\t\tvar cols = this.result.getVariableList();\r\n\t}\r\n\tvar self = this;\r\n\treturn (cols ? cols.filter(col => !self.hidden(col)) : []);\r\n}\r\n\r\nWOQLTable.prototype.getColumnHeaderContents = function(colid){\r\n\tcolid = UTILS.addNamespaceToVariable(colid);\r\n\tlet hr = new WOQLRule().matchColumn(this.config.rules, colid, \"header\");\r\n\tif(hr && hr.length){\r\n\t\tlet h = hr[hr.length-1].rule.header;\r\n\t\tif(typeof h == \"string\"){\r\n\t\t\treturn document.createTextNode(h);\t\t\t\r\n\t\t}\r\n\t\telse if(typeof h == \"function\"){\r\n\t\t\treturn h(colid);\r\n\t\t}\r\n\t\telse return h;\r\n\t}\r\n\tvar clab = UTILS.labelFromURL(colid);\r\n\treturn document.createTextNode(clab);\r\n}\r\n\r\n\r\nWOQLTable.prototype.hidden = function(col){\r\n\tcolid = UTILS.addNamespaceToVariable(col);\r\n\tlet matched_rules = new WOQLRule().matchColumn(this.config.rules, colid, \"hidden\");\r\n\tif(matched_rules.length){\r\n\t\treturn matched_rules[matched_rules.length-1].rule.hidden;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n/**\r\n * Called when you want to change the query associated with the table. \r\n */\r\nWOQLTable.prototype.update = function(nquery){\r\n\treturn nquery.execute(this.client).then((results) => {\r\n\t\tvar nresult = new WOQLResult(results, nquery);\r\n\t\tthis.setResult(nresult);\r\n\t\tif(this.notify) this.notify(nresult);\r\n\t\treturn nresult;\r\n\t});\t\r\n}\r\n\r\nWOQLTable.prototype.hasDefinedEvent = function(row, key, scope, action, rownum){\r\n\tif(scope == \"row\"){\r\n\t\tvar matched_rules = new WOQLRule().matchRow(this.config.rules, row, this.result.cursor, action);\t\r\n\t}\r\n\telse {\r\n\t\tvar matched_rules = new WOQLRule().matchCell(this.config.rules, row, key, this.result.cursor, action);\t\r\n\t}\r\n\tif(matched_rules && matched_rules.length) return true;\r\n\treturn false;\r\n}\r\n\r\nWOQLTable.prototype.getDefinedEvent = function(row, key, scope, action, rownum){\r\n\tif(scope == \"row\"){\r\n\t\tvar matched_rules = new WOQLRule().matchRow(this.config.rules, row, this.result.cursor, action);\t\r\n\t}\r\n\telse {\r\n\t\tvar matched_rules = new WOQLRule().matchCell(this.config.rules, row, key, this.result.cursor, action);\t\r\n\t}\r\n\tif(matched_rules && matched_rules.length) {\r\n\t\tvar l = (matched_rules.length - 1);\r\n\t\treturn matched_rules[l].rule[action];\r\n\t}\r\n}\r\n\r\nWOQLTable.prototype.getRowClick = function(row){\r\n\tlet re = this.getDefinedEvent(row, false, \"row\", \"click\");\r\n\treturn re;\r\n}\r\n\r\nWOQLTable.prototype.getCellClick = function(row, col){\r\n\tlet cc = this.getDefinedEvent(row, col, \"column\", \"click\");\r\n\treturn cc;\r\n}\r\n\r\nWOQLTable.prototype.getRowHover = function(row){\r\n\treturn this.getDefinedEvent(row, false, \"row\", \"hover\");\r\n}\r\n\r\nWOQLTable.prototype.getCellHover = function(row, key){\r\n\treturn this.getDefinedEvent(row, key, \"column\", \"hover\");\r\n}\r\n\r\nWOQLTable.prototype.getColumnOrder = function(){\r\n\treturn this.config.column_order();\r\n}\r\n\r\nWOQLTable.prototype.hasColumnOrder = WOQLTable.prototype.getColumnOrder;\r\nWOQLTable.prototype.hasCellClick = WOQLTable.prototype.getCellClick;\r\nWOQLTable.prototype.hasRowClick = WOQLTable.prototype.getRowClick;\r\nWOQLTable.prototype.hasCellHover = WOQLTable.prototype.getCellHover;\r\nWOQLTable.prototype.hasRowHover = WOQLTable.prototype.getRowHover;\r\n\r\nWOQLTable.prototype.getRenderer = function(key, row, rownum){\r\n\tvar rend = this.getSpecificRender(key, row);\r\n\tif(rend) return rend;\r\n\tlet renderer = this.getDefinedEvent(row, key, \"column\", \"renderer\", rownum);\r\n\tlet args =  this.getDefinedEvent(row, key, \"column\", \"args\", rownum);\r\n\tif(!renderer){\r\n\t\tlet r = this.getRendererForDatatype(row[key]);\r\n\t\trenderer = r.name;\r\n\t\tif(!args) args = r.args;\r\n\t}\r\n\tif(renderer){\r\n\t\treturn this.datatypes.createRenderer(renderer, args);\t\t\r\n\t}\r\n}\r\n\r\nWOQLTable.prototype.renderValue = function(renderer, val, key, row){\r\n\tif(val && val['@type']){\r\n\t\trenderer.type = val['@type'];\r\n\t\tvar dv = new DataValue(val['@value'], val['@type'], key, row);\r\n\t}\t\r\n\telse if(val && val['@language']){\r\n\t\trenderer.type = \"xsd:string\";\r\n\t\tvar dv = new DataValue(val['@value'], renderer.type, key, row);\r\n\t}\r\n\telse if(val && typeof val == \"string\"){\r\n\t\trenderer.type = \"id\";\r\n\t\tvar dv = new DataValue(val, \"id\", key, row);\r\n\t}\r\n\tif(dv) return renderer.renderValue(dv);\r\n\treturn \"\";\r\n}\r\n\r\nfunction DataValue(val, type){\r\n\tthis.datavalue = (val == \"unknown\" ? \"\" : val);\r\n\tthis.datatype = type;\r\n}\r\n\r\nDataValue.prototype.value = function(nvalue){\r\n\tif(nvalue) {\r\n\t\tthis.datavalue = nvalue; \r\n\t\treturn this;\r\n\t}\r\n\treturn this.datavalue;\r\n}\r\n\r\n\r\nWOQLTable.prototype.getRendererForDatatype = function(val){\r\n\tif(val && val['@type']){\r\n\t\treturn this.datatypes.getRenderer(val['@type'], val['@value']);\r\n\t}\r\n\telse if(val && val['@language']){\r\n\t\treturn this.datatypes.getRenderer(\"xsd:string\", val['@value']);\r\n\t}\r\n\telse if(val && typeof val == \"string\"){\r\n\t\treturn this.datatypes.getRenderer(\"id\", val);\t\t\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nWOQLTable.prototype.getSpecificRender = function(key, row){\r\n\tlet rend = this.getDefinedEvent(row, key, \"column\", \"render\");\r\n\treturn rend;\r\n}\r\n\r\nmodule.exports = WOQLTable;","const Config  = require('./viewConfig.js');\r\nconst WOQLChooser  = require('./woqlChooser.js');\r\nconst UTILS = require('../utils');\r\n\r\nfunction WOQLChooserConfig(){\r\n    Config.ViewConfig.call(this); \r\n    this.type = \"chooser\";\r\n}\r\n\r\nWOQLChooserConfig.prototype = Object.create(Config.ViewConfig.prototype);\r\nWOQLChooserConfig.prototype.constructor = Config.ViewConfig;\r\n\r\nWOQLChooserConfig.prototype.create = function(client){\r\n\tvar wqt = new WOQLChooser(client, this);\r\n\treturn wqt;\r\n}\r\n\r\nWOQLChooserConfig.prototype.prettyPrint = function(){\r\n    var str = \"view = View.chooser();\\n\";\r\n    str += this.getBasicPrettyPrint();\r\n\tif(typeof this.change() != \"undefined\"){\r\n\t\tstr += \"view.change(\" + this.change() + \")\\n\";\r\n\t}\r\n\tif(typeof this.show_empty() != \"undefined\"){\r\n\t\tstr += \"view.show_empty('\" + this.show_empty() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.values() != \"undefined\"){\r\n\t\tstr += \"view.values('\" + UTILS.removeNamespaceFromVariable(this.values()) + \"')\\n\";\r\n\t}\r\n\tif(typeof this.labels() != \"undefined\"){\r\n\t\tstr += \"view.labels('\" + UTILS.removeNamespaceFromVariable(this.labels()) + \"')\\n\";\r\n\t}\r\n\tif(typeof this.titles() != \"undefined\"){\r\n\t\tstr += \"view.titles('\" + UTILS.removeNamespaceFromVariable(this.titles()) + \"')\\n\";\r\n\t}\r\n\tif(typeof this.sort() != \"undefined\"){\r\n\t\tstr += \"view.sort(\" + this.sort() + \")\\n\";\r\n\t}\r\n\tif(typeof this.direction() != \"undefined\"){\r\n\t\tstr += \"view.direction('\" + this.direction() + \"')\\n\";\r\n\t}\r\n\tfor(var i = 0; i<this.rules.length ; i++){\r\n\t\tstr += \"view.\" + this.rules[i].prettyPrint(\"chooser\") + \"\\n\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nWOQLChooserConfig.prototype.json = function(){\r\n\tvar conf = this.getBasicJSON();\r\n\tif(typeof this.change() != \"undefined\"){\r\n\t\tconf['change'] = this.change();\r\n\t}\r\n\tif(typeof this.show_empty() != \"undefined\"){\r\n\t\tconf['show_empty'] = this.show_empty();\r\n\t}\r\n\tif(typeof this.values() != \"undefined\"){\r\n\t\tconf['values'] = this.values();\r\n\t}\r\n\tif(typeof this.labels() != \"undefined\"){\r\n\t\tconf['labels'] = this.labels();\r\n\t}\r\n\tif(typeof this.titles() != \"undefined\"){\r\n\t\tconf['titles'] = this.titles();\r\n\t}\r\n\tif(typeof this.sort() != \"undefined\"){\r\n\t\tconf['sort'] = this.sort();\r\n\t}\r\n\tif(typeof this.direction() != \"undefined\"){\r\n\t\tconf['direction'] = this.direction();\r\n\t}\r\n\tlet mj = {\"chooser\" :conf, \"rules\": this.getRulesJSON()};\r\n\treturn mj;\r\n}\r\n\r\nWOQLChooserConfig.prototype.loadJSON = function(config, rules){\r\n\tvar jr = [];\r\n\tfor(var i = 0; i<rules.length; i++){\r\n\t\tvar nr = new WOQLChooserRule();\r\n\t\tnr.json(rules[i]);\r\n\t\tjr.push(nr);\r\n\t}\r\n    this.rules = jr;\r\n    this.loadBasicJSON(config);\r\n\tif(typeof config.change != \"undefined\"){\r\n\t\tthis.change(config.change);\r\n\t}\r\n\tif(typeof config.show_empty != \"undefined\"){\r\n\t\tthis.show_empty(config.show_empty);\r\n\t}\r\n\tif(typeof config.values != \"undefined\"){\r\n\t\tthis.values(config.values);\r\n\t}\r\n\tif(typeof config.labels != \"undefined\"){\r\n\t\tthis.labels(config.labels);\r\n\t}\r\n\tif(typeof config.titles != \"undefined\"){\r\n\t\tthis.titles(config.titles);\r\n\t}\r\n\tif(typeof config.sort != \"undefined\"){\r\n\t\tthis.sort(config.sort);\r\n\t}\r\n\tif(typeof config.direction != \"undefined\"){\r\n\t\tthis.direction(config.direction);\r\n\t}\r\n}\r\n\r\nWOQLChooserConfig.prototype.change = function(v){\r\n\tif(typeof v != \"undefined\"){\r\n\t\tthis.onChange = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.onChange;\r\n}\r\n\r\nWOQLChooserConfig.prototype.show_empty = function(p){\r\n\tif(typeof p != \"undefined\"){\r\n\t\tthis.placeholder = p;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.placeholder;\r\n}\r\n\r\nWOQLChooserConfig.prototype.rule = function(v){\r\n\tlet nr = new WOQLChooserRule().scope(\"row\");\r\n    this.rules.push(nr);\r\n    if(v) nr.vars(v);\r\n    //if(v) nr.v(v);\r\n    return nr;\r\n}\r\n\r\nWOQLChooserConfig.prototype.values = function(v){\r\n\tif(typeof v != \"undefined\"){\r\n\t\tif(v.substring(0, 2) != \"v:\") v = \"v:\" + v;\r\n\t\tthis.value_variable = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.value_variable;\r\n}\r\n\r\nWOQLChooserConfig.prototype.labels = function(v){\r\n\tif(v){\r\n\t\tif(v.substring(0, 2) != \"v:\") v = \"v:\" + v;\r\n\t\tthis.label_variable = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.label_variable;\r\n}\r\n\r\nWOQLChooserConfig.prototype.titles = function(v){\r\n\tif(v){\r\n\t\tif(v.substring(0, 2) != \"v:\") v = \"v:\" + v;\r\n\t\tthis.title_variable = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.title_variable;\r\n}\r\n\r\nWOQLChooserConfig.prototype.sort = function(v){\r\n\tif(v){\r\n\t\tif(v.substring(0, 2) != \"v:\") v = \"v:\" + v;\r\n\t\tthis.sort_variable = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.sort_variable;\r\n}\r\n\r\nWOQLChooserConfig.prototype.direction = function(v){\r\n\tif(v){\r\n\t\tthis.sort_direction = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.sort_direction;\r\n}\r\n\r\n\r\nfunction WOQLChooserRule(scope){\r\n\tConfig.WOQLViewRule.call(this,scope); \r\n};\r\n\r\nWOQLChooserRule.prototype = Object.create(Config.WOQLViewRule.prototype);\r\nWOQLChooserRule.prototype.constructor = Config.WOQLViewRule;\r\n\r\nWOQLChooserRule.prototype.label = function(l){\r\n\tif(l){\r\n\t\tthis.rule.label = l;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.label;\r\n}\r\n\r\nWOQLChooserRule.prototype.title = function(l){\r\n\tif(l){\r\n\t\tthis.rule.title = l;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.title;\r\n}\r\n\r\nWOQLChooserRule.prototype.values = function(l){\r\n\tif(l){\r\n\t\tthis.rule.values = l;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.values;\r\n}\r\n\r\nWOQLChooserRule.prototype.selected = function(s){\r\n\tif(typeof s != \"undefined\"){\r\n\t\tthis.rule.selected = s;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.selected;\r\n}\r\n\r\nWOQLChooserRule.prototype.prettyPrint = function(type){\r\n\tvar str = WOQLViewRule.prototype.prettyPrint.apply(this);\r\n    if(typeof this.selected() != \"undefined\"){\r\n\t    str += \".selected(\" + this.selected() + \")\";\r\n    }\r\n    if(typeof this.label() != \"undefined\"){\r\n\t    str += \".label(\\\"\" + this.label() + \"\\\")\";\r\n    }\r\n    if(typeof this.title() != \"undefined\"){\r\n\t    str += \".title(\\\"\" + this.title() + \"\\\")\";\r\n    }\r\n    if(typeof this.values() != \"undefined\"){\r\n\t    str += \".values(\\\"\" + this.values() + \"\\\")\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nmodule.exports = WOQLChooserConfig;","const WOQLChooserConfig = require(\"./chooserConfig\");\r\nconst UTILS = require('../utils');\r\nconst WOQLRule = require('../woqlRule');\r\n\r\n/*\r\n * Very simple implementation of a WOQL backed chooser\r\n * Makes a drop down from a WOQL query - configuration tells it which columns to use...\r\n */\r\nfunction WOQLChooser(client, config){\r\n\tthis.client = client;\r\n\tthis.config = (config ? config : new WOQLChooserConfig());\r\n\tthis.selected = false;\r\n\tthis.cursor = 0;\r\n\treturn this;\r\n}\r\n\r\nWOQLChooser.prototype.options = function(config){\r\n\tthis.config = config;\r\n\treturn this;\r\n}\r\n\r\nWOQLChooser.prototype.set = function(id){\r\n\tif(this.selected != id){\r\n\t\tthis.selected = id;\r\n\t\tlet ch = this.config.change;\r\n\t\tif(ch) ch(id);\r\n\t}\r\n}\r\n\r\n/*\r\n * Sets up the required variables from the result / config\r\n */\r\nWOQLChooser.prototype.setResult = function(result){\r\n\tthis.result = result;\r\n\tthis.choices = [];\r\n\tlet rows = 0;\r\n\tconst variables = result.getVariableList();\r\n\tif(!this.config.values() && variables.length){\r\n\t\tthis.config.values(variables[0]);\r\n\t}\r\n\t//sort it \r\n\tif(this.config.sort()){\r\n\t\tthis.result.sort(this.config.sort(), this.config.direction());\r\n\t}\r\n\twhile(row = this.result.next()){\r\n\t\tif(row && this.includeRow(row, this.result.cursor)){\r\n\t\t\tthis.choices.push(this.rowToChoice(row, rows++));\r\n\t\t}\t\t\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nWOQLChooser.prototype.includeRow = function(row, index){\r\n\tconst matched_rules = new WOQLRule().matchRow(this.config.rules, row, index, \"hidden\");\r\n\tfor(var i = 0; i<matched_rules.length; i++){\r\n\t\tif(matched_rules[i].rule.hidden) return false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nWOQLChooser.prototype.rowToChoice = function(row, rownum){\r\n\tvar choice = { \r\n\t\tid: this.getRowID(row) \r\n\t};\r\n\tchoice.label = this.getLabelFromBinding(row, rownum);\r\n\tchoice.title = this.getTitleFromBinding(row, rownum);\r\n\tchoice.selected = this.getSelectedFromBinding(row, rownum);\r\n\treturn choice;\r\n}\r\n\r\nWOQLChooser.prototype.getRowID = function(row){\r\n\tvar rval = row[this.config.values()];\r\n\tif(rval['@value']) return rval['@value'];\r\n\treturn rval;\r\n}\r\n\r\nWOQLChooser.prototype.getLabelFromBinding = function(row, rownum){\r\n\tlet sp = this.getSpecialRenderer(row, rownum, \"label\");\r\n\tif(sp) return this.renderSpecial(sp, row, rownum);\r\n\tif(this.config.labels()){\r\n\t\tif(row[this.config.labels()]){\r\n\t\t\tvar lab = row[this.config.labels()];\r\n\t\t\tif(lab[\"@value\"]) lab = lab[\"@value\"];\r\n\t\t\tif(lab != \"unknown\") return lab;\r\n\t\t}\r\n\t}\r\n\treturn UTILS.labelFromURL(this.getRowID(row));\r\n}\r\n\r\nWOQLChooser.prototype.getTitleFromBinding = function(row, rownum){\r\n\tlet sp = this.getSpecialRenderer(row, rownum, \"title\");\r\n\tif(sp) return this.renderSpecial(sp, row, rownum);\r\n\tif(this.config.titles()){\r\n\t\tif(row[this.config.titles()]){\r\n\t\t\tvar lab = row[this.config.titles()];\r\n\t\t\tif(lab[\"@value\"]) lab = lab[\"@value\"];\r\n\t\t\tif(lab != \"unknown\") return lab;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nWOQLChooser.prototype.getSelectedFromBinding = function(row, rownum){\r\n\tconst matched_rules =  new WOQLRule().matchRow(this.config.rules, row, rownum, \"selected\");\r\n\tif(matched_rules && matched_rules.length){\r\n\t\treturn matched_rules[matched_rules.length - 1].rule.selected;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nWOQLChooser.prototype.render = function(){\r\n\tif(this.renderer) return this.renderer.render(this);\r\n}\r\n\r\nWOQLChooser.prototype.setRenderer = function(rend){\r\n\tthis.renderer = rend;\r\n\treturn this;\r\n}\r\n\r\nWOQLChooser.prototype.getSpecialRenderer = function(row, index, type){\r\n\tconst matched_rules =  new WOQLRule().matchRow(this.config.rules, row, index, type);\r\n\tfor(var i = 0; i<matched_rules.length; i++){\r\n\t\tif(matched_rules[i].rule[type]) return matched_rules[i].rule[type];\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nWOQLChooser.prototype.renderSpecial = function(rule, row, rownum){\r\n\tif(rule && typeof rule == \"function\"){\r\n\t\treturn rule(row);\r\n\t}\r\n\tif(rule && typeof rule == \"string\"){\r\n\t\treturn rule;\r\n\t}\r\n}\r\n\r\nWOQLChooser.prototype.count = function(){\r\n\treturn this.result.count();\r\n}\r\n\r\nWOQLChooser.prototype.first = function(){\r\n\tthis.cursor = 0;\r\n\treturn this.choices[this.cursor];\r\n}\r\n\r\nWOQLChooser.prototype.next = function () {\r\n\tconst res = this.choices[this.cursor];\r\n\tthis.cursor++;\r\n\treturn res;\r\n};\r\n\r\nWOQLChooser.prototype.prev = function () {\r\n\tif (this.cursor > 0) {\r\n\t\tthis.cursor--;\r\n\t\treturn this.choices[this.cursor];\r\n\t}\r\n};\r\n\r\nmodule.exports = WOQLChooser;","const Config  = require('./viewConfig.js');\r\nconst WOQLGraph  = require('./woqlGraph.js');\r\nconst UTILS  = require('../utils.js');\r\n\r\nfunction WOQLGraphConfig(){\r\n    Config.ViewConfig.call(this); \r\n    this.type = \"graph\";\r\n}\r\n\r\nWOQLGraphConfig.prototype = Object.create(Config.ViewConfig.prototype);\r\nWOQLGraphConfig.prototype.constructor = Config.ViewConfig;\r\n\r\nWOQLGraphConfig.prototype.create = function(client){\r\n\tvar wqt = new WOQLGraph(client, this);\r\n\treturn wqt;\r\n}\r\n\r\nWOQLGraphConfig.prototype.literals = function(v){\r\n\tif(typeof v != \"undefined\"){\r\n\t\tthis.show_literals = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.show_literals;\r\n}\r\n\r\nWOQLGraphConfig.prototype.source = function(v){\r\n\tif(v){\r\n\t\tif(v.substring(0, 2) != \"v:\") v = \"v:\" + v;\r\n\t\tthis.source_variable = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.source_variable;\r\n}\r\n\r\nWOQLGraphConfig.prototype.fontfamily = function(v){\r\n\tif(typeof v != \"undefined\"){\r\n\t\tthis.fontfam = v;\r\n\t\treturn this;\r\n\t}\r\n\t//return 'Font Awesome 5 Free';\r\n\treturn this.fontfam;\r\n}\r\n\r\nWOQLGraphConfig.prototype.show_force = function(v){\r\n\tif(typeof v != \"undefined\"){\r\n\t\tthis.force = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.force;\r\n}\r\n\r\nWOQLGraphConfig.prototype.fix_nodes = function(v){\r\n\tif(typeof v != \"undefined\"){\r\n\t\tthis.fixed = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.fixed;\r\n}\r\n\r\nWOQLGraphConfig.prototype.explode_out = function(v){\r\n\tif(typeof v != \"undefined\"){\r\n\t\tthis.explode = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.explode;\r\n}\r\n\r\nWOQLGraphConfig.prototype.selected_grows = function(v){\r\n\tif(typeof v != \"undefined\"){\r\n\t\tthis.bigsel = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.bigsel;\r\n}\r\n\r\nWOQLGraphConfig.prototype.width = function(v){\r\n\tif(typeof v != \"undefined\"){\r\n\t\tthis.gwidth = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.gwidth;\r\n}\r\n\r\nWOQLGraphConfig.prototype.height = function(v){\r\n\tif(typeof v != \"undefined\"){\r\n\t\tthis.gheight = v;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.gheight;\r\n}\r\n\r\nWOQLGraphConfig.prototype.edges = function(...edges){\r\n\tif(edges && edges.length){\r\n\t\tvar nedges = [];\r\n\t\tfor(var i = 0; i<edges.length; i++){\r\n\t\t\tnedges.push(UTILS.addNamespacesToVariables(edges[i]));\r\n\t\t}\r\n\t\tthis.show_edges = nedges;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.show_edges;\r\n}\r\n\r\nWOQLGraphConfig.prototype.edge = function(source, target){\r\n\tlet nr = new WOQLGraphRule().edge(source, target);\r\n\tthis.rules.push(nr);\r\n\treturn nr;\r\n}\r\n\r\nWOQLGraphConfig.prototype.node = function(...cols){\r\n\tlet nr = new WOQLGraphRule();\r\n\tif(cols && cols.length){\r\n\t\tnr.scope(\"node\").setVariables(cols);\r\n\t}\r\n\telse {\r\n\t\tnr.scope(\"row\");\r\n\t}\r\n\tthis.rules.push(nr);\r\n\treturn nr;\r\n}\r\n\r\nWOQLGraphConfig.prototype.loadJSON = function(config, rules){\r\n\tvar jr = [];\r\n\tfor(var i = 0; i<rules.length; i++){\r\n\t\tvar nr = new WOQLGraphRule();\r\n\t\tnr.json(rules[i]);\r\n\t\tjr.push(nr);\r\n\t}\r\n\tthis.rules = jr;\r\n\tif(typeof config.literals != \"undefined\"){\r\n\t\tthis.literals(config.literals);\r\n\t}\r\n\tif(typeof config.source != \"undefined\"){\r\n\t\tthis.source(config.source);\r\n\t}\r\n\tif(typeof config.fontfamily != \"undefined\"){\r\n\t\tthis.fontfamily(config.fontfamily);\r\n\t}\r\n\tif(typeof config.show_force != \"undefined\"){\r\n\t\tthis.show_force(config.show_force);\r\n\t}\r\n\tif(typeof config.fix_nodes != \"undefined\"){\r\n\t\tthis.fix_nodes(config.fix_nodes);\r\n\t}\r\n\tif(typeof config.explode_out != \"undefined\"){\r\n\t\tthis.explode_out(config.explode_out);\r\n\t}\r\n\tif(typeof config.selected_grows != \"undefined\"){\r\n\t\tthis.selected_grows(config.selected_grows);\r\n\t}\r\n\tif(typeof config.width != \"undefined\"){\r\n\t\tthis.width(config.width);\r\n\t}\r\n\tif(typeof config.height != \"undefined\"){\r\n\t\tthis.height(config.height);\r\n\t}\r\n\tif(typeof config.edges != \"undefined\"){\r\n\t\tthis.edges(...config.edges);\r\n\t}\r\n}\r\n\r\nWOQLGraphConfig.prototype.prettyPrint = function(){\r\n\tvar str = \"view = View.graph();\\n\";\r\n\tif(typeof this.literals() != \"undefined\"){\r\n\t\tstr += \"view.literals('\" + this.literals() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.source() != \"undefined\"){\r\n\t\tstr += \"view.source('\" + UTILS.removeNamespaceFromVariable(this.source()) + \"')\\n\";\r\n\t}\r\n\tif(typeof this.fontfamily() != \"undefined\"){\r\n\t\tstr += \"view.fontfamily('\" + this.fontfamily() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.show_force() != \"undefined\"){\r\n\t\tstr += \"view.show_force('\" + this.show_force() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.fix_nodes() != \"undefined\"){\r\n\t\tstr += \"view.fix_nodes('\" + this.fix_nodes() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.explode_out() != \"undefined\"){\r\n\t\tstr += \"view.explode_out('\" + this.explode_out() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.selected_grows() != \"undefined\"){\r\n\t\tstr += \"view.selected_grows('\" + this.selected_grows() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.width() != \"undefined\"){\r\n\t\tstr += \"view.width('\" + this.width() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.height() != \"undefined\"){\r\n\t\tstr += \"view.height('\" + this.height() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.edges() != \"undefined\"){\r\n\t\tvar nedges = this.edges();\r\n\t\tvar estrs = [];\r\n\t\tfor(var i = 0; i<nedges.length; i++){\r\n\t\t\testrs.push(\"['\" + nedges[i][0] + \", \" + nedges[i][1] + \"']\");\r\n\t\t}\r\n\t\tstr += \"view.edges('\" + estrs.join(\", \") + \"')\\n\";\r\n\t}\r\n\tfor(var i = 0; i<this.rules.length ; i++){\r\n\t\tlet x = this.rules[i].prettyPrint();\r\n\t\tif(x) str += \"view.\" + x + \"\\n\";\t\t\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nWOQLGraphConfig.prototype.json = function(){\r\n\tlet jr = [];\r\n\tfor(var i = 0; i<this.rules.length; i++){\r\n\t\tjr.push(this.rules[i].json());\r\n\t}\r\n\tvar json = {};\r\n\tif(typeof this.literals() != \"undefined\"){\r\n\t\tjson['literals'] = this.literals();\r\n\t}\r\n\tif(typeof this.source() != \"undefined\"){\r\n\t\tjson['source'] = this.source();\r\n\t}\r\n\tif(typeof this.fontfamily() != \"undefined\"){\r\n\t\tjson['fontfamily'] = this.fontfamily();\r\n\t}\r\n\tif(typeof this.show_force() != \"undefined\"){\r\n\t\tjson['show_force'] = this.show_force();\r\n\t}\r\n\tif(typeof this.fix_nodes() != \"undefined\"){\r\n\t\tjson['fix_nodes'] = this.fix_nodes();\r\n\t}\r\n\tif(typeof this.explode_out() != \"undefined\"){\r\n\t\tjson['explode_out'] = this.explode_out();\r\n\t}\r\n\tif(typeof this.selected_grows() != \"undefined\"){\r\n\t\tjson['selected_grows'] = this.selected_grows();\r\n\t}\r\n\tif(typeof this.width() != \"undefined\"){\r\n\t\tjson['width'] = this.width();\r\n\t}\r\n\tif(typeof this.height() != \"undefined\"){\r\n\t\tjson['height'] = this.height();\r\n\t}\r\n\tif(typeof this.edges() != \"undefined\"){\r\n\t\tjson['edges'] = this.edges();\r\n\t}\r\n\tlet mj = {\"graph\" :json, \"rules\": jr};\r\n\treturn mj;\r\n}\r\n\r\nfunction WOQLGraphRule(scope){\r\n\tConfig.WOQLViewRule.call(this,scope); \r\n};\r\n\r\nWOQLGraphRule.prototype = Object.create(Config.WOQLViewRule.prototype);\r\nWOQLGraphRule.prototype.constructor = Config.WOQLViewRule;\r\n\r\nWOQLGraphRule.prototype.charge = function(v){\r\n\tif(typeof v == \"undefined\"){\r\n\t\treturn this.rule.charge;\r\n\t}\r\n\tthis.rule.charge = v;\r\n\treturn this;\r\n}\r\n\r\nWOQLGraphRule.prototype.collisionRadius = function(v){\r\n\tif(typeof v == \"undefined\"){\r\n\t\treturn this.rule.collisionRadius;\r\n\t}\r\n\tthis.rule.collisionRadius = v;\r\n\treturn this;\r\n}\r\n\r\nWOQLGraphRule.prototype.arrow = function(json){\r\n\tif(json){\r\n\t\tthis.rule.arrow = json;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.arrow;\r\n}\r\n\r\nWOQLGraphRule.prototype.distance = function(d){\r\n\tif(typeof d != \"undefined\"){\r\n\t\tthis.rule.distance = d;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.distance;\r\n}\r\n\r\nWOQLGraphRule.prototype.symmetric = function(d){\r\n\tif(typeof d != \"undefined\"){\r\n\t\tthis.rule.symmetric = d;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.symmetric ;\r\n}\r\n\r\n\r\nWOQLGraphRule.prototype.weight = function(w){\r\n\tif(typeof w != \"undefined\"){\r\n\t\tthis.rule.weight = w;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.weight;\r\n}\r\n\r\nWOQLGraphRule.prototype.prettyPrint = function(type){\r\n\tvar str = Config.WOQLViewRule.prototype.prettyPrint.apply(this);\r\n\tif(typeof this.charge() != \"undefined\"){\r\n\t\tstr += \".charge('\" + this.charge() + \"')\";\r\n\t}\r\n\tif(typeof this.distance() != \"undefined\"){\r\n\t\tstr += \".distance('\" + this.distance() + \"')\";\r\n\t}\r\n\tif(typeof this.weight() != \"undefined\"){\r\n\t\tstr += \".weight('\" + this.weight() + \"')\";\r\n\t}\r\n\tif(typeof this.symmetric() != \"undefined\"){\r\n\t\tstr += \".symmetric(\" + this.symmetric() + \")\";\r\n\t}\r\n\tif(typeof this.collisionRadius() != \"undefined\"){\r\n\t\tstr += \".collisionRadius(\" + this.collisionRadius() + \")\";\r\n\t}\t\r\n\tif(typeof this.arrow() != \"undefined\"){\r\n\t\tstr += \".arrow(\" + JSON.stringify(this.arrow()) + \")\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nmodule.exports = WOQLGraphConfig;","const WOQLGraphConfig = require(\"./graphConfig\");\r\nconst UTILS = require('../utils');\r\nconst WOQLRule = require('../woqlRule');\r\n\r\nfunction WOQLGraph(client, config){\r\n\tthis.client = client;\r\n\tthis.config = (config ? config : new WOQLGraphConfig());\r\n\tthis.nodes = [];\r\n\tthis.edges = [];\r\n}\r\n\r\nWOQLGraph.prototype.options = function(config){\r\n\tthis.config = config;\r\n\treturn this;\r\n}\r\n\r\nWOQLGraph.prototype.setResult = function(result){\r\n\tthis.result = result;\r\n\tthis.calculateVariableTypes(result);\r\n}\r\n\r\nWOQLGraph.prototype.calculateVariableTypes = function(){\r\n\tvar bindings = this.result.getBindings();\r\n\tif(bindings && bindings.length){\r\n\t\tfor(var i = 0; i<bindings.length; i++){\r\n\t\t\tthis.extractFromBinding(bindings[i], i);\r\n\t\t}\r\n\t}\r\n\tthis.edges = this.combineEdges(this.edges);\r\n\tthis.nodes = this.combineNodes(this.nodes);\r\n}\r\n\r\nWOQLGraph.prototype.extractFromBinding = function(row, rownum){\r\n\t//\r\n\tif(this.includeRow(row, rownum)){\r\n\t\t//get all the nodes (ids - non literals) //\r\n\t\t//see which nodes are excluded ...\r\n\t\tvar nodes = [];\r\n\t\tvar lits = [];\r\n\t\tfor(var k in row){\r\n\t\t\tif(typeof row[k] == \"string\"){\r\n\t\t\t\tif(row[k] && row[k] != \"unknown\" && this.includeNode(k, row)) nodes.push(k);\r\n\t\t\t}\r\n\t\t\telse if(row[k][\"@value\"] && this.includeLiteralNode(k, row)){\r\n\t\t\t\tlits.push(k);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(nodes.length == 0) return;\r\n\t\t//first of all we need to make the literal nodes targets of \r\n\t\tfor(var i = 0; i<lits.length; i++){\r\n\t\t\t//make an edge and put the lit in as a node...\r\n\t\t\tvar nid = UTILS.genBNID().substring(2);\r\n\t\t\tlet source = this.getLiteralOwner(nodes, lits[i], row);\r\n\t\t\tif(source) {\r\n\t\t\t\tthis.addAdornedNode(nid, lits[i], row);\r\n\t\t\t\tthis.addAdornedEdge(row[source], nid, source, lits[i], row);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.createEdgesFromIDs(nodes, row);\r\n\t\tfor(var i = 0; i<nodes.length; i++){\r\n\t\t\tvar ndid = row[nodes[i]];\r\n\t\t\tthis.addAdornedNode(ndid, nodes[i], row);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nWOQLGraph.prototype.addAdornedEdge = function(source, target, ks, kt, row){\r\n\tvar edge = { type: \"link\", target: target, source: source, text: kt};\r\n\tconst matched_rules = new WOQLRule().matchEdge(this.config.rules, row, ks, kt);\r\n\tvar hid = false;\r\n\tfor(var i = 0; i<matched_rules.length; i++){\r\n\t\tvar rule = matched_rules[i].rule;\r\n\t\tif(typeof rule.hidden != \"undefined\"){\r\n\t\t\thid = rule.hidden;\r\n\t\t}\r\n\t\tif(rule.size){\r\n\t\t\tedge.radius = UTILS.getConfigValue(rule.size, row);\r\n\t\t}\r\n\t\tif(rule.text){\r\n\t\t\tedge.text = UTILS.getConfigValue(rule.text, row);\r\n\t\t}\r\n\t\tif(rule.color){\r\n\t\t\tedge.color = UTILS.getConfigValue(rule.color, row);\r\n\t\t}\r\n\t\tif(rule.distance){\r\n\t\t\tedge.distance = UTILS.getConfigValue(rule.distance, row);\r\n\t\t}\r\n\t\tif(rule.arrow){\r\n\t\t\tedge.arrow = UTILS.getConfigValue(rule.arrow, row);\r\n\t\t}\r\n\t\tif(rule.symmetric){\r\n\t\t\tedge.symmetric = UTILS.getConfigValue(rule.symmetric, row);\r\n\t\t}\r\n\t\tif(rule.weight){\r\n\t\t\tedge.weight = UTILS.getConfigValue(rule.weight, row);\r\n\t\t}\r\n\t}\r\n\tif(!hid) this.edges.push(edge);\t\r\n}\r\n\r\nWOQLGraph.prototype.addAdornedNode = function(nid, k, row){\r\n\tvar node = { type: \"node\", id: nid, nodetype: k };\r\n\tconst matched_rules = new WOQLRule().matchNode(this.config.rules, row, k, nid);\r\n\tfor(var i = 0; i<matched_rules.length; i++){\r\n\t\tvar rule = matched_rules[i].rule;\r\n\t\tif(rule.size){\r\n\t\t\tnode.radius = UTILS.getConfigValue(rule.size, row);\r\n\t\t}\r\n\t\tif(rule.color){\r\n\t\t\tnode.color = UTILS.getConfigValue(rule.color, row);\r\n\t\t}\r\n\t\tif(rule.charge){\r\n\t\t\tnode.charge = UTILS.getConfigValue(rule.charge, row);\r\n\t\t}\r\n\t\tif(rule.collisionRadius ){\r\n\t\t\tnode.collisionRadius = UTILS.getConfigValue(rule.collisionRadius, row);\r\n\t\t}\r\n\t\tif(rule.icon ){\r\n\t\t\tnode.icon = UTILS.getConfigValue(rule.icon, row);\r\n\t\t}\r\n\t\tif(rule.text){\r\n\t\t\tnode.text = UTILS.getConfigValue(rule.text, row);\r\n\t\t}\r\n\t\tif(rule.border){\r\n\t\t\tnode.border = UTILS.getConfigValue(rule.border, row);\r\n\t\t}\r\n\t}\r\n\tif(!node.text){\r\n\t\tif(typeof row[k] == \"string\") node.text = row[k];\r\n\t\telse if(row[k]['@value']) node.text = row[k]['@value'];\r\n\t}\r\n\tthis.nodes.push(node);\r\n}\r\n\r\nWOQLGraph.prototype.getLiteralOwner = function(nodes, v, row){\r\n\tvar cs = this.config.source();\r\n\tif(cs && row[cs]){\r\n\t\treturn cs;\r\n\t}\r\n\tvar edges = this.config.edges();\r\n\tif(edges){\r\n\t\tfor(var i = 0; i < edges.length; i++){\r\n\t\t\tif(edges[i][1] == v){\r\n\t\t\t\treturn edges[i][0];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\treturn nodes[0];\r\n}\r\n\r\nWOQLGraph.prototype.createEdgesFromIDs = function(nodes, row){\r\n\tif(nodes.length < 2) return;\r\n\tvar cs = this.config.source();\r\n\tlet es = this.config.edges();\r\n\tif(!cs && es && es.length){\r\n\t\tfor(var i = 0; i< es.length; i++){\r\n\t\t\tif(nodes.indexOf(es[i][0]) != -1 && nodes.indexOf(es[i][1]) != -1 ){\r\n\t\t\t\tthis.addAdornedEdge(row[es[i][0]], row[es[i][1]], es[i][0], es[i][1], row);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\tvar s = (cs && nodes.indexOf(cs) != -1) ? cs : nodes[0];\r\n\tfor(var i = 0; i<nodes.length; i++){\r\n\t\tif(nodes[i] == s) continue;\r\n\t\tthis.addAdornedEdge(row[s], row[nodes[i]], s, nodes[i], row);\r\n\t}\r\n}\r\n\r\n\r\nWOQLGraph.prototype.getEdges = function(){\r\n\treturn this.edges;\r\n}\r\n\r\nWOQLGraph.prototype.combineNodes = function(nodes){\r\n\tvar nnodes = {};\r\n\tfor(var i = 0; i<nodes.length; i++){\r\n\t\tvar n = nodes[i];\r\n\t\tif(this.nodes_referenced_by_edges.indexOf(n.id) == -1) continue;\r\n\t\tif(typeof nnodes[n.id] == \"undefined\"){\r\n\t\t\tnnodes[n.id] = n;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfor(var k in n){\r\n\t\t\t\tif(typeof nnodes[n.id][k] == \"undefined\"){\r\n\t\t\t\t\tnnodes[n.id][k] = n[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn Object.values(nnodes);\r\n}\r\n\r\n\r\nWOQLGraph.prototype.combineEdges = function(edges){\r\n\tthis.nodes_referenced_by_edges = [];\r\n\tvar nedges = {};\r\n\tfor(var i = 0; i<edges.length; i++){\r\n\t\tvar e = edges[i];\r\n\t\tif(typeof nedges[e.source] == \"undefined\"){\r\n\t\t\tnedges[e.source] = {};\r\n\t\t}\r\n\t\tif(typeof nedges[e.source][e.target] == \"undefined\"){\r\n\t\t\tnedges[e.source][e.target] = e;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfor(var k in e){\r\n\t\t\t\tif(typeof nedges[e.source][e.target][k] == \"undefined\") nedges[e.source][e.target][k] = e[k];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(this.nodes_referenced_by_edges.indexOf(e.source) == -1) this.nodes_referenced_by_edges.push(e.source);\r\n\t\tif(this.nodes_referenced_by_edges.indexOf(e.target) == -1) this.nodes_referenced_by_edges.push(e.target);\r\n\t}\r\n\tvar fedges = [];\r\n\tfor(var k in nedges){\r\n\t\tfor(var k2 in nedges[k]){\r\n\t\t\tfedges.push(nedges[k][k2]);\r\n\t\t}\r\n\t}\r\n\treturn fedges;\r\n}\r\n\r\n\r\n\r\nWOQLGraph.prototype.getNodes = function(){\r\n\treturn  this.nodes;\r\n}\r\n\r\n\r\n\r\nWOQLGraph.prototype.includeNode = function(v, row){\r\n\tconst matched_rules = new WOQLRule().matchNode(this.config.rules, row, v, false, \"hidden\");\r\n\tfor(var i = 0; i<matched_rules.length; i++){\r\n\t\tif(matched_rules[i].rule.hidden) return false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nWOQLGraph.prototype.includeLiteralNode = function(v, row){\r\n\tlet l = this.config.literals();\r\n\tif(typeof l != \"undefined\" && !l) return false;\r\n\tconst matched_rules = new WOQLRule().matchNode(this.config.rules, row, v, false, \"hidden\");\r\n\tfor(var i = 0; i<matched_rules.length; i++){\r\n\t\tif(matched_rules[i].rule.hidden) return false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\n\r\nWOQLGraph.prototype.includeRow = function(row, num){\r\n\tconst matched_rules = new WOQLRule().matchRow(this.config.rules, row, num, \"hidden\");\r\n\tfor(var i = 0; i<matched_rules.length; i++){\r\n\t\tif(matched_rules[i].rule.hidden) return false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\n\r\n\r\nmodule.exports = WOQLGraph;","\r\nconst Config  = require('./viewConfig.js');\r\nconst WOQLChart  = require('./woqlChart.js');\r\n\r\nfunction WOQLChartConfig(){\r\n    Config.ViewConfig.call(this); \r\n    this.type = \"chart\";\r\n}\r\n\r\nWOQLChartConfig.prototype = Object.create(Config.ViewConfig.prototype);\r\nWOQLChartConfig.prototype.constructor = Config.ViewConfig;\r\n\r\n\r\nWOQLChartConfig.prototype.prettyPrint = function(){\r\n    var str = \"view = View.chart();\\n\";\r\n    for(var i = 0; i<this.rules.length ; i++){\r\n\t\tstr += \"view.\" + this.rules[i].prettyPrint() + \"\\n\";\r\n\t}\r\n\tif(typeof this.margin() != \"undefined\"){\r\n\t\tstr += \"view.margin(\" + this.margin() + \")\\n\";\r\n\t}\r\n\tif(typeof this.title() != \"undefined\"){\r\n\t\tstr += \"view.title('\" + this.title() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.description() != \"undefined\"){\r\n\t\tstr += \"view.description('\" + this.description() + \"')\\n\";\r\n\t}\r\n\tif(typeof this.layout() != \"undefined\"){\r\n\t\tstr += \"view.layout('\" + this.layout() + \"')\\n\";\r\n\t}\r\n\t\r\n    str += this.getBasicPrettyPrint();\r\n\treturn str;\r\n}\r\n\r\nWOQLChartConfig.prototype.json = function(){\r\n\t/*\r\n\t*general properties \r\n\t*/\r\n\tvar conf = {};\r\n\tif(typeof this.margin() != \"undefined\"){\r\n\t\tconf['margin'] = this.margin();\r\n\t}\r\n\tif(typeof this.title() != \"undefined\"){\r\n\t\tconf['title'] = this.title();\r\n\t}\r\n\tif(typeof this.description() != \"undefined\"){\r\n\t\tconf['description'] = this.description();\r\n\t}\r\n\tif(typeof this.layout() != \"undefined\"){\r\n\t\tconf['layout'] = this.layout();\r\n\t}\r\n\r\n\tlet mj = {\"chart\" :conf, \"rules\": this.getRulesJSON()};\r\n\treturn mj;\r\n}\r\n\r\nWOQLChartConfig.prototype.loadJSON = function(config, rules){\r\n    this.loadBasicJSON(config);\r\n    var jr = [];\r\n\tfor(var i = 0; i<rules.length; i++){\r\n\t\tvar nr = new WOQLChartRule();\r\n\t\tnr.json(rules[i]);\r\n\t\tjr.push(nr);\r\n\t}\r\n\tthis.rules = jr;\r\n\tif(typeof config.margin != \"undefined\"){\r\n\t\tthis.margin(config.margin);\r\n\t}\r\n\tif(typeof config.title != \"undefined\"){\r\n\t\tthis.title(config.title);\r\n\t}\r\n\tif(typeof config.description != \"undefined\"){\r\n\t\tthis.description(config.description);\r\n\t}\r\n\tif(typeof config.layout != \"undefined\"){\r\n\t\tthis.layout(config.layout);\r\n\t}\r\n}\r\n\r\nWOQLChartConfig.prototype.title = function(title){\r\n\tif(typeof title == \"undefined\"){\r\n\t\treturn this._title;\r\n\t}\r\n\tthis._title = title;\r\n\treturn this;\r\n}\r\n\r\nWOQLChartConfig.prototype.description=function(description){\r\n\tif(description){\r\n\t\tthis._description=description;\r\n\t\treturn this\r\n\t}\r\n\treturn this._description;\r\n}\r\n\r\n//layout \"vertical\" | \"horizontal\"\r\nWOQLChartConfig.prototype.layout=function(layout){\r\n\tif(layout){\r\n\t\tthis._layout=layout;\r\n\t\treturn this\r\n\t}\r\n\treturn this._layout;\r\n}\r\n\r\n\r\n//default is { top: 10, right: 30, left: 0, bottom: 0 }\r\nWOQLChartConfig.prototype.margin=function(marginObj){\r\n\tif(marginObj){\r\n\t\tthis._margin=marginObj;\r\n\t\treturn this\r\n\t}\r\n\r\n\treturn this._margin;\r\n}\r\n\r\n\r\nWOQLChartConfig.prototype.create = function(client){\r\n\tvar wqt = new WOQLChartConfig(client, this);\r\n\treturn wqt;\r\n}\r\n\r\n/*\r\n{\"XAxis\":{dataKey:\"date_i\",type:'number'}\r\n\t\t\t\t\t\t\t,\"chartObj\":\r\n\t\t\t\t\t\t\t[{'label':'Confident','dataKey':'conf',\"chartType\":\"Area\",\r\n\t\t\t\t\t\t\t\"style\":{\"stroke\":\"#82ca9d\", \"fillOpacity\":1, \"fill\":\"#82ca9d\"}},\r\n\t\t\t\t\t\t\t {'label':'Predictions','dataKey':'predictions',\"chartType\":\"Line\",\r\n\t\t\t\t\t\t\t \"style\":{\"strokeWidth\":2, \"stroke\":\"#ff8000\"}},\r\n\t\t\t\t\t\t\t {'label':'Picks','dataKey':'picks',\"chartType\":\"Point\",\"style\": \r\n\t\t\t\t\t\t\t {\"stroke\": '#8884d8', \"fill\": '#8884d8'}},\r\n\t\t\t\t\t\t\t {'label':'Stock','dataKey':'stock',\"chartType\":\"Line\",\"style\":\r\n\t\t\t\t\t\t\t  {\"stroke\": '#0000ff', \"fill\": '#0000ff'}}]}\r\n\r\n{\"XAxis\":{dataKey:\"v:Date\",\"label\":{rotate:\"-50\"}},\"chartObj\":\r\n\t\t\t\t\t\t\t  \t[{'dot':true, 'label':'Quantity','dataKey':'v:Quantity',\"chartType\":\"Line\",  \r\n\t\t\t\t\t\t\t  \t  \"style\": {\"stroke\": '#FF9800', \"fill\": '#FF9800'}}]\r\n\t\t\t\t\t\t\t  }\r\n*/\r\n\r\n\r\nWOQLChartConfig.prototype.xAxis = function(...vars){\r\n\tlet woqlRule = new WOQLChartRule().scope(\"XAxis\");\r\n\twoqlRule.setVariables(vars);\r\n\tthis.rules.push(woqlRule);\r\n\treturn woqlRule;\r\n}\r\n\r\nWOQLChartConfig.prototype.bar = function(...vars){\r\n\tlet woqlRule=new WOQLChartRule().scope(\"Bar\");\r\n\twoqlRule.setVariables(vars);\r\n\tthis.rules.push(woqlRule);\r\n\treturn woqlRule;\r\n}\r\n\r\nWOQLChartConfig.prototype.line=function(...vars){\r\n\tlet woqlRule=new WOQLChartRule().scope(\"Line\");\r\n\twoqlRule.setVariables(vars);\r\n\tthis.rules.push(woqlRule);\r\n\treturn woqlRule;\r\n}\r\n\r\nWOQLChartConfig.prototype.point=function(...vars){\r\n\tlet woqlRule=new WOQLChartRule().scope(\"Point\");\r\n\twoqlRule.setVariables(vars);\r\n\tthis.rules.push(woqlRule);\r\n\treturn woqlRule;\r\n}\r\n\r\nWOQLChartConfig.prototype.area=function(...vars){\r\n\tlet woqlRule=new WOQLChartRule().scope(\"Area\");\r\n\twoqlRule.setVariables(vars);\r\n\tthis.rules.push(woqlRule);\r\n\treturn woqlRule;\r\n}\r\n\r\n/**\r\n * \r\n * @param {Chart} scope  \r\n */\r\nfunction WOQLChartRule(){\r\n\tConfig.WOQLViewRule.call(this); \r\n};\r\n\r\nWOQLChartRule.prototype = Object.create(Config.WOQLViewRule.prototype);\r\nWOQLChartRule.prototype.constructor = Config.WOQLViewRule;\r\n\r\nWOQLChartRule.prototype.style=function(key,value){\r\n\tif(value){\r\n\t\tthis.rule[key]=value;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule[key];\r\n}\r\n\r\nWOQLChartRule.prototype.label = function(label){\r\n\tif(label){\r\n\t\tthis.rule.label = label;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.label;\r\n}\r\n\r\n/*\r\n*line is the default value\r\n* 'line' | 'square' | 'rect'| 'circle' | 'cross' | 'diamond' | 'square' | 'star' | 'triangle' | 'wye' | 'none'\r\n*/\r\n\r\nWOQLChartRule.prototype.legendType = function(legendType){\r\n\tif(legendType){\r\n\t\tthis.rule.legendType = legendType;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.legendType;\r\n}\r\n\r\n\r\nWOQLChartRule.prototype.fill=function(color){\r\n\tif(color){\r\n\t\tthis.rule.fill = color;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.fill;\r\n}\r\n\r\nWOQLChartRule.prototype.stroke=function(color){\r\n\tif(color){\r\n\t\tthis.rule['stroke'] = color;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule['stroke'];\r\n}\r\n\r\n\r\nWOQLChartRule.prototype.strokeWidth=function(size){\r\n\tif(typeof size != \"undefined\"){\r\n\t\tthis.rule.strokeWidth = size;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.strokeWidth;\r\n}\r\n\r\n\r\nWOQLChartRule.prototype.dot=function(isVisible){\r\n\tif(typeof isVisible != \"undefined\"){\r\n\t\tthis.rule.dot = isVisible;\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.dot;\r\n}\r\n\r\nWOQLChartRule.prototype.labelRotate=function(angle){\r\n\tif(angle){\r\n\t\tthis.rule.labelRotate = angle;\r\n\t\treturn this\r\n\t}\r\n\treturn this.rule.labelRotate;\r\n}\r\n\r\n/*\r\n* The type of xAxis or yAxis 'number' | 'category' default is 'category'.\r\n* The type of line chart 'basis'|'basisClosed'|'basisOpen'|'linear'|'linearClosed'|'natural'|'monotoneX'|'monotoneY'|'monotone' | 'step' | 'stepBefore' | 'stepAfter' | \r\n*/\r\n\r\nWOQLChartRule.prototype.type=function(type){\r\n\tif(type){\r\n\t\tthis.rule.type=type\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.type\r\n}\r\n/*\r\n* works only if type is number\r\n* domainArr =[min,max];\r\n*/\r\nWOQLChartRule.prototype.axisDomain=function(domainArr){\r\n\tif(domainArr){\r\n\t\tthis.rule.domain=domainArr\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.domain\r\n}\r\n\r\n\r\nWOQLChartRule.prototype.barSize=function(barSize){\r\n\tif(barSize){\r\n\t\tthis.rule.barSize=barSize\r\n\t\treturn this;\r\n\t}\r\n\treturn this.rule.barSize\r\n}\r\n\r\nmodule.exports = WOQLChartConfig;","const WOQLChartConfig = require(\"./chartConfig\");\r\n\r\nfunction WOQLChart(client, config){\r\n\tthis.client = client;\r\n\tthis.config = (config ? config : new WOQLChartConfig());\r\n\treturn this;\r\n}\r\n\r\nWOQLChart.prototype.options = function(config){\r\n\tthis.config = config;\r\n\treturn this;\r\n}\r\n\r\nWOQLChart.prototype.setResult = function(res){\r\n\tthis.result = res;\r\n\treturn this;\r\n}","const Config  = require('./viewConfig.js');\r\nconst WOQLStream  = require('./woqlStream.js');\r\n\r\nfunction WOQLStreamConfig(){\r\n    Config.ViewConfig.call(this); \r\n    this.type = \"stream\";\r\n}\r\n\r\nWOQLStreamConfig.prototype = Object.create(Config.ViewConfig.prototype);\r\nWOQLStreamConfig.prototype.constructor = Config.ViewConfig;\r\n\r\nWOQLStreamConfig.prototype.create = function(client){\r\n\tvar wqt = new WOQLStream(client, this);\r\n\treturn wqt;\r\n}\r\n\r\nWOQLStreamConfig.prototype.row = function(){\r\n    var wqt = new WOQLStreamRule().scope(\"row\");\r\n    this.rules.push(wqt);    \r\n\treturn wqt;\r\n}\r\n\r\nWOQLStreamConfig.prototype.template = function(template){\r\n\tif(!template) return this.mtemplate; \r\n\tthis.mtemplate = template;\r\n\treturn this;\r\n}\r\n\r\n\r\nWOQLStreamConfig.prototype.prettyPrint = function(){\r\n\tvar str = \"view = View.stream();\\n\";\r\n\tif(typeof this.template() != \"undefined\"){\r\n\t\tstr += \"view.template(\" + JSON.stringify(this.template()) + \")\\n\";\r\n\t}\r\n\tfor(var i = 0; i<this.rules.length ; i++){\r\n\t\tstr += \"view.\" + this.rules[i].prettyPrint() + \"\\n\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nWOQLStreamConfig.prototype.loadJSON = function(config, rules){\r\n\tvar jr = [];\r\n\tfor(var i = 0; i<rules.length; i++){\r\n\t\tvar nr = new WOQLStreamRule();\r\n\t\tnr.json(rules[i]);\r\n\t\tjr.push(nr);\r\n\t}\r\n\tthis.rules = jr;\r\n\tif(config.template){\r\n\t\tthis.mtemplate = config.template;\r\n\t}\r\n}\r\n\r\nWOQLStreamConfig.prototype.json = function(){\r\n\tlet jr = [];\r\n\tfor(var i = 0; i<this.rules.length; i++){\r\n\t\tjr.push(this.rules[i].json());\r\n\t}\r\n\tvar conf = {};\r\n\tif(this.mtemplate){\r\n\t\tconf.template = this.mtemplate;\r\n\t}\r\n\tlet mj = {\"stream\" :conf, \"rules\": jr};\r\n\treturn mj;\r\n}\r\n\r\nfunction WOQLStreamRule(){\r\n\tConfig.WOQLViewRule.call(this); \r\n};\r\n\r\nWOQLStreamRule.prototype = Object.create(Config.WOQLViewRule.prototype);\r\nWOQLStreamRule.prototype.constructor = Config.WOQLViewRule;\r\n\r\nWOQLStreamRule.prototype.template = function(template){\r\n\tif(!template) return this.rule.template; \r\n\tthis.rule.template = template;\r\n\treturn this;\r\n}\r\n\r\nmodule.exports = WOQLStreamConfig;","const WOQLStreamConfig = require(\"./streamConfig\");\r\n\r\nfunction WOQLStream(client, config){\r\n\tthis.client = client;\r\n\tthis.config = (config ? config : new WOQLStreamConfig());\r\n\treturn this;\r\n}\r\n\r\nWOQLStream.prototype.options = function(config){\r\n\tthis.config = config;\r\n\treturn this;\r\n}\r\n\r\nWOQLStream.prototype.setResult = function(wqrs){\r\n\tthis.result = wqrs;\r\n}\r\n\r\nmodule.exports = WOQLStream;","\r\nconst Config  = require('./viewConfig.js');\r\nconst FrameRule  = require('../frameRule.js');\r\nconst DocumentFrame  = require('./documentFrame.js');\r\n\r\nfunction FrameConfig(){\r\n    Config.ViewConfig.call(this); \r\n    this.type = \"document\";\r\n}\r\n\r\nFrameConfig.prototype = Object.create(Config.ViewConfig.prototype);\r\nFrameConfig.prototype.constructor = Config.ViewConfig;\r\n\r\nFrameConfig.prototype.create = function(client){\r\n\tvar tf = new DocumentFrame(client, this);\r\n\treturn tf;\r\n}\r\n\r\nFrameConfig.prototype.prettyPrint = function(){\r\n    var str = \"view = View.document();\\n\";\r\n    str += this.getBasicPrettyPrint();\r\n\tif(typeof this.load_schema() != \"undefined\"){\r\n\t\tstr += \"view.load_schema(\" + this.load_schema() + \")\\n\";\r\n\t}\r\n\tfor(var i = 0; i<this.rules.length ; i++){\r\n\t\tstr += \"view.\" + this.rules[i].prettyPrint() + \"\\n\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nFrameConfig.prototype.json = function(){\r\n\tvar conf = this.getBasicJSON();\r\n\tif(typeof this.load_schema() != \"undefined\"){\r\n\t\tconf['load_schema'] = this.load_schema();\r\n\t}\r\n\tlet mj = {\"frame\" :conf, \"rules\": this.getRulesJSON()};\r\n\treturn mj;\r\n}\r\n\r\nFrameConfig.prototype.loadJSON = function(config, rules){\r\n\tvar jr = [];\r\n\tfor(var i = 0; i<rules.length; i++){\r\n\t\tvar nr = new DocumentRule();\r\n\t\tnr.json(rules[i]);\r\n\t\tjr.push(nr);\r\n\t}\r\n    this.rules = jr;\r\n    this.loadBasicJSON(config);\r\n\tif(typeof config.load_schema != \"undefined\"){\r\n\t\tthis.load_schema(config.load_schema);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nFrameConfig.prototype.json_rules = function(){\r\n\tlet jr = [];\r\n\tfor(var i = 0; i<this.rules.length; i++){\r\n\t\tjr.push(this.rules[i].json());\r\n\t}\r\n\treturn jr;\r\n}\r\n\r\nFrameConfig.prototype.load_schema = function(tf){\r\n\tif(typeof tf == \"undefined\") return this.get_schema;\r\n\tthis.get_schema = tf;\r\n\treturn this;\r\n}\r\n\r\nFrameConfig.prototype.show_all = function(r){\r\n\tthis.all().renderer(r);\r\n\treturn this;\r\n}\r\n\r\nFrameConfig.prototype.show_parts = function(o, p, d){\r\n\tthis.object().renderer(o);\r\n\tthis.property().renderer(p);\r\n\tthis.data().renderer(d);\r\n\treturn this;\r\n}\r\n\r\nFrameConfig.prototype.object = function(){\r\n\tlet fp = new DocumentRule().scope(\"object\");\r\n\tthis.rules.push(fp);\r\n\treturn fp;\r\n}\r\n\r\nFrameConfig.prototype.property = function(){\r\n\tlet fp = new DocumentRule().scope(\"property\");\r\n\tthis.rules.push(fp);\r\n\treturn fp;\r\n}\r\n\r\nFrameConfig.prototype.scope = function(scope){\r\n\tlet fp = new DocumentRule().scope(scope);\r\n\tthis.rules.push(fp);\r\n\treturn fp;\r\n}\r\n\r\nFrameConfig.prototype.data = function(){\r\n\tlet fp = new DocumentRule().scope(\"data\");\r\n\tthis.rules.push(fp);\r\n\treturn fp;\r\n}\r\n\r\nFrameConfig.prototype.all = function(){\r\n\tlet fp = new DocumentRule().scope(\"*\");\r\n\tthis.rules.push(fp);\r\n\treturn fp;\r\n}\r\n\r\n/**\r\n * Attaches display options to frames from matching rules\r\n */\r\nFrameConfig.prototype.setFrameDisplayOptions = function(frame, rule){\r\n\tif(typeof frame.display_options == \"undefined\") frame.display_options = {};\r\n\tif(typeof rule.mode() != \"undefined\") {\tframe.display_options.mode = rule.mode();}\r\n\tif(typeof rule.view() != \"undefined\") frame.display_options.view = rule.view();\r\n\tif(typeof rule.showDisabledButtons() != \"undefined\") frame.display_options.show_disabled_buttons = rule.showDisabledButtons();\r\n\tif(typeof rule.hidden() != \"undefined\") frame.display_options.hidden = rule.hidden();\r\n\tif(typeof rule.collapse() != \"undefined\") frame.display_options.collapse = rule.collapse();\r\n\tif(typeof rule.style() != \"undefined\") frame.display_options.style = rule.style();\r\n\tif(typeof rule.headerStyle() != \"undefined\") frame.display_options.header_style = rule.headerStyle();\r\n\tif(typeof rule.features() != \"undefined\") {\t\tframe.display_options.features = this.setFrameFeatures(frame.display_options.features, rule.features());\t}\r\n\tif(typeof rule.headerFeatures() != \"undefined\") frame.display_options.header_features = this.setFrameFeatures(frame.display_options.header_features, rule.headerFeatures());\r\n\tif(typeof rule.header() != \"undefined\") frame.display_options.header = rule.header();\r\n\tif(typeof rule.showEmpty() != \"undefined\") frame.display_options.show_empty = rule.showEmpty();\r\n\tif(typeof rule.dataviewer() != \"undefined\") frame.display_options.dataviewer = rule.dataviewer();\r\n\tif(typeof rule.args() != \"undefined\") frame.display_options.args = this.setFrameArgs(frame.display_options.args, rule.args());\r\n}\r\n\r\n/*\r\nConsolidates properties of features sent in in different rules\r\n*/\r\nFrameConfig.prototype.setFrameFeatures = function(existing, fresh){\r\n\t//preserve order of existing\r\n\tif(!existing || !existing.length) return fresh;\r\n\tif(!fresh || !fresh.length)  return existing;\r\n\tlet got = [];\r\n\tfor(var i = 0; i< existing.length; i++){\r\n\t\tvar key = (typeof existing[i] == \"string\" ? existing[i] : Object.keys(existing[i])[0]);\r\n\t\tgot.push(key);\r\n\t}\r\n\tfor(var j = 0; j< fresh.length; j++){\r\n\t\tvar fkey = (typeof fresh[j] == \"string\" ? fresh[j] : Object.keys(fresh[j])[0]);\r\n\t\tvar rep = got.indexOf(fkey);\r\n\t\tif(rep == -1) existing.push(fresh[j]);\r\n\t\telse if(typeof fresh[j] == \"object\"){\r\n\t\t\tvar val = existing[rep];\r\n\t\t\tif(typeof val == 'string') existing[rep] = fresh[j];\r\n\t\t\telse if(typeof val == 'object'){\r\n\t\t\t\tvar props = fresh[j][fkey];\r\n\t\t\t\tfor(var p in props){\r\n\t\t\t\t\texisting[rep][fkey][p] = props[p];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn existing;\t\r\n}\r\n\r\nFrameConfig.prototype.setFrameArgs = function(existing, fresh){\r\n\tif(!existing) return fresh;\r\n\tif(!fresh) return existing;\r\n\tfor(var k in fresh){\r\n\t\texisting[k] = fresh[k];\r\n\t}\r\n\treturn existing;\r\n}\r\n\r\n\r\nfunction DocumentRule(){\r\n\tFrameRule.call(this); \r\n\tthis.rule = {};\r\n};\r\n\r\nDocumentRule.prototype = Object.create(FrameRule.prototype);\r\nDocumentRule.prototype.constructor = FrameRule;\r\n\r\nDocumentRule.prototype.renderer = function(rend){\r\n\tif(typeof rend == \"undefined\"){\r\n\t\treturn this.rule.renderer;\r\n\t}\r\n\tthis.rule.renderer = rend;\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.compare = function(func){\r\n\tif(typeof func == \"undefined\"){\r\n\t\treturn this.rule.compare;\r\n\t}\r\n\tthis.rule.compare = func;\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.mode = function(mode){\r\n\tif(typeof mode == \"undefined\"){\r\n\t\treturn this.rule.mode;\r\n\t}\r\n\tthis.rule.mode = mode;\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.collapse = function(func){\r\n\tif(typeof func == \"undefined\"){\r\n\t\treturn this.rule.collapse;\r\n\t}\r\n\tthis.rule.collapse = func;\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.view = function(m){\r\n\tif(!m) return this.rule.view;\r\n\tthis.rule.view = m;\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Should actions which are disabled in the given context be displayed?\r\n */\r\nDocumentRule.prototype.showDisabledButtons = function(m){\r\n\tif(typeof m == \"undefined\") return this.rule.show_disabled_buttons;\r\n\tthis.rule.show_disabled_buttons = m;\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.header = function(m){\r\n\tif(!m) return this.rule.header;\r\n\tthis.rule.header = m;\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.headerStyle = function(m){\r\n\tif(!m) return this.rule.headerStyle;\r\n\tthis.rule.headerStyle = m;\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.showEmpty = function(m){\r\n\tif(!m) return this.rule.show_empty;\r\n\tthis.rule.show_empty = m;\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.dataviewer = function(m){\r\n\tif(!m) return this.rule.dataviewer;\r\n\tthis.rule.dataviewer = m;\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.features = function(...m){\r\n\tif(typeof m == \"undefined\" || m.length == 0) return this.rule.features;\r\n\tthis.rule.features = m;\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.headerFeatures = function(...m){\r\n\tif(typeof m == \"undefined\" || m.length == 0) return this.rule.header_features;\r\n\tthis.rule.header_features = m;\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.render = function(func){\r\n\tif(!func) return this.rule.render;\r\n\tvar hf = this.headerFeatures(); \r\n\tvar f = this.features(); \r\n\tif(hf && hf.length){\r\n\t\tvar feats = this.applyFeatureProperty(hf, \"render\", func);\r\n\t\tthis.headerFeatures(...feats);\r\n\t}\r\n\telse if(f && f.length){\r\n\t\tvar feats = this.applyFeatureProperty(f, \"render\", func);\r\n\t\tthis.features(...feats);\r\n\t}\r\n\telse {\r\n\t\tthis.rule.render = func;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nDocumentRule.prototype.style = function(style){\r\n\tif(typeof style == \"undefined\") return this.rule.style;\r\n\tvar hf = this.headerFeatures(); \r\n\tvar f = this.features(); \r\n\tif(hf && hf.length){\r\n\t\tvar feats = this.applyFeatureProperty(hf, \"style\", style);\r\n\t\tthis.headerFeatures(...feats);\r\n\t}\r\n\telse if(f && f.length){\r\n\t\tvar feats = this.applyFeatureProperty(f, \"style\", style);\r\n\t\tthis.features(...feats);\r\n\t}\r\n\telse {\r\n\t\tthis.rule.style = style;\r\n\t}\r\n\treturn this;\r\n};\r\n\r\n/**\r\n * The frame or feature will be hidden or unhidden (boolean)\r\n */\r\nDocumentRule.prototype.hidden = function(m){\r\n\tif(typeof m == \"undefined\") return this.rule.hidden;\r\n\tvar hf = this.headerFeatures(); \r\n\tvar f = this.features(); \r\n\tif(hf && hf.length){\r\n\t\tvar feats = this.applyFeatureProperty(hf, \"hidden\", m);\r\n\t\tthis.headerFeatures(...feats);\r\n\t}\r\n\telse if(f && f.length){\r\n\t\tvar feats = this.applyFeatureProperty(f, \"hidden\", m);\r\n\t\tthis.features(...feats);\r\n\t}\r\n\telse {\r\n\t\tthis.rule.hidden = m;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Specifies arguments to a renderer \r\n */\r\nDocumentRule.prototype.args = function(json){\r\n\tif(!json) return this.rule.args;\r\n\tvar hf = this.headerFeatures(); \r\n\tvar f = this.features(); \r\n\tif(hf && hf.length){\r\n\t\tvar feats = this.applyFeatureProperty(hf, \"args\", json);\r\n\t\tthis.headerFeatures(...feats);\r\n\t}\r\n\telse if(f && f.length){\r\n\t\tvar feats = this.applyFeatureProperty(f, \"args\", json);\r\n\t\tthis.features(...feats);\r\n\t}\r\n\telse {\r\n\t\tthis.rule.args = json;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n/**\r\n * Adds a property to a feature array\r\n */\r\nDocumentRule.prototype.applyFeatureProperty = function(feats, prop, val){\r\n\tvar nfeats = [];\r\n\tfor(var i = 0; i<feats.length; i++){\r\n\t\tif(typeof feats[i] == \"string\"){\r\n\t\t\tvar nfeat = {};\r\n\t\t\tnfeat[feats[i]] = {};\r\n\t\t\tnfeat[feats[i]][prop] = val;\r\n\t\t\tnfeats.push(nfeat);\r\n\t\t}\r\n\t\telse if(typeof feats[i] == \"object\"){\r\n\t\t\tlet fkey = Object.keys(feats[i])[0];\r\n\t\t\tif(fkey){\r\n\t\t\t\tvar nfeat = feats[i];\r\n\t\t\t\tnfeat[fkey][prop] = val;\r\n\t\t\t\tnfeats.push(nfeat);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn nfeats;\r\n}\r\n\r\nDocumentRule.prototype.unpackFeatures = function(feats){\r\n\tlet extensions = {};\r\n\tvar fstr = \"\";\r\n\tfor(var i = 0; i<feats.length; i++){\r\n\t\tif(typeof feats[i] == \"string\"){\r\n\t\t\tfstr += '\"' + feats[i] + '\"';\r\n\t\t}\r\n\t\telse if(typeof feats[i] == \"object\"){\r\n\t\t\tvar fid = Object.keys(feats[i])[0];\r\n\t\t\tfstr += '\"' +  fid + '\"';\r\n\t\t\tfor(var prop in feats[i][fid]){\r\n\t\t\t\textensions[prop] = feats[i][fid][prop];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(i < feats.length - 1){\r\n\t\t\tfstr += \", \"\r\n\t\t}\r\n\t}\r\n\tfor(var k = 0; k < Object.keys(extensions).length; k++){\r\n\t\tvar ext = Object.keys(extensions)[k];\r\n\t\tvar val = extensions[ext];\r\n\t\tfstr += \").\" + ext + \"(\";\r\n\t\tif(typeof val == \"function\"){\r\n\t\t\tfstr += val;\r\n\t\t}\r\n\t\telse if(typeof val == \"string\"){\r\n\t\t\tfstr += '\"' + val + '\"';\r\n\t\t}\r\n\t\telse if(typeof val == \"object\"){\r\n\t\t\tfstr += JSON.stringify(val);\r\n\t\t}\r\n\t}\r\n\treturn fstr;\r\n}\r\n\r\nDocumentRule.prototype.prettyPrint = function(){\r\n\tif(this.pattern){\r\n\t\tstr = this.pattern.prettyPrint();\r\n\t}\r\n\tif(typeof this.renderer() != \"undefined\"){\r\n\t\tstr += \".renderer('\" + this.renderer() + \"')\";\r\n\t}\r\n\tif(typeof this.render() != \"undefined\"){\r\n\t\tstr += \".render(\" + this.render + \")\";\r\n\t}\r\n\tif(typeof this.compare() != \"undefined\"){\r\n\t\tstr += \".compare(\" + this.compare() + \")\";\r\n\t}\r\n\tif(typeof this.mode() != \"undefined\"){\r\n\t\tstr += \".mode('\" + this.mode() + \"')\";\r\n\t}\r\n\tif(typeof this.collapse() != \"undefined\"){\r\n\t\tstr += \".collapse(\" + this.collapse() + \")\";\r\n\t}\r\n\tif(typeof this.hidden() != \"undefined\"){\r\n\t\tstr += \".hidden(\" + this.hidden() + \")\";\r\n\t}\r\n\tif(typeof this.view() != \"undefined\"){\r\n\t\tstr += \".view('\" + this.view() + \"')\";\r\n\t}\r\n\tif(typeof this.showDisabledButtons() != \"undefined\"){\r\n\t\tstr += \".showDisabledButtons(\" + this.showDisabledButtons() + \")\";\r\n\t}\r\n\tif(typeof this.header() != \"undefined\"){\r\n\t\tstr += \".header(\" + this.header() + \")\";\r\n\t}\r\n\tif(typeof this.style() != \"undefined\"){\r\n\t\tstr += \".style(\\\"\" + this.style() + \"\\\")\";\r\n\t}\r\n\tif(typeof this.headerStyle() != \"undefined\"){\r\n\t\tstr += \".headerStyle(\\\"\" + this.headerStyle() + \"\\\")\";\r\n\t}\r\n\tif(typeof this.args() != \"undefined\"){\r\n\t\tstr += \".args(\" + JSON.stringify(this.args()) + \")\";\r\n\t}\r\n\tif(typeof this.showEmpty() != \"undefined\"){\r\n\t\tstr += \".showEmpty(\" + this.show_empty() + \")\";\r\n\t}\r\n\tif(typeof this.dataviewer() != \"undefined\"){\r\n\t\tstr += \".dataviewer(\\\"\" + this.dataviewer() + \"\\\")\";\r\n\t}\r\n\tif(typeof this.features() != \"undefined\"){\r\n\t\tstr += \".features(\" + this.unpackFeatures(this.features()) + \")\";\r\n\t}\r\n\tif(typeof this.headerFeatures() != \"undefined\"){\r\n\t\tstr += \".headerFeatures(\" + this.unpackFeatures(this.headerFeatures()) + \")\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nmodule.exports = FrameConfig;","const ObjectFrame = require(\"../objectFrame\");\r\nconst FrameConfig = require(\"./frameConfig\");\r\nconst FrameHelper = require(\"../utils\");\r\n\r\nfunction DocumentFrame(client, config){\r\n\tthis.client = client;\r\n\tthis.config = (config ? config : new FrameConfig());\r\n\tthis.load_schema = false;\r\n}\r\n\r\nDocumentFrame.prototype.options = function(opts){\r\n\tthis.config = opts;\r\n\treturn this;\r\n}\r\n\r\nDocumentFrame.prototype.db = function(dburl){\r\n    this.client.connectionConfig.setDB(dburl);\r\n    return this;\r\n}\r\n\r\nDocumentFrame.prototype.load = function(url, cls){\r\n\tif(url) {\r\n\t\tif(url.substring(0,4) == \"doc:\"){\r\n\t\t\turl = url.substring(4);\r\n\t\t}\r\n\t\tif(this.config.load_schema()){\r\n\t\t\treturn this.loadComplete(url, cls)\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this.loadDocument(url);\r\n\t\t}\r\n\t}\r\n\tif(cls){\r\n\t\treturn this.loadSchema(cls);\r\n\t}\r\n\t//return Promise.reject\r\n}\r\n\r\n/**\r\n *  @param {String} url - loads the document frame from the document API in frame form\r\n *  @summary - loads the frame encapsulates more meta-data in the json and reduces the number of api calls we need to make\r\n *  @returns {Promise}\r\n */\r\nDocumentFrame.prototype.loadDocument = function(url, encoding){\r\n     encoding = encoding || \"terminus:frame\";\r\n\t return this.client.getDocument(url, {\"terminus:encoding\": encoding})\r\n\t.then((response) => {\r\n\t\t(encoding == \"terminus:frame\" ? this.loadDataFrames(response) : this.loadJSON(response));\r\n\t});\r\n}\r\n\r\nDocumentFrame.prototype.loadSchema = function(cls, dbURL){\r\n\tvar ncls = FrameHelper.unshorten(cls);\r\n\treturn this.client.getClassFrame(dbURL, ncls)\r\n\t.then((response) => this.loadSchemaFrames(response, ncls));\r\n}\r\n\r\n/**\r\n *  @param {String} url - loads the document frame along with its class frame\r\n *  @param {String} [cls] - optional class id of the document - if absent class frames will be loaded from the document class once it is loaded\r\n *  @returns {Promise}\r\n *  @summary - loads a document frame and it's class frame in unison\r\n */\r\n\r\nDocumentFrame.prototype.loadComplete = function(url, cls){\r\n    if(cls){\r\n        return Promise.all([this.loadDocument(url), this.loadDocumentSchema(cls)]);        \r\n    }\r\n    else {\r\n\t    return this.loadDocument(url)\r\n        .then((response) =>  {\r\n\t\t\tthis.loadSchema(this.document.cls);\r\n\t\t});\r\n    }\r\n}\r\n\r\nDocumentFrame.prototype.loadJSON = function(json, type){\r\n    if(this.docid){\r\n        return this.loadDocument(this.docid);\r\n    }\r\n    else if(this.clsid){\r\n        return this.loadDocumentSchema(this.clsid);\r\n    }\r\n    console.error(\"Either docid or clid must be set before load is called\")\r\n}\r\n\r\nDocumentFrame.prototype.loadDataFrames = function(dataframes, cls, classframes){\r\n\tif(!cls){\r\n\t\tif(this.document) cls = this.document.cls;\r\n\t\telse {\r\n\t\t\tif(dataframes && dataframes.length && dataframes[0] && dataframes[0].domain){\r\n\t\t\t\tcls = dataframes[0].domain;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif(cls){\r\n\t\tif(!this.document){\r\n\t\t\tthis.document = new ObjectFrame(cls, dataframes, classframes);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.document.loadDataFrames(dataframes);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tconsole.log(\"Missing Class\" + \" \" + \"Failed to add dataframes due to missing class\");\r\n\t}\r\n}\r\n\r\nDocumentFrame.prototype.loadSchemaFrames = function(classframes, cls){\r\n\tif(!cls){\r\n\t\tif(classframes && classframes.length && classframes[0] && classframes[0].domain){\r\n\t\t\tcls = classframes[0].domain;\r\n\t\t}\r\n\t}\r\n\tif(cls){\r\n\t\tif(!this.document){\r\n\t\t\tthis.document = new ObjectFrame(cls);\r\n\t\t}\r\n\t\tif(classframes){\r\n\t\t\tthis.document.loadClassFrames(classframes);\r\n\t\t\tif(!this.document.subjid){\r\n\t\t\t\tthis.document.newDoc = true;\r\n\t\t\t\tthis.document.fillFromSchema(\"_:\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tconsole.log(\"Missing Class\", \"Failed to add class frames due to missing both class and classframes\");\r\n\t}\r\n}\r\n\r\n/*\r\n * adds render and compare functions to object frames\r\n */\r\nDocumentFrame.prototype.applyRules = function(doc, config, mymatch){\r\n\tdoc = (doc ? doc : this.document);\r\n\tconfig = (config ? config : this.config);\r\n\tvar self = this;\r\n\tvar onmatch = function(frame, rule){\r\n\t\tconfig.setFrameDisplayOptions(frame, rule);\r\n\t\tif(mymatch) mymatch(frame, rule);\r\n\t};\r\n\tdoc.filter(config.rules, onmatch);\r\n}\r\n\r\nmodule.exports = DocumentFrame ;\r\n","const HTMLStringViewer = require('./datatypes/String');\r\nconst HTMLStringEditor = require('./datatypes/StringEditor');\r\nconst HTMLBooleanViewer = require('./datatypes/Boolean');\r\nconst HTMLBooleanEditor = require('./datatypes/BooleanEditor');\r\nconst HTMLChoiceViewer = require('./datatypes/Choice');\r\nconst HTMLChoiceEditor = require('./datatypes/ChoiceEditor');\r\nconst HTMLCoordinateViewer = require('./datatypes/Coordinate');\r\nconst HTMLCoordinateEditor = require('./datatypes/CoordinateEditor');\r\nconst HTMLDateViewer = require('./datatypes/Date');\r\nconst HTMLDateEditor = require('./datatypes/DateEditor');\r\nconst HTMLEntityViewer = require('./datatypes/Entity');\r\nconst HTMLEntityEditor = require('./datatypes/EntityEditor');\r\nconst HTMLImageViewer = require('./datatypes/Image');\r\nconst HTMLImageEditor = require('./datatypes/ImageEditor');\r\nconst HTMLLinkViewer = require('./datatypes/Link');\r\nconst HTMLNumberViewer = require('./datatypes/Number');\r\nconst HTMLRangeViewer = require('./datatypes/Range');\r\nconst HTMLRangeEditor = require('./datatypes/RangeEditor');\r\nconst GoogleMapEditor = require('./datatypes/GoogleMapEditor');\r\nconst GoogleMapViewer = require('./datatypes/GoogleMapViewer');\r\nconst HTMLMarkupEditor = require('./datatypes/HTMLMarkupEditor');\r\nconst S2EntityEditor = require('./datatypes/S2EntityEditor');\r\n\r\n\r\nfunction initialiseDataRenderers(RenderingMap, plugins, options){\r\n\tRenderingMap.registerViewerForTypes(\"HTMLBooleanViewer\", {label: \"Checkbox Viewer\"}, [\"xsd:boolean\"]);\r\n\tRenderingMap.registerEditorForTypes(\"HTMLBooleanEditor\", {label: \"Checkbox Editor\"}, [\"xsd:boolean\"]);\r\n\tRenderingMap.registerViewerForTypes(\"HTMLChoiceViewer\", {label: \"Choice Viewer\"}, [\"oneOf\"]);\r\n\tRenderingMap.registerEditorForTypes(\"HTMLChoiceEditor\", {label: \"Choice Selector\"}, [\"oneOf\"]);\r\n\tRenderingMap.registerViewerForTypes(\"HTMLCoordinateViewer\", {label: \"Coordinate Viewer\"}, [\"xdd:coordinate\", \"xdd:coordinatePolyline\", \"xdd:coordinatePolygon\"]);\r\n\tRenderingMap.registerEditorForTypes(\"HTMLCoordinateEditor\", {label: \"Coordinate Editor\"}, [\"xdd:coordinate\", \"xdd:coordinatePolyline\", \"xdd:coordinatePolygon\"]);\r\n\tRenderingMap.registerViewerForTypes(\"HTMLDateViewer\", {label: \"Date Viewer\"}, [\"xsd:time\", \"xsd:date\", \"xsd:dateTime\", \"xsd:gYear\", \r\n\t\t\"xsd:gYearRange\", \"xsd:gMonth\", \"xsd:gDay\", \"xsd:gYearMonth\", \"xsd:gMonthDay\", \"xsd:dateTimeStamp\"]);\r\n\tRenderingMap.registerEditorForTypes(\"HTMLDateEditor\", {label: \"Date Editor\"}, [\"xsd:time\", \"xsd:date\", \"xsd:dateRange\" ,\"xsd:dateTime\", \"xsd:gYear\", \r\n\t\t\"xsd:gYearRange\", \"xsd:gMonth\", \"xsd:gDay\", \"xsd:gYearMonth\", \"xsd:gMonthDay\", \"xsd:dateTimeStamp\"]);\r\n\t\r\n\tvar hevopts = {label: \"Document Viewer\"};\r\n\tif (options && options[\"HTMLEntityViewer\"]) hevopts.args = options[\"HTMLEntityViewer\"];\r\n\tRenderingMap.registerViewerForTypes(\"HTMLEntityViewer\", hevopts, [\"document\"]);\r\n\tRenderingMap.registerEditorForTypes(\"HTMLEntityEditor\", {label: \"Document Selector\"}, [\"document\"]);\r\n\tRenderingMap.registerViewerForTypes(\"HTMLImageViewer\", {label: \"Image Viewer\"}, [\"xdd:url\", \"xsd:anyURI\", \"xsd:base64Binary\"]);\r\n\tRenderingMap.registerEditorForTypes(\"HTMLImageEditor\", {label: \"Image Editor\"}, [\"xsd:base64Binary\"]);\r\n\tRenderingMap.registerViewerForTypes(\"HTMLImageViewer\", {label: \"Image Viewer\"}, [\"xdd:url\", \"xsd:anyURI\", \"xsd:base64Binary\"]);\r\n\tRenderingMap.registerEditorForTypes(\"HTMLImageEditor\", {label: \"Image Editor\"}, [\"xsd:base64Binary\"]);\r\n\tRenderingMap.registerViewerForTypes(\"HTMLLinkViewer\", {label: \"Link Viewer\"}, [\"xdd:url\", \"xsd:anyURI\"]);\r\n\tRenderingMap.registerViewerForTypes(\"HTMLNumberViewer\", {label: \"Number with commas\"}, \r\n\t\t\t[\"xsd:decimal\", \"xsd:double\", \"xsd:float\", \"xsd:short\", \"xsd:integer\", \"xsd:long\", \r\n\t\t\t\t\"xsd:nonNegativeInteger\", \"xsd:positiveInteger\", \"xsd:negativeInteger\", \"xsd:nonPositiveInteger\"]);\r\n\tRenderingMap.registerViewerForTypes(\"HTMLRangeViewer\", {label: \"Range Viewer\"}, [\"xdd:gYearRange\", \"xdd:dateRange\", \"xdd:integerRange\", \"xdd:decimalRange\"]);\r\n\tRenderingMap.registerEditorForTypes(\"HTMLRangeEditor\", {label: \"Range Editor\"}, [\"xdd:gYearRange\", \"xdd:dateRange\", \"xdd:integerRange\", \"xdd:decimalRange\"]);\r\n\tRenderingMap.universalEditor = \"HTMLStringEditor\";\r\n\tRenderingMap.universalViewer = \"HTMLStringViewer\";\r\n\taddPlugins(RenderingMap, plugins);\r\n\tRenderingMap.createRenderer = function(type, args){\r\n\t\tlet r = createDataRenderer(type, args);\r\n\t\treturn r;\r\n\t}\r\n}\r\n\r\nfunction createDataRenderer(type, options){\r\n\ttry {\r\n\t\tvar viewer = eval(\"new \" + type + \".\" + type + \"()\");\r\n\t\tif(viewer.options) viewer.options(options);\r\n\t}\r\n\tcatch(e){\r\n\t\treturn false;\r\n\t}\r\n\treturn viewer;\r\n}\r\n\r\nfunction addPlugins(RenderingMap, plugins){\r\n\tif(plugins && plugins.indexOf(\"gmaps\") != -1){\r\n\t\tRenderingMap.registerEditorForTypes(\"GoogleMapEditor\", {label: \"Google Map Editor\"}, [\"xdd:coordinate\", \"xdd:coordinatePolyline\", \"xdd:coordinatePolygon\"]);\r\n\t\tRenderingMap.registerViewerForTypes(\"GoogleMapViewer\", {label: \"Google Map Editor\"}, [\"xdd:coordinate\", \"xdd:coordinatePolyline\", \"xdd:coordinatePolygon\"]);\r\n\t}\r\n\tif(plugins && plugins.indexOf(\"quill\") != -1){\r\n\t\tRenderingMap.registerEditorForTypes(\"HTMLMarkupEditor\", {label: \"Quill WYSIWIG HTML Editor\"}, [\"xdd:html\"]);\r\n\t}\r\n\tif(plugins && plugins.indexOf(\"select2\") != -1){\r\n\t\tRenderingMap.registerEditorForFrameType(\"S2EntityEditor\", {label: \"S2 Autocomplete Selector\"}, \"document\");\r\n\t}\r\n}\r\n\r\nmodule.exports = {createDataRenderer, initialiseDataRenderers};","function HTMLDateHelper(){\r\n\tthis.months = [\"January\", \"Februrary\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\r\n}\r\n\r\nHTMLDateHelper.prototype.getMonthName = function(num){\r\n\treturn this.months[num-1];\r\n}\r\n\r\nmodule.exports={HTMLDateHelper}","function GoogleMapHelper(options){\r\n\tthis.polygon = false;\r\n\tthis.polyline = false;\r\n\tthis.markers = [];\r\n\tthis.init(options);\r\n}\r\n\r\nGoogleMapHelper.prototype.init = function(config){\r\n\tthis.type = ((config && config.type) ? config.type: 'Shape'); \r\n\tthis.width = ((config && config.width) ? config.width : '400px'); \r\n\tthis.height = ((config && config.height ) ? config.height : '400px'); \r\n\tthis.mapLat = ((config && config.mapLat) ? config.mapLat : '41.9010004'); \r\n\tthis.mapLong = ((config && config.mapLong ) ? config.mapLong : '12.500061500000015');\r\n\tthis.zoom = ((config && config.zoom) ? config.zoom : 3);\r\n\tthis.stroke = ((config && config.stroke) ? config.stroke : { color: '#FF0000', opacity: 0.3, weight: 3});\r\n\tthis.fill = ((config && config.fill) ? config.fill : { color: '#FF0000', opacity: 0.1});\r\n\tthis.line = ((config && config.line) ? config.line : { color: '#000000', opacity: 0.9, weight: 3});\r\n}\r\n\r\nGoogleMapHelper.prototype.destroy = function(){\r\n    this.clear();\r\n} \r\n\r\nGoogleMapHelper.prototype.translatePolygonToArray = function(polygon){\r\n   var data = \"[\";\r\n   var vertices = polygon.getPath();\r\n   var seenValue = false;\r\n   for (var j=0; j<vertices.getLength(); j++){\r\n       if(seenValue){\r\n           data = data + \",\";\r\n       }\r\n       var xy = vertices.getAt(j);\r\n       data = data + \"[\" + xy.lat() + \",\" + xy.lng() + \"]\"\r\n       seenValue = true;\r\n   }\r\n   data = data + \"]\";\r\n   return data;\r\n};\r\n\r\nGoogleMapHelper.prototype.translateArrayToPolygon = function(array){\r\n   var jsonified = JSON.parse(array);\r\n   var output = [];\r\n   for(var i=0;i<jsonified.length;i++){\r\n       var latlong = {}\r\n       latlong.lat = jsonified[i][0];\r\n       latlong.lng = jsonified[i][1];\r\n       output.push(latlong);\r\n   }\r\n   return output;\r\n}\r\n\r\nGoogleMapHelper.prototype.createPolygon = function(coords, map) {\r\n\tvar polygon = new google.maps.Polygon({\r\n        paths: coords,\r\n        strokeColor: this.stroke.color,\r\n        strokeOpacity: this.stroke.opacity,\r\n        strokeWeight: this.stroke.weight,\r\n        fillColor: this.fill.color,\r\n        fillOpacity: this.fill.opacity\r\n\t});\r\n    polygon.setMap(map);\r\n\treturn polygon;\r\n}\r\n\r\nGoogleMapHelper.prototype.createPolyline = function(coords){\r\n\tvar init = {\r\n\t      strokeColor: this.line.color,\r\n\t      strokeOpacity: this.line.opacity,\r\n\t      strokeWeight: this.line.weight\r\n\t};\r\n\tif(coords){\r\n\t\tinit.paths = coords;\r\n\t}\r\n\tvar poly = new google.maps.Polyline(init);\r\n\treturn poly;\r\n}\r\n\r\nGoogleMapHelper.prototype.clearMarkers = function() {\r\n\tfor (var i = 0; i < this.markers.length; i++ ) {\r\n\t\tthis.markers[i].setMap(null);\r\n\t}\r\n\tthis.markers.length = 0;\r\n}\r\n\r\n\r\nGoogleMapHelper.prototype.addMarker = function(position, map, frame, title, ty) {\r\n\tvar init = {\r\n\t\tposition: position, \r\n\t\tmap: map\r\n\t}\r\n\tif(title){\r\n\t\tinit.title = title;\r\n\t}\r\n\tvar marker = new google.maps.Marker(init);\r\n\tvar self = this;\r\n\tif(this.markers.length == 0 && ty == \"xdd:coordinatePolygon\"){\r\n     \tmarker.addListener('click', function() {\r\n\t\t\tvar coords = self.getCoordsFromMarkers();\r\n    \t\tself.polygon = self.createPolygon(coords, map);\r\n            self.clearMarkers();\r\n            self.polyline.setMap(null);\r\n            frame.set(self.translatePolygonToArray(self.polygon));\r\n        });                \t\r\n    }\r\n\tthis.markers.push(marker);\r\n\tif(ty == \"xdd:coordinatePolyline\"){\r\n\t\tvar x = this.translatePolygonToArray(this.polyline);\r\n\t\tframe.set(x);\r\n\t}\r\n\treturn marker;\r\n}\r\n\r\nGoogleMapHelper.prototype.getCoordsFromMarkers = function(){\r\n\treturn this.polyline.getPath();\r\n}\r\n\r\nGoogleMapHelper.prototype.clear = function(){\r\n\tif(this.polygon) {\r\n\t\tthis.polygon.setMap(null);\r\n\t\tthis.polygon = false;\r\n\t}\r\n\tif(this.polyline) {\r\n\t\tthis.clearMarkers();\r\n\t\tthis.polyline.setMap(null);\r\n\t}\r\n}\r\n\r\nGoogleMapHelper.prototype.initMap = function(mapContainer, value, type){\r\n\tmapContainer.style.width = this.width;\r\n\tmapContainer.style.height = this.height;\r\n\tif(typeof google == \"undefined\"){\r\n\t\talert(\"google is not effing loaded\");\r\n\t\treturn false;\r\n\t}\r\n\tvar map = new google.maps.Map(mapContainer, {\r\n\t    zoom: this.zoom,\r\n\t\tcenter: {lat: parseFloat(this.mapLat), lng: parseFloat(this.mapLong)}  \r\n\t});\r\n\tif(type == \"xdd:coordinatePolygon\"){\r\n\t    this.polyline = this.createPolyline();\r\n\t\tthis.polyline.setMap(map);\r\n\t\tvar coords = (value ? this.translateArrayToPolygon(value) : []);\r\n\t\tif(value){\r\n\t    \tthis.polygon = this.createPolygon(coords, map);\r\n\t    }\r\n\t}\r\n\telse if(type == \"xdd:coordinatePolyline\"){\r\n\t\tvar coords = (value ? this.translateArrayToPolygon(value) : []);\r\n\t    this.polyline = this.createPolyline();\r\n\t\tthis.polyline.setMap(map);\t\t\r\n\t\tif(value){\r\n\t    \tthis.polyline.setPath(coords);\r\n\t    }\r\n\t}\t\r\n\telse if(type == \"xdd:coordinate\"){\r\n\t\tif(value){\r\n\t\t\tthis.clearMarkers();\r\n            var lat = parseFloat(value.substring(1, value.indexOf(\",\")));\r\n\t\t\tvar long = parseFloat(value.substring(value.indexOf(\",\")+1, value.length-1));\r\n            var init = {\r\n            \tposition: {lat: lat, lng: long},\r\n        \t\tmap: map\r\n\t        }\r\n\t        var marker = new google.maps.Marker(init);\r\n\t        this.markers.push(marker);\r\n\t\t}\r\n\t}\r\n    google.maps.event.trigger(map, 'resize');\r\n    return map;\r\n}\r\n\r\nmodule.exports=GoogleMapHelper;","/*\r\n * Maintains a list of renderers that are available for rendering \r\n * datatype values - also covers choice values and id values\r\n */\r\n\r\nfunction DatatypeRenderers(options){\r\n\tthis.registeredDataViewers = {},\r\n\tthis.registeredDataEditors = {},\r\n\tthis.defaultViewers = {};\r\n\tthis.defaultEditors = {};\r\n\tthis.universalViewer = false;\r\n\tthis.universalEditor = false;\r\n\tif(options) this.options(options);\r\n\t//links to other documents, choices, id field, id fields of contained objects, ids of structural elements: properties, etc\r\n\tthis.specials = ['document', 'oneOf', 'id', 'contained', 'structural'];\r\n}\r\n\r\nDatatypeRenderers.prototype.options = function (options){\r\n\tthis.universalViewer = (options && options.universalViewer ? options.universalViewer : false);\r\n\tthis.universalEditor = (options && options.universalEditor ? options.universalEditor : false);\r\n\tthis.editor = (options && options.editor ? options.editor : false);\r\n}\r\n\r\nDatatypeRenderers.prototype.getValidDataViewerList = function(datatype){\r\n\tlet valids = [];\r\n\tif(datatype && typeof this.registeredDataViewers[datatype] != \"undefined\"){\r\n\t\tvalids = valids.concat(this.registeredDataViewers[datatype]);\r\n\t}\r\n\tif(this.universalViewer && valids.indexOf(this.universalViewer) == -1){\r\n\t\tvalids.push(this.universalViewer);\r\n\t}\r\n\treturn valids;\r\n};\r\n\r\nDatatypeRenderers.prototype.getValidDataEditorList = function(datatype){\r\n\tlet valids = [];\r\n\tif(datatype && typeof this.registeredDataEditors[datatype] != \"undefined\"){\r\n\t\tvar nftypes = this.registeredDataEditors[datatype];\r\n\t\tif(nftypes){\r\n\t\t\tfor(var i = 0; i<nftypes.length; i++){\r\n\t\t\t\tif(valids.indexOf(nftypes[i]) == -1) valids.push(nftypes[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif(typeof this.registeredDataEditors[datatype] != \"undefined\"){\r\n\t\tvalids = valids.concat(this.registeredDataEditors[datatype]);\r\n\t}\r\n\tif(this.universalEditor && valids.indexOf(this.universalEditor) == -1){\r\n\t\tvalids.push(this.universalEditor);\r\n\t}\r\n\treturn valids;\r\n}\r\n\r\nDatatypeRenderers.prototype.getEditorForDataFrame = function(datatype){\r\n\tvar vals = this.getValidDataEditorList(datatype);\r\n\tif(this.defaultEditors[datatype] && vals[this.defaultEditors[datatype]]){\r\n\t\treturn vals[this.defaultEditors[datatype]];\r\n\t}\r\n\t//last added is default if no explicit default is set\r\n\tif(vals){\r\n\t\treturn vals[Object.keys(vals)[0]];\r\n\t}\r\n\telse {\r\n\t\tif(this.universalEditor) return this.universalEditor;\r\n\t}\r\n}\r\n\r\nDatatypeRenderers.prototype.getViewerForDataFrame = function(datatype){\r\n\tvar vals = this.getValidDataViewerList(datatype);\r\n\tif(this.defaultViewers[datatype] && vals[this.defaultViewers[datatype]]){\r\n\t\treturn vals[this.defaultViewers[datatype]];\r\n\t}\r\n\tif(vals){\r\n\t\treturn vals[Object.keys(vals)[0]];\r\n\t}\r\n\telse {\r\n\t\tif(this.universalViewer) return this.universalViewer;\r\n\t}\r\n\r\n}\r\n\r\nDatatypeRenderers.prototype.registerViewerForTypes = function(viewer, record, types){\r\n\tfor(var i = 0; i < types.length; i++){\r\n\t\tif(typeof this.registeredDataViewers[types[i]] == \"undefined\"){\r\n\t\t\tthis.registeredDataViewers[types[i]] = {};\r\n\t\t}\r\n\t\tif(!this.registeredDataViewers[types[i]][viewer]){\r\n\t\t\tthis.registeredDataViewers[types[i]][viewer] = record;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nDatatypeRenderers.prototype.registerEditorForTypes = function(viewer, record, types){\r\n\tfor(var i = 0; i < types.length; i++){\r\n\t\tif(typeof this.registeredDataEditors[types[i]] == \"undefined\"){\r\n\t\t\tthis.registeredDataEditors[types[i]] = {};\r\n\t\t}\r\n\t\tif(!this.registeredDataEditors[types[i]][viewer]){\r\n\t\t\tthis.registeredDataEditors[types[i]][viewer] = record;\r\n\t\t}\t\t\t\r\n\t}\r\n}\r\n\r\nDatatypeRenderers.prototype.getRenderer = function(type, value){\r\n\tvar r = {};\r\n\tlet v = this.getViewerForDataFrame(type);\r\n\tif(v){\r\n\t\tif(typeof v == \"object\"){\r\n\t\t\tr.name = Object.keys(v)[0];\r\n\t\t\tif(v[r.name].label){\r\n\t\t\t\tr.label = v[r.name].label;\r\n\t\t\t}\r\n\t\t\tif(v[r.name].args){\r\n\t\t\t\tr.args = v[r.name].args;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tr.name = v;\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nDatatypeRenderers.prototype.getEditor = function(type, value){\r\n\tvar r = {};\r\n\tlet v = this.getEditorForDataFrame(type);\r\n\tif(v){\r\n\t\tif(typeof v == \"object\"){\r\n\t\t\tr.name = Object.keys(v)[0];\r\n\t\t\tif(v[r.name].label){\r\n\t\t\t\tr.label = v[r.name].label;\r\n\t\t\t}\r\n\t\t\tif(v[r.name].args){\r\n\t\t\t\tr.args = v[r.name].args;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tr.name = v;\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n\r\nmodule.exports=DatatypeRenderers;\r\n\r\n\r\n","function TerminusViolations(vios, ui){\r\n\tthis.ui = ui;\r\n\tthis.vios = [];\r\n\tvar nvios = [];\r\n\tfor(var i = 0; i<vios.length; i++){\r\n\t\tnvios.push(vios[i]);\r\n\t}\r\n\tfor(var i = 0; i<nvios.length; i++){\r\n\t\tthis.vios.push(new TerminusViolation(nvios[i], this.ui));\r\n\t}\r\n}\r\n\r\nTerminusViolations.prototype.getAsDOM = function(context_msg){\r\n\tvar vdom = document.createElement(\"div\");\r\n\tvdom.setAttribute(\"class\", \"terminus-violations terminus-show-msg-vio\");\r\n\tvar vioHeading = document.createElement(\"div\");\r\n\tvioHeading.setAttribute('class', 'terminus-violations-heading');\r\n\tvdom.appendChild(vioHeading);\r\n\tvar msg = this.vios.length + (this.vios.length > 1 ? \" Violations Detected\" : \" Violation Detected\");\r\n\tif(context_msg) msg += \" \" + context_msg;\r\n\tvioHeading.appendChild(document.createTextNode(msg));\r\n\tfor(var i = 0; i<this.vios.length; i++){\r\n\t\tvdom.appendChild(this.vios[i].getAsDOM());\r\n\t}\r\n\treturn vdom;\r\n}\r\n\r\n/*\r\n * Class for displaying violation reports as HTML\r\n */\r\nfunction TerminusViolation(vio, ui){\r\n\tthis.ui = ui;\r\n\tthis.vio = vio;\r\n}\r\n\r\nTerminusViolation.prototype.getAsDOM = function(){\r\n\tvar vdom = document.createElement(\"div\");\r\n\tvdom.setAttribute(\"class\", \"terminus-violation\");\r\n\tif(this.vio['@type']){\r\n\t\tvar msg = this.vio['vio:message'] || {\"@value\": \"\"};\r\n\t\tvdom.appendChild(this.getPropertyAsDOM(this.vio[\"@type\"], msg));\r\n\t}\r\n\tfor(var prop in this.vio){\r\n\t\tif(prop != \"vio:message\" && prop != \"@type\"){\r\n\t\t\tvdom.appendChild(this.getPropertyAsDOM(prop, this.vio[prop]));\r\n\t\t}\r\n\t}\r\n\treturn vdom;\r\n}\r\n\r\nTerminusViolation.prototype.getPropertyAsDOM = function(prop, val){\r\n\tvar pdom = document.createElement(\"div\");\r\n\tpdom.setAttribute(\"class\", \"terminus-violation-property\");\r\n\tvar ldom = document.createElement(\"span\");\r\n\tldom.setAttribute(\"class\", \"terminus-label terminus-violation-property-label\");\r\n\tldom.appendChild(document.createTextNode(prop));\r\n\tvar vdom = document.createElement(\"span\");\r\n\tvdom.setAttribute(\"class\", \"terminus-violation-property-value\");\r\n\tvar mval = val[\"@value\"] || val;\r\n\tif(mval && typeof mval != \"object\") vdom.appendChild(document.createTextNode(mval));\r\n\tpdom.appendChild(ldom);\r\n\tpdom.appendChild(vdom);\r\n\treturn pdom;\r\n}\r\n\r\nmodule.exports=TerminusViolations\r\n","const TerminusUI = require('./TerminusUI');\r\nconst TerminusViewer =require('./html/TerminusViewer')\r\nmodule.exports={TerminusUI:TerminusUI,\r\n\tTerminusViewer:TerminusViewer}","/**\r\n * Terminus UI object\r\n *\r\n * Traffic control of messages going between different Terminus UI pages and features\r\n *\r\n * @param opts - options array\r\n */\r\nconst ApiExplorer = require('./ApiExplorer');\r\nconst TerminusDBsdk = require('./TerminusDB');\r\nconst TerminusViolations = require('./html/TerminusViolation');\r\nconst TerminusQueryViewer = require('./TerminusQuery');\r\nconst TerminusSchemaViewer = require('./TerminusSchema');\r\nconst TerminusServersdk = require('./TerminusServer');\r\nconst TerminusURLLoader = require('./TerminusURL');\r\nconst TerminusPluginManager = require('./plugins/TerminusPlugin');\r\nconst UTILS = require('./Utils');\r\nconst HTMLHelper = require('./html/HTMLHelper');\r\nconst TerminusClient = require('@terminusdb/terminus-client');\r\n\r\nfunction TerminusUI(opts){\r\n\tthis.client = new TerminusClient.WOQLClient();\r\n\tthis.controls = [];\r\n\tthis.setOptions(opts);\r\n}\r\n\r\n/*\r\n * Client connects to specified server and specified part\r\n * opts is a json with the following fields:\r\n * server: mandatory URL of the server to connect to\r\n * key: optional client API key\r\n * dbid: id of the database to connect to\r\n * schema: if set, the UI will load the schema page after connecting\r\n * query: if set, the query will be sent to the server and the results will be loaded on the query page\r\n * document: if set, the document page corresponding to this document will be loaded after connecting\r\n *\r\n * (note: schema, query, document are mutually exclusive and must also have a dbid set)\r\n */\r\nTerminusUI.prototype.connect = function(opts){\r\n\tvar self = this;\r\n\tthis.client.connectionConfig.server = false;\r\n\tvar key = ((opts && opts.key) ? opts.key : false);\r\n\tthis.showBusy(\"Connecting to server at \" + opts.server);\r\n\treturn this.client.connect(opts.server, key)\r\n\t.then( function(response) {\r\n\t\tself.clearBusy();\r\n\t\tif(opts && opts.db && self.getDBRecord(opts.db)){\r\n\t\t\tself.connectToDB(opts.db);\r\n\t\t\tif(opts.document && self.showView(\"get_document\")){\r\n\t\t\t\tresponse = self.showDocumentPage(opts.document);\r\n\t\t\t}\r\n\t\t\telse if(opts.schema && self.showView(\"get_schema\")){\r\n\t\t\t\tresponse = self.showSchemaPage(opts.schema);\r\n\t\t\t}\r\n\t\t\telse if(opts.query && self.showView(\"woql_select\")){\r\n\t\t\t\tself.showQueryPage(opts.query);\r\n\t\t\t}\r\n\t\t\telse if(opts.explorer && self.showView(\"api_explorer\")){\r\n\t\t\t\tself.showExplorer(opts.explorer);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tself.showDBMainPage();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.showServerMainPage();\r\n\t\t}\r\n\t\tself.redraw();\r\n\t\treturn response;\r\n\t})\r\n\t.catch(function(err) {\r\n\t\tself.clearBusy();\r\n\t\tself.showError(err);\r\n\t\tthrow(err);\r\n\t});\r\n}\r\n\r\n/**\r\n * Sends a request to create a new database to the server and interprets the response\r\n *\r\n * dbdets is a json object with the following fields:\r\n * id: the id of the new database (alphanumeric, no spaces, url friendly) mandatory\r\n * title: the text name of the new database for tables, etc. mandatory\r\n * description: text description of the database (optional)\r\n * key: a API client key for server auth\r\n * schema: the url of another Terminus DB from which to import schema\r\n * instance: the url of another Terminus DB from which to import data\r\n *\r\n */\r\nTerminusUI.prototype.createDatabase = function(dbdets){\r\n\tvar self = this;\r\n\tif(!dbdets.id || !dbdets.title){\r\n        return Promise.reject(new Error(self.getBadArguments(\"createDatabase\", \"ID and title are mandatory fields\")));\r\n\t}\r\n\tvar dbid = dbdets.id;\r\n\tself.showBusy(\"Creating Database \" + dbdets.title + \" with id \" + dbid);\r\n\tvar dbdoc = this.generateNewDatabaseDocument(dbdets);\r\n\treturn this.client.createDatabase(dbid, dbdoc)\r\n\t.then(function(response){ //reload list of databases in background..\r\n\t\tself.clearBusy();\r\n\t\treturn self.refreshDBList()\r\n\t\t.then(function(response){\r\n\t\t\tif(crec = self.client.connection.getDBRecord(dbid)){\r\n\t\t\t\tself.client.connectionConfig.dbid = dbid;\r\n\t\t\t\tself.showDBMainPage();\r\n\t\t\t\tself.showMessage(\"Successfully Created Database \" + dbid, \"success\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t        return Promise.reject(new Error(self.getCrashString(\"createDatabase\", \"Failed to retrieve record of created database \" + dbid)));\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n\t.catch(function(error){\r\n\t\tself.clearBusy();\r\n\t\tself.showError(error);\r\n\t});\r\n}\r\n\r\n/**\r\n * Deletes the database with the passed id from the currently connected server\r\n */\r\nTerminusUI.prototype.deleteDatabase = function(dbid){\r\n\tvar self = this;\r\n\tvar delrec = this.client.connection.getDBRecord();\r\n\tvar lid = (dbid ? dbid : this.db());\r\n\tvar dbn = (delrec && delrec['rdfs:label'] && delrec['rdfs:label'][\"@value\"] ? delrec['rdfs:label'][\"@value\"] + \" (id: \" + lid + \")\" : lid);\r\n\tthis.showBusy(\"Deleting database \" + dbn);\r\n\treturn this.client.deleteDatabase(lid)\r\n\t.then(function(response){\r\n\t\tself.clearBusy();\r\n\t\tself.showServerMainPage();\r\n\t\tself.showMessage(\"Successfully Deleted Database \" + dbn, \"warning\");\r\n\t\tself.refreshDBList();\r\n\t\treturn response;\r\n\t})\r\n\t.catch(function(error){\r\n\t\tself.clearBusy();\r\n\t\tself.showError(error);\r\n\t});\r\n}\r\n\r\n/*\r\n * Transforms a details (id, title, description) array into  json-ld document\r\n */\r\nTerminusUI.prototype.generateNewDatabaseDocument = function(dets){\r\n\tvar doc = {\r\n\t\t\"@context\" : {\r\n\t\t\trdfs: \"http://www.w3.org/2000/01/rdf-schema#\",\r\n\t\t\tterminus: \"http://terminusdb.com/schema/terminus#\"\r\n\t\t},\r\n\t\t\"@type\": \"terminus:Database\"\r\n\t}\r\n\tif(dets.title){\r\n\t\tdoc['rdfs:label'] = {\r\n\t\t\t\"@language\":  \"en\",\r\n\t\t\t\"@value\": dets.title\r\n\t\t};\r\n\t}\r\n\tif(dets.description){\r\n\t\tdoc['rdfs:comment'] = {\r\n\t\t\t\"@language\":  \"en\",\r\n\t\t\t\"@value\": dets.description\r\n\t\t};\r\n\t}\r\n\tdoc['terminus:allow_origin'] = { \"@type\" : \"xsd:string\", \"@value\" : \"*\" };\r\n\treturn doc;\r\n}\r\n\r\nTerminusUI.prototype.getBadArguments = function(fname, str){\r\n\treturn \"Bad arguments to \" + fname + \": \" + str;\r\n}\r\n\r\nTerminusUI.prototype.getCrashString = function(fname, str){\r\n\treturn \"Results from \" + fname + \" indicate the possibility of a system failure \" + str;\r\n}\r\n\r\n/*\r\n * Parses the passed URL and turns it into a call to the connect function - loads the appropriate endpoing\r\n */\r\nTerminusUI.prototype.load = function(url, key){\r\n\tvar args = {};\r\n\tif(url && url.indexOf(\"/document/\") != -1){\r\n\t\turl = url.substring(0, url.indexOf(\"/document/\"));\r\n\t\targs.document = url.substring(url.indexOf(\"/document/\")+10);\r\n\t}\r\n\telse if(url && url.indexOf(\"/schema\") != -1){\r\n\t\turl = url.substring(0, url.indexOf(\"/schema\"));\r\n\t\targs.schema = {};\r\n\t}\r\n\telse if(url && url.indexOf(\"/woql\") != -1){\r\n\t\turl = url.substring(0, url.indexOf(\"/query\"));\r\n\t\targs.query = url.substring(url.indexOf(\"/query\")+7);\r\n\t}\r\n\targs.server = url;\r\n\tif(key) args.key = key;\r\n\treturn this.connect(args);\r\n}\r\n\r\n/**\r\n * Fetches the DB URL from the url by chopping off the extra bits\r\n */\r\nTerminusUI.prototype.getConnectionEndpoint = function(url){\r\n\tif(url && url.lastIndexOf(\"/schema\") != -1){\r\n\t\treturn url.substring(0, url.lastIndexOf(\"/schema\"));\r\n\t}\r\n\tif(url && url.lastIndexOf(\"/document\") != -1){\r\n\t\treturn url.substring(0, url.lastIndexOf(\"/document\"));\r\n\t}\r\n\tif(url && url.lastIndexOf(\"/frame\") != -1){\r\n\t\treturn url.substring(0, url.lastIndexOf(\"/frame\"));\r\n\t}\r\n\tif(url && url.lastIndexOf(\"/woql\") != -1){\r\n\t\treturn url.substring(0, url.lastIndexOf(\"/woql\"));\r\n\t}\r\n\treturn url;\r\n}\r\n\r\nTerminusUI.prototype.server = function(){\r\n\treturn this.client.connectionConfig.server;\r\n}\r\n\r\nTerminusUI.prototype.db = function(){\r\n\treturn this.client.connectionConfig.dbid;\r\n}\r\n\r\nTerminusUI.prototype.clearServer = function(){\r\n\tthis.client.connectionConfig.server = false;\r\n}\r\n\r\nTerminusUI.prototype.connectToDB = function(dbid){\r\n\tthis.client.connectionConfig.dbid = dbid;\r\n\t//set standard prefixes for the current db\r\n\tTerminusClient.UTILS.addURLPrefix('doc', this.client.connectionConfig.dbURL() + \"/document/\");\r\n\tTerminusClient.UTILS.addURLPrefix('scm', this.client.connectionConfig.dbURL() + \"/schema#\");\r\n}\r\n\r\nTerminusUI.prototype.clearDB = function(){\r\n\tthis.client.connectionConfig.dbid = false;\r\n}\r\n\r\nTerminusUI.prototype.removeDB = function(db, url){\r\n\tthis.client.connection.removeDB(db, url);\r\n}\r\n\r\nTerminusUI.prototype.getDBRecord = function(db, url){\r\n\treturn this.client.connection.getDBRecord(db, url);\r\n}\r\n\r\nTerminusUI.prototype.refreshDBList = function(){\r\n\tvar self = this;\r\n\treturn this.client.connect();\r\n}\r\n\r\nTerminusUI.prototype.showServerMainPage = function(){\r\n\tthis.viewer = new TerminusServersdk.TerminusServerViewer(this);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showCollaboratePage = function(){\r\n\tthis.viewer = new TerminusURLLoader(this);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\n\r\nTerminusUI.prototype.showLoadURLPage = function(val){\r\n\tthis.viewer = new TerminusURLLoader(this, val);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showDBMainPage = function(){\r\n\tthis.viewer = new TerminusDBsdk.TerminusDBViewer(this);\r\n\tthis.page = \"db\";\r\n\tthis.redraw();\r\n}\r\n\r\nTerminusUI.prototype.showCreateDBPage = function(){\r\n\tthis.viewer = new TerminusDBsdk.TerminusDBCreator(this);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showSchemaPage = function(durl){\r\n\tthis.viewer = new TerminusSchemaViewer(this);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showQueryPage = function(query){\r\n\tthis.viewer = new TerminusQueryViewer(this, query, this.options);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showDocumentPage = function(durl){\r\n\tthis.viewer = new TerminusDBsdk.TerminusDBViewer(this);\r\n\tthis.page = \"docs\";\r\n\tif(durl){\r\n\t\tthis.viewer.docid = durl;\r\n\t}\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showCreateDocument = function(durl){\r\n\tthis.viewer = new TerminusDocumentViewer(this, \"create\", this.getDocCreatorOptions());\r\n\tconst promise = this.viewer.loadCreateDocument(durl);\r\n\tthis.redrawMainPage();\r\n\treturn promise;\r\n}\r\n\r\nTerminusUI.prototype.redrawMainPage = function(){\r\n\tHTMLHelper.removeChildren(this.mainDOM);\r\n\tif(this.viewer && this.mainDOM){\r\n\t\tvar x = this.viewer.getAsDOM();\r\n\t\tthis.mainDOM.appendChild(x);\r\n\t}\r\n}\r\n\r\nTerminusUI.prototype.deleteDBPermitted = function(dbid){\r\n\tif(dbid == \"terminus\") return false;\r\n\tif(this.client.connection.capabilitiesPermit(\"delete_database\", dbid)){\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusUI.prototype.getDeleteDBButton = function(dbid){\r\n\tif(!this.deleteDBPermitted(dbid)) return false;\r\n\t//var delbut = document.createElement('button');\r\n\tvar icon = document.createElement('i');\r\n\ticon.setAttribute(\"class\", \"terminus-db-list-del-icon fa fa-trash\");\r\n\t//delbut.appendChild(icon);\r\n\t//delbut.appendChild(document.createTextNode(\"Delete Database\"));\r\n\t//delbut.setAttribute(\"class\", \"terminus-control-button terminus-delete-db-button\");\r\n\t\t// function to fix db in a closure\r\n\tvar self = this;\r\n\tvar delDB = function(db){\r\n\t\treturn function(){\r\n\t\t\tlet deleteConfirm = confirm(`This action is irreversible, it will remove the database from the system permanently. Are you sure you want to delete ${db} Database?`);\r\n\t\t\tif (deleteConfirm == true) {\r\n\t\t\t\tself.deleteDatabase(db);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\ticon.addEventListener(\"click\", delDB(dbid));\r\n\treturn icon;\r\n}\r\n\r\nTerminusUI.prototype.showResult = function(response){\r\n\tthis.showMessage(response, \"success\");\r\n};\r\n\r\nTerminusUI.prototype.showError = function(response){\r\n\tthis.showMessage(response, \"error\");\r\n};\r\n\r\nTerminusUI.prototype.showWarning = function(response){\r\n\tthis.showMessage(response, \"warning\");\r\n};\r\n\r\n\r\nTerminusUI.prototype.clearMessages = function(response){\r\n\tif(this.messages) HTMLHelper.removeChildren(this.messages);\r\n};\r\n\r\nTerminusUI.prototype.clearMainPage = function(){\r\n\tif(this.main) HTMLHelper.removeChildren(this.main);\r\n}\r\n\r\nTerminusUI.prototype.setMessageDOM = function(dom){\r\n\tthis.messages = dom;\r\n}\r\n\r\nTerminusUI.prototype.setbuttonControls = function(dom){\r\n\tthis.buttons = dom;\r\n}\r\n\r\nTerminusUI.prototype.setControllerDOM = function(dom){\r\n\tthis.controller = dom;\r\n}\r\n\r\nTerminusUI.prototype.setExplorerDOM = function(dom){\r\n\tthis.explorer = dom;\r\n}\r\n\r\nTerminusUI.prototype.setPluginsDOM = function(dom){\r\n\tthis.plugins = dom;\r\n}\r\n\r\nTerminusUI.prototype.setViewerDOM = function(dom){\r\n\tthis.mainDOM = dom;\r\n}\r\n\r\nTerminusUI.prototype.draw = function(comps, slocation){\r\n\tif(comps && comps.viewer) this.setViewerDOM(comps.viewer);\r\n\tif(comps && comps.buttons) this.setbuttonControls(comps.buttons);\r\n\tif(comps && comps.messages) this.setMessageDOM(comps.messages);\r\n\tif(comps && comps.controller) this.setControllerDOM(comps.controller);\r\n\t//if(comps && comps.explorer) this.setExplorerDOM(comps.explorer);\r\n\tif(comps && comps.plugins) this.setPluginsDOM(comps.plugins);\r\n\tif(this.plugins){\r\n\t\tthis.drawPlugins();\r\n\t}\r\n\tif(this.buttons){\r\n\t\t//this.toggleControl();\r\n\t}\r\n\tvar self = this;\r\n\tvar cdrawn = false;\r\n\tif(slocation && slocation.server){\r\n\t\tif(typeof this.client.connection.connection[slocation.server] == \"undefined\") {\r\n\t\t\treturn this.connect(slocation)\r\n\t\t\t.catch(function(error){\r\n\t\t\t\tself.showLoadURLPage();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis.showLoadURLPage();\r\n\t};\r\n}\r\n\r\nTerminusUI.prototype.redraw = function(msg){\r\n\tthis.clearMessages();\r\n\tthis.redrawControls();\r\n\tif(this.explorer){\r\n\t\tHTMLHelper.removeChildren(this.explorer);\r\n\t\t//this.drawExplorer();\r\n\t}\r\n\tif(this.viewer){\r\n\t\tthis.redrawMainPage();\r\n\t}\r\n\tif(msg) this.showMessage(msg);\r\n};\r\n\r\n\r\nTerminusUI.prototype.toggleDashboardWidget = function(widget){\r\n    HTMLHelper.removeChildren(this.controller);\r\n    HTMLHelper.removeChildren(this.explorer);\r\n    UTILS.removeSelectedNavClass('terminus-dashboard-selected');\r\n    widget.classList.add('terminus-dashboard-selected');\r\n}\r\n\r\nTerminusUI.prototype.toggleControl = function(){\r\n /* var self = this;\r\n  this.buttons.client.addEventListener('click', function(){\r\n    self.toggleDashboardWidget(this);\r\n    self.drawControls();\r\n    self.showServerMainPage();\r\n  })\r\n  this.buttons.explorer.addEventListener('click', function(){\r\n    self.toggleDashboardWidget(this);\r\n    self.drawExplorer();\r\n  })*/\r\n}\r\n\r\nTerminusUI.prototype.redrawControls = function(){\r\n\tif(this.controller){\r\n\t\tHTMLHelper.removeChildren(this.controller);\r\n\t\tthis.drawControls();\r\n\t}\r\n}\r\n\r\nTerminusUI.prototype.drawControls = function(){\r\n\tthis.controls = [];\r\n\tthis.loadControls();\r\n\tfor(var i = 0; i<this.controls.length; i++){\r\n\t\tvar ncontrol = this.controls[i];\r\n\t\tif(ncontrol && (nd = ncontrol.getAsDOM())){\r\n\t\t\tthis.controller.appendChild(nd);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusUI.prototype.drawExplorer = function(){\r\n\tif(this.explorer){\r\n\t\tif(this.showControl(\"api_explorer\")){\r\n\t\t\tvar exp = new ApiExplorer(this);\r\n\t\t\tae = exp.getAsDOM();\r\n\t\t\tthis.explorer.appendChild(ae);\r\n\t\t\tthis.explorer.style.display = 'block';\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusUI.prototype.loadControls = function(){\r\n\tif(this.showControl('server')){\r\n\t\tvar sc = new TerminusServersdk.TerminusServerController(this);\r\n\t\tif(sc) {\r\n\t\t\tthis.controls.push(sc);\r\n\t\t}\r\n\t\tif(this.db() && this.showControl(\"db\")){\r\n\t\t\tvar sc = new TerminusDBsdk.TerminusDBController(this);\r\n\t\t\tif(sc) this.controls.push(sc);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusUI.prototype.showControl = function(el){\r\n\tif(this.show_controls.indexOf(el) == -1) return false;\r\n\tif(this.pseudoCapability(el)) return true;\r\n\tif(this.client.connection.capabilitiesPermit(el)) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusUI.prototype.showView = function(el){\r\n\tif(this.show_views.indexOf(el) == -1) return false;\r\n\tif(this.pseudoCapability(el)) return true;\r\n\tif(this.client.connection.capabilitiesPermit(el)) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusUI.prototype.clearBusy = function(response){\r\n\tthis.clearMessages();\r\n\tif(this.viewer && typeof this.viewer.busy == \"function\") this.viewer.busy(false);\r\n}\r\n\r\nTerminusUI.prototype.getBusyLoader = function(bsyDom){\r\n     var pd = document.createElement('div');\r\n     var pbc = document.createElement('div');\r\n     pbc.setAttribute('class', 'term-progress-bar-container');\r\n     pd.appendChild(pbc);\r\n\r\n     var pbsa = document.createElement('div');\r\n     pbsa.setAttribute('class', 'term-progress-bar term-stripes animated reverse slower');\r\n     pbc.appendChild(pbsa);\r\n     var pbia = document.createElement('span');\r\n     pbia.setAttribute('class', 'term-progress-bar-inner');\r\n     pbsa.appendChild(pbia);\r\n\r\n     bsyDom.appendChild(pd);\r\n}\r\n\r\nTerminusUI.prototype.showMessage = function(msg, type){\r\n\tif(this.messages){\r\n\t\tHTMLHelper.removeChildren(this.messages);\r\n\t\tvar md = document.createElement('div');\r\n        switch(type){\r\n            case 'busy':\r\n                var msgHolder = document.createElement('div');\r\n                msgHolder.setAttribute('class', 'terminus-busy-msg')\r\n                msgHolder.appendChild(document.createTextNode(msg));\r\n                md.appendChild(msgHolder);\r\n                this.getBusyLoader(md);\r\n            break;\r\n            case 'success':\r\n                md.setAttribute('class', 'terminus-show-msg-success');\r\n                md.appendChild(document.createTextNode(msg));\r\n            break;\r\n            case 'error':\r\n                md.setAttribute('class', 'terminus-show-msg-error');\r\n                md.appendChild(document.createTextNode(msg));\r\n            break;\r\n            case 'info':\r\n                md.setAttribute('class', 'terminus-show-msg-info');\r\n                md.appendChild(document.createTextNode(msg));\r\n            break;\r\n            case 'warning':\r\n                md.setAttribute('class', 'terminus-show-msg-warning');\r\n                md.appendChild(document.createTextNode(msg));\r\n            break;\r\n        }\r\n\t\tthis.messages.appendChild(md);\r\n\t}\r\n};\r\n\r\nTerminusUI.prototype.showViolations = function(vios, type){\r\n\tvar nvios = new TerminusViolations(vios, this);\r\n\tif(this.messages){\r\n\t\tvar cmsg = (type == \"schema\" ? \" in Schema\" : \" in Document\");\r\n\t\tHTMLHelper.removeChildren(this.messages);\r\n\t\tthis.messages.appendChild(nvios.getAsDOM(cmsg));\r\n\t}\r\n}\r\n\r\nTerminusUI.prototype.showBusy = function(msg){\r\n\tthis.showMessage(msg, \"busy\");\r\n\tif(this.viewer && typeof this.viewer.busy == \"function\") this.viewer.busy(msg);\r\n};\r\n\r\nTerminusUI.prototype.pseudoCapability = function(el){\r\n\tvar pseuds = [\"server\", \"db\", \"collaborate\", \"change-server\", \"api_explorer\", \"import_schema\", \"add_new_library\"];\r\n\tif(pseuds.indexOf(el) == -1) return false;\r\n\treturn true;\r\n}\r\n\r\nTerminusUI.prototype.setOptions = function(opts){\r\n\tthis.show_controls = opts && opts.controls ? opts.controls :\r\n\t\t[\"server\", \"db\", \"change-server\", \"schema_format\",\r\n\t\t\t\"import_schema\", \"class_frame\", \"create_database\",\r\n\t\t\t\"collaborate\", \"get_document\", \"update_schema\",\r\n\t\t\t\"get_schema\", \"woql_select\"\r\n\t\t];\r\n\tthis.show_views = opts && opts.views ? opts.views : this.show_controls;\r\n\tif(opts.document){\r\n\t\tthis.document_options = opts.document;\r\n\t}\r\n\tif(opts.schema){\r\n\t\tthis.schema_options = opts.schema;\r\n\t}\r\n\tthis.piman = new TerminusPluginManager();\r\n\tvar self = this;\r\n\tthis.piman.init(opts.plugins, function(){\r\n\t\t/*var pins = [\"gmaps\", \"quill\", \"select2\"];\r\n\t\tfor(var i = 0; i<pins.length; i++){\r\n\t\t\tif(self.piman.pluginAvailable(pins[i])){\r\n\t\t\t\t//RenderingMap.addPlugin(pins[i]);\r\n\t\t\t}\r\n\t\t}*/\r\n\t\t//self.redraw();\r\n\t});\r\n\tif(opts.css && this.piman){\r\n\t\tthis.piman.loadPageCSS(opts.css);\r\n\t}\r\n\tthis.loadControls();\r\n}\r\n\r\nTerminusUI.prototype.pluginAvailable = function(p){\r\n\treturn this.piman.pluginAvailable(p);\r\n}\r\n\r\nTerminusUI.prototype.drawPlugins = function(){\r\n\tif(!this.piman) {\r\n\t\tconsole.log(new Error(\"No plugin manager initialised in UI object\"));\r\n\t\treturn false;\r\n\t}\r\n\tthis.plugins.appendChild(this.piman.getAsDOM(this));\r\n}\r\n\r\nTerminusUI.prototype.getDocViewerOptions = function(){\r\n\tif(this.document_options && this.document_options['view']){\r\n\t\treturn this.document_options['view'];\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusUI.prototype.getDocCreatorOptions = function(){\r\n\tif(this.document_options && this.document_options['view']){\r\n\t\treturn this.document_options['view'];\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusUI.prototype.getClassFrameOptions = function(){\r\n\treturn this.viewdoc_options;\r\n}\r\n\r\nmodule.exports=TerminusUI\r\n","/**\r\n * @file Javascript Api explorer tool\r\n * @author Kitty Jose\r\n * @license Copyright 2018-2019 Data Chemist Limited, All Rights Reserved. See LICENSE file for more\r\n *\r\n * @summary Displays a demo and description of api calls from WOQLCLient and what happens under the hood of api calls\r\n */\r\nconst TerminusPluginManager = require('./plugins/TerminusPlugin');\r\nconst UTILS = require('./Utils');\r\nconst TerminusClient = require('@terminusdb/terminus-client');\r\nconst HTMLHelper = require('./html/HTMLHelper');\r\n\r\nlet apiNavConfig = {\r\n    mainNav: {\r\n        connect: {\r\n    \t\tnavText: 'Connect API',\r\n            action : 'connect',\r\n            icon   : 'link',\r\n            defaultSelected: true\r\n    \t},\r\n        database: {\r\n            navText: 'Database API',\r\n            action : 'create',\r\n            icon   : 'database'\r\n        },\r\n        schema: {\r\n            navText: 'Schema API',\r\n            action : 'schema',\r\n            icon   : 'cog'\r\n        },\r\n        document: {\r\n            navText: 'Document API',\r\n            action : 'document',\r\n            icon   : 'file'\r\n        },\r\n        query: {\r\n            navText: 'Query API',\r\n            action : 'query',\r\n            icon   : 'search'\r\n        }\r\n    },\r\n    subNav: {\r\n        database: {\r\n            createDatabase: {\r\n                navText: 'Create database',\r\n                action : 'create',\r\n                icon   : 'plus',\r\n                defaultSelected: true\r\n            },\r\n            deleteDatabase: {\r\n                navText: 'Delete database',\r\n                action : 'delete',\r\n                icon   : 'trash-alt'\r\n            }\r\n        },\r\n        schema: {\r\n            getSchema: {\r\n                navText: 'View Schema',\r\n                action : 'getSchema',\r\n                icon   : 'eye',\r\n                defaultSelected: true\r\n            },\r\n            updateSchema: {\r\n                navText: 'Update Schema',\r\n                action : 'updateSchema',\r\n                icon   : 'arrow-up'\r\n            },\r\n            getClassFrames: {\r\n                navText: 'Get Class Frames',\r\n                action : 'getClassFrames',\r\n                icon   : 'share-alt'\r\n            }\r\n        },\r\n        document: {\r\n            viewDocument: {\r\n        \t\tnavText: 'View Document',\r\n                action : 'viewDocument',\r\n                icon   : 'eye',\r\n                defaultSelected: true\r\n        \t},\r\n            createDocument: {\r\n                navText: 'Create Document',\r\n                action : 'createDocument',\r\n                icon   : 'plus'\r\n            },\r\n            updateDocument: {\r\n                navText: 'Update Document',\r\n                action : 'updateDocument',\r\n                icon   : 'arrow-up'\r\n            },\r\n            deleteDocument:{\r\n                navText: 'Delete Document',\r\n                action : 'deleteDocument',\r\n                icon   : 'trash-alt'\r\n            }\r\n        },\r\n        query: {\r\n            select: {\r\n                navText: 'Select',\r\n                action : 'select',\r\n                icon   : 'mouse-pointer',\r\n                defaultSelected: true\r\n            },\r\n            update: {\r\n                navText: 'Update',\r\n                action : 'update',\r\n                icon   : 'arrow-up'\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction ApiExplorer(ui){\r\n    this.ui = ui;\r\n    this.viewer = ui.mainDOM;\r\n    this.client = new TerminusClient.WOQLClient();\r\n    this.client.use_fetch = true;\r\n    this.client.return_full_response = true;\r\n    this.pman = new TerminusPluginManager();\r\n}\r\n\r\n// Controller provides access to Api explorer functions\r\nApiExplorer.prototype.getAsDOM = function(){\r\n \tvar aec = document.createElement(\"div\");\r\n    aec.setAttribute(\"class\", \"terminus-db-controller\");\r\n    if(this.ui){\r\n       this.getApiNav(aec, this.viewer); // nav\r\n       this.getApiExplorerDom('connect', this.viewer); // content dom\r\n    } // if this.ui\r\n    return aec;\r\n }\r\n\r\n/***** Api Nav bar *****/\r\n// Toggle selected nav bars\r\nApiExplorer.prototype.setSelectedNavMenu = function(a){\r\n    UTILS.removeSelectedNavClass(\"terminus-selected\");\r\n    a.classList.add(\"terminus-selected\");\r\n}\r\n\r\nApiExplorer.prototype.navOnSelect = function(action, nav, viewer){\r\n    UTILS.removeSelectedNavClass(\"terminus-selected\");\r\n    nav.classList.add(\"terminus-selected\");\r\n    this.getApiExplorerDom(action, viewer);\r\n}\r\n\r\n// create nav bars\r\nApiExplorer.prototype.createNavs = function(navConfig, viewer, ul){\r\n    var a = document.createElement('a');\r\n    a.setAttribute('class', 'terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n    if(navConfig.defaultSelected) a.classList.add('terminus-selected');\r\n    var self = this;\r\n    a.addEventListener(\"click\", function(){\r\n        self.navOnSelect(navConfig.action, this, viewer);\r\n    })\r\n    var icon = document.createElement('i');\r\n    icon.setAttribute('class', 'terminus-menu-icon fa fa-' + navConfig.icon);\r\n    a.appendChild(icon);\r\n    var txt = document.createTextNode(navConfig.navText);\r\n    a.appendChild(txt);\r\n    ul.appendChild(a);\r\n}\r\n\r\n// gets api nav bar\r\nApiExplorer.prototype.getApiNav = function(navDom, viewer){\r\n    // list view of apis\r\n    var nav = document.createElement('div');\r\n    navDom.appendChild(nav);\r\n    // connect to server api\r\n    var ul = document.createElement('ul');\r\n    ul.setAttribute('class', 'terminus-ul');\r\n    nav.appendChild(ul);\r\n    // loop over apiNavConfig\r\n    for (var key in apiNavConfig.mainNav){\r\n        if (apiNavConfig.mainNav.hasOwnProperty(key)) {\r\n            this.createNavs(apiNavConfig.mainNav[key], viewer, ul);\r\n        }\r\n    } // for apiNavConfig\r\n    return navDom;\r\n} // getApiNav()\r\n\r\n/***** Api sub navs  *****/\r\n// get schema api explorer - nav bar, alert msg, headers ...\r\nApiExplorer.prototype.getApiExplorerDom = function(view, viewer){\r\n    // clear of viewer\r\n    HTMLHelper.removeChildren(viewer);\r\n    // wrapper\r\n    var wrap = document.createElement('div');\r\n    //wrap.setAttribute('class', 'terminus-wrapper terminus-wrapper-height');\r\n    viewer.appendChild(wrap);\r\n    var cont = document.createElement('div');\r\n    cont.setAttribute('class', 'container-fluid');\r\n    wrap.appendChild(cont);\r\n    var row = document.createElement('div');\r\n    row.setAttribute('class', 'row-fluid');\r\n    cont.appendChild(row);\r\n    var body = document.createElement('div');\r\n    body.setAttribute('class', 'terminus-module-body');\r\n    row.appendChild(body);\r\n    var api = document.createElement('div');\r\n    api.setAttribute('class', 'terminus-module-body terminus-module-body-white-bg terminus-module-body-width');\r\n    body.appendChild(api);\r\n    // body\r\n    var cont = document.createElement('div');\r\n    var self = this;\r\n    switch(view){\r\n        case 'connect':\r\n            var apiCont = self.getConnectExplorer(cont);\r\n            api.appendChild(apiCont);\r\n        break;\r\n        case 'create':\r\n            var apiCont = self.getDatabaseExplorer(cont);\r\n            api.appendChild(apiCont);\r\n        break;\r\n        case 'schema':\r\n            var apiCont = self.getSchemaApi(cont);\r\n            api.appendChild(apiCont);\r\n        break;\r\n        case 'document':\r\n            var apiCont = self.getDocumentApi(cont);\r\n            api.appendChild(apiCont);\r\n        break;\r\n        case 'query':\r\n            var apiCont = self.getQueryApi(cont);\r\n            api.appendChild(apiCont);\r\n        break;\r\n    }// switch(api)\r\n    return wrap;\r\n} // getApiExplorerDom\r\n\r\n// on trigger of click event - change dom\r\nApiExplorer.prototype.changeSubApiDom = function(curSubMenu, action, cont, body){\r\n    HTMLHelper.removeChildren(body);\r\n    switch(curSubMenu){\r\n        case 'database':\r\n            var dom = this.getDatabaseDom(action, body);\r\n        break;\r\n        case 'schema':  // getShowApiDom() deals with schema and document\r\n             var dom = this.getShowApiDom(action, body);\r\n        break;\r\n        case 'document': // getShowApiDom() deals with schema and document\r\n             var dom = this.getShowApiDom(action, body);\r\n        break;\r\n        case 'query':\r\n            var dom = this.getQueryApiDom(action, body);\r\n        break;\r\n        default:\r\n            console.log('Invalid Api Config');\r\n        break;\r\n    }\r\n    cont.appendChild(dom);\r\n}\r\n\r\nApiExplorer.prototype.subNavOnSelect = function(curSubMenu, subMenuConfig, subNav, cont, body){\r\n    UTILS.setSelectedSubMenu(subNav);\r\n    this.changeSubApiDom(curSubMenu, subMenuConfig.action, cont, body);\r\n}\r\n\r\n// create sub nav bars\r\nApiExplorer.prototype.createSubNavs = function(curSubMenu, subMenuConfig, cont, body, ul){\r\n    // comment getclassframes for api explorer time being\r\n    if(subMenuConfig.action == 'getClassFrames') return;\r\n    var a = document.createElement('a');\r\n    a.setAttribute('class', 'terminus-a terminus-hz-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n    if(subMenuConfig.defaultSelected) a.classList.add('terminus-submenu-selected');\r\n    var self = this;\r\n    a.addEventListener(\"click\", function() {\r\n        self.subNavOnSelect(curSubMenu, subMenuConfig, this, cont, body);\r\n    })\r\n    var icon = document.createElement('i');\r\n    icon.setAttribute('class', 'terminus-menu-icon fa fa-' + subMenuConfig.icon);\r\n    a.appendChild(icon);\r\n    var txt = document.createTextNode(subMenuConfig.navText);\r\n    a.appendChild(txt);\r\n    ul.appendChild(a);\r\n}\r\n\r\n// get connect to server api calls - on click of connectAPI nav bar\r\nApiExplorer.prototype.getConnectExplorer = function(body){\r\n    var self = this;\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    // get signature\r\n    var b = this.getSignature('connect');\r\n    body.appendChild(b);\r\n    // get header Parameter\r\n    body.appendChild(UTILS.getHeaderDom('Parameters'));\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    //form to get server url\r\n    this.getForm( '', body, true, 'connect', 'URL : server_url');\r\n    //body.appendChild(form);\r\n    return body;\r\n} // getConnectExplorer\r\n\r\n// get database api calls - on click of databaseAPI nav bar - submenus of database Api defined here\r\nApiExplorer.prototype.getDatabaseExplorer = function(cont){\r\n    var body = document.createElement('div');\r\n    // list view of Databse tools\r\n    var ul = document.createElement('ul');\r\n    ul.setAttribute('class','terminus-ul-horizontal');\r\n    // loop over apiNavConfig\r\n    for (var key in apiNavConfig.subNav.database){\r\n        if (apiNavConfig.subNav.database.hasOwnProperty(key))\r\n            this.createSubNavs('database', apiNavConfig.subNav.database[key], cont, body, ul);\r\n    } // for apiNavConfig\r\n    cont.appendChild(ul);\r\n    // landing page\r\n    var dom = this.getDatabaseDom(apiNavConfig.subNav.database.createDatabase.action, body);\r\n    cont.appendChild(dom);\r\n    return cont;\r\n} // getDatabaseExplorer\r\n\r\n// get schema api calls - on click of SchemaAPI nav bar - submenus of schema Api defined here\r\nApiExplorer.prototype.getSchemaApi = function(cont){\r\n    var body = document.createElement('div');\r\n    // list view of Databse tools\r\n    var ul = document.createElement('ul');\r\n    ul.setAttribute('class','terminus-ul-horizontal');\r\n    // loop over apiNavConfig\r\n    for (var key in apiNavConfig.subNav.schema){\r\n        if (apiNavConfig.subNav.schema.hasOwnProperty(key)) {\r\n            this.createSubNavs('schema', apiNavConfig.subNav.schema[key], cont, body, ul);\r\n        }\r\n    } // for apiNavConfig\r\n    cont.appendChild(ul);\r\n    var dom = this.getShowApiDom(apiNavConfig.subNav.schema.getSchema.action, body);\r\n    cont.appendChild(dom);\r\n    return cont;\r\n} // getSchemaApi\r\n\r\n// get document api calls - on click of DocumentAPI nav bar\r\nApiExplorer.prototype.getDocumentApi = function(cont){\r\n    var body = document.createElement('div');\r\n    // list view of Databse tools\r\n    var ul = document.createElement('ul');\r\n    ul.setAttribute('class','terminus-ul-horizontal');\r\n    // loop over apiNavConfig\r\n    for (var key in apiNavConfig.subNav.document){\r\n        if (apiNavConfig.subNav.document.hasOwnProperty(key)) {\r\n            this.createSubNavs('document', apiNavConfig.subNav.document[key], cont, body, ul);\r\n        }\r\n    } // for apiNavConfig\r\n    cont.appendChild(ul);\r\n    var dom = this.getShowApiDom(apiNavConfig.subNav.document.viewDocument.action, body);\r\n    cont.appendChild(dom);\r\n    return cont;\r\n} // getDocumentApi\r\n\r\n// get query api calls - on click of QueryAPI nav bar - submenus of Query Api defined here\r\nApiExplorer.prototype.getQueryApi  = function(cont){\r\n    var body = document.createElement('div');\r\n    // list view of Databse tools\r\n    var ul = document.createElement('ul');\r\n    ul.setAttribute('class','terminus-ul-horizontal');\r\n    // loop over apiNavConfig\r\n    for (var key in apiNavConfig.subNav.query){\r\n        if (apiNavConfig.subNav.query.hasOwnProperty(key)) {\r\n            this.createSubNavs('query', apiNavConfig.subNav.query[key], cont, body, ul);\r\n        }\r\n    } // for apiNavConfig\r\n    cont.appendChild(ul);\r\n    var dom = this.getQueryApiDom(apiNavConfig.subNav.query.select.action, body);\r\n    cont.appendChild(dom);\r\n    return cont;\r\n} //getQueryApi\r\n\r\n/***** Api Content view  *****/\r\n// get database dom\r\nApiExplorer.prototype.getDatabaseDom = function(mode, body){\r\n    var self = this;\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    // get signature\r\n    var b = this.getSignature(mode);\r\n    body.appendChild(b);\r\n    // get header Parameter\r\n    body.appendChild(UTILS.getHeaderDom('Parameters'));\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    //form to get database id\r\n    if(mode == 'create') this.getForm( null, body, false, mode, 'URL : server/database_id');\r\n    else this.getForm( null, body, true, mode, 'URL : server/database_id');\r\n    return body;\r\n} // getConnectExplorer\r\n\r\n//get create & delete db form\r\nApiExplorer.prototype.getServerForm = function(){\r\n  // form\r\n  var form = document.createElement('form');\r\n  form.setAttribute('class', 'terminus-form-horizontal row-fluid');\r\n\r\n  var fd = document.createElement('div');\r\n  fd.setAttribute('class', 'terminus-control-group');\r\n  form.appendChild(fd);\r\n  var inpLabel = document.createElement('label');\r\n  inpLabel.setAttribute('class', 'terminus-control-label');\r\n  inpLabel.setAttribute('for', 'basicinput');\r\n  inpLabel.innerHTML = 'Url:';\r\n  fd.appendChild(inpLabel);\r\n  var cd = document.createElement('div');\r\n  cd.setAttribute('class', 'terminus-controls');\r\n  fd.appendChild(cd);\r\n  var inpId = document.createElement('input');\r\n  inpId.setAttribute('type', 'text');\r\n  inpId.setAttribute('id', 'basicinput');\r\n  inpId.setAttribute('class', 'terminus-input-text');\r\n  inpId.setAttribute('placeholder', 'URL : server_url');\r\n  if(this.val) inpId.value = this.val;\r\n  cd.appendChild(inpId);\r\n\r\n  var fd = document.createElement('div');\r\n  fd.setAttribute('class', 'terminus-control-group');\r\n  form.appendChild(fd);\r\n  var keyLabel = document.createElement('label');\r\n  keyLabel.setAttribute('class', 'terminus-control-label');\r\n  keyLabel.setAttribute('for', 'basicinput');\r\n  keyLabel.innerHTML = 'Key:';\r\n  fd.appendChild(keyLabel);\r\n  var cd = document.createElement('div');\r\n  cd.setAttribute('class', 'terminus-controls');\r\n  fd.appendChild(cd);\r\n  var key = document.createElement('input');\r\n  key.setAttribute('type', 'text');\r\n  key.setAttribute('id', 'basicinput');\r\n  key.setAttribute('class', 'span8 terminus-input-text');\r\n  key.setAttribute('placeholder', 'Key : key');\r\n  if(this.val) key.value = this.val;\r\n  cd.appendChild(key);\r\n\r\n  var button = document.createElement('button');\r\n  button.setAttribute('class', 'terminus-btn terminus-send-api-btn');\r\n  button.setAttribute('type', 'button');\r\n  button.innerHTML = 'Send Api';\r\n  var gatherips = function(){\r\n    var input = {};\r\n    input.url = inpId.value;\r\n    input.key = key.value;\r\n    return input;\r\n  }\r\n  var resd = document.createElement('div');\r\n  form.appendChild(button);\r\n  form.appendChild(resd);\r\n  var self = this;\r\n  button.addEventListener(\"click\", function(){\r\n    var buttonSelf = this;\r\n    //opts = {};\r\n    var input = gatherips();\r\n    self.client.connect(input.url, input.key)\r\n    .then(function(response){\r\n      HTMLHelper.removeChildren(resd);\r\n      var resultDom = UTILS.showHttpResult(response, 'connect', resd, self.ui);\r\n    });\r\n  }) // button click\r\n  return form;\r\n} // getServerForm()\r\n\r\n// get database api calls - on click of databaseAPI nav bar - submenus of database Api defined here\r\nApiExplorer.prototype.getDatabaseExplorer = function(cont){\r\n  var body = document.createElement('div');\r\n  // list view of Databse tools\r\n  var ul = document.createElement('ul');\r\n  ul.setAttribute('class','terminus-ul-horizontal');\r\n  // loop over apiNavConfig\r\n  for (var key in apiNavConfig.subNav.database){\r\n      if (apiNavConfig.subNav.database.hasOwnProperty(key)) {\r\n          this.createSubNavs('database', apiNavConfig.subNav.database[key], cont, body, ul);\r\n      }\r\n  } // for apiNavConfig\r\n  cont.appendChild(ul);\r\n  // landing page\r\n  var dom = this.getDatabaseDom(apiNavConfig.subNav.database.createDatabase.action, body);\r\n  cont.appendChild(dom);\r\n  return cont;\r\n} // getDatabaseExplorer\r\n\r\n\r\n// get schema & document dom\r\nApiExplorer.prototype.getShowApiDom = function(action, body){\r\n    var self = this;\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    // signature\r\n    var b = this.getSignature(action);\r\n    body.appendChild(b);\r\n    // get header Parameter\r\n    body.appendChild(UTILS.getHeaderDom('Parameters'));\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    // get input\r\n    switch(action){\r\n        case 'getSchema':\r\n            this.getForm( 'schema', body, true, action, 'URL : server/database_id');\r\n        break;\r\n        case 'getClassFrames':\r\n            this.getForm( 'getClassFrames', body, true, action, 'URL : server/database_id');\r\n        break;\r\n        case 'updateSchema':\r\n            this.getForm( 'schema', body, false, action, 'URL : server/database_id');\r\n        break;\r\n        case 'viewDocument':\r\n            this.getForm('document', body, true, action, 'URL : server/database_id/document/document_id');\r\n        break;\r\n        case 'deleteDocument':\r\n            this.getForm('document', body, true, action, 'URL : server/database_id/document/document_id');\r\n        break;\r\n        case 'createDocument':\r\n            this.getForm('document', body, false, action, 'URL : server/database_id/document/document_id');\r\n        break;\r\n        case 'updateDocument':\r\n            this.getForm('document', body, false, action, 'URL : server/database_id/document/document_id');\r\n        break;\r\n        default:\r\n            console.log('Invalid Api Call on form');\r\n        break;\r\n   }// switch(action)\r\n\r\n   return body;\r\n } // getShowApiDom()\r\n\r\n// get query api dom\r\nApiExplorer.prototype.getQueryApiDom = function(action, body){\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    // signature\r\n    var b = this.getSignature(action);\r\n    body.appendChild(b);\r\n    // get header Parameter\r\n    body.appendChild(UTILS.getHeaderDom('Parameters'));\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    this.getForm( 'query', body, false, action, 'URL : server/database_id');\r\n    return body;\r\n} // getQueryApiDom\r\n\r\n/*ApiExplorer.prototype.getClassFramesForm = function(){\r\n    // form\r\n    var form = document.createElement('form');\r\n    form.setAttribute('class', 'terminus-form-horizontal row-fluid');\r\n    var fd = document.createElement('div');\r\n    fd.setAttribute('class', 'terminus-control-group');\r\n    form.appendChild(fd);\r\n    var inpLabel = document.createElement('label');\r\n    inpLabel.setAttribute('class', 'terminus-control-label');\r\n    inpLabel.setAttribute('for', 'basicinput');\r\n    inpLabel.innerHTML = 'Url:';\r\n    fd.appendChild(inpLabel);\r\n    var cd = document.createElement('div');\r\n    cd.setAttribute('class', 'terminus-controls');\r\n    fd.appendChild(cd);\r\n    var inpUrl = document.createElement('input');\r\n    inpUrl.setAttribute('type', 'text');\r\n    inpUrl.setAttribute('id', 'basicinput');\r\n    inpUrl.setAttribute('class', 'span8 terminus-input-text');\r\n    inpUrl.setAttribute('placeholder', 'URL : database_url');\r\n    if(this.val) inpUrl.value = this.val;\r\n    cd.appendChild(inpUrl);\r\n    var fd = document.createElement('div');\r\n    fd.setAttribute('class', 'terminus-control-group');\r\n    form.appendChild(fd);\r\n    var inpLabel = document.createElement('label');\r\n    inpLabel.setAttribute('class', 'terminus-control-label');\r\n    inpLabel.setAttribute('for', 'basicinput');\r\n    inpLabel.innerHTML = 'Url/ ID:';\r\n    fd.appendChild(inpLabel);\r\n    var cd = document.createElement('div');\r\n    cd.setAttribute('class', 'terminus-controls');\r\n    fd.appendChild(cd);\r\n    var inpDocUrl = document.createElement('input');\r\n    inpDocUrl.setAttribute('type', 'text');\r\n    inpDocUrl.setAttribute('id', 'basicinput');\r\n    inpDocUrl.setAttribute('class', 'span8 terminus-input-text');\r\n    inpDocUrl.setAttribute('placeholder', 'Url or ID of document class');\r\n    cd.appendChild(inpDocUrl);\r\n    var fd = document.createElement('div');\r\n    fd.setAttribute('class', 'terminus-control-group');\r\n    form.appendChild(fd);\r\n    var optLabel = document.createElement('label');\r\n    optLabel.setAttribute('class', 'terminus-control-label');\r\n    optLabel.setAttribute('for', 'basicinput');\r\n    optLabel.innerHTML = 'Options:';\r\n    fd.appendChild(optLabel);\r\n    var cd = document.createElement('div');\r\n    cd.setAttribute('class', 'terminus-controls');\r\n    fd.appendChild(cd);\r\n    var optInp = document.createElement('input');\r\n    optInp.setAttribute('type', 'text');\r\n    optInp.setAttribute('id', 'basicinput');\r\n    optInp.setAttribute('class', 'span8 terminus-input-text');\r\n    optInp.setAttribute('placeholder', 'options');\r\n    cd.appendChild(optInp);\r\n    var button = document.createElement('button');\r\n    button.setAttribute('class', 'terminus-btn terminus-send-api-btn');\r\n    button.setAttribute('type', 'button');\r\n    button.innerHTML = 'Send Api';\r\n    var gatherips = function(){\r\n        var input = {};\r\n        input.url = inpUrl.value;\r\n        input.docUrl = inpDocUrl.value;\r\n        input.options = optInp.value;\r\n        return input;\r\n    }\r\n    var self = this;\r\n    button.addEventListener(\"click\", function(form){\r\n      var input = gatherips();\r\n      var buttonSelf = this;\r\n      opts = {};\r\n      opts.explorer = true;\r\n      self.client.getClassFrame(input.url, input.docUrl, opts)\r\n      .then(function(response){\r\n          var currForm = buttonSelf.parentNode;\r\n          var resultDom = UTILS.showHttpResult(response, 'getClassFrames', currForm, self.ui);\r\n      });\r\n    }) // button click\r\n    form.appendChild(button);\r\n    return form;\r\n}   */\r\n\r\n// get form for all Apis\r\nApiExplorer.prototype.getForm = function(curApi, body, view, action, urlPlaceholder){\r\n    // form\r\n    var formDoc = document.createElement('form');\r\n    formDoc.setAttribute('class', 'terminus-form-horizontal row-fluid');\r\n    var fd = document.createElement('div');\r\n    fd.setAttribute('class', 'terminus-control-group');\r\n    formDoc.appendChild(fd);\r\n    var urlLabel = document.createElement('label');\r\n    urlLabel.setAttribute('class', 'terminus-control-label');\r\n    urlLabel.setAttribute('for', 'basicinput');\r\n    urlLabel.innerHTML = 'Url:';\r\n    fd.appendChild(urlLabel);\r\n    var cd = document.createElement('div');\r\n    cd.setAttribute('class', 'terminus-controls');\r\n    fd.appendChild(cd);\r\n    var inpUrl = document.createElement('input');\r\n    inpUrl.setAttribute('type', 'text');\r\n    inpUrl.setAttribute('id', 'basicinput');\r\n    inpUrl.setAttribute('class', 'span8 terminus-input-text');\r\n    inpUrl.setAttribute('placeholder', urlPlaceholder);\r\n    cd.appendChild(inpUrl);\r\n    // add extra form fields based on current api chosen\r\n    switch(curApi){\r\n        case 'getClassFrames':\r\n            var fd = document.createElement('div');\r\n            fd.setAttribute('class', 'terminus-control-group');\r\n            formDoc.appendChild(fd);\r\n            var docUrlLabel = document.createElement('label');\r\n            docUrlLabel.setAttribute('class', 'terminus-control-label');\r\n            docUrlLabel.setAttribute('for', 'basicinput');\r\n            docUrlLabel.innerHTML = 'Url/ ID:';\r\n            fd.appendChild(docUrlLabel);\r\n            var cd = document.createElement('div');\r\n            cd.setAttribute('class', 'terminus-controls');\r\n            fd.appendChild(cd);\r\n            var inpDocUrl = document.createElement('input');\r\n            inpDocUrl.setAttribute('type', 'text');\r\n            inpDocUrl.setAttribute('id', 'basicinput');\r\n            inpDocUrl.setAttribute('class', 'span8 terminus-input-text');\r\n            inpDocUrl.setAttribute('placeholder', 'Url or ID of document class');\r\n            cd.appendChild(inpDocUrl);\r\n        break;\r\n        case 'schema':\r\n            //encoding\r\n           /* var fd = document.createElement('div');\r\n            fd.setAttribute('class', 'terminus-control-group');\r\n            formDoc.appendChild(fd);\r\n            var encLabel = document.createElement('label');\r\n            encLabel.setAttribute('class', 'terminus-control-label');\r\n            encLabel.setAttribute('for', 'basicinput');\r\n            encLabel.innerHTML = 'Encoding:';\r\n            fd.appendChild(encLabel);\r\n            var cd = document.createElement('div');\r\n            cd.setAttribute('class', 'terminus-controls');\r\n            fd.appendChild(cd);\r\n            var inpEnc = document.createElement('select');\r\n            inpEnc.setAttribute('style', 'height: 50px;width: 300px;padding: 10px;');\r\n            inpEnc.setAttribute('placeholder', 'turtle');\r\n            var optTurt = document.createElement('option');\r\n            optTurt.setAttribute('value', 'terminus:turtle');\r\n            optTurt.appendChild(document.createTextNode('turtle'));\r\n            inpEnc.appendChild(optTurt);\r\n            var optJld = document.createElement('option');\r\n            optJld.setAttribute('value', 'terminus:jsonld');\r\n            optJld.appendChild(document.createTextNode('jsonLD'));\r\n            inpEnc.appendChild(optJld);\r\n            cd.appendChild(inpEnc); */\r\n        break;\r\n    }\r\n    var fd = document.createElement('div');\r\n    fd.setAttribute('class', 'terminus-control-group');\r\n    formDoc.appendChild(fd);\r\n    var keyLabel = document.createElement('label');\r\n    keyLabel.setAttribute('class', 'terminus-control-label');\r\n    keyLabel.setAttribute('for', 'basicinput');\r\n    keyLabel.innerHTML = 'Key:';\r\n    fd.appendChild(keyLabel);\r\n    var cd = document.createElement('div');\r\n    cd.setAttribute('class', 'terminus-controls');\r\n    fd.appendChild(cd);\r\n    var inpKey = document.createElement('input');\r\n    inpKey.setAttribute('type', 'text');\r\n    inpKey.setAttribute('id', 'basicinput');\r\n    inpKey.setAttribute('class', 'span8 terminus-input-text');\r\n    inpKey.setAttribute('placeholder', 'Key');\r\n    cd.appendChild(inpKey);\r\n    if(!view){\r\n        // include text area only if call is type post\r\n        var fd = document.createElement('div');\r\n        fd.setAttribute('class', 'terminus-control-group');\r\n        formDoc.appendChild(fd);\r\n        var docLabel = document.createElement('label');\r\n        docLabel.setAttribute('class', 'terminus-control-label');\r\n        docLabel.setAttribute('for', 'basicinput');\r\n        if(curApi == 'query') docLabel.innerHTML = 'Query:';\r\n        docLabel.innerHTML = 'Document:';\r\n        fd.appendChild(docLabel);\r\n        var cd = document.createElement('div');\r\n        cd.setAttribute('class', 'terminus-controls');\r\n        fd.appendChild(cd);\r\n        var inpDoc = document.createElement('textarea');\r\n        cd.appendChild(inpDoc);\r\n        inpDoc.setAttribute('class', 'terminus-api-explorer-text-area');\r\n        UTILS.stylizeEditor(this.ui, inpDoc, 'api-doc', 'javascript');\r\n    }\r\n    body.appendChild(formDoc);\r\n    // gather inputs\r\n    var inp ={};\r\n    inp.url = inpUrl;\r\n    inp.key = inpKey;\r\n    if(curApi == 'getClassFrames') inp.docUrl = inpDocUrl;\r\n    //if(curApi == 'schema') inp.enc = inpEnc;\r\n    if(!view) inp.doc = inpDoc;\r\n    var form = this.getApiSendButton(action, inp);\r\n    body.appendChild(form);\r\n}\r\n\r\n// define event listeners on send api of schema & documents\r\n\r\nApiExplorer.prototype.getApiForm = function(action, input){\r\n  // form\r\n  var form = document.createElement('form');\r\n  form.setAttribute('class', 'terminus-form-horizontal row-fluid');\r\n\r\n  var button = document.createElement('button');\r\n  button.setAttribute('class', 'terminus-btn terminus-send-api-btn');\r\n  button.setAttribute('type', 'button');\r\n  button.innerHTML = 'Send Api';\r\n  form.appendChild(button);\r\n  var resd = document.createElement('div');\r\n  form.appendChild(resd);\r\n  var self = this;\r\n  switch(action){\r\n    case 'getSchema':\r\n      button.addEventListener(\"click\", function(){\r\n        var opts = {};\r\n        opts['terminus:encoding'] = input.enc.value;\r\n        opts['terminus:user_key'] = 'terminus:turtle';\r\n        var schurl = input.url.value;\r\n        var buttonSelf = this;\r\n        self.client.getSchema(schurl, opts)\r\n        .then(function(response){\r\n          HTMLHelper.removeChildren(resd);\r\n          var resultDom = UTILS.showHttpResult(response, 'getSchema', resd, self.ui);\r\n        });\r\n      }) // button click\r\n    break;\r\n    case 'updateSchema':\r\n      button.addEventListener(\"click\", function(){\r\n        var buttonSelf = this;\r\n        opts = {};\r\n        opts['terminus:encoding'] = input.enc.value;\r\n        opts['terminus:user_key'] = 'terminus:turtle';\r\n        var schurl = input.url.value;\r\n        self.client.connectionConfig.connected_mode = false;\r\n        self.client.updateSchema(schurl, input.doc.value, opts)\r\n        .then(function(response){\r\n          var gtxtar = document.createElement('textarea');\r\n          gtxtar.setAttribute('readonly', true);\r\n          gtxtar.innerHTML = response;\r\n          var currForm = buttonSelf.parentNode;\r\n          currForm.appendChild(gtxtar);\r\n          UTILS.stylizeEditor(this.ui, txtar, 'schema', 'turtle');\r\n        });\r\n      }) // button click\r\n    break;\r\n    case 'viewDocument':\r\n      button.addEventListener(\"click\", function(){\r\n      var dcurl = input.value;\r\n      var buttonSelf = this;\r\n      var opts = {};\r\n      opts.format = 'turtle';\r\n      self.client.getDocument(dcurl, opts)\r\n      .then(function(response){\r\n        HTMLHelper.removeChildren(resd);\r\n        var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n      });\r\n    }) // button click\r\n    break;\r\n    case 'deleteDocument':\r\n      button.addEventListener(\"click\", function(){\r\n      var dcurl = input.value;\r\n      var buttonSelf = this;\r\n      var opts = {};\r\n      self.client.deleteDocument(dcurl, opts)\r\n      .then(function(response){\r\n        HTMLHelper.removeChildren(resd);\r\n        var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n      });\r\n    }) // button click\r\n    break;\r\n    case 'createDocument':\r\n      button.addEventListener(\"click\", function(){\r\n        var dcurl = input.schemaUrlDom.value;\r\n        var payload = input.htmlEditor.getValue();\r\n        var buttonSelf = this;\r\n        opts = {};\r\n        self.client.createDocument(dcurl, payload, opts)\r\n        .then(function(response){\r\n          HTMLHelper.removeChildren(resd);\r\n          var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n        });\r\n      }) // button click\r\n    break;\r\n    case 'updateDocument':\r\n      button.addEventListener(\"click\", function(){\r\n        var dcurl = input.schemaUrlDom.value;\r\n        var payload = input.htmlEditor.getValue();\r\n        var buttonSelf = this;\r\n        opts = {};\r\n        opts.editmode = 'replace';\r\n        opts.format = 'json';\r\n        self.client.updateDocument(dcurl, payload, opts)\r\n        .then(function(response){\r\n          HTMLHelper.removeChildren(resd);\r\n          var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n        });\r\n      }) // button click\r\n    break;\r\n  } // switch(action)\r\n\r\n  var br = document.createElement('BR');\r\n  form.appendChild(br);\r\n  var br = document.createElement('BR');\r\n  form.appendChild(br);\r\n\r\n  return form;\r\n} // getApiForm()\r\n\r\n\r\n// define event listeners on send api of schema & documents\r\nApiExplorer.prototype.getApiSendButton = function(action, input){\r\n    // form\r\n    var form = document.createElement('form');\r\n    form.setAttribute('class', 'terminus-form-horizontal row-fluid');\r\n    var button = document.createElement('button');\r\n    button.setAttribute('class', 'terminus-btn terminus-send-api-btn');\r\n    button.setAttribute('type', 'button');\r\n    button.innerHTML = 'Send Api';\r\n    form.appendChild(button);\r\n    var resd = document.createElement('div');\r\n    form.appendChild(resd);\r\n    var self = this;\r\n    switch(action){\r\n        case 'connect':\r\n            button.addEventListener(\"click\", function(){\r\n                self.client.connect(input.url.value, input.key.value)\r\n                .then(function(response){\r\n                \tHTMLHelper.removeChildren(resd);\r\n                    var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n               });\r\n            }) // button click\r\n        break;\r\n        case 'create':\r\n            button.addEventListener(\"click\", function(form){\r\n              self.client.createDatabase(input.url.value, JSON.parse(input.doc.value), input.key.value)\r\n              .then(function(response){\r\n            \t  HTMLHelper.removeChildren(resd);\r\n                  var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n              });\r\n            }) // button click\r\n        break;\r\n        case 'delete':\r\n            button.addEventListener(\"click\", function(){\r\n              var opts ={}\r\n              self.client.deleteDatabase(input.url.value, input.key.value)\r\n              .then(function(response){\r\n            \t  HTMLHelper.removeChildren(resd);\r\n                  var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n              });\r\n            }) // button click\r\n        break\r\n        case 'getSchema':\r\n            button.addEventListener(\"click\", function(){\r\n                var opts = {};\r\n                opts['terminus:encoding'] = 'terminus:turtle';\r\n                opts['terminus:user_key'] = input.key.value;\r\n                var schurl = input.url.value;\r\n                self.client.getSchema(schurl, opts)\r\n                .then(function(response){\r\n                \tHTMLHelper.removeChildren(resd);\r\n                    var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n                });\r\n            }) // button click\r\n        break;\r\n        case 'updateSchema':\r\n            button.addEventListener(\"click\", function(){\r\n                opts = {};\r\n                opts['terminus:encoding'] = 'terminus:turtle';\r\n                opts['terminus:user_key'] = input.key.value;\r\n                var payload = input.doc.value;\r\n                var schurl = input.url.value;\r\n                self.client.connectionConfig.connected_mode = false;\r\n                self.client.updateSchema(schurl, input.doc.value, opts)\r\n                //self.client.updateSchema(schurl, input.doc.value, opts)\r\n                .then(function(response){\r\n                \tHTMLHelper.removeChildren(resd);\r\n                    var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n                });\r\n            }) // button click\r\n        break;\r\n        case 'getClassFrames':\r\n            button.addEventListener(\"click\", function(form){\r\n                var schurl = input.url.value;\r\n                opts = {};\r\n                opts.explorer = true;\r\n                self.client.getClassFrame(input.url, JSON.parse(input.docUrl.value), opts)\r\n                .then(function(response){\r\n                    var currForm = buttonSelf.parentNode;\r\n                    var resultDom = UTILS.showHttpResult(response, action, currForm, self.ui);\r\n                });\r\n            }) // button click\r\n        break;\r\n        case 'viewDocument':\r\n          button.addEventListener(\"click\", function(){\r\n              var dcurl = input.url.value;\r\n              var opts = {};\r\n              opts['terminus:encoding'] = \"jsonld\";\r\n              opts['terminus:user_key'] = input.key.value;\r\n              self.client.getDocument(dcurl, opts)\r\n              .then(function(response){\r\n            \t    HTMLHelper.removeChildren(resd);\r\n                    var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n              });\r\n        }) // button click\r\n        break;\r\n        case 'deleteDocument':\r\n          button.addEventListener(\"click\", function(){\r\n              var dcurl = input.url.value;\r\n              var opts = {};\r\n              opts.key = input.key.value;\r\n              self.client.deleteDocument(dcurl, opts)\r\n              .then(function(response){\r\n            \t  HTMLHelper.removeChildren(resd);\r\n                  var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n              });\r\n          }) // button click\r\n        break;\r\n        case 'createDocument':\r\n          button.addEventListener(\"click\", function(){\r\n              var dcurl = input.url.value;\r\n              var payload = input.doc.value;\r\n              opts = {};\r\n              opts['terminus:encoding'] = \"jsonld\";\r\n              opts['terminus:user_key'] = input.key.value;\r\n              self.client.createDocument(dcurl, JSON.parse(payload), opts)\r\n              .then(function(response){\r\n            \t   HTMLHelper.removeChildren(resd);\r\n                   var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n               });\r\n          }) // button click\r\n        break;\r\n        case 'updateDocument':\r\n          button.addEventListener(\"click\", function(){\r\n            var dcurl = input.url.value;\r\n            var payload = input.doc.value;\r\n            var buttonSelf = this;\r\n            opts = {};\r\n            opts['terminus:encoding'] = \"jsonld\";\r\n            opts['terminus:user_key'] = input.key.value;\r\n            self.client.updateDocument(dcurl, JSON.parse(payload), opts)\r\n            .then(function(response){\r\n            \tHTMLHelper.removeChildren(resd);\r\n                var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n            });\r\n          }) // button click\r\n        break;\r\n        case 'select':\r\n            button.addEventListener(\"click\", function(){\r\n                var opts = {};\r\n                opts.key = input.key.value;\r\n                var doc = JSON.parse(input.doc.value);\r\n                self.client.select(input.url.value, doc, opts)\r\n                .then(function(response){\r\n                \tHTMLHelper.removeChildren(resd);\r\n                    var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n                });\r\n            }) // button click\r\n        break;\r\n        case 'update':\r\n            button.addEventListener(\"click\", function(){\r\n              var opts = {};\r\n              opts.key = input.key.value;\r\n              var doc = JSON.parse(input.doc.value);\r\n              self.client.update(input.url.value, doc, opts)\r\n              .then(function(response){\r\n            \t  HTMLHelper.removeChildren(resd);\r\n                  var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n              });\r\n            }) // button click\r\n        break;\r\n        default:\r\n            console.log('Invalid Api call on button');\r\n        break;\r\n    } // switch(action)\r\n    var br = document.createElement('BR');\r\n    form.appendChild(br);\r\n    var br = document.createElement('BR');\r\n    form.appendChild(br);\r\n    return form;\r\n} // getApiSendButton()\r\n\r\n// get signature of api calls\r\nApiExplorer.prototype.getSignature = function(action){\r\n    var api = document.createElement('div');\r\n    // get header signature\r\n    var sg = document.createElement('button');\r\n    sg.appendChild(document.createTextNode('Click to read API Signature'));\r\n    sg.setAttribute('class', 'terminus-collapsible');\r\n    ic = document.createElement('i');\r\n    ic.setAttribute('class', 'terminus-cheveron-float fa fa-chevron-down');\r\n    sg.appendChild(ic);\r\n    api.appendChild(sg);\r\n    var br = document.createElement('BR');\r\n    api.appendChild(br);\r\n    var cl = document.createElement('div');\r\n    cl.setAttribute('class', 'terminus-collapsible-content content');\r\n    var sig = UTILS.getFunctionSignature(action);\r\n    var txt = document.createTextNode(sig.spec);\r\n    var pre = document.createElement('pre');\r\n    pre.setAttribute('class', 'terminus-api-signature-pre');\r\n    pre.appendChild(txt);\r\n    var txt =  document.createTextNode(sig.descr);\r\n    pre.appendChild(txt);\r\n    var br = document.createElement('BR');\r\n    pre.appendChild(br);\r\n    var br = document.createElement('BR');\r\n    pre.appendChild(br);\r\n    var txt = document.createTextNode(sig.result);\r\n    pre.appendChild(txt);\r\n    cl.appendChild(pre);\r\n    api.appendChild(cl);\r\n    var br = document.createElement('BR');\r\n    api.appendChild(br);\r\n    sg.addEventListener('click', function(){\r\n        UTILS.tolggleContent(ic, cl);\r\n    });\r\n    return api;\r\n} // getSignature()\r\n\r\n// displays signature only on click\r\nfunction tolggleSignatureContent(content){\r\n    if (content.style.display === \"block\")\r\n        content.style.display = \"none\";\r\n    else content.style.display = \"block\";\r\n}\r\n\r\nmodule.exports=ApiExplorer\r\n","/**\r\n * @file Javascript WOQL client object\r\n * @license Apache Version 2\r\n * @summary Simple Javascript Client for accessing the Terminus DB API\r\n */\r\n\r\nconst CONST = require('./const');\r\nconst DispatchRequest = require('./dispatchRequest');\r\nconst ErrorMessage = require('./errorMessage');\r\nconst ConnectionCapabilities = require('./connectionCapabilities');\r\nconst ConnectionConfig = require('./connectionConfig');\r\nconst UTILS = require('./utils.js');\r\n\r\n/**\r\n  * Constructor - takes an option json list of connection parameters\r\n  * @param {Object} params a json object containing connection parameters\r\n  * which can be: \r\n  * params.server URL of server to connect to\r\n  *\tparams.dbid ID of database to connect to\r\n  * params.docid = ID of document to load;\r\n*/\r\nfunction WOQLClient(params) {\r\n\t// current connection context variables\r\n\tconst key = (params && params.key) ? params.key : undefined;\r\n\tthis.use_fetch = false;\r\n\tthis.return_full_response = false;\r\n\tthis.connectionConfig = new ConnectionConfig(params);\r\n\tthis.connection = new ConnectionCapabilities(this.connectionConfig, key);\r\n}\r\n\r\nWOQLClient.CONST = CONST;\r\n\r\n/**\r\n * Connect to a Terminus server at the given URI with an API key\r\n * Stores the terminus:ServerCapability document returned\r\n * in the connection register which stores, the url, key, capabilities,\r\n * and database meta-data for the connected server\r\n *\r\n * If the curl argument is false or null,\r\n * this.connectionConfig.server will be used if present,\r\n * or the promise will be rejected.\r\n\r\n * @param  {string} curl Terminus server URI\r\n * @param  {string} [key] API  key\r\n * @param  {string} [dbid] Optional DB to connect to by default\r\n * @return {Promise}\r\n * @public\r\n */\r\nWOQLClient.prototype.connect = function (curl, key, dbid) {\r\n\tif (curl && !this.connectionConfig.setServer(curl)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(curl, CONST.CONNECT))\r\n\t\t);\r\n\t}\r\n\tconst serverURL = this.connectionConfig.serverURL();\r\n\tif (key) {\r\n\t\tthis.connection.setClientKey(serverURL, key);\r\n\t}\r\n\t// unset the current server setting until successful connect\r\n\tthis.connectionConfig.server = false;\r\n\treturn this.dispatch(serverURL, CONST.CONNECT)\r\n\t.then((response) => {\r\n\t    this.connectionConfig.server = serverURL;\r\n\t    if(dbid) this.connectionConfig.dbid = dbid;\r\n\t    this.connection.addConnection(serverURL, response);\r\n\t    return response;\r\n\t});\r\n};\r\n\r\n/**\r\n * Create a Terminus Database by posting\r\n * a terminus:Database document to the Terminus API\r\n *\r\n * The dburl argument can be\r\n *    1) a valid URL of a terminus database or\r\n *    2) a valid Terminus database id or\r\n *    3) can be omitted\r\n * \t\tin case 2) the current server will be used,\r\n * \t\tin case 3) the database id will be set from the @id field of the terminuse:Database document.\r\n *\r\n * The second (details) argument contains a terminus:Database document\r\n * with a mandatory rdfs:label field and an optional rdfs:comment field.\r\n * The third (key) argument contains an optional API key\r\n *\r\n * @param {string} dburl Terminus server URI or a TerminusID\r\n * @param {object} details\r\n * @param {string} key\r\n * @return {Promise}\r\n * @public\r\n */\r\nWOQLClient.prototype.createDatabase = function (dburl, details, key) {\r\n\tif (dburl && !this.connectionConfig.setDB(dburl)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(dburl, 'Create Database'))\r\n\t\t);\r\n\t}\r\n\tif (\r\n\t\tdetails\r\n    && details['@id']\r\n    && !this.connectionConfig.setDB(details['@id'], details['@context'])\r\n\t) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(details['@id'], 'Create Database'))\r\n\t\t);\r\n\t}\r\n\tdetails = this.makeDocumentConsistentWithURL(details, this.connectionConfig.dbURL());\r\n\r\n\tconst opts = {};\r\n\tif (key) {\r\n\t\topts.key = key;\r\n\t}\r\n\tconst doc = this.addOptionsToDocument(details, opts);\r\n\treturn this.dispatch(this.connectionConfig.dbURL('create'), CONST.CREATE_DATABASE, doc);\r\n};\r\n\r\n/**\r\n * Delete a Database\r\n * @param {String} dburl it is a terminusDB Url or a terminusDB Id\r\n * @param {String} key an optional API key\r\n * @return {Promise}\r\n *\r\n * if dburl is omitted, the current server and database will be used\r\n */\r\nWOQLClient.prototype.deleteDatabase = function (dburl, key) {\r\n\tif (dburl && !this.connectionConfig.setDB(dburl)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(dburl, 'Delete Database'))\r\n\t\t);\r\n\t}\r\n\tconst dbid = this.connectionConfig.dbid\r\n\tconst opts = {};\r\n\r\n\tif (key) {\r\n\t\topts.key = key;\r\n\t}\r\n\r\n\tconst self = this;\r\n\treturn this.dispatch(`${this.connectionConfig.dbURL()}`, CONST.DELETE_DATABASE, opts).then(\r\n\t\t(response) => {\r\n\t\t\tself.connection.removeDB(dbid);\r\n\t\t\treturn response;\r\n\t\t}\r\n\t);\r\n};\r\n\r\n/**\r\n * Retrieves the schema of the specified database\r\n *\r\n * @param {string} schurl TerminusDB server URL or a valid TerminusDB Id or omitted\r\n * @param {object} opts is an options object\r\n * @return {Promise}\r\n *\r\n * opts.format is optional and defines which format is requested (*json / turtle)\r\n * opts.key is an optional API key\r\n */\r\nWOQLClient.prototype.getSchema = function (schurl, opts) {\r\n\tif (schurl && !this.connectionConfig.setSchemaURL(schurl)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(schurl, 'Get Schema'))\r\n\t\t);\r\n\t}\r\n\t// consoleco.log('schemaURL', this.connectionConfig.schemaURL());\r\n\treturn this.dispatch(this.connectionConfig.schemaURL(), CONST.GET_SCHEMA, opts);\r\n};\r\n\r\n/**\r\n * Updates the Schema of the specified database\r\n *\r\n * @param {string} schurl TerminusDB server URL or a valid TerminusDB Id or omitted\r\n * @param {object} doc is a valid owl ontology in json-ld or turtle format\r\n * @param {object} opts is an options object\r\n * @return {Promise}\r\n *\r\n * if omitted the current server and database will be used\r\n * opts.format is used to specify which format is being used (*json / turtle)\r\n * opts.key is an optional API key\r\n */\r\nWOQLClient.prototype.updateSchema = function (schurl, doc, opts) {\r\n\tif (schurl && !this.connectionConfig.setSchemaURL(schurl)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(schurl, 'Update Schema'))\r\n\t\t);\r\n\t}\r\n\tdoc = this.addOptionsToDocument(doc, opts);\r\n\treturn this.dispatch(this.connectionConfig.schemaURL(), 'update_schema', doc);\r\n};\r\n\r\n/**\r\n * Creates a new document in the specified database\r\n *\r\n * The first (docurl) argument can be\r\n * 1) a valid URL of a terminus database (an id will be randomly assigned) or\r\n * 2) a valid URL or of a terminus document (the document will be given the passed URL) or\r\n * 3) a valid terminus document id (the current server and database will be used)\r\n * 4) can be omitted (the URL will be taken from the document if present)\r\n * The second argument (doc) is a valid document in json-ld\r\n * the third argument (opts) is an options json - opts.key is an optional API key\r\n */\r\nWOQLClient.prototype.createDocument = function (docurl, doc, opts) {\r\n\tif (docurl && !this.connectionConfig.setDocument(docurl)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(docurl, 'Create Document'))\r\n\t\t);\r\n\t} if (\r\n\t\tdoc\r\n    && doc['@id']\r\n    && !this.connectionConfig.setDocument(doc['@id'], doc['@context'])\r\n\t) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(doc['@id'], 'Create Document'))\r\n\t\t);\r\n\t}\r\n\tdoc = this.addOptionsToDocument(\r\n\t\tthis.makeDocumentConsistentWithURL(doc, this.connectionConfig.docURL()),\r\n\t\topts\r\n\t);\r\n\treturn this.dispatch(this.connectionConfig.docURL(), 'create_document', doc);\r\n};\r\n\r\n/**\r\n * Retrieves a document from the specified database\r\n *\r\n * The first (docurl) argument can be\r\n * 1) a valid URL of a terminus document or\r\n * 2) a valid ID of a terminus document in the current database\r\n * the second argument (opts) is an options json -\r\n * \t\topts.key is an optional API key\r\n * \t\topts.shape is frame | *document\r\n */\r\nWOQLClient.prototype.getDocument = function (docurl, opts) {\r\n\tif (docurl && (!this.connectionConfig.setDocument(docurl) || !this.connectionConfig.docid)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(docurl, 'Get Document'))\r\n\t\t);\r\n\t}\r\n\treturn this.dispatch(this.connectionConfig.docURL(), 'get_document', opts);\r\n};\r\n\r\n/**\r\n * Updates a document in the specified database with a new version\r\n *\r\n * The first (docurl) argument can be\r\n * 1) a valid URL of a terminus document or\r\n * 2) a valid ID of a terminus document in the current database or\r\n * 3) omitted in which case the id will be taken from the document @id field\r\n * the second argument (doc) is a document in json-ld format\r\n * the third argument (opts) is an options json - opts.key is an optional API key\r\n */\r\nWOQLClient.prototype.updateDocument = function (docurl, doc, opts) {\r\n\tif (docurl && !this.connectionConfig.setDocument(docurl)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(docurl, 'Update Document'))\r\n\t\t);\r\n\t}\r\n\tif (doc && doc['@id']\r\n    && !this.connectionConfig.setDocument(doc['@id'], doc['@context'])\r\n\t) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(doc['@id'], 'Update Document'))\r\n\t\t);\r\n\t}\r\n\tdoc = this.addOptionsToDocument(\r\n\t\tthis.makeDocumentConsistentWithURL(doc, this.connectionConfig.docURL()),\r\n\t\topts\r\n\t);\r\n\treturn this.dispatch(this.connectionConfig.docURL(), 'update_document', doc);\r\n};\r\n\r\n/**\r\n * Deletes a document from the specified database\r\n *\r\n * The first (docurl) argument can be\r\n * 1) a valid URL of a terminus document or\r\n * 2) a valid ID of a terminus document in the current database\r\n * 3) omitted - the current document will be used\r\n * the second argument (opts) is an options json - opts.key is an optional API key\r\n */\r\nWOQLClient.prototype.deleteDocument = function (docurl, opts) {\r\n\tif (docurl && (!this.connectionConfig.setDocument(docurl) || !this.connectionConfig.docid)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(docurl, 'Delete Document'))\r\n\t\t);\r\n\t}\r\n\treturn this.dispatch(this.connectionConfig.docURL(), 'delete_document', opts);\r\n};\r\n\r\n/**\r\n * Executes a read-only WOQL query on the specified database and returns the results\r\n *\r\n * @param {string} qurl TerminusDB server URL or omitted (the current DB will be used)\r\n * @param {string} woql is a \"woql query select statement\"\r\n * @param {object} opts it can contents the API key (opts.key)\r\n *\r\n */\r\nWOQLClient.prototype.select = function (qurl, woql, opts) {\r\n\tif (qurl && !this.connectionConfig.setQueryURL(qurl)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(qurl, 'Select'))\r\n\t\t);\r\n\t}\r\n\tlet q = { 'terminus:query': JSON.stringify(woql) };\r\n\tq = this.addOptionsToWOQL(q, opts);\r\n\treturn this.dispatch(this.connectionConfig.queryURL(), CONST.WOQL_SELECT, q);\r\n};\r\n\r\n/**\r\n * Executes a WOQL query on the specified database which updates the state and returns the results\r\n *\r\n * The first (qurl) argument can be\r\n * 1) a valid URL of a terminus database or\r\n * 2) omitted - the current database will be used\r\n * the second argument (woql) is a woql select statement encoded as a string\r\n * the third argument (opts) is an options json - opts.key is an optional API key\r\n */\r\nWOQLClient.prototype.update = function (qurl, woql, opts) {\r\n\tif (qurl && !this.connectionConfig.setQueryURL(qurl)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(qurl, 'Update'))\r\n\t\t);\r\n\t}\r\n\twoql = this.addOptionsToWOQL(woql, opts);\r\n\treturn this.dispatch(this.connectionConfig.queryURL(), 'woql_update', woql);\r\n};\r\n\r\n/**\r\n * Retrieves a WOQL query on the specified database which updates the state and returns the results\r\n *\r\n * The first (cfurl) argument can be\r\n * 1) a valid URL of a terminus database or\r\n * 2) omitted - the current database will be used\r\n * the second argument (cls) is the URL / ID of a document class that exists in the database schema\r\n * the third argument (opts) is an options json - opts.key is an optional API key\r\n */\r\nWOQLClient.prototype.getClassFrame = function (cfurl, cls, opts) {\r\n\tif (cfurl && !this.connectionConfig.setClassFrameURL(cfurl)) {\r\n\t\treturn Promise.reject(\r\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(cfurl, 'Get Class Frame'))\r\n\t\t);\r\n\t}\r\n\tif (!opts) opts = {};\r\n\topts['terminus:class'] = cls;\r\n\treturn this.dispatch(this.connectionConfig.frameURL(), 'class_frame', opts);\r\n};\r\n\r\n/*\r\n * Utility functions for adding standard fields to API arguments\r\n */\r\n\r\n /**\r\n  * Adds a key to the passed woql query if it is present in the opts json\r\n  * \r\n  */\r\nWOQLClient.prototype.addOptionsToWOQL = function (woql, opts) {\r\n\tif (opts && opts.key) {\r\n\t\twoql.key = opts.key;\r\n\t}\r\n\treturn woql;\r\n};\r\n\r\n\r\n/**\r\n * Wrapws the passed json document in a valid TerminusDB update document API shell\r\n */\r\nWOQLClient.prototype.addOptionsToDocument = function (doc, opts) {\r\n\tconst pdoc = {};\r\n\tpdoc['@context'] = doc['@context'];\r\n\t// add blank node prefix as document base url\r\n\tif (pdoc['@context'] && doc['@id']) { \r\n\t\tpdoc['@context']._ = `${doc['@id']}/`;\r\n\t}\r\n\tif (opts && opts['terminus:encoding'] && opts['terminus:encoding'] === 'terminus:turtle') {\r\n\t\tpdoc['terminus:turtle'] = doc;\r\n\t\tpdoc['terminus:schema'] = this.connectionConfig.schemaURL();\r\n\t\tdelete pdoc['terminus:turtle']['@context'];\r\n\t} else {\r\n\t\tpdoc['terminus:document'] = doc;\r\n\t\tdelete pdoc['terminus:document']['@context'];\r\n\t}\r\n\tpdoc['@type'] = 'terminus:APIUpdate';\r\n\tif (opts && opts['terminus:user_key']) {\r\n\t\tpdoc['terminus:user_key'] = opts['terminus:user_key'];\r\n\t}\r\n\tif (opts && opts.key) {\r\n\t\tpdoc['terminus:user_key'] = opts.key;\r\n\t}\r\n\treturn pdoc;\r\n};\r\n\r\n/**\r\n * Adds an api key to the payload\r\n */\r\nWOQLClient.prototype.addKeyToPayload = function (payload, url) {\r\n\tif (typeof payload !== 'object')payload = {};\r\n\tif (payload.key) {\r\n\t\tpayload['terminus:user_key'] = payload.key;\r\n\t\tdelete payload.key;\r\n\t} else if (this.connection.getClientKey()) {\r\n\t\tpayload['terminus:user_key'] = this.connection.getClientKey();\r\n\t} else if (this.connection.getClientKey(url)) {\r\n\t\tpayload['terminus:user_key'] = this.connection.getClientKey(url);\r\n\t}\r\n\treturn payload;\r\n};\r\n\r\n/**\r\n * Document updates include the URL in both the endpoint and the document itself\r\n * This ensures that they are the same by using the endpoint URL as the authoritative version \r\n * and copying it into the embedded document ID\r\n */\r\nWOQLClient.prototype.makeDocumentConsistentWithURL = function (doc, dburl) {\r\n\tdoc['@id'] = dburl;\r\n\treturn doc;\r\n};\r\n\r\n/**\r\n * Common request dispatch function\r\n */\r\nWOQLClient.prototype.dispatch = function (url, action, payload) {\r\n\tif (this.connectionConfig.includeKey()) {\r\n\t\tpayload = this.addKeyToPayload(payload, url);\r\n\t}\r\n\tif (this.use_fetch) {\r\n\t\treturn this.dispatchFetch(url, action, payload);\r\n\t}\r\n\treturn DispatchRequest(url, action, payload);\r\n};\r\n\r\n/**\r\n * If the use_fetch switch is set, the browser's built in fetch will be used rather than the npm axios module \r\n */\r\nWOQLClient.prototype.dispatchFetch = function (url, action, payload) {\r\n\tconst api = {\r\n\t\t//mode: 'cors',  no-cors, cors, *same-origin\r\n\t\tredirect: 'follow', // manual, *follow, error\r\n\t\treferrer: 'client', // no-referrer, *client\r\n\t};\r\n\tlet hdrs = {};\r\n\tif (payload && payload['terminus:user_key']) {\r\n\t\thdrs = { Authorization: `Basic ${btoa(`:${payload['terminus:user_key']}`)}` };\r\n\t\tdelete (payload['terminus:user_key']);\r\n\t}\r\n\t// read only API calls - use GET\r\n\tswitch (action) {\r\n\tcase CONST.DELETE_DATABASE:\r\n\tcase CONST.DELETE_DOCUMENT:\r\n\t\tif (Object.keys(payload).length > 0) url += `?${UTILS.URIEncodePayload(payload)}`;\r\n\t\tapi.method = 'DELETE';\r\n\t\tapi.cache = 'no-cache';\r\n\t\tbreak;\r\n\tcase CONST.CREATE_DATABASE:\r\n\tcase CONST.UPDATE_SCHEMA:\r\n\tcase CONST.CREATE_DOCUMENT:\r\n\tcase CONST.UPDATE_DOCUMENT:\r\n\tcase CONST.WOQL_UPDATE:\r\n\t\tapi.method = 'POST';\r\n\t\tapi.cache = 'no-cache';\r\n\t\thdrs['Content-Type'] = 'application/json';\r\n\t\tapi.body = JSON.stringify(payload);\r\n\t\tbreak;\r\n\tcase CONST.GET_SCHEMA:\r\n\tcase CONST.CONNECT:\r\n\tcase CONST.CLASS_FRAME:\r\n\tcase CONST.WOQL_SELECT:\r\n\tcase CONST.GET_DOCUMENT:\r\n\tdefault:\r\n\t\tapi.method = 'GET';\r\n\t\tif (Object.keys(payload).length > 0) url += `?${UTILS.URIEncodePayload(payload)}`;\r\n\t}\r\n\tconst self = this;\r\n\tif (Object.keys(hdrs).length > 0) {\r\n\t\tapi.headers = new Headers(hdrs);\r\n\t}\r\n\treturn fetch(url, api).then((response) => {\r\n\t\tif (self.return_full_response) return response;\r\n\t\tif (response.ok) {\r\n\t\t\treturn response.json();\r\n\t\t}\r\n\t\tself.error = self.parseAPIError(response);\r\n\t\treturn Promise.reject(new Error(self.getAPIErrorMessage(url, api, self.error)));\r\n\t});\r\n};\r\n\r\nmodule.exports = WOQLClient;\r\n","/**\r\n * @file Dispatch Request\r\n * @license Apache Version 2\r\n * @summary Functions for dispatching API requests via the axios library. \r\n */\r\n\r\nconst axios = require('axios');\r\nconst UTILS = require('./utils.js');\r\nconst CONST = require('./const.js');\r\nconst ErrorMessage = require('./errorMessage');\r\n\r\n/**\r\n * @summary base 64 encodes a string using either the btoa implementation if available or the Buffer object. \r\n * @param {String} str string to be base 64 encoded\r\n */\r\nfunction btoaImplementation(str) {\r\n\ttry {\r\n\t\treturn btoa(str);\r\n\t} catch (err) {\r\n\t\t// console.log('in buffer')\r\n\t\treturn Buffer.from(str).toString('base64');\r\n\t}\r\n}\r\n\r\n/**\r\n * \r\n * @param {String} url  API endpoint URL\r\n * @param {String} action API action\r\n * @param {Object} payload data to be transmitted to endpoint\r\n */\r\nfunction DispatchRequest(url, action, payload) {\r\n\t/*\r\n\t*CORS is only required when trying to fetch data from a browser,\r\n\t*as browsers by default will block requests to different origins\r\n\t*/\r\n\tconst options = {\r\n\t\tmode: 'cors', // no-cors, cors, *same-origin\r\n\t\tredirect: 'follow', // manual, *follow, error\r\n\t\treferrer: 'client',\r\n\t\t// url:url,\r\n\t\t// no-referrer, *client\r\n\t};\r\n\tif (payload && payload['terminus:user_key']) {\r\n\t\toptions.headers = { Authorization: `Basic ${btoaImplementation(`:${payload['terminus:user_key']}`)}` };\r\n\t\tdelete (payload['terminus:user_key']);\r\n\t}\r\n\r\n\tswitch (action) {\r\n\tcase CONST.DELETE_DATABASE:\r\n\tcase CONST.DELETE_DOCUMENT:\r\n\t\tif (payload) {\r\n\t\t\tconst ext = UTILS.URIEncodePayload(payload);\r\n\t\t\tif (ext) url += `?${ext}`;\r\n\t\t}\r\n\t\treturn axios.delete(url, options)\r\n\t\t\t.then(response => response.data)\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tthrow new Error(ErrorMessage.getAPIErrorMessage(url, options, err));\r\n\t\t\t});\r\n\tcase CONST.CREATE_DATABASE:\r\n\tcase CONST.UPDATE_SCHEMA:\r\n\tcase CONST.CREATE_DOCUMENT:\r\n\tcase CONST.UPDATE_DOCUMENT:\r\n\tcase CONST.WOQL_UPDATE:\r\n\t\toptions.headers = options.headers ? options.headers : {};\r\n\t\toptions.headers['Content-Type'] = 'application/json';\r\n\t\treturn axios.post(url, JSON.stringify(payload), options)\r\n\t\t\t.then(response => response.data)\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tconst e = new Error(ErrorMessage.getAPIErrorMessage(url, options, err));\r\n\t\t\t\tif (err.response && err.response.data) e.data = err.response.data;\r\n\t\t\t\tthrow e;\r\n\t\t\t});\r\n\tcase CONST.GET_SCHEMA:\r\n\tcase CONST.CONNECT:\r\n\tcase CONST.CLASS_FRAME:\r\n\tcase CONST.WOQL_SELECT:\r\n\tcase CONST.GET_DOCUMENT:\r\n\tdefault:\r\n\t\tif (payload) {\r\n\t\t\tconst ext = UTILS.URIEncodePayload(payload);\r\n\t\t\tif (ext) url += `?${ext}`;\r\n\t\t}\r\n\t\treturn axios.get(url, options)\r\n\t\t\t.then((response => response.data))\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tlet e = new Error(ErrorMessage.getAPIErrorMessage(url, options, err));\r\n\t\t\t\tif(err.response && err.response.data){\r\n\t\t\t\t\te.data = err.response.data;\r\n\t\t\t\t}\r\n\t\t\t\tthrow e; \r\n\t\t\t});\r\n\t}\r\n}\r\n\r\nmodule.exports = DispatchRequest;\r\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\n/*\n * Export kMaxLength after typed array support is determined.\n */\nexports.kMaxLength = kMaxLength()\n\nfunction typedArraySupport () {\n  try {\n    var arr = new Uint8Array(1)\n    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\nfunction createBuffer (that, length) {\n  if (kMaxLength() < length) {\n    throw new RangeError('Invalid typed array length')\n  }\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = new Uint8Array(length)\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    if (that === null) {\n      that = new Buffer(length)\n    }\n    that.length = length\n  }\n\n  return that\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {\n    return new Buffer(arg, encodingOrOffset, length)\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new Error(\n        'If encoding is specified then the first argument must be a string'\n      )\n    }\n    return allocUnsafe(this, arg)\n  }\n  return from(this, arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\n// TODO: Legacy, not needed anymore. Remove in next major version.\nBuffer._augment = function (arr) {\n  arr.__proto__ = Buffer.prototype\n  return arr\n}\n\nfunction from (that, value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {\n    return fromArrayBuffer(that, value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(that, value, encodingOrOffset)\n  }\n\n  return fromObject(that, value)\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(null, value, encodingOrOffset, length)\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n  if (typeof Symbol !== 'undefined' && Symbol.species &&\n      Buffer[Symbol.species] === Buffer) {\n    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97\n    Object.defineProperty(Buffer, Symbol.species, {\n      value: null,\n      configurable: true\n    })\n  }\n}\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be a number')\n  } else if (size < 0) {\n    throw new RangeError('\"size\" argument must not be negative')\n  }\n}\n\nfunction alloc (that, size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(that, size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpretted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(that, size).fill(fill, encoding)\n      : createBuffer(that, size).fill(fill)\n  }\n  return createBuffer(that, size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(null, size, fill, encoding)\n}\n\nfunction allocUnsafe (that, size) {\n  assertSize(size)\n  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < size; ++i) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(null, size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(null, size)\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  var length = byteLength(string, encoding) | 0\n  that = createBuffer(that, length)\n\n  var actual = that.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    that = that.slice(0, actual)\n  }\n\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  that = createBuffer(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array, byteOffset, length) {\n  array.byteLength // this throws if `array` is not a valid ArrayBuffer\n\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\\'offset\\' is out of bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\\'length\\' is out of bounds')\n  }\n\n  if (byteOffset === undefined && length === undefined) {\n    array = new Uint8Array(array)\n  } else if (length === undefined) {\n    array = new Uint8Array(array, byteOffset)\n  } else {\n    array = new Uint8Array(array, byteOffset, length)\n  }\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = array\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromArrayLike(that, array)\n  }\n  return that\n}\n\nfunction fromObject (that, obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    that = createBuffer(that, len)\n\n    if (that.length === 0) {\n      return that\n    }\n\n    obj.copy(that, 0, 0, len)\n    return that\n  }\n\n  if (obj) {\n    if ((typeof ArrayBuffer !== 'undefined' &&\n        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {\n      if (typeof obj.length !== 'number' || isnan(obj.length)) {\n        return createBuffer(that, 0)\n      }\n      return fromArrayLike(that, obj)\n    }\n\n    if (obj.type === 'Buffer' && isArray(obj.data)) {\n      return fromArrayLike(that, obj.data)\n    }\n  }\n\n  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength()` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    }\n    buf.copy(buffer, pos)\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&\n      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    string = '' + string\n  }\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n      case undefined:\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect\n// Buffer instances.\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError('Argument must be a Buffer')\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset  // Coerce to Number.\n  if (isNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (Buffer.TYPED_ARRAY_SUPPORT &&\n        typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction latin1Write (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Write(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = this.subarray(start, end)\n    newBuf.__proto__ = Buffer.prototype\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; ++i) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; --i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; ++i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, start + len),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if (code < 256) {\n        val = code\n      }\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : utf8ToBytes(new Buffer(val, encoding).toString())\n    var len = bytes.length\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction isnan (val) {\n  return val !== val // eslint-disable-line no-self-compare\n}\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(\n      uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)\n    ))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","module.exports = require('./lib/axios');","'use strict';\n\nvar utils = require('./utils');\nvar bind = require('./helpers/bind');\nvar Axios = require('./core/Axios');\nvar mergeConfig = require('./core/mergeConfig');\nvar defaults = require('./defaults');\n\n/**\n * Create an instance of Axios\n *\n * @param {Object} defaultConfig The default config for the instance\n * @return {Axios} A new instance of Axios\n */\nfunction createInstance(defaultConfig) {\n  var context = new Axios(defaultConfig);\n  var instance = bind(Axios.prototype.request, context);\n\n  // Copy axios.prototype to instance\n  utils.extend(instance, Axios.prototype, context);\n\n  // Copy context to instance\n  utils.extend(instance, context);\n\n  return instance;\n}\n\n// Create the default instance to be exported\nvar axios = createInstance(defaults);\n\n// Expose Axios class to allow class inheritance\naxios.Axios = Axios;\n\n// Factory for creating new instances\naxios.create = function create(instanceConfig) {\n  return createInstance(mergeConfig(axios.defaults, instanceConfig));\n};\n\n// Expose Cancel & CancelToken\naxios.Cancel = require('./cancel/Cancel');\naxios.CancelToken = require('./cancel/CancelToken');\naxios.isCancel = require('./cancel/isCancel');\n\n// Expose all/spread\naxios.all = function all(promises) {\n  return Promise.all(promises);\n};\naxios.spread = require('./helpers/spread');\n\nmodule.exports = axios;\n\n// Allow use of default import syntax in TypeScript\nmodule.exports.default = axios;\n","/*!\n * Determine if an object is a Buffer\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n\nmodule.exports = function isBuffer (obj) {\n  return obj != null && obj.constructor != null &&\n    typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj)\n}\n","'use strict';\n\nvar utils = require('./../utils');\nvar buildURL = require('../helpers/buildURL');\nvar InterceptorManager = require('./InterceptorManager');\nvar dispatchRequest = require('./dispatchRequest');\nvar mergeConfig = require('./mergeConfig');\n\n/**\n * Create a new instance of Axios\n *\n * @param {Object} instanceConfig The default config for the instance\n */\nfunction Axios(instanceConfig) {\n  this.defaults = instanceConfig;\n  this.interceptors = {\n    request: new InterceptorManager(),\n    response: new InterceptorManager()\n  };\n}\n\n/**\n * Dispatch a request\n *\n * @param {Object} config The config specific for this request (merged with this.defaults)\n */\nAxios.prototype.request = function request(config) {\n  /*eslint no-param-reassign:0*/\n  // Allow for axios('example/url'[, config]) a la fetch API\n  if (typeof config === 'string') {\n    config = arguments[1] || {};\n    config.url = arguments[0];\n  } else {\n    config = config || {};\n  }\n\n  config = mergeConfig(this.defaults, config);\n  config.method = config.method ? config.method.toLowerCase() : 'get';\n\n  // Hook up interceptors middleware\n  var chain = [dispatchRequest, undefined];\n  var promise = Promise.resolve(config);\n\n  this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor) {\n    chain.unshift(interceptor.fulfilled, interceptor.rejected);\n  });\n\n  this.interceptors.response.forEach(function pushResponseInterceptors(interceptor) {\n    chain.push(interceptor.fulfilled, interceptor.rejected);\n  });\n\n  while (chain.length) {\n    promise = promise.then(chain.shift(), chain.shift());\n  }\n\n  return promise;\n};\n\nAxios.prototype.getUri = function getUri(config) {\n  config = mergeConfig(this.defaults, config);\n  return buildURL(config.url, config.params, config.paramsSerializer).replace(/^\\?/, '');\n};\n\n// Provide aliases for supported request methods\nutils.forEach(['delete', 'get', 'head', 'options'], function forEachMethodNoData(method) {\n  /*eslint func-names:0*/\n  Axios.prototype[method] = function(url, config) {\n    return this.request(utils.merge(config || {}, {\n      method: method,\n      url: url\n    }));\n  };\n});\n\nutils.forEach(['post', 'put', 'patch'], function forEachMethodWithData(method) {\n  /*eslint func-names:0*/\n  Axios.prototype[method] = function(url, data, config) {\n    return this.request(utils.merge(config || {}, {\n      method: method,\n      url: url,\n      data: data\n    }));\n  };\n});\n\nmodule.exports = Axios;\n","'use strict';\n\nvar utils = require('./../utils');\n\nfunction InterceptorManager() {\n  this.handlers = [];\n}\n\n/**\n * Add a new interceptor to the stack\n *\n * @param {Function} fulfilled The function to handle `then` for a `Promise`\n * @param {Function} rejected The function to handle `reject` for a `Promise`\n *\n * @return {Number} An ID used to remove interceptor later\n */\nInterceptorManager.prototype.use = function use(fulfilled, rejected) {\n  this.handlers.push({\n    fulfilled: fulfilled,\n    rejected: rejected\n  });\n  return this.handlers.length - 1;\n};\n\n/**\n * Remove an interceptor from the stack\n *\n * @param {Number} id The ID that was returned by `use`\n */\nInterceptorManager.prototype.eject = function eject(id) {\n  if (this.handlers[id]) {\n    this.handlers[id] = null;\n  }\n};\n\n/**\n * Iterate over all the registered interceptors\n *\n * This method is particularly useful for skipping over any\n * interceptors that may have become `null` calling `eject`.\n *\n * @param {Function} fn The function to call for each interceptor\n */\nInterceptorManager.prototype.forEach = function forEach(fn) {\n  utils.forEach(this.handlers, function forEachHandler(h) {\n    if (h !== null) {\n      fn(h);\n    }\n  });\n};\n\nmodule.exports = InterceptorManager;\n","'use strict';\n\nvar utils = require('./../utils');\nvar transformData = require('./transformData');\nvar isCancel = require('../cancel/isCancel');\nvar defaults = require('../defaults');\nvar isAbsoluteURL = require('./../helpers/isAbsoluteURL');\nvar combineURLs = require('./../helpers/combineURLs');\n\n/**\n * Throws a `Cancel` if cancellation has been requested.\n */\nfunction throwIfCancellationRequested(config) {\n  if (config.cancelToken) {\n    config.cancelToken.throwIfRequested();\n  }\n}\n\n/**\n * Dispatch a request to the server using the configured adapter.\n *\n * @param {object} config The config that is to be used for the request\n * @returns {Promise} The Promise to be fulfilled\n */\nmodule.exports = function dispatchRequest(config) {\n  throwIfCancellationRequested(config);\n\n  // Support baseURL config\n  if (config.baseURL && !isAbsoluteURL(config.url)) {\n    config.url = combineURLs(config.baseURL, config.url);\n  }\n\n  // Ensure headers exist\n  config.headers = config.headers || {};\n\n  // Transform request data\n  config.data = transformData(\n    config.data,\n    config.headers,\n    config.transformRequest\n  );\n\n  // Flatten headers\n  config.headers = utils.merge(\n    config.headers.common || {},\n    config.headers[config.method] || {},\n    config.headers || {}\n  );\n\n  utils.forEach(\n    ['delete', 'get', 'head', 'post', 'put', 'patch', 'common'],\n    function cleanHeaderConfig(method) {\n      delete config.headers[method];\n    }\n  );\n\n  var adapter = config.adapter || defaults.adapter;\n\n  return adapter(config).then(function onAdapterResolution(response) {\n    throwIfCancellationRequested(config);\n\n    // Transform response data\n    response.data = transformData(\n      response.data,\n      response.headers,\n      config.transformResponse\n    );\n\n    return response;\n  }, function onAdapterRejection(reason) {\n    if (!isCancel(reason)) {\n      throwIfCancellationRequested(config);\n\n      // Transform response data\n      if (reason && reason.response) {\n        reason.response.data = transformData(\n          reason.response.data,\n          reason.response.headers,\n          config.transformResponse\n        );\n      }\n    }\n\n    return Promise.reject(reason);\n  });\n};\n","'use strict';\n\nvar utils = require('./../utils');\n\n/**\n * Transform the data for a request or a response\n *\n * @param {Object|String} data The data to be transformed\n * @param {Array} headers The headers for the request or response\n * @param {Array|Function} fns A single function or Array of functions\n * @returns {*} The resulting transformed data\n */\nmodule.exports = function transformData(data, headers, fns) {\n  /*eslint no-param-reassign:0*/\n  utils.forEach(fns, function transform(fn) {\n    data = fn(data, headers);\n  });\n\n  return data;\n};\n","'use strict';\n\nvar utils = require('../utils');\n\nmodule.exports = function normalizeHeaderName(headers, normalizedName) {\n  utils.forEach(headers, function processHeader(value, name) {\n    if (name !== normalizedName && name.toUpperCase() === normalizedName.toUpperCase()) {\n      headers[normalizedName] = value;\n      delete headers[name];\n    }\n  });\n};\n","'use strict';\n\nvar createError = require('./createError');\n\n/**\n * Resolve or reject a Promise based on response status.\n *\n * @param {Function} resolve A function that resolves the promise.\n * @param {Function} reject A function that rejects the promise.\n * @param {object} response The response.\n */\nmodule.exports = function settle(resolve, reject, response) {\n  var validateStatus = response.config.validateStatus;\n  if (!validateStatus || validateStatus(response.status)) {\n    resolve(response);\n  } else {\n    reject(createError(\n      'Request failed with status code ' + response.status,\n      response.config,\n      null,\n      response.request,\n      response\n    ));\n  }\n};\n","'use strict';\n\n/**\n * Update an Error with the specified config, error code, and response.\n *\n * @param {Error} error The error to update.\n * @param {Object} config The config.\n * @param {string} [code] The error code (for example, 'ECONNABORTED').\n * @param {Object} [request] The request.\n * @param {Object} [response] The response.\n * @returns {Error} The error.\n */\nmodule.exports = function enhanceError(error, config, code, request, response) {\n  error.config = config;\n  if (code) {\n    error.code = code;\n  }\n\n  error.request = request;\n  error.response = response;\n  error.isAxiosError = true;\n\n  error.toJSON = function() {\n    return {\n      // Standard\n      message: this.message,\n      name: this.name,\n      // Microsoft\n      description: this.description,\n      number: this.number,\n      // Mozilla\n      fileName: this.fileName,\n      lineNumber: this.lineNumber,\n      columnNumber: this.columnNumber,\n      stack: this.stack,\n      // Axios\n      config: this.config,\n      code: this.code\n    };\n  };\n  return error;\n};\n","'use strict';\n\nvar utils = require('./../utils');\n\n// Headers whose duplicates are ignored by node\n// c.f. https://nodejs.org/api/http.html#http_message_headers\nvar ignoreDuplicateOf = [\n  'age', 'authorization', 'content-length', 'content-type', 'etag',\n  'expires', 'from', 'host', 'if-modified-since', 'if-unmodified-since',\n  'last-modified', 'location', 'max-forwards', 'proxy-authorization',\n  'referer', 'retry-after', 'user-agent'\n];\n\n/**\n * Parse headers into an object\n *\n * ```\n * Date: Wed, 27 Aug 2014 08:58:49 GMT\n * Content-Type: application/json\n * Connection: keep-alive\n * Transfer-Encoding: chunked\n * ```\n *\n * @param {String} headers Headers needing to be parsed\n * @returns {Object} Headers parsed into an object\n */\nmodule.exports = function parseHeaders(headers) {\n  var parsed = {};\n  var key;\n  var val;\n  var i;\n\n  if (!headers) { return parsed; }\n\n  utils.forEach(headers.split('\\n'), function parser(line) {\n    i = line.indexOf(':');\n    key = utils.trim(line.substr(0, i)).toLowerCase();\n    val = utils.trim(line.substr(i + 1));\n\n    if (key) {\n      if (parsed[key] && ignoreDuplicateOf.indexOf(key) >= 0) {\n        return;\n      }\n      if (key === 'set-cookie') {\n        parsed[key] = (parsed[key] ? parsed[key] : []).concat([val]);\n      } else {\n        parsed[key] = parsed[key] ? parsed[key] + ', ' + val : val;\n      }\n    }\n  });\n\n  return parsed;\n};\n","'use strict';\n\nvar utils = require('./../utils');\n\nmodule.exports = (\n  utils.isStandardBrowserEnv() ?\n\n  // Standard browser envs have full support of the APIs needed to test\n  // whether the request URL is of the same origin as current location.\n    (function standardBrowserEnv() {\n      var msie = /(msie|trident)/i.test(navigator.userAgent);\n      var urlParsingNode = document.createElement('a');\n      var originURL;\n\n      /**\n    * Parse a URL to discover it's components\n    *\n    * @param {String} url The URL to be parsed\n    * @returns {Object}\n    */\n      function resolveURL(url) {\n        var href = url;\n\n        if (msie) {\n        // IE needs attribute set twice to normalize properties\n          urlParsingNode.setAttribute('href', href);\n          href = urlParsingNode.href;\n        }\n\n        urlParsingNode.setAttribute('href', href);\n\n        // urlParsingNode provides the UrlUtils interface - http://url.spec.whatwg.org/#urlutils\n        return {\n          href: urlParsingNode.href,\n          protocol: urlParsingNode.protocol ? urlParsingNode.protocol.replace(/:$/, '') : '',\n          host: urlParsingNode.host,\n          search: urlParsingNode.search ? urlParsingNode.search.replace(/^\\?/, '') : '',\n          hash: urlParsingNode.hash ? urlParsingNode.hash.replace(/^#/, '') : '',\n          hostname: urlParsingNode.hostname,\n          port: urlParsingNode.port,\n          pathname: (urlParsingNode.pathname.charAt(0) === '/') ?\n            urlParsingNode.pathname :\n            '/' + urlParsingNode.pathname\n        };\n      }\n\n      originURL = resolveURL(window.location.href);\n\n      /**\n    * Determine if a URL shares the same origin as the current location\n    *\n    * @param {String} requestURL The URL to test\n    * @returns {boolean} True if URL shares the same origin, otherwise false\n    */\n      return function isURLSameOrigin(requestURL) {\n        var parsed = (utils.isString(requestURL)) ? resolveURL(requestURL) : requestURL;\n        return (parsed.protocol === originURL.protocol &&\n            parsed.host === originURL.host);\n      };\n    })() :\n\n  // Non standard browser envs (web workers, react-native) lack needed support.\n    (function nonStandardBrowserEnv() {\n      return function isURLSameOrigin() {\n        return true;\n      };\n    })()\n);\n","'use strict';\n\nvar utils = require('./../utils');\n\nmodule.exports = (\n  utils.isStandardBrowserEnv() ?\n\n  // Standard browser envs support document.cookie\n    (function standardBrowserEnv() {\n      return {\n        write: function write(name, value, expires, path, domain, secure) {\n          var cookie = [];\n          cookie.push(name + '=' + encodeURIComponent(value));\n\n          if (utils.isNumber(expires)) {\n            cookie.push('expires=' + new Date(expires).toGMTString());\n          }\n\n          if (utils.isString(path)) {\n            cookie.push('path=' + path);\n          }\n\n          if (utils.isString(domain)) {\n            cookie.push('domain=' + domain);\n          }\n\n          if (secure === true) {\n            cookie.push('secure');\n          }\n\n          document.cookie = cookie.join('; ');\n        },\n\n        read: function read(name) {\n          var match = document.cookie.match(new RegExp('(^|;\\\\s*)(' + name + ')=([^;]*)'));\n          return (match ? decodeURIComponent(match[3]) : null);\n        },\n\n        remove: function remove(name) {\n          this.write(name, '', Date.now() - 86400000);\n        }\n      };\n    })() :\n\n  // Non standard browser env (web workers, react-native) lack needed support.\n    (function nonStandardBrowserEnv() {\n      return {\n        write: function write() {},\n        read: function read() { return null; },\n        remove: function remove() {}\n      };\n    })()\n);\n","'use strict';\n\n/**\n * Determines whether the specified URL is absolute\n *\n * @param {string} url The URL to test\n * @returns {boolean} True if the specified URL is absolute, otherwise false\n */\nmodule.exports = function isAbsoluteURL(url) {\n  // A URL is considered absolute if it begins with \"<scheme>://\" or \"//\" (protocol-relative URL).\n  // RFC 3986 defines scheme name as a sequence of characters beginning with a letter and followed\n  // by any combination of letters, digits, plus, period, or hyphen.\n  return /^([a-z][a-z\\d\\+\\-\\.]*:)?\\/\\//i.test(url);\n};\n","'use strict';\n\n/**\n * Creates a new URL by combining the specified URLs\n *\n * @param {string} baseURL The base URL\n * @param {string} relativeURL The relative URL\n * @returns {string} The combined URL\n */\nmodule.exports = function combineURLs(baseURL, relativeURL) {\n  return relativeURL\n    ? baseURL.replace(/\\/+$/, '') + '/' + relativeURL.replace(/^\\/+/, '')\n    : baseURL;\n};\n","'use strict';\n\nvar Cancel = require('./Cancel');\n\n/**\n * A `CancelToken` is an object that can be used to request cancellation of an operation.\n *\n * @class\n * @param {Function} executor The executor function.\n */\nfunction CancelToken(executor) {\n  if (typeof executor !== 'function') {\n    throw new TypeError('executor must be a function.');\n  }\n\n  var resolvePromise;\n  this.promise = new Promise(function promiseExecutor(resolve) {\n    resolvePromise = resolve;\n  });\n\n  var token = this;\n  executor(function cancel(message) {\n    if (token.reason) {\n      // Cancellation has already been requested\n      return;\n    }\n\n    token.reason = new Cancel(message);\n    resolvePromise(token.reason);\n  });\n}\n\n/**\n * Throws a `Cancel` if cancellation has been requested.\n */\nCancelToken.prototype.throwIfRequested = function throwIfRequested() {\n  if (this.reason) {\n    throw this.reason;\n  }\n};\n\n/**\n * Returns an object that contains a new `CancelToken` and a function that, when called,\n * cancels the `CancelToken`.\n */\nCancelToken.source = function source() {\n  var cancel;\n  var token = new CancelToken(function executor(c) {\n    cancel = c;\n  });\n  return {\n    token: token,\n    cancel: cancel\n  };\n};\n\nmodule.exports = CancelToken;\n","'use strict';\n\n/**\n * Syntactic sugar for invoking a function and expanding an array for arguments.\n *\n * Common use case would be to use `Function.prototype.apply`.\n *\n *  ```js\n *  function f(x, y, z) {}\n *  var args = [1, 2, 3];\n *  f.apply(null, args);\n *  ```\n *\n * With `spread` this example can be re-written.\n *\n *  ```js\n *  spread(function(x, y, z) {})([1, 2, 3]);\n *  ```\n *\n * @param {Function} callback\n * @returns {Function}\n */\nmodule.exports = function spread(callback) {\n  return function wrap(arr) {\n    return callback.apply(null, arr);\n  };\n};\n","//the below are aspirational...\r\n//TerminusClient.WOQL.map = function(){ return new WOQLMapConfig(); }\r\n\r\nconst WOQLTableConfig = require('./viewer/tableConfig');\r\nconst WOQLChooserConfig = require('./viewer/chooserConfig');\r\nconst WOQLGraphConfig = require('./viewer/graphConfig');\r\nconst WOQLChartConfig = require('./viewer/chartConfig');\r\nconst WOQLStreamConfig = require('./viewer/streamConfig');\r\nconst FrameConfig = require('./viewer/frameConfig');\r\nconst WOQLRule = require('./woqlRule');\r\nconst FrameRule = require('./frameRule');\r\n\r\n/**\r\n * We bundle the useful functions in a View object and just export that for ease of consumption\r\n */\r\nconst View = {};\r\n\r\nView.table = function(){ return new WOQLTableConfig(); }\r\nView.chart = function(){ return new WOQLChartConfig(); }\r\nView.graph = function(){ return new WOQLGraphConfig(); }\r\nView.chooser = function(){ return new WOQLChooserConfig(); }\r\nView.stream = function(){ return new WOQLStreamConfig(); }\r\nView.document = function(){ return new FrameConfig(); }\r\nView.loadConfig = function(config){\r\n\tif(config.table){\r\n\t\tvar view = new WOQLTableConfig();\r\n\t\tview.loadJSON(config.table, config.rules);\r\n\t}\r\n\telse if(config.chooser){\r\n\t\tvar view = new WOQLChooserConfig();\r\n\t\tview.loadJSON(config.chooser, config.rules);\r\n\t}\r\n\telse if(config.graph){\r\n\t\tvar view = new WOQLGraphConfig();\r\n\t\tview.loadJSON(config.graph, config.rules);\r\n\t}\r\n\telse if(config.chart){\r\n\t\tvar view = new WOQLChartConfig();\r\n\t\tview.loadJSON(config.chart, config.rules);\r\n\t}\r\n\telse if(config.stream){\r\n\t\tvar view = new WOQLStreamConfig();\r\n\t\tview.loadJSON(config.stream, config.rules);\r\n\t}\r\n\telse if(config.frame){\r\n\t\tvar view = new FrameConfig();\r\n\t\tview.loadJSON(config.frame, config.rules);\r\n\t}\r\n\treturn view;\r\n}\r\n\r\n/**\r\n * Shorthand functions for accessing the pattern matching capabilities\r\n */\r\nView.rule = function(type){ \r\n\tif(type && type == \"frame\") return new FrameRule(); \r\n\treturn new WOQLRule(); \r\n}\r\n\r\nView.pattern = function(type){ \r\n\tif(type && type == \"woql\") return new WOQLRule().pattern;\r\n\telse return new FrameRule().pattern;\r\n}\r\n\r\n/**\r\n * Called to match an entire row of results is matched by a set of rules\r\n * returns array of rules that matched\r\n */\r\nView.matchRow = function(rules, row, rownum, action){\r\n\treturn new WOQLRule().matchRow(rules, row, rownum, action);\r\n}\r\n\r\n/**\r\n * Called to test whether an entire column of results is matched by a set of rules\r\n * returns array of rules that matched\r\n */\r\nView.matchColumn = function(rules, key, action){\r\n\treturn new WOQLRule().matchColumn(rules, key, action);\r\n}\r\n\r\n/**\r\n * Called to test whether a specific cell is matched by a set of rules\r\n * returns array of rules that matched\r\n */\r\nView.matchCell = function(rules, row, key, rownum, action){\r\n\treturn new WOQLRule().matchCell(rules, row, key, rownum, action);\r\n}\r\n\r\n/**\r\n * Called to test whether a specific node is matched by a set of rules\r\n * returns array of rules that matched\r\n */\r\nView.matchNode = function(rules, row, key, nid, action){\r\n\treturn new WOQLRule().matchNode(rules, row, key, nid, action);\r\n}\r\n\r\n/**\r\n * Called to test whether a specific edge (source -> target) is matched by a set of rules\r\n * returns array of rules that matched\r\n */\r\nView.matchEdge = function(rules, row, keya, keyb, action){\r\n\treturn new WOQLRule().matchPair(rules, row, keya, keyb, action);\r\n}\r\n\r\n/**\r\n * Called to test whether a specific frame is matched by a set of rules\r\n */\r\nView.matchFrame = function(rules, frame, onmatch){\r\n\treturn new FrameRule().testRules(rules, frame, onmatch);\r\n}\r\n\r\nmodule.exports = View;\r\n","/**\r\n * @file Javascript Terminus Document Classes\r\n * @license Apache Version 2\r\n * @summary Helper classes for accessing documents returned by the Terminus DB API programmatically\r\n * \r\n * Usage: let doc = new TerminusDocument(client);\r\n * \r\n * These set the objects document property and return promises:\r\n *  \r\n * doc.loadDocument(URL) //.then(() => console.log(this.document));\r\n * doc.loadComplete(URL, CLS) // .then(() => console.log(this.document))\r\n * doc.loadSchema(cls) //.then(() => console.log(this.document))\r\n * \r\n * These just set the object's document property \r\n * doc.loadJSON(json_frames, cls) //console.log(this.document)\r\n * doc.loadDataFrames(json_frames, cls)\r\n * doc.loadClassFrames(json_frames, cls)\r\n * \r\n */\r\nconst FrameHelper = require('./utils');\r\nconst FrameRule = require('./frameRule');\r\n\r\n/**\r\n * Represents a frame for programmatic access to object frame, anywhere within a document\r\n * Recursive data structure where this.children contains an indexed array of object frames\r\n * and this.dataframes contains a property indexed array of data frames\r\n * Every object frame carries a reference to its classframe\r\n * This gives us instructions as to how to create new frames according to the schema\r\n * After that it's turtles all the way down.\r\n * @param cls - ID of the class (URL)\r\n * @param classframe - an array of frames representing a class\r\n * @param archetypes list of class frames\r\n * @param parent parent object\r\n * @returns\r\n */\r\n\r\nfunction ObjectFrame(cls, dataframes, classframes, parent, parentframe) {\r\n\t// the class of the frame - mandatory\r\n\tthis.empty();\r\n\tthis.cls = cls;\r\n\r\n\t// array of frames representing the full class frame\r\n\t// (optional - required to be able to safely add missing properties)\r\n\tif (classframes && typeof classframes === 'object') {\r\n\t\tthis.loadClassFrames(classframes);\r\n\t}\r\n\tif (dataframes && typeof dataframes === 'object') {\r\n\t\tthis.originalFrames = dataframes;\r\n\t\tthis.loadDataFrames(dataframes);\r\n\t} else {\r\n\t\tthis.originalFrames = false;\r\n\t}\r\n\t// parent object frame\r\n\tthis.parent = parent;\r\n\t// original frame used by parent to create me\r\n\tthis.parentframe = parentframe;\r\n\t// set to true if this is a newly created document\r\n\tthis.newDoc = false;\r\n}\r\n\r\n/**\r\n * Loads class frames for the object's class - the instructions about how to put an object together\r\n */\r\nObjectFrame.prototype.loadClassFrames = function (classframes) {\r\n\tfor (let j = 0; j < classframes.length; j += 1) {\r\n\t\tif (classframes[j]['@context']) this.jsonld_context = classframes[j]['@context'];\r\n\r\n\t\tconst cf = new ClassFrame(classframes[j]);\r\n\t\tif (cf.isValid()) {\r\n\t\t\tif(!this.classframes) this.classframes = {};\r\n\t\t\tif(typeof this.classframes[classframes[j].property] === 'undefined') {\r\n\t\t\t\tthis.classframes[classframes[j].property] = [];\r\n\t\t\t}\r\n\t\t\tthis.classframes[classframes[j].property] = cf;\r\n\t\t\tif (cf.isObject() && this.properties[classframes[j].property]) {\r\n\t\t\t\tfor (let i = 0; i < this.properties[classframes[j].property].values.length; i += 1) {\r\n\t\t\t\t\tthis.properties[classframes[j].property].values[i].loadClassFrames(classframes[j].frame);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n};\r\n\r\n/**\r\n * Does this object have a schema loaded?\r\n */\r\nObjectFrame.prototype.hasSchema = function () {\r\n\treturn !FrameHelper.empty(this.classframes);\r\n};\r\n\r\n/*\r\n * Loads an array of data frames into the object's internal index\r\n * {property: [frames]}\r\n */\r\nObjectFrame.prototype.loadDataFrames = function (frames) {\r\n\tif (typeof frames !== 'object' || !frames.length) return undefined;\r\n\tif (!this.originalFrames) this.originalFrames = frames;\r\n\tif (!this.subjid && frames[0].domainValue) this.subjid = frames[0].domainValue;\r\n\tfor (let i = 0; i < frames.length; i += 1) {\r\n\t\tif (frames[i]['@context']) this.jsonld_context = frames[i]['@context'];\r\n\t\tlet cframe = this.getPropertyClassFrame(frames[i].property, frames[i]);\r\n\t\tif (cframe && cframe.isClassChoice()) {\r\n\t\t\tcframe = cframe.getChosenClassFrame(frames[i].range);\r\n\t\t\tif (!cframe) {\r\n\t\t\t\tconsole.log(`no choice frame ${frames[i].range}`);\r\n\t\t\t}\r\n\t\t} else if (cframe && cframe.isLogic()) {\r\n\t\t\tcframe = cframe.getChosenFrame(frames[i]);\r\n\t\t}\r\n\t\tif (cframe) {\r\n\t\t\tif (typeof this.properties[frames[i].property] === 'undefined') {\r\n\t\t\t\tthis.properties[frames[i].property] = new PropertyFrame(frames[i].property, cframe, this);\r\n\t\t\t}\r\n\t\t\tthis.properties[frames[i].property].addFrame(frames[i]);\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n};\r\n\r\n/*\r\n * Serialises the javascript object as an array of frames\r\n */\r\nObjectFrame.prototype.getAsFrame = function (prop, parent) {\r\n\tif (this.parentframe) return this.parentframe;\r\n\tconst ff = { type: 'objectProperty', property: prop };\r\n\tff.range = this.cls;\r\n\tff.domain = parent.cls;\r\n\tff.domainValue = parent.subjid;\r\n\tff.frame = [];\r\n\tfor (const prop of Object.keys(this.properties)) {\r\n\t\tff.frame = ff.frame.concat(ff.frame, this.properties[prop].getAsFrames());\r\n\t}\r\n\treturn ff;\r\n};\r\n\r\nObjectFrame.prototype.getAsFrames = function (prop, parent) {\r\n\tvar frames = [];\r\n\tfor (const prop of Object.keys(this.properties)) {\r\n\t\tframes = frames.concat(frames, this.properties[prop].getAsFrames());\r\n\t}\r\n\treturn frames;\r\n}\r\n\r\n/**\r\n * Cleans out object and sets everything empty\r\n */\r\nObjectFrame.prototype.empty = function () {\r\n\t// all indexed by property\r\n\tthis.properties = {};\r\n\tthis.restrictions = {};\r\n\tthis.subjid = false;\r\n\tthis.cls = false;\r\n};\r\n\r\n/*\r\n * Resets object state to original state\r\n */\r\nObjectFrame.prototype.reset = function (prop) {\r\n\tif (prop) {\r\n\t\tconst props = [];\r\n\t\tfor (let i = 0; i < this.originalFrames.length; i += 1) {\r\n\t\t\tif (this.originalFrames[i].property === prop) {\r\n\t\t\t\tprops.push(this.originalFrames[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.properties[prop]) this.properties[prop] = [];\r\n\t\tthis.loadDataFrames(props);\r\n\t} else {\r\n\t\tthis.restrictions = {};\r\n\t\tthis.properties = {};\r\n\t\tthis.loadDataFrames(this.originalFrames);\r\n\t}\r\n};\r\n\r\n/*\r\n * Clears out any specific information from a tree\r\n */\r\nObjectFrame.prototype.clear = function () {\r\n\tfor (const prop of Object.keys(this.properties)) {\r\n\t\tthis.properties[prop].clear();\r\n\t}\r\n\treturn this;\r\n};\r\n\r\n/*\r\n * Filters the frame and its children\r\n */\r\nObjectFrame.prototype.filter = function (rules, onmatch) {\r\n\tvar hits = new FrameRule().testRules(rules, this, onmatch);\r\n\tfor (const prop of Object.keys(this.properties)) {\r\n\t\tthis.properties[prop].filter(rules, onmatch);\r\n\t}\r\n\treturn this;\r\n};\r\n\r\n\r\n/**\r\n * If a class frame is present, it is returned for the given property\r\n * If no class frame is present and an instance frame is passed in the\r\n * this enables make it up as you go along editing\r\n * second argument a class frame will be created from the instance frame.\r\n */\r\nObjectFrame.prototype.getPropertyClassFrame = function (prop, instance) {\r\n\tif (this.classframes && typeof this.classframes === 'object' && typeof this.classframes[prop] === 'object') {\r\n\t\treturn this.classframes[prop];\r\n\t}\r\n\tif (instance) {\r\n\t\tconst cf = new ClassFrame(instance);\r\n\t\treturn cf;\r\n\t}\r\n\tif (this.properties[prop]) {\r\n\t\treturn new ClassFrame(this.properties[prop].values[0]);\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/*\r\n * Returns a list of properties - type can be filled|missing|all\r\n */\r\nObjectFrame.prototype.getProperties = function (type) {\r\n\tif(type == \"filled\" || !this.classframes){\r\n\t\treturn Object.keys(this.properties);\r\n\t}\r\n\tif (type == 'missing') {\r\n\t\tconst filled = Object.keys(this.properties);\r\n\t\tconst all = Object.keys(this.classframes);\r\n\t\tconst missing = [];\r\n\t\tfor (let i = 0; i < all.length; i++) {\r\n\t\t\tif (filled.indexOf(all[i]) == -1 && missing.indexOf(all[i]) == -1) {\r\n\t\t\t\tmissing.push(all[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn missing;\r\n\t}\r\n\treturn Object.keys(this.classframes);\r\n};\r\n\r\n/**\r\n * Missing properties are those that are present in the classframe,\r\n * but not instantiated in the current object frame\r\n * for this to work we need to load the frame with the associated classframe\r\n */\r\nObjectFrame.prototype.getMissingPropertyList = function () {\r\n\tvar missing = this.getProperties(\"missing\");\r\n\tconst nmissing = [];\r\n\tfor (let i = 0; i < missing.length; i++) {\r\n\t\tconst cframe = this.getPropertyClassFrame(missing[i]);\r\n\t\tif(cframe){\r\n\t\t\tvar newb = { label: cframe.getLabel(), value: missing[i] };\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar newb = { label: missing[i], value: missing[i]};\r\n\t\t}\r\n\t\tnmissing.push(newb);\r\n\t}\r\n\treturn nmissing;\r\n};\r\n\r\n/**\r\n * List of properties that are filled in the object\r\n */\r\nObjectFrame.prototype.getFilledPropertyList = function () {\r\n\tvar props = this.getProperties(\"filled\");\r\n\tconst filled = [];\r\n\tfor (let i = 0; i < props.length; i++) {\r\n\t\tconst cframe = this.getPropertyClassFrame(props[i]);\r\n\t\tif(cframe){\r\n\t\t\tvar newb = { label: cframe.getLabel(), value: props[i] };\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar newb = { label: props[i], value: props[i]};\r\n\t\t}\r\n\t\tfilled.push(newb);\r\n\t}\r\n\treturn filled;\r\n};\r\n\r\n/*\r\n * Fills the object frame from the schema - adding all the necessary property frames, etc to make it complete\r\n */\r\nObjectFrame.prototype.fillFromSchema = function (newid) {\r\n\tif (newid) this.subjid = newid;\r\n\tnewid = (newid || FrameHelper.genBNID());\r\n\tconst properties = {};\r\n\tif(this.classframes){\r\n\t\tfor (const prop of Object.keys(this.classframes)) {\r\n\t\t\tconst pf = this.getPropertyClassFrame(prop);\r\n\t\t\tproperties[prop] = new PropertyFrame(prop, pf, this);\r\n\t\t\tproperties[prop].fillFromSchema(newid);\r\n\t\t}\r\n\t}\r\n\tthis.properties = properties;\r\n\tthis.originalFrames = [];\r\n\tfor (const prop of Object.keys(this.properties)) {\r\n\t\tthis.originalFrames.push(this.properties[prop].getAsFrames());\r\n\t}\r\n\treturn this;\r\n};\r\n\r\n/*\r\n * Clones an object frame to be a copy of the current frame\r\n */\r\nObjectFrame.prototype.clone = function (newid) {\r\n\tconst properties = {};\r\n\tconst cloned = new ObjectFrame(this.cls, false, false, this.parent);\r\n\tcloned.classframes = this.classframes;\r\n\tcloned.subjid = newid;\r\n\tfor (const prop of Object.keys(this.properties)) {\r\n\t\tproperties[prop] = this.properties[prop].clone();\r\n\t}\r\n\tcloned.properties = properties;\r\n\treturn cloned;\r\n};\r\n\r\n\r\n/**\r\n * Returns a child frame with a particular id\r\n * If the second parameter is included, it will only look in that specific property\r\n * Otherwise searches all properties for the child\r\n */\r\nObjectFrame.prototype.getChild = function (childid, prop) {\r\n\tlet pframe = this.getProperty(prop);\r\n\tfor (let i = 0; i < pframe.values.length; pframe++) {\r\n\t\tif (pframe.values[i].isObject() && pframe.values[i].subject === childid) return pframe.values[i];\r\n\t}\r\n\tif (!prop) {\r\n\t\tfor (const key of Object.keys(this.properties)) {\r\n\t\t\tfor (let i = 0; i < this.properties[key].values.length; i += 1) {\r\n\t\t\t\tif (this.properties[key].values[i].subject() === childid) return this.properties[key].values[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nObjectFrame.prototype.addProperty = function (prop, cls) {\r\n\tconst cframe = this.getPropertyClassFrame(prop);\r\n\tvar ndata = false;\r\n\tif(cframe){\r\n\t\tconst nprop = new PropertyFrame(prop, cframe, this);\r\n\t\tif(cframe.isObject()){\r\n\t\t\tif (!cframe.isClassChoice()) {\r\n\t\t\t\tndata = cframe.createEmpty(FrameHelper.genBNID());\r\n\t\t\t}\r\n\t\t\tif (cls) {\r\n\t\t\t\tndata = cframe.createEmptyChoice(cls, FrameHelper.genBNID());\r\n\t\t\t}\r\n\t\t\tconst clss = cframe.getClassChoices();\r\n\t\t\tif (clss && clss.length) {\r\n\t\t\t\tndata = cframe.createEmptyChoice(clss[0], FrameHelper.genBNID());\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tndata = cframe.createEmpty();\r\n\t\t}\r\n\t\tif(ndata){\r\n\t\t\tnprop.addValueFrame(ndata);\r\n\t\t}\r\n\t\tif (typeof this.properties[prop] === 'undefined') {\r\n\t\t\tthis.properties[prop] = [];\r\n\t\t}\r\n\t\tthis.properties[prop].push(nprop);\r\n\t\treturn nprop;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nObjectFrame.prototype.addPropertyValue = function (prop, value) {\r\n\tconst pframe = this.properties[prop];\r\n\treturn pframe.addValue(value);\r\n};\r\n\r\nObjectFrame.prototype.removeProperty = function (prop) {\r\n\tif (typeof this.properties[prop] !== 'undefined') {\r\n\t\tdelete (this.properties[prop]);\r\n\t}\r\n};\r\n\r\nObjectFrame.prototype.removePropertyValue = function (prop, value, index) {\r\n\tconst pframe = this.properties[prop];\r\n\tpframe.removeValue(value, index);\r\n\tif (pframe.values.length == 0) {\r\n\t\tthis.removeProperty(prop);\r\n\t}\r\n};\r\n\r\nObjectFrame.prototype.error = function (msg) {\r\n\tconsole.error(msg);\r\n};\r\n\r\nObjectFrame.prototype.extract = function(){\r\n\tvar extracts = {};\r\n\tfor(var prop in this.properties){\r\n\t\tfor(var i = 0; i<this.properties[prop].length; i++){\r\n\t\t\tvar extracted = this.properties[prop][i].extract();\r\n\t\t\tif(!FrameHelper.empty(extracted)){\r\n\t\t\t\tif(typeof extracts[prop] == \"undefined\") extracts[prop] = [];\r\n\t\t\t\textracts[prop] = extracts[prop].concat(extracted);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif(FrameHelper.empty(extracts) && this.parent){\r\n\t\treturn false;\r\n\t}\r\n\telse {\r\n\t\tvar ext = this.extractJSONLD(extracts);\r\n\t\treturn ext;\r\n\t}\r\n}\r\n\r\nObjectFrame.prototype.extractJSONLD = function(extracts){\r\n\textracts[\"@type\"] = this.cls;\r\n\tif(this.subject() != \"_:\")\textracts[\"@id\"] = this.subject();\r\n\tif(this.jsonld_context) extracts['@context'] = this.jsonld_context;\r\n\treturn extracts;\r\n}\r\n\r\n\r\nObjectFrame.prototype.subject = function () {\r\n\treturn this.subjid;\r\n};\r\n\r\nObjectFrame.prototype.get = ObjectFrame.prototype.subject;\r\nObjectFrame.prototype.set = function(val){\r\n\tthis.subjid = val;\r\n}\r\n\r\nObjectFrame.prototype.isObject = function () { return true; };\r\nObjectFrame.prototype.isProperty = function () { return false; };\r\nObjectFrame.prototype.isData = function () { return false; };\r\n\r\n\r\nObjectFrame.prototype.subjectClass = function () {\r\n\treturn this.cls;\r\n};\r\n\r\nObjectFrame.prototype.depth = function () {\r\n\tif (this.parent) return (this.parent.depth() + 1);\r\n\treturn 0;\r\n};\r\n\r\nObjectFrame.prototype.getProperty = function (prop) {\r\n\treturn this.properties[prop];\r\n};\r\n\r\nObjectFrame.prototype.first = function (prop) {\r\n\tif (this.properties && this.properties[prop]) {\r\n\t\treturn this.properties[prop].first();\r\n\t}\r\n};\r\n\r\nObjectFrame.prototype.property = function (prop) {\r\n\tif (this.parent) return this.parent.property();\r\n\treturn false;\r\n};\r\n\r\nObjectFrame.prototype.parentObject = function () {\r\n\tif (this.parent && this.parent.parent) {\r\n\t\treturn this.parent.parent;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nObjectFrame.prototype.root = function () {\r\n\tif (this.parent) return false;\r\n\treturn true;\r\n};\r\n\r\nObjectFrame.prototype.renderProperties = function () {\r\n\tconst props = this.sortProperties();\r\n\tconst nprops = [];\r\n\tfor (let i = 0; i < props.length; i++) {\r\n\t\tif (this.properties[props[i]].render) {\r\n\t\t\tconst rend = this.properties[props[i]].render(this.properties[props[i]]);\r\n\t\t\tif (rend) nprops.push(rend);\r\n\t\t}\r\n\t}\r\n\treturn nprops;\r\n};\r\n\r\nObjectFrame.prototype.sortProperties = function () {\r\n\tconst unsorted = Object.keys(this.properties);\r\n\tif (this.compare) {\r\n\t\treturn unsorted.sort((a, b) => this.compare(a, b, this));\r\n\t}\r\n\treturn unsorted.sort((a, b) => this.standardCompare(a, b, this));\r\n};\r\n\r\n/*\r\n * Label first, then datatype properties, then object properties\r\n */\r\nObjectFrame.prototype.standardCompare = function (a, b, doc) {\r\n\tif (a == 'rdfs:label') return -1;\r\n\tif (b == 'rdfs:label') return 1;\r\n\tif (a == 'rdfs:comment') return -1;\r\n\tif (b == 'rdfs:comment') return 1;\r\n\tif (doc.properties[a].isData() && doc.properties[b].isObject()) return -1;\r\n\tif (doc.properties[b].isData() && doc.properties[a].isObject()) return 1;\r\n\treturn 0;\r\n};\r\n\r\nObjectFrame.prototype.cardControlAllows = function(action){\r\n\tif(!this.parent) return true;\r\n\tif(this.parent.cframe.hasRestriction()){\r\n\t\tvar rest = this.parent.cframe.restriction;\r\n\t\tvar currentnum = this.parent.values.length;\r\n\t\tif(action == \"add\" || action == \"clone\"){\r\n\t\t\tif(rest.max && currentnum >= rest.max){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(action == \"delete\" && (rest.min && currentnum <= rest.min)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nObjectFrame.prototype.isUpdated = function(){\r\n\tvar i = 0;\r\n\tfor(var prop in this.properties){\r\n\t\tif(this.originalFrames[i] != prop) return true;\r\n\t\tif(this.properties[prop].isUpdated()) return true;\r\n\t\ti++;\r\n\t}\r\n\tif(i != this.originalFrames.length) return true;\r\n\treturn false;\r\n}\r\n\r\nObjectFrame.prototype.isNew = function(){\r\n\treturn (this.subject().substring(0, 2) == \"_:\");\r\n}\r\n\r\nObjectFrame.prototype.getSummary = function(){\r\n\tvar ret = { status: \"ok\" };\r\n\tif(this.isUpdated()) ret.status = \"updated\";\r\n\tif(this.isNew()) ret.status = \"new\";\r\n\tret.propcount = 0;\r\n\tfor(var prop in this.properties){\r\n\t\tret.propcount++;\r\n\t}\r\n\tret.long = ret.propcount + \" properties\";\r\n\treturn ret;\r\n}\r\n\r\nfunction PropertyFrame(property, cframe, parent) {\r\n\tthis.predicate = property;\r\n\tthis.cframe = cframe;\r\n\tthis.parent = parent;\r\n\tthis.values = [];\r\n}\r\n\r\nPropertyFrame.prototype.addFrame = function (frame) {\r\n\tif(this.cframe.isData()){\r\n\t\tvar df = new DataFrame(frame, this, this.values.length);\r\n\t\tthis.values.push(df);\r\n\t} else {\r\n\t\tconst kid = new ObjectFrame(this.range(), this.cframe.frame, frame.frame, this, frame);\r\n\t\tthis.values.push(kid);\r\n\t}\r\n};\r\n\r\nPropertyFrame.prototype.addValueFrame = function (oframe) {\r\n\toframe.parent = this;\r\n\toframe.index = this.values.length;\r\n\tthis.values.push(oframe);\r\n};\r\n\r\n\r\nPropertyFrame.prototype.fillFromSchema = function (newid) {\r\n\tif (this.isData() || (this.isObject() && !this.isClassChoice())) {\r\n\t\tvar values = [];\r\n\t\tif (this.cframe.hasRestriction() && this.cframe.restriction.min) {\r\n\t\t\tfor (let i = 0; i < this.cframe.restriction.min; i += 1) {\r\n\t\t\t\tvar nframe = this.createEmpty(newid);\r\n\t\t\t\tnframe.parent = this;\r\n\t\t\t\tvalues.push(nframe);\r\n\t\t\t}\r\n\t\t} \r\n\t\telse {\r\n\t\t\tvar nframe = this.createEmpty(newid);\r\n\t\t\tnframe.parent = this;\r\n\t\t\tvalues.push(nframe);\r\n\t\t}\r\n\t\tthis.values = values;\r\n\t}\r\n\telse if (this.isClassChoice()) {\r\n\t\tconst clss = this.cframe.getClassChoices();\r\n\t\tif (clss && clss.length) {\r\n\t\t\tconst empty = this.cframe.createEmptyChoice(clss[0], FrameHelper.genBNID());\r\n\t\t\tempty.parent = this;\r\n\t\t\tthis.values = [empty];\r\n\t\t}\r\n\t}\r\n};\r\n\r\nPropertyFrame.prototype.isData = function () {\r\n\treturn this.cframe.isData();\r\n};\r\n\r\nPropertyFrame.prototype.isObject = function () {\r\n\treturn this.cframe.isObject();\r\n};\r\n\r\nPropertyFrame.prototype.isProperty = function () {\r\n\treturn true;\r\n};\r\n\r\nPropertyFrame.prototype.property = function () {\r\n\treturn this.predicate;\r\n};\r\n\r\nPropertyFrame.prototype.extract = function () {\r\n \tconst extracts = [];\r\n \tfor (let i = 0; i < this.values.length; i++) {\r\n \t\tconst val = this.values[i].extract();\r\n \t\tif (val !== '' && val !== false && typeof val !== 'undefined') extracts.push(val);\r\n \t}\r\n\treturn extracts;\r\n};\r\n\r\nPropertyFrame.prototype.subject = function () {\r\n\treturn (this.parent ? this.parent.subject() : false);\r\n};\r\nPropertyFrame.prototype.subjectClass = function () {\r\n\treturn (this.parent ? this.parent.subjectClass() : false);\r\n};\r\nPropertyFrame.prototype.depth = function () {\r\n\treturn (this.parent ? this.parent.depth() : false);\r\n};\r\nPropertyFrame.prototype.updated = function () {\r\n\treturn (this.parent ? this.parent.childUpdated() : false);\r\n};\r\nPropertyFrame.prototype.range = function () {\r\n\treturn (this.cframe ? this.cframe.range : '');\r\n};\r\nPropertyFrame.prototype.getLabel = function () {\r\n\treturn (\r\n\t\tthis.cframe ? this.cframe.getLabel() : '');\r\n};\r\nPropertyFrame.prototype.getComment = function () {\r\n\treturn (this.cframe ? this.cframe.getComment() : false);\r\n};\r\nPropertyFrame.prototype.hasCardinalityRestriction = function () {\r\n\treturn (this.cframe ? this.cframe.hasRestriction() : false);\r\n};\r\nPropertyFrame.prototype.getRestriction = function () {\r\n\treturn (this.cframe ? this.cframe.restriction : false);\r\n};\r\nPropertyFrame.prototype.isClassChoice = function () {\r\n\treturn (this.cframe ? this.cframe.isClassChoice() : false);\r\n};\r\n\r\nPropertyFrame.prototype.deletePropertyValue = function (value, index) {\r\n\tthis.parent.removePropertyValue(this.property(), value, index);\r\n};\r\n\r\nPropertyFrame.prototype.get = function(){\r\n\tvar gets = [];\r\n\tfor(var i = 0; i<this.values.length; i++){\r\n\t\tif(this.values[i]) {\r\n\t\t\tvar x = this.values[i].get();\r\n\t\t\tif(x) gets.push(x);\r\n\t\t}\r\n\t}\r\n\treturn gets;\r\n}\r\n\r\nPropertyFrame.prototype.set = function(val){\r\n\tfor(var i = 0; i<this.values.length; i++){\r\n\t\tif(this.values[i]) {\r\n\t\t\tthis.values[i].set(val);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nPropertyFrame.prototype.clear = function(){\r\n\tfor(var i = 0 ; i<this.values.length; i++){\r\n\t\tthis.values[i].clear();\r\n\t}\r\n}\r\n\r\nPropertyFrame.prototype.clone = function(){\r\n\tconst cvalues = [];\r\n\tconst cloned = new PropertyFrame(this.predicate, this.cframe, this.parent);\r\n\tfor(var i = 0 ; i<this.values.length; i++){\r\n\t\tcvalues.push(this.values[i].clone());\r\n\t}\r\n\tcloned.values = cvalues;\r\n\treturn cloned;\r\n\t//\r\n}\r\n\r\nPropertyFrame.prototype.getAsFrames = function(){\r\n\tvar fs = [];\r\n\tfor(var i = 0; i<this.values.length; i++){\r\n\t\tif(this.values[i]){\r\n\t\t\tif(this.isData()){\r\n\t\t\t\tfs.push(this.values[i].getAsFrame());\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfs = fs.concat(this.values[i].getAsFrames());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn fs;\r\n}\r\n\r\nPropertyFrame.prototype.createEmpty = function(){\r\n\tif (this.cframe.isData()) {\r\n\t\tconst df = this.cframe.copy();\r\n\t\tdf.set('');\r\n\t\treturn df;\r\n\t}\r\n\telse if (this.cframe.isObject()) {\r\n\t\tif (!this.cframe.isClassChoice()) {\r\n\t\t\tconst df = this.cframe.createEmpty(FrameHelper.genBNID());\r\n\t\t\treturn df;\r\n\t\t}\r\n\t\tconst clss = this.cframe.getClassChoices();\r\n\t\tif (clss && clss.length) {\r\n\t\t\tconst df = this.cframe.createEmptyChoice(clss[0], FrameHelper.genBNID());\r\n\t\t\treturn df;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nPropertyFrame.prototype.filter = function (rules, onmatch) {\r\n\tvar hits = new FrameRule().testRules(rules, this, onmatch);\r\n\tfor (var i = 0; i<this.values.length; i++){\r\n\t\tthis.values[i].filter(rules, onmatch);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n/*\r\n * Shorthand functions to make it easier to access the underlying data\r\n */\r\n\r\nPropertyFrame.prototype.first = function () {\r\n\tif (this.values && this.values[0]) {\r\n\t\treturn this.values[0].get();\r\n\t}\r\n};\r\n\r\nPropertyFrame.prototype.renderValues = function(){\r\n\tvar sortedVals = this.sortValues();\r\n\tvar vals = [];\r\n\tfor(var i = 0; i<sortedVals.length; i++){\r\n\t\tif(sortedVals[i] && sortedVals[i].render){\r\n\t\t\tvar rend = sortedVals[i].render(sortedVals[i]);\r\n\t\t\tif(rend) vals.push(rend);\r\n\t\t}\r\n\t}\r\n\treturn vals;\r\n};\r\n\r\nPropertyFrame.prototype.sortValues = function () {\r\n\tif (this.compare) {\r\n\t\treturn this.values.sort((a, b) => this.compare(a, b, this));\r\n\t}\r\n\treturn this.values;\r\n};\r\n\r\nPropertyFrame.prototype.cardControlAllows = function(action){\r\n\tif(this.cframe.hasRestriction()){\r\n\t\tvar rest = this.cframe.restriction;\r\n\t\tvar currentnum = this.values.length;\r\n\t\tif(action == \"add\" || action == \"clone\"){\r\n\t\t\tif(rest.max && currentnum >= rest.max){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(action == \"delete\" && (rest.min)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nPropertyFrame.prototype.isUpdated = function(){\r\n\treturn true;\r\n\tif(this.values.length != this.originalValues.length) return true;\r\n\tfor(var i = 0 ; i < this.values.length; i++){\r\n\t\tif(this.cframe && this.cframe.isData()){\r\n\t\t\tif(this.values[i].value() != this.originalValues[i]){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(this.values[i].subject() != this.originalValues[i]) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif(this.values[i].isUpdated()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n\r\nfunction DataFrame(frame, parent, index) {\r\n\tthis.err = false;\r\n\tthis.parent = parent;\r\n\t// the id of the object that owns this dataframe\r\n\tthis.subjid = (parent ? parent.subjid : false);\r\n\tthis.index = index;\r\n\tif (frame) {\r\n\t\tthis.load(frame);\r\n\t}\r\n}\r\n\r\nDataFrame.prototype.load = function (frame) {\r\n\tif (typeof frame !== 'object') {\r\n\t\tthis.error('No frame passed to load');\r\n\t\treturn;\r\n\t}\r\n\t// all the meta-data carried in frames:\r\n\tthis.type = frame.type;\r\n\tthis.predicate = frame.property;\r\n\tthis.range = frame.range;\r\n\tthis.rangeValue = frame.rangeValue;\r\n\tthis.domain = frame.domain;\r\n\tthis.domainValue = frame.domainValue;\r\n\tthis.frame = frame.frame;\r\n\tthis.label = frame.label;\r\n\tthis.comment = frame.comment;\r\n\tconst { restriction } = frame;\r\n\tthis.restriction = false;\r\n\tif (restriction && typeof restriction === 'object') {\r\n\t\tthis.restriction = new Restriction(restriction);\r\n\t}\r\n};\r\n\r\nDataFrame.prototype.filter = function (rules, onmatch) {\r\n\tvar hits = new FrameRule().testRules(rules, this, onmatch);\r\n\treturn this;\r\n};\r\n\r\nDataFrame.prototype.delete = function () {\r\n\tthis.parent.deletePropertyValue(this.get(), this.index);\r\n};\r\n\r\nDataFrame.prototype.save = function () {\r\n\tif (this.parent) {\r\n\t\tthis.parent.save();\r\n\t}\r\n};\r\n\r\nDataFrame.prototype.reset = function () {\r\n\tthis.set(this.originalValue);\r\n\t// this.redraw();\r\n};\r\n\r\nDataFrame.prototype.clone = function () {\r\n\tconst newb = this.parent.addPropertyValue(this.get());\r\n\tconst nrend = this.copy(newb);\r\n\tnrend.setNew();\r\n\tnrend.mode = 'edit';\r\n\tnrend.index = this.parent.values.length;\r\n\tthis.parent.values.push(nrend);\r\n};\r\n\r\n\r\nDataFrame.prototype.depth = function () { return (this.parent ? this.parent.depth() : false); };\r\nDataFrame.prototype.property = function () { return (this.parent ? this.parent.property() : false); };\r\nDataFrame.prototype.subject = function () { return (this.parent ? this.parent.subject() : false); };\r\nDataFrame.prototype.subjectClass = function () { return (this.parent ? this.parent.subjectClass() : false); };\r\nDataFrame.prototype.type = function () {\treturn (this.range ? this.range : false); };\r\n\r\nDataFrame.prototype.isValidType = function (dt) {\r\n\tconst vtypes = ['datatypeProperty', 'objectProperty', 'restriction '];\r\n\tif (vtypes.indexOf(dt) === -1) return false;\r\n\treturn true;\r\n};\r\n\r\n\r\nDataFrame.prototype.getAsFrame = function () {\r\n\t const ff = { type: this.type, property: this.property() };\r\n\t if (this.range) ff.range = this.range;\r\n\t if (this.rangeValue) ff.rangeValue = this.rangeValue;\r\n\t if (this.domain) ff.domain = this.domain;\r\n\t if (this.domainValue) ff.domainValue = this.domainValue;\r\n\t if (this.frame) ff.frame = this.frame;\r\n\t if (this.label) ff.label = this.label;\r\n\t if (this.comment) ff.comment = this.comment;\r\n\t return ff;\r\n};\r\n\r\nDataFrame.prototype.hasRestriction = function () {\r\n\t if (this.restriction) {\r\n\t\t return this.restriction.hasCardRestriction();\r\n\t }\r\n\t return false;\r\n};\r\n\r\nDataFrame.prototype.copy = function (newid) {\r\n\tconst copy = new DataFrame(this, this.parent);\r\n\tif (newid) copy.domainValue = newid;\r\n\treturn copy;\r\n};\r\n\r\nDataFrame.prototype.getLabel = function () {\r\n\tlet lab = '';\r\n\tif(this.predicate == \"rdfs:label\") return \"Name\";\r\n\tif(this.predicate == \"rdfs:comment\") return \"Description\";\r\n\tif (this.label && typeof this.label === 'object') lab = this.label['@value'];\r\n\tif (this.label && typeof this.label === 'string') lab = this.label;\r\n\t// always return something\r\n\tif (!lab && this.property()) lab = FrameHelper.labelFromURL(this.property());\r\n\tif (!lab) lab = FrameHelper.labelFromURL(this.cls);\r\n\treturn lab;\r\n};\r\n\r\nDataFrame.prototype.getType = function () {\r\n\tif (this.range) return this.range;\r\n\tif (this.rangeValue && this.rangeValue.type) return this.rangeValue.type;\r\n\treturn false;\r\n};\r\n\r\nObjectFrame.prototype.getLabel = DataFrame.prototype.getLabel;\r\n\r\nDataFrame.prototype.getComment = function () {\r\n\tlet comment = '';\r\n\tif (this.comment && typeof this.comment === 'object') comment = this.comment['@value'];\r\n\tif (this.comment && typeof this.comment === 'string') comment = this.comment;\r\n\treturn comment;\r\n};\r\n\r\nObjectFrame.prototype.getComment = DataFrame.prototype.getComment;\r\n\r\n\r\nDataFrame.prototype.error = function (msg) {\r\n\tif (msg)\tthis.err = msg;\r\n\treturn this.err;\r\n};\r\n\r\nDataFrame.prototype.isValid = function () {\r\n\tif (!(this.type && this.isValidType(this.type))) {\r\n\t\tthis.error(`Missing or Illegal Frame Type ${this.type}`);\r\n\t\treturn false;\r\n\t}\r\n\tif (!(this.predicate)) {\r\n\t\tthis.error('Missing Frame Property');\r\n\t\treturn false;\r\n\t}\r\n\tif (!(this.domain)) {\r\n\t\tthis.error('Missing Frame Domain');\r\n\t\treturn false;\r\n\t}\r\n\tif (!(this.range)) {\r\n\t\tthis.error('Missing Frame Range');\r\n\t\treturn false;\r\n\t}\r\n\tif (this.isObjectProperty() && !(this.frame && typeof this.frame === 'object')) {\r\n\t\tthis.error('Missing Object Frame');\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nDataFrame.prototype.isObjectProperty = function () {\r\n\treturn this.type === 'objectProperty';\r\n};\r\n\r\nDataFrame.prototype.isDatatypeProperty = function () {\r\n\treturn this.type === 'datatypeProperty';\r\n};\r\n\r\nDataFrame.prototype.isLogic = function () {\r\n\tif (this.type === 'and' || this.type === 'or' || this.type === 'xor') {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nDataFrame.prototype.isRestriction = function () {\r\n\treturn this.type === 'restriction';\r\n};\r\n\r\nDataFrame.prototype.ftype = function () {\r\n\tif (this.isDocument()) return 'document';\r\n\tif (this.isDatatypeProperty()) return 'data';\r\n\tif (this.isChoice()) return 'oneOf';\r\n\tif (this.isObject()) return 'object';\r\n\tif (this.isLogic()) return 'logic';\r\n\tif (this.isClassChoice()) return 'class_choice';\r\n\treturn undefined;\r\n};\r\n\r\n\r\nDataFrame.prototype.isClassChoice = function () {\r\n\treturn (this.frame && this.frame.type === 'class_choice');\r\n};\r\n\r\nDataFrame.prototype.isString = function () {\r\n\tif (this.range === FrameHelper.getStdURL('xsd', 'string')) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nDataFrame.prototype.getChoiceOptions = function () {\r\n\tconst opts = [];\r\n\tfor (let i = 0; i < this.frame.elements.length; i += 1) {\r\n\t\tconst option = {};\r\n\t\tif (this.frame.elements[i].label) {\r\n\t\t\toption.label = this.frame.elements[i].label['@value'];\r\n\t\t} else {\r\n\t\t\toption.label = FrameHelper.labelFromURL(this.frame.elements[i].class);\r\n\t\t}\r\n\t\toption.value = this.frame.elements[i].class;\r\n\t\topts.push(option);\r\n\t}\r\n\treturn opts;\r\n};\r\n\r\nDataFrame.prototype.lang = function () {\r\n\treturn 'en';\r\n};\r\n\r\nDataFrame.prototype.isChoice = function () {\r\n\treturn (this.frame && this.frame.type === 'oneOf');\r\n};\r\n\r\nDataFrame.prototype.isDocument = function () {\r\n\treturn (this.frame && this.frame.type === 'document');\r\n};\r\n\r\nDataFrame.prototype.isData = function () {\r\n\treturn (this.isDocument() || this.isChoice() || this.isDatatypeProperty());\r\n};\r\n\r\nDataFrame.prototype.isObject = function () {\r\n\treturn (this.isObjectProperty() && this.frame && !(this.isChoice() || this.isDocument()));\r\n};\r\n\r\nDataFrame.prototype.isProperty = function () {\r\n\treturn false;\r\n};\r\n\r\nDataFrame.prototype.getTypeShorthand = function () {\r\n\tif (this.isDocument()) return 'document';\r\n\tif (this.isChoice()) return 'choice';\r\n\tconst sh = FrameHelper.getShorthand(this.getType());\r\n\treturn (sh || this.getType());\r\n};\r\n\r\nDataFrame.prototype.get = function () {\r\n\tif (this.contents) {\r\n\t\treturn this.contents;\r\n\t}\r\n\tif (this.isDatatypeProperty() && this.rangeValue && typeof this.rangeValue['@value'] !== 'undefined') {\r\n\t\treturn this.rangeValue['@value'];\r\n\t}\r\n\tif (this.isChoice() || this.isDocument()) {\r\n\t\treturn this.frame.domainValue;\r\n\t}\r\n\treturn '';\r\n};\r\n\r\nDataFrame.prototype.set = function (value, normalizer) {\r\n\tif (normalizer) value = normalizer(value, this);\r\n\tthis.contents = value;\r\n\tif (this.isChoice() || this.isDocument()) {\r\n\t\tthis.frame.domainValue = value;\r\n\t}\r\n\tif (this.isDatatypeProperty() && this.rangeValue) {\r\n\t\tthis.rangeValue['@value'] = value;\r\n\t}\r\n};\r\n\r\nDataFrame.prototype.clear = function () {\r\n\tif (this.isDocument() || this.isChoice() || this.isDatatypeProperty()) {\r\n\t\tthis.set('');\r\n\t}\r\n};\r\n\r\nDataFrame.prototype.cardControlAllows = function(action){\r\n\tif(this.parent.cframe.hasRestriction()){\r\n\t\tvar rest = this.parent.cframe.restriction;\r\n\t\tvar currentnum = this.parent.values.length;\r\n\t\tif(action == \"add\" || action == \"clone\"){\r\n\t\t\tif(rest.max && currentnum >= rest.max){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(action == \"delete\" && (rest.min && currentnum <= rest.min)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nDataFrame.prototype.extract = function(){\r\n\tvar val = this.get();\r\n\tif(val !== \"\" && val !== false){\r\n\t\tif(this.isDatatypeProperty()){\r\n\t\t\tvar objlit = { \"@value\": this.get()}\r\n\t\t\tif(this.isString()) objlit[\"@language\"] = this.lang();\r\n\t\t\telse objlit[\"@type\"] = this.getType();\r\n\t\t\treturn objlit;\r\n\t\t}\r\n\t\telse if(this.isChoice() || this.isDocument()){\r\n\t\t\treturn {\"@id\": val}\r\n\t\t}\r\n\t}\r\n\treturn val;\r\n}\r\n\r\n\r\n/*\r\n * Class frames represent the archetypal version of a property frame as returned by the class frame api\r\n */\r\nfunction ClassFrame(frame, parent) {\r\n\tthis.err = false;\r\n\tthis.parent = parent;\r\n\t// the id of the object that owns this dataframe\r\n\tthis.subjid = (parent ? parent.subjid : false);\r\n\tif (frame) {\r\n\t\tthis.load(frame);\r\n\t}\r\n}\r\n\r\nClassFrame.prototype = DataFrame.prototype;\r\n\r\nClassFrame.prototype.loadFromObjectFrame = function (par, child) {\r\n\t// all the meta-data carried in frames:\r\n\tthis.type = 'objectProperty';\r\n\tthis.predicate = par.property;\r\n\tthis.range = par.range;\r\n\tthis.rangeValue = child.subjid;\r\n\tthis.domain = par.cls;\r\n\tthis.domainValue = par.subjid;\r\n\tthis.label = par.getLabel();\r\n\tthis.comment = par.getComment();\r\n\tthis.restriction = par.restriction;\r\n};\r\n\r\nClassFrame.prototype.createEmptyChoice = function (cls, newid) {\r\n\tconst cf = this.getChosenClassFrames(cls);\r\n\tconst objframe = new ObjectFrame(cls);\r\n\tif (newid) objframe.subjid = newid;\r\n\tobjframe.loadClassFrames(cf);\r\n\tconst fframe = objframe.fillFromSchema();\r\n\treturn fframe;\r\n};\r\n\r\nClassFrame.prototype.getChosenClassFrames = function (chosen) {\r\n\tlet nc = [];\r\n\tfor (let i = 0; i < this.frame.operands.length; i += 1) {\r\n\t\tfor (let j = 0; j < this.frame.operands[i].length; j += 1) {\r\n\t\t\tif (chosen === this.frame.operands[i][j].domain) {\r\n\t\t\t\tnc = nc.concat(this.frame.operands[i][j]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn nc;\r\n};\r\n\r\nClassFrame.prototype.createEmpty = function (newid) {\r\n\tif (this.isObject()) {\r\n\t\tconst objframe = new ObjectFrame(this.range);\r\n\t\tif (newid) objframe.subjid = newid;\r\n\t\tobjframe.loadClassFrames(this.frame);\r\n\t\tconst fframe = objframe.fillFromSchema();\r\n\t\treturn fframe;\r\n\t}\r\n\tif (this.isData()) {\r\n\t\tconst dataframe = this.copy();\r\n\t\tdataframe.set('');\r\n\t\treturn dataframe;\r\n\t}\r\n\treturn undefined;\r\n};\r\n\r\nClassFrame.prototype.cloneDataFrame = function (newid, other) {\r\n\treturn other;\r\n};\r\n\r\nClassFrame.prototype.clone = function (newid, other) {\r\n\tif (this.isObject()) {\r\n\t\tconsole.log('cannot clone class frame');\r\n\t} else if (this.isData()) {\r\n\t\treturn this.cloneDataFrame(newid, other);\r\n\t}\r\n\treturn undefined;\r\n};\r\n\r\nClassFrame.prototype.getClassChoices = function () {\r\n\tconst choices = [];\r\n\tif (this.frame.operands) {\r\n\t\tfor (let i = 0; i < this.frame.operands.length; i += 1) {\r\n\t\t\tfor (let j = 0; j < this.frame.operands[i].length; j += 1) {\r\n\t\t\t\tconst domcls = this.frame.operands[i][j].domain;\r\n\t\t\t\tif (domcls && choices.indexOf(domcls) === -1) {\r\n\t\t\t\t\tchoices.push(domcls);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn choices;\r\n};\r\n\r\nClassFrame.prototype.getChosenClassFrame = function (chosen) {\r\n\tfor (let i = 0; i < this.frame.operands.length; i += 1) {\r\n\t\tconst operand = this.frame.operands[i];\r\n\t\tif (operand.length) {\r\n\t\t\tfor (let j = 0; j < operand.length; j += 1) {\r\n\t\t\t\tif (operand[j] && (chosen === operand[j].domain)) {\r\n\t\t\t\t\tconst cf = new ClassFrame(operand);\r\n\t\t\t\t\treturn cf;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (operand.range && chosen === operand.range) {\r\n\t\t\tconst cf = new ClassFrame(operand);\r\n\t\t\treturn cf;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nClassFrame.prototype.getChosenFrame = function (dataframe) {\r\n\treturn dataframe;\r\n};\r\n\r\n\r\nfunction Restriction(restriction) {\r\n\tthis.min = 0;\r\n\tthis.max = 0;\r\n\tif (restriction) this.loadRestriction(restriction);\r\n}\r\n\r\nRestriction.prototype.hasCardRestriction = function () {\r\n\tif (this.min === 0 && this.max === 0) return false;\r\n\treturn true;\r\n};\r\n\r\nRestriction.prototype.loadRestriction = function (restriction) {\r\n\tif (typeof restriction.cardinality !== 'undefined') {\r\n\t\tthis.max = restriction.cardinality;\r\n\t\tthis.min = restriction.cardinality;\r\n\t} else if (typeof restriction.maxCardinality !== 'undefined') {\r\n\t\tthis.max = restriction.maxCardinality;\r\n\t} else if (typeof restriction.minCardinality !== 'undefined') {\r\n\t\tthis.min = restriction.minCardinality;\r\n\t} else if (typeof restriction.type !== 'undefined' && restriction.type === 'and' && typeof restriction.operands === 'object') {\r\n\t\tfor (let i = 0; i < restriction.operands.length; i += 1) {\r\n\t\t\tconst nrest = new Restriction(restriction.operands[i]);\r\n\t\t\tif (this.max === 0 && nrest.max > 0) this.max = nrest.max;\r\n\t\t\telse if (this.max > 0 && nrest.max > 0 && nrest.max < this.max) this.max = nrest.max;\r\n\t\t\tif (this.min === 0 && nrest.min > 0) this.min = nrest.min;\r\n\t\t\telse if (this.min > 0 && nrest.min > 0 && nrest.min > this.min) this.min = nrest.min;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nmodule.exports = ObjectFrame;\r\n","function Codemirror(text, format, config){\r\n  this.textdom = text;\r\n  this.mode = format;\r\n  if(objectIsEmpty(config)) this.darkMode = config.darkMode;\r\n  if(this.jsonldCheck(format)) this.mode = 'javascript';\r\n}\r\n// checks if a json object is empty\r\nfunction objectIsEmpty(arg) {\r\n  for (var item in arg) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction autocomplete(){\r\n    var orig = CodeMirror.hint.javascript = function (cm) {\r\n        var list = [];//\"limit()\",\"start()\",\"triple()\"];//Session.get(Template.strSessionDistinctFields) || [];\r\n        var cursor = cm.getCursor();\r\n        var currentLine = cm.getLine(cursor.line);\r\n        var start = cursor.ch;\r\n        var end = start;\r\n        while (end < currentLine.length && /[\\w$]+/.test(currentLine.charAt(end))) ++end;\r\n        while (start && /[\\w$]+/.test(currentLine.charAt(start - 1))) --start;\r\n        var curWord = start != end && currentLine.slice(start, end);\r\n        var regex = new RegExp('^' + curWord, 'i');\r\n        var result = {\r\n            list: (!curWord ? list : list.filter(function (item) {\r\n                return item.match(regex);\r\n            })).sort(),\r\n            from: CodeMirror.Pos(cursor.line, start),\r\n            to: CodeMirror.Pos(cursor.line, end)\r\n        };\r\n        return result;\r\n    };\r\n    // codeMirror.hint.sql is defined when importing codemirror/addon/hint/sql-hint\r\n    // (this is mentioned in codemirror addon documentation)\r\n    // Reference the hint function imported here when including other hint addons\r\n    // or supply your own\r\n   \t//cm.replaceSelection(\".\");\r\n    //codeMirror.showHint(cm, CodeMirror.hint.javascript, hintOptions);\r\n}\r\n\r\n/*\r\ntxtar    : editor is attached to textar\r\nmode     : format for highlighting, ex: json, html etc.\r\neditable : readOnly false/ nocursor is special value in code editor to set readonly true */\r\nCodemirror.prototype.colorizeTextArea = function(dimensions){\r\n    //initize auto complete\r\n    /*CodeMirror.commands.autocomplete = function(cm) {\r\n    cm.showHint({hint: CodeMirror.hint.anyword});\r\n    }*/\r\n\r\n    // initialise code editor on text area\r\n    var editor = CodeMirror.fromTextArea(this.textdom, {\r\n        mode                : this.mode,\r\n        firstLineNumber     : 1,\r\n        lineNumbers         : true,\r\n        styleActiveLine     : true,\r\n        lineWrapping        : true,\r\n        smartIndent         : true,\r\n        indentWithTabs      : true,\r\n        newlineAndIndent    : true,\r\n        autoCloseBrackets   : true,\r\n        matchBrackets       : {afterCursor: true},\r\n        extraKeys           : {\"Ctrl-F\": \"find\",\r\n                               //\"Tab\": \"autocomplete\",\r\n                               \"Ctrl-Q\": function(cm){ cm.foldCode(cm.getCursor()); }},\r\n        refresh             : true,\r\n        foldGutter          : true,\r\n        gutters             : [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"]\r\n    });\r\n    editor.foldCode(CodeMirror.Pos(13, 0));\r\n    if(false && !(objectIsEmpty(dimensions))){\r\n      editor.setSize(dimensions.width, dimensions.height);\r\n    }\r\n    else this.setCodemirrorSize(editor, dimensions);\r\n    editor.defaultCharWidth('20px');\r\n    if(true || this.darkMode) editor.setOption(\"theme\", 'erlang-dark');\r\n    else editor.setOption(\"theme\", 'neo');\r\n    return editor;\r\n} // colorizeTextArea()\r\n\r\n/*\r\n  set editor size according to screens\r\n  editor : code mirror editor Object\r\n  mode   : editor being viewed from schema/ doc/ query page*/\r\nCodemirror.prototype.setCodemirrorSize = function(editor, dimensions){\r\n  switch(dimensions){\r\n    case 'query':\r\n      editor.setSize('auto', '400');\r\n    break;\r\n    case 'schema':\r\n      editor.setSize('auto', '1550');\r\n    break;\r\n    case 'document':\r\n     editor.setSize('765', '500');\r\n    break;\r\n    case 'api-doc':\r\n        editor.setSize('800', '500');\r\n    break;\r\n    case 'doc-json':\r\n        editor.setSize('1410', 'auto');\r\n    break;\r\n    case 'doc-json-create':\r\n        editor.setSize('1410', '500');\r\n    break;\r\n  } // switch(dimensions)\r\n} // setCodemirrorSize()\r\n\r\n// updateTextArea(): highlights new changes on editor\r\nCodemirror.prototype.updateTextArea = function(editor){\r\n  editor.save();\r\n  setTimeout(function() {\r\n      editor.refresh();\r\n  },1);\r\n  // save changes of code mirror editor\r\n  editor.on('change', function(){\r\n    editor.save();\r\n  });\r\n} //updateTextArea()\r\n\r\n/*\r\ncolorizePre() to colorise pre tags (read only mode)\r\ntext (string)    : The document to run through the highlighter.\r\nmode (mode spec) : format to highlight color\r\noutput (DOM node): The tokens will be converted to spans as in an editor,\r\n                   and inserted into the node (through innerHTML).*/\r\nCodemirror.prototype.colorizePre = function(){\r\n  CodeMirror.runMode(this.textdom.innerText, this.mode, this.textdom);\r\n  if(true || this.darkMode)\r\n      var theme = 'cm-s-erlang-dark';\r\n  else var theme = 'cm-s-neo';\r\n  this.textdom.setAttribute('class', 'CodeMirror CodeMirror-wrap ' + theme + ' terminus-wrap-text terminus-wrapper-height ');\r\n  return this.textdom;\r\n} // colorizePre()\r\n\r\nCodemirror.prototype.jsonldCheck = function(format){\r\n  if(format == 'jsonld') return true;\r\n}\r\n\r\nmodule.exports=Codemirror\r\n","/*\r\n * User Interface elements dealing with database level functions - view, delete, create, db\r\n * view document etc\r\n */\r\nconst UTILS=require('./Utils');\r\nconst TerminusClient = require('@terminusdb/terminus-client');\r\nconst HTMLHelper = require('./html/HTMLHelper');\r\nconst TerminusViewer = require(\"./html/TerminusViewer\");\r\n\r\n\r\n/**\r\n * DB home page main function\r\n * @param {TerminusUI} ui\r\n */\r\nfunction TerminusDBViewer(ui){\r\n\tthis.ui = ui;\r\n\tthis.tv = new TerminusViewer(ui.client);\r\n\tthis.container = document.createElement(\"span\");\r\n\tthis.container.setAttribute(\"class\", \"terminus-main-page\");\r\n\tthis.pages = [\"home\"];\r\n}\r\n\r\n//Document configuration for DB meta-data listing on DB home page\r\nTerminusDBViewer.prototype.getDatabaseDocumentConfig = function(){\r\n\tvar property_style = \"display: block; padding: 0.3em 1em;\"\r\n\tvar box_style = \"padding: 8px; border: 1px solid #afafaf; background-color: #efefef;\"\r\n\tvar label_style = \"display: inline-block; min-width: 100px; font-weight: 600; color: #446ba0;\";\r\n\tvar value_style = \"font-weight: 400; color: #002856;\";\r\n\tvar config = TerminusClient.View.document();\r\n\tconfig.show_all(\"SimpleFrameViewer\");\r\n\tconfig.object().style(box_style);\r\n\tconfig.object().headerFeatures(\"id\").style(property_style).args({headerStyle: label_style + \" padding-right: 10px;\", bodyStyle: value_style, label: \"Database ID\", removePrefixes: true});\r\n\tconfig.object().headerFeatures(\"type\").style(property_style).args({headerStyle: label_style + \" padding-right: 10px;\", bodyStyle: value_style})\r\n\tconfig.object().features(\"value\").style(property_style);\r\n\tconfig.property().features(\"label\").style(label_style);\r\n\tconfig.property().features(\"label\", \"value\");\r\n\tconfig.property().property(\"terminus:id\").hidden(true);\r\n\tconfig.data().features(\"value\").style(value_style);\r\n\treturn config;\r\n}\r\n\r\n\r\n/**\r\n * Query Pane Configurations\r\n */\r\n\r\n//documents home page table\r\nTerminusDBViewer.prototype.getDocumentsQueryPane = function(docs, docClasses){\r\n\tvar table = TerminusClient.View.table();\r\n\t//table.pager(true);\r\n\ttable.column('ID').header('Document ID');\r\n\ttable.column('Label').header('Name');\r\n\ttable.column('Comment').header('Description');\r\n\ttable.column_order(\"ID\", \"Label\", \"Type\", \"Comment\");\r\n\tvar self = this;\r\n\tvar x = function(row){\r\n\t\tself.showDocumentPage(row[\"v:ID\"], docClasses, false, docs);\r\n\t}\r\n\ttable.row().click(x);\r\n\tvar qp = this.tv.getResult(docs.query, table, docs);\r\n\treturn qp;\r\n}\r\n\r\n\r\n//Create document page pane configuration\t\t\r\nTerminusDBViewer.prototype.getCreateDataPaneConfig = function(){\r\n\tconst pc = {\r\n\t\tshowQuery: false, \r\n\t\teditQuery: false\r\n\t};\r\n\treturn pc;\r\n}\r\n\r\n//Document configuration for create document page\r\nTerminusDBViewer.prototype.getCreateDocumentConfig = function(){\r\n\tvar property_style = \"display: block; padding: 0.3em 1em;\"\r\n\tvar box_style = \"padding: 8px; border: 1px solid #afafaf; background-color: #efefef;\"\r\n\tvar label_style = \"display: inline-block; min-width: 100px; font-weight: 600; color: #446ba0;\";\r\n\tvar value_style = \"font-weight: 400; color: #002856;\";\r\n\t\r\n\tvar config = TerminusClient.View.document().load_schema(true);\r\n\tconfig.all().mode(\"edit\");\r\n\tconfig.show_all(\"SimpleFrameViewer\");\r\n\tconfig.object().style(box_style);\r\n\tconfig.object().depth(0).headerFeatures(\"id\").style(property_style).args({headerStyle: label_style + \" padding-right: 10px;\", bodyStyle: value_style, label: \"Document ID\", removePrefixes: true});\r\n\tconfig.object().headerFeatures(\"type\").style(property_style).args({headerStyle: label_style + \" padding-right: 10px;\", bodyStyle: value_style})\r\n\tconfig.object().features(\"value\").style(property_style);\r\n\tconfig.property().features(\"label\").style(label_style);\r\n\tconfig.property().features(\"label\", \"value\");\r\n\tconfig.property().property(\"terminus:id\").hidden(true);\r\n\tconfig.data().features(\"value\").style(value_style);\r\n\treturn config;\r\n}\r\n\r\n//Document configuration for view / edit document page\r\nTerminusDBViewer.prototype.getShowDocumentConfig = function(){\r\n\tvar property_style = \"display: block; padding: 1.5em 1em 0.8em 1em; position: relative;\"\r\n\tvar config = TerminusClient.View.document().load_schema(true);\r\n\tconfig.show_all(\"SimpleFrameViewer\");\r\n\tconfig.object().depth(0).style(\"border: 1px solid #aaa; background-color: #fafafd\").headerStyle(\"background-color: #002856; color: white; padding: 8px; display: block; \");\r\n\tconfig.object().headerFeatures(\"id\", \"type\").args({headerStyle: \"text-align: right; display: inline-block; width: 200px; padding-right: 10px; text-weight: 600px; color: white\"});\r\n\t//config.object().headerFeatures(\"mode\").style(\"float: right\");\r\n\tconfig.object().features(\"value\").style(property_style);\r\n\tconfig.property().features(\"label\", \"value\");\r\n\tconfig.property().features(\"label\").style(\"text-align: right; display: inline-block; width: 200px; padding-right: 10px; font-weight: 600; color: #002856\");\r\n\tconfig.property().features(\"value\").style(\"display: inline-block; vertical-align: top\");\r\n\tconfig.data().features(\"value\").style(\"color: #002856; display: block; margin-bottom: 1em;\");\r\n\treturn config;\r\n};\r\n\r\nTerminusDBViewer.prototype.getDocumentsGraphConfig = function(res){\r\n\tvar graph = TerminusClient.View.graph();\r\n\tgraph.literals(false);\r\n\tgraph.height(800).width(1250);\r\n\tgraph.edges([\"v:doc1\", \"v:doc2\"], [\"v:doc1\", \"v:Enttype\"], [\"v:doc2\", \"v:Enttype2\"]);\r\n\tgraph.node(\"v:Label\", \"v:Label2\", \"v:Predicate\").hidden(true);\r\n\tgraph.edge(\"v:doc1\", \"v:doc2\").distance(100).text(\"v:Predicate\");\r\n\tgraph.edge(\"v:doc1\", \"v:Enttype\").distance(100).text(\"Class\");\r\n\tgraph.edge(\"v:doc2\", \"v:Enttype2\").distance(100).text(\"Class\");\r\n    graph.node(\"v:Enttype\").text(\"v:Enttype\").color([200, 250, 200]).icon({label: true, color: [15, 50, 10]}).collisionRadius(80);\r\n    graph.node(\"v:Enttype2\").text(\"v:Enttype2\").color([200, 250, 200]).icon({label: true, color: [15, 50, 10]}).collisionRadius(80);\r\n\tgraph.node(\"v:doc1\").size(24).text(\"v:Label1\").icon({label: true, color: [15, 50, 10]}).collisionRadius(80)\r\n\tgraph.node(\"v:doc2\").size(24).text(\"v:Label2\").icon({label: true, color: [15, 50, 10]}).collisionRadius(80)\r\n\treturn graph;\r\n}\r\n\r\nTerminusDBViewer.prototype.showDocumentGraph = function(insertDOM){\r\n\tvar dburl = this.ui.client.connectionConfig.dbURL();\r\n\tvar q = TerminusClient.WOQL.from(dburl).limit(200).getAllDocumentConnections();\r\n\tvar qp = this.tv.getResult(q, this.getDocumentsGraphConfig());\r\n\tvar dloader = this.getLoaderDOM(\"Terminus Server is generating the document graph\");\r\n\tinsertDOM.appendChild(dloader)\r\n\tinsertDOM.appendChild(qp.getAsDOM());\r\n\tthis.graph_query_pane = qp;\r\n\tqp.load().finally(() => insertDOM.removeChild(dloader));\r\n}\r\n\r\nTerminusDBViewer.prototype.showDocumentConnections = function(docid, targetDOM, docClasses, docs){\r\n\tvar q = TerminusClient.WOQL.limit(50).getDocumentConnections(docid);\r\n\tvar viewer = TerminusClient.View.table().column_order(\"Outgoing\", \"Incoming\", \"Entid\", \"Label\", \"Enttype\", \"Class_Label\" );\r\n\tviewer.column(\"Entid\").hidden(true);\r\n\tviewer.column(\"Enttype\").hidden(true);\r\n\tviewer.column(\"Label\").header(\"Document Name\");\r\n\tviewer.column(\"Class_Label\").header(\"Type\");\r\n\tviewer.column(\"Incoming\").header(\"Incoming Link\");\r\n\tviewer.column(\"Outgoing\").header(\"Outgoing Link\");\r\n\tvar self = this;\r\n\tvar x = function(row){\r\n\t\tself.showDocumentPage(row[\"v:Entid\"], docClasses, false, docs);\r\n\t}\r\n\tviewer.row().click(x);\r\n\tvar graph = TerminusClient.View.graph();\r\n\tgraph.literals(false);\r\n\tgraph.height(800).width(1250);\r\n\tgraph.edges([\"v:Docid\", \"v:Entid\"], [\"v:Entid\", \"v:Docid\"]);\r\n\tgraph.node(\"Outgoing\", \"Incoming\", \"Label\", \"Enttype\", \"Class_Label\").hidden(true);\r\n\t\r\n\t//graph.edge(\"v:Entid\", \"v:Docid\").distance(200).text(\"v:Incoming\");\r\n\tgraph.edge(\"v:Entid\", \"v:Docid\").v(\"v:Incoming\").in(\"unknown\").hidden(true);\r\n\tgraph.edge(\"v:Entid\", \"v:Docid\").distance(200).text(\"v:Incoming\").color([255, 0, 0]);\r\n\r\n\tgraph.edge(\"v:Docid\", \"v:Entid\").v(\"v:Outgoing\").in(\"unknown\").hidden(true);\r\n\tgraph.edge(\"v:Docid\", \"v:Entid\").distance(200).text(\"v:Outgoing\").color([0, 0, 255]);\r\n\t\r\n\tgraph.node(\"v:Docid\").text(\"v:Docid\").icon({label: true});\r\n\tgraph.node(\"v:Entid\").text(\"v:Label\");\r\n\tvar introdom = document.createElement(\"h3\");\r\n\tintrodom.style = \"margin-top: 1.5em; margin-bottom: -32px; color: #224488;\"\r\n\tintrodom.appendChild(document.createTextNode(\"Links from other documents\"));\r\n\tvar rpc = { intro: introdom, viewers: [graph] }\r\n    var qp = this.tv.getQueryPane(q, [viewer], false, [rpc]);\r\n    var dloader = this.getLoaderDOM(\"Fetching document relationship table\");\r\n\ttargetDOM.appendChild(dloader)\r\n\ttargetDOM.appendChild(qp.getAsDOM());\r\n\tqp.load().finally(() => targetDOM.removeChild(dloader));\r\n}\r\n\r\n\r\nTerminusDBViewer.prototype.createFullDocumentPane = function(docid, result_options, target, docClasses, docs){\r\n\tvar self = this;\r\n\tvar func = function(v){\r\n\t\tself.showDocumentPage(v, docClasses, false, docs);\r\n\t};\r\n\tvar dpoptions = {\"HTMLEntityViewer\": { \"onclick\": func}};\r\n\tvar dp = this.tv.getDocumentPane(docid, result_options, dpoptions);\t\r\n\treturn dp;\r\n}\r\n\r\n/**\r\n * HTML Page drawing functions\r\n */\r\n\r\n/**\r\n * Called first - runs set-up queries to seed UI elements\r\n * before drawing the page body \r\n */\r\nTerminusDBViewer.prototype.getAsDOM = function(){\r\n\tHTMLHelper.removeChildren(this.container);\r\n\tvar limit = 20;\r\n\tvar WOQL = TerminusClient.WOQL;\r\n\tvar dburl = this.ui.client.connectionConfig.dbURL();\r\n\tvar q = WOQL.from(dburl).limit(limit).documentMetadata();\r\n\tq.execute(this.ui.client).then( (result) => {\r\n\t\tvar docs = new TerminusClient.WOQLResult(result, q);\r\n\t\tvar q2 = WOQL.from(dburl).concreteDocumentClasses();\r\n\t\tq2.execute(this.ui.client).then( (result2) => {\r\n\t\t\tvar docClasses = new TerminusClient.WOQLResult(result2, q2);\r\n\t\t\tvar bdom = this.getBodyAsDOM(docs, docClasses);\r\n\t\t\tif(bdom) this.container.appendChild(bdom);\r\n\t\t});\r\n\t}).catch((e) => {\r\n\t\tthis.ui.showError(e);\r\n\t});\r\n\treturn this.container;\r\n}\r\n\r\n/**\r\n * Two main pages - DB home page and documents section\r\n */\r\nTerminusDBViewer.prototype.getBodyAsDOM = function(docs, docClasses){\r\n\tif(this.body){\r\n\t\tHTMLHelper.removeChildren(this.body);\r\n\t}\r\n\telse {\r\n\t\tthis.body = document.createElement(\"div\");\r\n\t\tthis.body.setAttribute(\"class\", \"terminus-home-body terminus-document-view\");\r\n\t}\r\n\tif(this.ui.page == \"docs\"){\r\n\t\t(this.docid ? \r\n\t\t\tthis.showDocumentPage(this.docid, docClasses, this.body, docs) :\t\t\r\n\t\t\tthis.getDocumentsDOM(docs, docClasses, this.body));\r\n\t}\r\n\telse {\r\n\t\t this.getHomeDOM(docs, docClasses, this.body);\r\n\t}\r\n\treturn this.body\r\n}\r\n\r\n/**\r\n * DB home page \r\n */\r\nTerminusDBViewer.prototype.getHomeDOM = function(docs, docClasses, body){\r\n\tvar intro = this.showHappyBox(\"dbhome\", \"demo\");\r\n\tbody.appendChild(intro);\r\n\tvar config = this.getDatabaseDocumentConfig();\r\n\tvar cont = document.createElement(\"span\");\r\n\tintro.appendChild(cont);\r\n\tvar mydb = this.ui.db();\r\n\tthis.ui.connectToDB(\"terminus\");\r\n\tthis.insertDocument(\"doc:\" + mydb, cont, config);\r\n\tthis.ui.connectToDB(mydb); \r\n\tif(docs.count() > 0){\r\n\t\tbody.appendChild(this.showHappyBox(\"dbhome\", \"intro\"));\r\n\t\tbody.appendChild(this.showHappyBox(\"happy\", \"query\"));\r\n\t}\r\n\telse if(docClasses.count() > 0) {\r\n\t\tvar dchooser = this.getCreateDataChooser(docClasses, docs);\r\n\t\tif(docClasses.count() <= 3){\r\n\t\t\tbody.appendChild(this.showHappyBox(\"empty\", \"schema\"));\r\n\t\t\tbody.appendChild(this.showHappyBox(\"empty\", \"query\"));\r\n\t\t}\r\n\t\telse  {\r\n\t\t\tbody.appendChild(this.showHappyBox(\"happy\", \"docs\", dchooser));\r\n\t\t\tbody.appendChild(this.showHappyBox(\"happy\", \"query\"));\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tbody.appendChild(this.showHappyBox(\"empty\", \"schema\"));\r\n\t\tbody.appendChild(this.showHappyBox(\"empty\", \"query\"));\t\r\n\t}\r\n\tvar delw = this.getDeleteDatabaseWidget(\"fa-2x\");\r\n\tif(delw) body.appendChild(this.showHappyBox(\"happy\", \"delete\", delw));\r\n\treturn body;\r\n}\r\n\r\n/**\r\n * Main Document Listing Page\r\n */\r\nTerminusDBViewer.prototype.getDocumentsDOM = function(docs, docClasses, body){\r\n\tvar mactions = this.getDocumentsMenu(docs, docClasses, body);\r\n\tif(mactions) body.appendChild(mactions);\r\n\tthis.tableDOM = document.createElement(\"span\");\r\n\tbody.appendChild(this.tableDOM);\r\n\tthis.graphDOM = document.createElement(\"span\");\r\n\tthis.graphDOM.setAttribute(\"class\", \"terminus-documents-graph\");\r\n\tthis.graphDOM.style.display = \"none\";\r\n\tbody.appendChild(this.graphDOM);\r\n\tif(docs.count() > 0){\r\n\t\tif(!this.document_table) this.document_table = this.getDocumentsQueryPane(docs, docClasses);\r\n\t\tthis.tableDOM.appendChild(this.document_table.getAsDOM());\r\n\t\tthis.showDocumentGraph(this.graphDOM);\r\n\t}\r\n\telse {\r\n\t\tvar dchooser = this.getCreateDataChooser(docClasses, docs);\r\n\t\tif(docClasses.count() <= 3){\r\n\t\t\tthis.ui.showWarning(\"The database must have a schema before you can add documents to it\")\r\n\t\t\tbody.appendChild(this.showHappyBox(\"empty\", \"schema\"));\r\n\t\t\tbody.appendChild(this.showHappyBox(\"empty\", \"query\"));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.ui.showWarning(\"No documents have been added to the database\");\r\n\t\t\tbody.appendChild(this.showHappyBox(\"happy\", \"docs\", dchooser));\r\n\t\t\tbody.appendChild(this.showHappyBox(\"happy\", \"query\"));\r\n\t\t}\r\n\t}\r\n\treturn body;\r\n}\r\n\r\n/**\r\n * Document View / Edit Page\r\n */\r\nTerminusDBViewer.prototype.showDocumentPage = function(docid, docClasses, target, docs){\r\n\tthis.ui.clearMessages();\r\n\tHTMLHelper.removeChildren(target);\r\n\tthis.ui.page = \"docs\";\r\n\tthis.ui.redrawControls();\r\n\tvar start = docid.substring(0, 4);\r\n\tif(start != \"doc:\" && start != \"http\") docid = \"doc:\" + docid;\t\r\n\tvar config = this.getShowDocumentConfig();\r\n\tvar dp = this.createFullDocumentPane(docid, config, target, docClasses, docs);\r\n\tthis.docid = docid; \r\n\tthis.pages.push(docid);\r\n\tvar dcDOM = document.createElement(\"span\");\r\n\tvar vc = this.showDocumentConnections(docid, dcDOM, docClasses, docs);\r\n\treturn dp.load().then(() => {\r\n\t\tHTMLHelper.removeChildren(this.container);\r\n\t\tvar nav = this.getNavigationDOM(docClasses, docs);\r\n\t\tthis.container.appendChild(nav);\r\n\t\tvar mactions = this.getDocumentsMenu(docs, docClasses, this.container, docid);\r\n\t\tif(mactions) this.container.appendChild(mactions);\r\n\t\tvar dx = dp.getAsDOM();\r\n\t\tthis.container.appendChild(dx);\r\n\t\tthis.container.appendChild(dcDOM);\r\n\t})\r\n\t.catch((e) => this.ui.showError(e));\t\r\n}\r\n\r\n\r\n/**\r\n * Main Create New Document Page\r\n */\r\nTerminusDBViewer.prototype.loadCreateDocumentPage = function(cls, docClasses, docs){\r\n\tthis.ui.page = \"docs\";\r\n\tthis.ui.redrawControls();\r\n\tvar WOQL = TerminusClient.WOQL;\r\n\tvar dburl = this.ui.client.connectionConfig.dbURL();\r\n\tvar config = this.getCreateDocumentConfig();\r\n\r\n\tvar dp = this.tv.getNewDocumentPane(cls, config);\r\n\tdp.documentLoader = this.getShowDocumentControl(docClasses, docs);\r\n\t/*var df = new DocumentPane(this.ui.client).options({\r\n\t\tshowQuery: true,\r\n\t\teditQuery: true,\r\n\t\tshowConfig: false,\r\n\t\teditConfig: false,\r\n\t\tloadDocument: this.getShowDocumentControl(docClasses, docs)\r\n\t});*/\r\n\tif(docClasses && docClasses.count() > 0){\r\n\t\tvar dchooser = this.getCreateDataChooser(docClasses, docs );\r\n\t\tdp.setClassLoader(dchooser);\r\n\t}\r\n\telse {\r\n\t\tvar q2 = WOQL.from(dburl).concreteDocumentClasses();\r\n\t\tq2.execute(this.ui.client).then( (result2) => {\r\n\t\t\tdocClasses = (docClasses ? docClasses : new TerminusClient.WOQLResult(result2, q2));\r\n\t\t\tvar dchooser = this.getCreateDataChooser(docClasses, docs );\r\n\t\t\tdp.setClassLoader(dchooser);\r\n\t\t});\r\n\t}\r\n\tthis.container.appendChild(dp.getAsDOM());\r\n\tdp.load().then(() => {\r\n\t\tHTMLHelper.removeChildren(this.container);\r\n\t\tvar nav = this.getNavigationDOM(docClasses, docs);\r\n\t\tthis.container.appendChild(nav);\r\n\t\tthis.container.appendChild(dp.getAsDOM());\r\n\t});\r\n}\r\n\r\n/**\r\n * Toolbox Menu on top of the page on the documents home page\r\n */\r\nTerminusDBViewer.prototype.getDocumentsMenu = function(docs, docClasses, target, docid){\r\n\tvar self = this;\r\n\tvar page_actions = document.createElement(\"div\");\r\n\tpage_actions.setAttribute(\"class\", \"terminus-home-actions\");\r\n\tvar span = document.createElement('span');\r\n\tpage_actions.appendChild(span);\r\n\tif(docs.count() > 0){\r\n\t\tvar show_doc_action = this.getShowDocumentControl(docClasses, docs, target);\r\n\t\tspan.appendChild(show_doc_action);\r\n\t\tif(!docid){\r\n\t\t\tvar tgtd = this.getToggleGraphTableDOM();\r\n\t\t\tif(tgtd) page_actions.appendChild(tgtd);\r\n\t\t}\r\n\t}\t\r\n\treturn page_actions;//turned off create document stuff\r\n\tif(docClasses.count() > 0){\r\n\t\tvar ch = function(cls){\r\n\t\t\tif(cls)\tself.loadCreateDocumentPage(cls, docClasses, docs);\r\n\t\t}\r\n\t\tvar dchooser = this.getCreateDataChooser(docClasses, docs, ch);\r\n\t\tif(docs.count() > 1) span.appendChild(dchooser);\r\n\t}\r\n\telse {\r\n\t\tthis.ui.showError(\"No document classes found in schema - you must define a document, entity or relationship class before you can create documents\");\r\n\t}\r\n\treturn page_actions;\r\n}\r\n\r\n\r\nTerminusDBViewer.prototype.getLoaderDOM = function(msg){\r\n\tvar cont = document.createElement('div');\r\n\tcont.setAttribute('class', 'terminus-busy-msg')\r\n\tcont.appendChild(document.createTextNode(msg));           \r\n\tthis.ui.getBusyLoader(cont, msg);\r\n\treturn cont;\r\n}\r\n\r\n\r\n/**\r\n * Switches between graph and table display modes on documents home page\r\n */\r\nTerminusDBViewer.prototype.redrawDocumentPage = function(){\r\n\tif(this.docview == \"graph\"){\r\n\t\tthis.tableDOM.style.display = \"none\";\r\n\t\tthis.graphDOM.style.display = \"inline\";\r\n\t}\r\n\telse {\r\n\t\tthis.tableDOM.style.display = \"inline\";\r\n\t\tthis.graphDOM.style.display = \"none\";\r\n\t}\r\n}\t\r\n\r\nTerminusDBViewer.prototype.getToggleGraphTableDOM = function(){\r\n\t// delete database\r\n\tvar isp = document.createElement('span');\r\n\tisp.setAttribute(\"class\", \"terminus-toggle-documents\");\r\n\tvar tisp = document.createElement('span');\r\n\tvar gisp = document.createElement('span');\r\n\tisp.appendChild(tisp);\r\n\tisp.appendChild(gisp);\r\n\tvar ticon = document.createElement(\"i\");\r\n\tticon.setAttribute(\"class\", \"fa fa-table\");\r\n\tticon.classList.add('terminus-result-view-icon');\r\n\tvar gicon = document.createElement(\"i\");\r\n\ttisp.appendChild(ticon);\r\n\tgisp.appendChild(gicon);\r\n\tgisp.setAttribute(\"title\", \"Click to view a graph of the links between the documents in the database\");\r\n\ttisp.setAttribute(\"title\", \"Switch back to a regular table of documents\");\r\n\tgicon.setAttribute(\"class\", \"fas fa-code-branch\");\r\n\tgicon.classList.add('terminus-result-view-icon');\r\n\tif(this.docview && this.docview == \"graph\"){\r\n\t\tgisp.style.display = \"none\";\r\n\t}\r\n\telse {\r\n\t\ttisp.style.display = \"none\";\r\n\t}\r\n\r\n\tvar hov = function(ticon){\r\n\t\ttisp.addEventListener('mouseover', function(){\r\n\t\t\tthis.style.cursor = \"pointer\";\r\n\t\t});\r\n\t}\r\n\thov(gisp);\r\n\thov(tisp);\r\n\r\n\tgisp.addEventListener(\"click\", () => {\r\n\t\tif(this.docview && this.docview == \"graph\") return;\r\n\t\tif(!this.graph_query_pane){\r\n\t\t\tthis.showDocumentGraph(this.graphDOM);\r\n\t\t}\r\n\t\tthis.docview = \"graph\";\r\n\t\tgisp.style.display = \"none\";\r\n\t\tthis.graphDOM.style.display = \"inline\";\r\n\t\ttisp.style.display = \"inline\";\r\n\t\tthis.tableDOM.style.display = \"none\";\r\n\r\n\t});\r\n\tticon.addEventListener(\"click\", () => {\r\n\t\tif(!this.docview || this.docview == \"table\") return;\r\n\t\tthis.docview = \"table\";\r\n\t\ttisp.style.display = \"none\";\r\n\t\tgisp.style.display = \"inline\";\r\n\t\tthis.graphDOM.style.display = \"none\";\r\n\t\tthis.tableDOM.style.display = \"inline\";\r\n\t});\r\n\tisp.appendChild(tisp);\r\n\tisp.appendChild(gisp);\r\n\treturn isp;\t\r\n}\r\n\r\nTerminusDBViewer.prototype.getDeleteDatabaseWidget = function(css){\r\n\t// delete database\r\n\tif(this.ui.db() == \"terminus\") return;\r\n\tvar d = document.createElement(\"span\");\r\n\td.setAttribute(\"class\", \"terminus-db-widget\");\r\n\tHTMLHelper.removeChildren(this.container);\r\n    var del = document.createElement('button');\r\n    del.setAttribute('class', 'terminus-btn terminus-btn-float-right terminus-home-del');\r\n    del.setAttribute('type', 'button');\r\n\tdel.appendChild(document.createTextNode('Delete Database'));\r\n\tvar di = document.createElement(\"i\");\r\n\tvar icss = \"fa fa-trash fa-2x terminus-icon-padding\" + (css ? \" \" + css : \"\");\r\n\tdi.setAttribute(\"class\", icss);\r\n\tdel.appendChild(di);\r\n\tvar dbrec = this.ui.getDBRecord();\r\n\tif(dbrec)\r\n\t\tvar nm = (dbrec[\"rdfs:label\"] && dbrec[\"rdfs:label\"][\"@value\"] ? dbrec[\"rdfs:label\"][\"@value\"] : this.ui.db());\r\n\telse var nm = this.ui.db();\r\n    var self = this;\r\n\tvar dbdel = this.ui.db();\r\n\tvar delbut = this.ui.getDeleteDBButton(dbdel);\r\n\tif(delbut){\r\n\t\td.appendChild(delbut);\r\n\t}\r\n\treturn d;\r\n}\r\n\r\nTerminusDBViewer.prototype.styleCreateDocumentChooser = function(){\r\n\tvar select = document.getElementsByClassName('woql-chooser');\r\n\tfor(i=0; i<select.length; i++){\r\n\t\tif(select[i].type == 'select'){\r\n\t\t\tselect[i].classList.add('terminus-form-doc-value');\r\n\t\t\tvar self = this;\r\n\t\t\tselect[i].addEventListener('change', function(){\r\n\t\t\t\tself.showCreateDocument(this.value);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusDBViewer.prototype.getCreateDataChooser = function(docClasses, docs, change, pholder){\r\n\tpholder = (pholder ? pholder : \"Create a New Document\");\r\n\t//qopts  = (qopts ? qopts :  {});\r\n\t//var dp = new QueryPane(this.ui.client, docClasses.query, docClasses).options(qopts);\r\n\tvar chooser = TerminusClient.View.chooser().values(\"Class\").labels(\"Label\").titles(\"Comment\").show_empty(pholder);\r\n\t\r\n\tvar self = this;\r\n\tchooser.change = (change ? change : function(cls){\r\n\t\tif(cls)\tself.loadCreateDocumentPage(cls, docClasses, docs);\r\n\t});\r\n\tvar dp = this.tv.getResult(docClasses.query, chooser, docClasses);\r\n\tvar dchooser = dp.getAsDOM();\r\n\treturn dchooser;\r\n}\r\n\r\nTerminusDBViewer.prototype.showHappyBox = function(happy, type, chooser){\r\n\tvar hbox = document.createElement(\"div\");\r\n\thbox.setAttribute(\"class\", \"terminus-welcome-box terminus-no-res-alert\");\r\n\tvar self = this;\r\n\tvar sets = {};\r\n\tif(type == \"schema\"){\r\n\t\tsets.title = (happy == \"happy\") ? \"Document Classes Created\" : \"Create Schema from OWL\";\r\n\t\tsets.text = (happy == \"happy\") ? \"You have successfully created a schema with valid document classes!\" : \"You can create a schema for your database from an OWL document\";\r\n\t\tsets.css = \"fa fa-cog fa-2x terminus-welcome-icons\";\r\n\t}\r\n\telse if(type == \"docs\"){\r\n\t\tsets.css = \"fa fa-book fa-2x terminus-welcome-icons\";\r\n\t\tsets.title = \"Create Documents\";\r\n\t\tsets.text = (happy == \"happy\") ? \"Add data to the system through easy to use automatically generated forms for each document type\" : \"You should create a schema and add at least one document classes before you add data to the system\";\r\n\t}\r\n\telse if(type == \"intro\"){\r\n\t\tsets.css = \"fa fa-book fa-2x terminus-welcome-icons\";\r\n\t\tsets.title = \"View Documents\";\r\n\t\tsets.text = \"View the documents in the database and add new ones\";\r\n\t}\r\n\telse if(type == \"query\"){\r\n\t\tsets.css = \"fa fa-search fa-2x terminus-welcome-icons\";\r\n\t\tsets.title = (happy == \"happy\") ? \"Run Queries\" : \"Create Schema with Queries\";\r\n\t\tsets.text = (happy == \"happy\") ? \"You can add data to the system with queries and scripts, and import data directly from CSVs and URLs\" : \"You can write WOQL queries to create a schema through our query interface\";\r\n\t}\r\n\telse if(type == \"demo\"){\r\n\t\tsets.css = \"fa fa-database fa-2x terminus-welcome-icons\";\r\n\t\tvar dbrec = this.ui.getDBRecord();\r\n\t\tif(dbrec)\r\n\t\t\tvar nm = (dbrec[\"rdfs:label\"] && dbrec[\"rdfs:label\"][\"@value\"] ? dbrec[\"rdfs:label\"][\"@value\"] : this.ui.db());\r\n\t\telse var nm = this.ui.db();\r\n\t\tsets.title = nm ;\r\n\t\tsets.text = \"\";\r\n\t}\r\n\telse if(type == \"delete\"){\r\n\t\tsets.css = \"fa fa-trash fa-2x terminus-welcome-icons terminus-db-list-del-icon\";\r\n\t\tsets.title = \"Delete Database\";\r\n\t\tsets.text = \"This will delete all data and permanently remove all record of this database from the system\";\r\n\t}\r\n\tvar ispan =  document.createElement(\"span\");\r\n\tispan.setAttribute(\"class\", \"terminus-db-widget\");\r\n\tvar ic = document.createElement(\"i\");\r\n\tic.setAttribute(\"class\", sets.css);\r\n\tispan.appendChild(ic);\r\n\thbox.appendChild(ispan);\r\n\tvar htit = document.createElement(\"span\");\r\n\thtit.appendChild(document.createElement(\"strong\").appendChild(document.createTextNode(sets.title)));\r\n\thtit.classList.add('terminus-welcome-title');\r\n\thbox.appendChild(htit);\r\n\tvar body = document.createElement(\"p\");\r\n\tbody.setAttribute('class', 'terminus-welcome-body');\r\n\tbody.appendChild(document.createTextNode(sets.text));\r\n\thbox.appendChild(body);\r\n\tif(type == \"schema\"){\r\n\t\thbox.addEventListener(\"click\", function(){\r\n\t\t\tself.ui.page = \"schema\";\r\n\t\t\tself.ui.showSchemaPage();\r\n\t\t\tself.ui.clearMessages();\r\n\t\t\tself.ui.redrawControls();\r\n\t\t});\r\n\t};\r\n\tif(type == \"delete\"){\r\n\t\tispan.addEventListener(\"click\", function(){\r\n\t\t\tself.ui.clearMessages();\r\n\t\t\tlet db = self.ui.db();\r\n\t\t\tlet deleteConfirm = confirm(`This action is irreversible, it will remove the database from the system permanently. Are you sure you want to delete ${db} Database?`);\r\n\t\t\tif (deleteConfirm == true) {\r\n\t\t\t\tself.ui.deleteDatabase();\r\n\t\t\t\tself.ui.client.connectionConfig.dbid = false;\r\n\t\t\t\tself.ui.redrawControls();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tif(type == \"intro\" || (type == \"docs\" && false && !chooser)){\r\n\t\thbox.addEventListener(\"click\", function(){\r\n\t\t\tself.ui.page = \"docs\";\r\n\t\t\tself.ui.showDocumentPage();\r\n\t\t\tself.ui.clearMessages();\r\n\t\t\tself.ui.redrawControls();\r\n\t\t});\r\n\t};\r\n\tif(type == \"query\"){\r\n\t\thbox.addEventListener(\"click\", function(){\r\n\t\t\tself.ui.page = \"query\";\r\n\t\t\tself.ui.showQueryPage();\r\n\t\t\tself.ui.clearMessages();\r\n\t\t\tself.ui.redrawControls();\r\n\t\t});\r\n\t};\r\n\tif(type == \"query\" || type == \"schema\" || type == \"intro\"){\r\n\t\thbox.addEventListener('mouseover', function(){\r\n\t\t\tthis.style.cursor = \"pointer\";\r\n\t\t});\r\n\t}\r\n\tif(type == \"docs\" && false && chooser){\r\n\t\tvar sp = document.createElement('span');\r\n\t\tsp.setAttribute('class', 'terminus-welcome-chooser');\r\n\t\tsp.appendChild(chooser);\r\n\t\thbox.appendChild(sp);\r\n\t}\r\n\treturn hbox;\r\n}\r\n\r\nTerminusDBViewer.prototype.getNavigationDOM = function(docClasses, docs){\r\n\tvar s = document.createElement(\"span\");\r\n\ts.setAttribute('class', 'terminus-back-to-home terminus-backtohome-span');\r\n\tvar i = document.createElement(\"span\");\r\n\ti.setAttribute(\"class\", \"fa fas fa-arrow-left\");\r\n\ts.appendChild(i);\r\n\tvar p =  this.pages[this.pages.length-2];\r\n\tif(p){\r\n\t\tvar msg = (p == \"home\" ? \"document list\" : p)\r\n\t\ts.appendChild(document.createTextNode(\" back to \" + msg));\r\n\t}\r\n\telse {\r\n\t\tthis.pages.push(\"home\");\r\n\t\ts.appendChild(document.createTextNode(\" back to document list \"));\r\n\t}\r\n\ts.addEventListener(\"click\", () => {\r\n\t\tvar pp = this.pages.pop();\r\n\t\tp =  this.pages[this.pages.length-1];\r\n\t\tif(p == \"home\"){\r\n\t\t\tdelete(this[\"docid\"]);\r\n\t\t\tthis.getAsDOM();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpp = this.pages.pop();\r\n\t\t\tthis.docid = pp;\r\n\t\t\tthis.showDocumentPage(pp, docClasses, false, docs);\r\n\t\t}\r\n\t});\r\n\ts.addEventListener('mouseover', function(){\r\n\t\tthis.style.cursor = \"pointer\";\r\n\t});\r\n\treturn s;\r\n}\r\n\r\nTerminusDBViewer.prototype.insertDocument = function(docid, insertDOM, config, nuke){\r\n\tvar dp = this.tv.getDocument(docid, config);\r\n\tdp.load().then(() => {\r\n\t\tif(nuke) HTMLHelper.removeChildren(insertDOM);\r\n\t\tinsertDOM.appendChild(dp.getAsDOM());\r\n\t})\r\n\t.catch((e) => this.ui.showError(e));\t\r\n}\r\n\r\nTerminusDBViewer.prototype.getShowDocumentControl = function(docClasses, docs, target){\r\n\tvar scd = document.createElement(\"span\");\r\n\tscd.setAttribute(\"class\", \"terminus-get-doc terminus-document-chooser terminus-form-horizontal terminus-control-group\");\r\n\tvar lab = document.createElement(\"span\");\r\n\tlab.setAttribute(\"class\", \"terminus-document-chooser-label terminus-doc-control-label terminus-control-label-padding\");\r\n\tvar dcip = document.createElement(\"input\");\r\n\tdcip.setAttribute(\"class\", \"terminus-form-doc-value terminus-document-chooser terminus-doc-input-text\");\r\n\tdcip.setAttribute(\"placeholder\", \"Enter Document ID to view ...\");\r\n\tvar nbut = document.createElement(\"button\");\r\n\tnbut.setAttribute('class', \"terminus-control-button terminus-document-button terminus-btn\");\r\n\tnbut.setAttribute('title', 'Enter Document ID to view');\r\n\tvar is = document.createElement('i');\r\n\tis.setAttribute('class', 'fa fa-caret-left');\r\n\tnbut.appendChild(is);\r\n\tnbut.appendChild(document.createTextNode(\" Load \"));\r\n\tvar i = document.createElement('i');\r\n\ti.setAttribute('class', 'fa fa-caret-right');\r\n\tnbut.appendChild(i);\r\n\tvar self = this;\r\n\tnbut.addEventListener(\"click\", function(){\r\n\t\tif(dcip.value) {\r\n\t\t\tself.showDocumentPage(dcip.value, docClasses, target, docs);\r\n\t\t}\r\n\t})\r\n\tdcip.addEventListener(\"keyup\", function(event) {\r\n\t\tevent.preventDefault();\r\n\t\tif (event.keyCode === 13 && dcip.value) {\r\n\t\t\tself.showDocumentPage(dcip.value, docClasses, target, docs);\r\n\t\t}\r\n\t});\r\n\tscd.appendChild(lab);\r\n\tscd.appendChild(dcip);\r\n\tscd.appendChild(nbut);\r\n\treturn scd;\r\n}\r\n\r\n/**\r\n * Class Representing the create Database form\r\n * @param {TerminusUI} ui\r\n */\r\nfunction TerminusDBCreator(ui){\r\n\tthis.ui = ui;\r\n}\r\n\r\nTerminusDBCreator.prototype.getAsDOM = function(selected){\r\n\tvar scd = document.createElement(\"div\");\r\n\tscd.setAttribute(\"class\", \"terminus-db-creator\");\r\n\tvar sct = document.createElement(\"h3\");\r\n\tsct.setAttribute(\"class\", \"terminus-db-creator-title terminus-module-head\");\r\n\tsct.appendChild(UTILS.getHeaderDom(\"Create Database\"));\r\n\tscd.appendChild(sct);\r\n\tvar mfd = document.createElement('div');\r\n\tmfd.setAttribute('class', 'terminus-form-border ');\r\n\tscd.appendChild(mfd);\r\n\tvar dht = document.createElement('div');\r\n\tdht.setAttribute('class', 'terminus-form-margin-top');\r\n\tmfd.appendChild(dht);\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-form-field-spacing terminus-form-horizontal terminus-control-group\");\r\n\tvar slab = document.createElement(\"span\");\r\n\tslab.setAttribute(\"class\", \"terminus-id-label terminus-form-label terminus-control-label\");\r\n\tslab.appendChild(document.createTextNode(\"ID\"));\r\n\tsci.appendChild(slab);\r\n\tvar idip = document.createElement(\"input\");\r\n\tidip.setAttribute(\"type\", \"text\");\r\n\tidip.setAttribute(\"class\", \"terminus-form-value terminus-input-text\");\r\n\tidip.setAttribute(\"placeholder\", \"No spaces or special characters allowed in IDs\");\r\n\tsci.appendChild(idip);\r\n\tmfd.appendChild(sci);\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-form-field-spacing terminus-form-horizontal terminus-control-group\");\r\n\tvar slab = document.createElement(\"span\");\r\n\tslab.setAttribute(\"class\", \"terminus-title-label terminus-form-label terminus-control-label\");\r\n\tslab.appendChild(document.createTextNode(\"Title\"));\r\n\tvar titip = document.createElement(\"input\");\r\n\ttitip.setAttribute(\"type\", \"text\");\r\n\ttitip.setAttribute(\"placeholder\", \"A brief title for the Database\");\r\n\ttitip.setAttribute(\"class\", \"terminus-form-value terminus-input-text\");\r\n\tsci.appendChild(slab);\r\n\tsci.appendChild(titip);\r\n\tmfd.appendChild(sci);\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-form-field-spacing terminus-form-horizontal terminus-control-group\");\r\n\tvar slab = document.createElement(\"span\");\r\n\tslab.setAttribute(\"class\", \"terminus-title-label terminus-form-label terminus-control-label\");\r\n\tslab.appendChild(document.createTextNode(\"Description\"));\r\n\tsci.appendChild(slab);\r\n\tvar descip = document.createElement(\"textarea\");\r\n\tdescip.setAttribute(\"class\", \"terminus-textarea terminus-db-description terminus-textarea \");\r\n\tdescip.setAttribute(\"placeholder\", \"A short text describing the database and its purpose\");\r\n\tsci.appendChild(descip);\r\n\tmfd.appendChild(sci);\r\n\tvar butfield = document.createElement(\"div\");\r\n\tbutfield.setAttribute(\"class\", \"terminus-control-buttons\");\r\n\tvar cancbut = document.createElement(\"button\");\r\n\tcancbut.setAttribute(\"class\", \"terminus-control-button terminus-cancel-db-button terminus-btn terminus-btn-float-right\");\r\n\tcancbut.appendChild(document.createTextNode(\"Cancel\"));\r\n\tvar loadbut = document.createElement(\"button\");\r\n\tloadbut.setAttribute(\"class\", \"terminus-control-button terminus-create-db-button terminus-btn terminus-btn-float-right\");\r\n\tloadbut.appendChild(document.createTextNode(\"Create\"));\r\n\tvar self = this;\r\n\tvar gatherips = function(){\r\n\t\tvar input = {};\r\n\t\tinput.id = idip.value;\r\n\t\tinput.title = titip.value;\r\n\t\tinput.description = descip.value;\r\n\t\t//input.schema = schem.value;\r\n\t\t//input.key = kip.value;\r\n\t\t//input.data = datip.value;\r\n\t\treturn input;\r\n\t}\r\n\tvar self = this;\r\n\tloadbut.addEventListener(\"click\", function(){\r\n\t\tvar input = gatherips();\r\n\t\tself.ui.createDatabase(input);\r\n\t})\r\n\tcancbut.addEventListener(\"click\", function(){\r\n\t\tself.ui.showServerMainPage();\r\n\t})\r\n\tbutfield.appendChild(cancbut);\r\n\tbutfield.appendChild(loadbut);\r\n\tmfd.appendChild(butfield);\r\n\r\n\treturn scd;\r\n}\r\n\r\n/*\r\n * User Interface elements dealing with database level functions - view, delete, create, db\r\n * view document etc\r\n */\r\nfunction TerminusDBController(ui){\r\n\tthis.ui = ui;\r\n}\r\n\r\n/*\r\n* Controller provides access to the server level functions (create/delete db) and db-level functions (schema, query, document)\r\n* Populates left hand column on dashboard page\r\n*/\r\nTerminusDBController.prototype.getAsDOM = function(){\r\n   var self = this;\r\n   var dbc = document.createElement(\"div\");\r\n   dbc.setAttribute(\"class\", \"terminus-db-controller\");\r\n   if(this.ui && this.ui.db()){\r\n\t   var scd = document.createElement(\"div\");\r\n\t   scd.setAttribute(\"class\", \"terminus-field terminus-db-connection\");\r\n\t   var dbrec = this.ui.client.connection.getDBRecord();\r\n\t   var nm = (dbrec && dbrec[\"rdfs:label\"] && dbrec[\"rdfs:label\"][\"@value\"] ? dbrec[\"rdfs:label\"][\"@value\"] : this.ui.db());\r\n\t   //dbc.appendChild(scd);\r\n\t   var nav = document.createElement('div');\r\n\t   nav.setAttribute('class', 'span3');\r\n\t   dbc.appendChild(nav);\r\n\t   var ul = document.createElement('ul');\r\n\t   ul.setAttribute('class','terminus-ul' );\r\n\t   nav.appendChild(ul);\r\n\t   // connected to db\r\n\t   var a = document.createElement('a');\r\n\t   a.setAttribute('class', 'terminus-dashboard-info terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer\"');\r\n\t   a.appendChild(document.createTextNode(nm));\r\n\t   ul.appendChild(a);\r\n\t   var p = this.ui.page ? this.ui.page : \"db\";\r\n\t   if(this.ui.showControl(\"db\")){\r\n\t\t   if(p == \"db\") {\r\n\t\t\t   a.classList.add(\"terminus-selected\");\r\n\t\t\t   self.ui.page = \"db\";\r\n\t\t   }\r\n\t\t   a.addEventListener(\"click\", function(event){\r\n\t\t\t   event.stopPropagation();\r\n\t\t\t   self.ui.showDBMainPage();\r\n\t\t\t   self.ui.page = \"db\";\r\n\t\t\t   self.ui.clearMessages();\r\n\t\t\t   self.ui.redrawControls();\r\n\t\t   });\r\n\t   }\r\n\t   if(this.ui.showControl(\"get_document\")){\r\n\t\t   var item = this.getControlHTML(\"Documents\", \"fas fa fa-book\");\r\n\t\t   if(p == \"docs\") item.classList.add(\"terminus-selected\");\r\n\t\t   item.addEventListener(\"click\", function(event){\r\n\t\t\t   event.stopPropagation();\r\n\t\t\t   self.ui.showDocumentPage();\r\n\t\t\t   self.ui.clearMessages();\r\n\t\t\t   self.ui.page = \"docs\";\r\n\t\t\t   self.ui.redrawControls();\r\n\t\t\t});\r\n\t\t   ul.appendChild(item);\r\n\t   }\r\n\t   if(this.ui.showControl(\"delete_database\")){\r\n\t\t   var item = this.getControlHTML(\"Delete Database\", \"fa-trash-alt\");\r\n\t\t   item.addEventListener(\"click\", function(event){\r\n\t\t\t   UTILS.activateSelectedNav(this, self);\r\n\t\t\t   self.ui.clearMessages();\r\n\t\t\t   self.ui.deleteDatabase();\r\n\t\t   });\r\n\t\t   ul.appendChild(item);\r\n\t   }\r\n\t   if(this.ui.showControl(\"woql_select\")){\r\n\t\t   var item = this.getControlHTML(\"Query\", \"fa-search\");\r\n\t\t   if(p == \"query\") item.classList.add(\"terminus-selected\");\r\n\t\t   item.addEventListener(\"click\", function(event){\r\n\t\t\t   UTILS.activateSelectedNav(this, self);\r\n\t\t\t   event.stopPropagation();\r\n\t\t\t   self.ui.page = \"query\";\r\n\t\t\t   self.ui.showQueryPage();\r\n\t\t\t   self.ui.clearMessages();\r\n\t\t\t   self.ui.redrawControls();\r\n\t\t   });\r\n\t\t   ul.appendChild(item);\r\n\t   }\r\n\t   if(this.ui.showControl(\"get_schema\")){\r\n\t\t   var item = this.getControlHTML(\"Schema\", \"fa-cog\");\r\n\t\t   if(p == \"schema\") item.classList.add(\"terminus-selected\");\r\n\t\t   item.addEventListener(\"click\", function(){\r\n\t\t\t   UTILS.activateSelectedNav(this, self);\r\n\t\t\t   self.ui.page = \"schema\";\r\n\t\t\t   self.ui.showSchemaPage();\r\n\t\t\t   self.ui.clearMessages();\r\n\t\t\t   self.ui.redrawControls();\r\n\t\t   })\r\n\t\t   ul.appendChild(item);\r\n\t   }\r\n   }\r\n   return dbc;\r\n}\r\n\r\n\r\nTerminusDBController.prototype.getControlHTML = function(text, ic, css){\r\n   var self = this;\r\n   var a = document.createElement('a');\r\n   a.setAttribute('class', 'terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n   var icon = document.createElement('i');\r\n   icon.setAttribute('class', 'terminus-menu-icon fa ' + ic);\r\n   a.appendChild(icon);\r\n   var txt = document.createTextNode(text);\r\n   a.appendChild(txt);\r\n   return a;\r\n}\r\n\r\n\r\n\r\nmodule.exports={TerminusDBViewer:TerminusDBViewer,\r\n\t            TerminusDBController:TerminusDBController,\r\n\t            TerminusDBCreator:TerminusDBCreator}\r\n","const TerminusClient = require('@terminusdb/terminus-client');\r\nconst TerminusCodeSnippet = require('./query/TerminusCodeSnippet');\r\nconst ResultPane = require(\"./ResultPane\");\r\nconst UTILS = require('../Utils');\r\nconst HTMLHelper = require('./HTMLHelper');\r\nconst TerminusViolations = require('./TerminusViolation');\r\n\r\nfunction QueryPane(client, query, result){\r\n\tthis.client = client;\r\n\tthis.query = query;\r\n\tthis.result = result;\r\n\tthis.views = [];\r\n\tthis.container = document.createElement('span');\r\n\tthis.messages = document.createElement('div');\r\n\tthis.messages.setAttribute('class', 'terminus-query-messages');\r\n\tthis.defaultResultView = { showConfig: false, editConfig: false };\r\n\tthis.defaultQueryView = { showQuery: false, editQuery: false };\r\n}\r\n\r\nQueryPane.prototype.load = function(repl){\r\n\treturn this.query.execute(this.client).then( (result) => {\r\n\t\t\tlet nresult = new TerminusClient.WOQLResult(result, this.query);\r\n\t\t\tthis.updateResult(nresult);\r\n\t});\r\n}\r\n\r\n\r\nQueryPane.prototype.fireDefaultQueries = function(){\r\n\tlet WOQL = TerminusClient.WOQL;\r\n\tvar query = WOQL.query().classMetadata();\r\n\tquery.execute(this.client).then((results) => {\r\n\t\tlet qcres = new TerminusClient.WOQLResult(results, query);\r\n\t\tthis.classMetaDataRes = qcres;\r\n\t})\r\n\tvar query = WOQL.query().propertyMetadata();\r\n\tquery.execute(this.client).then((results) => {\r\n\t\tlet qpres = new TerminusClient.WOQLResult(results, query);\r\n\t\tthis.propertyMetaDataRes = qpres;\r\n\t})\r\n}\r\n\r\nQueryPane.prototype.options = function(opts){\r\n\tthis.showQuery = (opts && typeof opts.showQuery != \"undefined\" ? opts.showQuery : false);\r\n\tthis.editQuery = (opts && typeof opts.editQuery != \"undefined\" ? opts.editQuery : false);\r\n\tthis.showHeader = (opts && typeof opts.showHeader != \"undefined\" ? opts.showHeader : false);\r\n\tthis.addViews = (opts && typeof opts.addViews != \"undefined\" ? opts.addViews : false);\r\n\tthis.intro = (opts && typeof opts.intro != \"undefined\" ? opts.intro : false);\r\n\tvar css = (opts && typeof opts.css != \"undefined\" ? opts.css : 'terminus-query-pane-cont');\r\n    this.container.setAttribute('class', css);\r\n    return this;\r\n}\r\n\r\nQueryPane.prototype.getSection = function(sName){\r\n\tvar btn = document.createElement('button');\r\n\tbtn.setAttribute('class', 'terminus-query-section');\r\n\tbtn.appendChild(document.createTextNode(sName));\r\n\treturn btn;\r\n}\r\n\r\nQueryPane.prototype.clearSubMenus = function(btn){\r\n\tvar par = btn.parentElement.parentElement;\r\n\tvar smenus = par.getElementsByClassName('terminus-queries-submenu');\r\n\tfor(var i=0; i<smenus.length; i++){\r\n\t\tHTMLHelper.removeChildren(smenus[i]);\r\n\t}\r\n}\r\n\r\nQueryPane.prototype.getResults = function(query){\r\n\tif(query)\r\n\t\tthis.input.setQuery(query);\r\n\tHTMLHelper.removeChildren(this.sampleQueryDOM);\r\n\tthis.sampleQueryDOM.appendChild(document.createTextNode(\" Saved Queries \"))\r\n\tthis.input.refreshContents();\r\n}\r\n\r\nQueryPane.prototype.AddEvents = function(btn, aval){\r\n\tvar self = this;\r\n\tbtn.addEventListener('click', function(){\r\n\t\tlet WOQL = TerminusClient.WOQL;\r\n\t\tself.clearSubMenus(this);\r\n\t\tvar query;\r\n\t\tswitch(this.value){\r\n\t\t\tcase 'Show All Schema Elements':\r\n\t\t\t\tquery = WOQL.query().elementMetadata();\r\n\t\t\tbreak;\r\n\t\t\tcase 'Show All Classes':\r\n\t\t\t\tquery = WOQL.query().classMetadata();\r\n\t\t\tbreak;\r\n\t\t\tcase 'Show All Properties':\r\n\t\t\t\tquery = WOQL.query().propertyMetadata();\r\n\t\t\tbreak;\r\n\t\t\tcase 'Show Document Classes':\r\n\t\t\t\tquery = WOQL.query().concreteDocumentClasses();\r\n\t\t\tbreak;\r\n\t\t\tcase 'Show All Data':\r\n\t\t\t\tquery = WOQL.query().getEverything();\r\n\t\t\tbreak;\r\n\t\t\tcase 'Show all documents':\r\n\t\t\t\tquery = WOQL.query().documentMetadata();\r\n\t\t\tbreak;\r\n\t\t\tcase 'Show data of chosen type':\r\n\t\t\t\tvar choosen = aval || 'scm:' + this.innerText;\r\n\t\t\t\tquery = WOQL.query().getDataOfClass(choosen);\r\n\t\t\tbreak;\r\n\t\t\tcase 'Show data of chosen property':\r\n\t\t\t\tvar choosen = aval || 'scm:' + this.innerText;\r\n\t\t\t\tquery = WOQL.query().getDataOfProperty(choosen);\r\n\t\t\tbreak;\r\n\t\t\tcase 'Show data of type':\r\n\t\t\t\treturn;\r\n\t\t\tbreak;\r\n\t\t\tcase 'Show data for property':\r\n\t\t\t\treturn;\r\n\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log('Invalid Type of query');\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tself.getResults(query);\r\n\t})\r\n}\r\n\r\nQueryPane.prototype.getQueryMenu = function(qName){\r\n\tvar btn = document.createElement('button');\r\n\tbtn.setAttribute('class', 'terminus-load-queries');\r\n\tbtn.setAttribute('value', qName);\r\n\tbtn.appendChild(document.createTextNode(qName));\r\n\tthis.AddEvents(btn);\r\n\treturn btn;\r\n}\r\n\r\nQueryPane.prototype.getSubDataMenu = function(qName, val, aval){\r\n\tvar btn = document.createElement('button');\r\n\tbtn.setAttribute('class', 'terminus-load-queries');\r\n\tbtn.setAttribute('value', qName);\r\n\tbtn.appendChild(document.createTextNode(val));\r\n\tthis.AddEvents(btn, aval);\r\n\treturn btn;\r\n}\r\n\r\n// schema queries\r\nQueryPane.prototype.getSchemaSection = function(d){\r\n\tvar section = this.getSection('Schema Queries');\r\n\td.appendChild(section);\r\n\tvar btn = this.getQueryMenu('Show All Schema Elements');\r\n\td.appendChild(btn);\r\n\tvar btn = this.getQueryMenu('Show All Classes');\r\n\td.appendChild(btn);\r\n\tvar btn = this.getQueryMenu('Show Document Classes');\r\n\td.appendChild(btn);\r\n\tvar btn = this.getQueryMenu('Show All Properties');\r\n\td.appendChild(btn);\r\n}\r\n\r\nQueryPane.prototype.checkIfDataMenuOpen = function(btn){\r\n\tvar isOpen = false;\r\n\tif(btn.children.length){\r\n\t\tfor(var i=0; i<btn.children.length; i++){\r\n\t\t\t//var child = btn.children[i].getElementsByClassName('terminus-queries-submenu');\r\n\t\t\tvar child = btn.getElementsByClassName('terminus-queries-submenu');\r\n\t\t\tif(child.length){\r\n\t\t\t\tfor(var j=0; j<child.length; j++){\r\n\t\t\t\t\tHTMLHelper.removeElement(child[j]);\r\n\t\t\t\t\tisOpen = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn isOpen;\r\n}\r\n\r\nQueryPane.prototype.showDataOfTypeEvent = function(btn){\r\n\tvar self = this;\r\n\tbtn.addEventListener('click', function(){\r\n\t\tvar isMenuOpen = self.checkIfDataMenuOpen(this);\r\n\t\tif(!isMenuOpen){\r\n\t\t\tvar subPar = document.createElement('div');\r\n\t\t\tsubPar.setAttribute('class', 'terminus-queries-submenu');\r\n\t\t\tif(self.classMetaDataRes && self.classMetaDataRes.hasBindings()){\r\n\t\t\t\tfor(var i = 0; i<self.classMetaDataRes.bindings.length; i++){\r\n\t\t\t\t\tvar text = self.classMetaDataRes.bindings[i]['v:Label']['@value'];\r\n\t\t\t\t\tvar val = self.classMetaDataRes.bindings[i]['v:Element'];\r\n\t\t\t\t\tsubPar.appendChild(self.getSubDataMenu('Show data of chosen type', text, val));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbtn.appendChild(subPar);\r\n\t\t}\t\t\r\n\t})\r\n}\r\n\r\nQueryPane.prototype.showPropertyOfTypeEvent = function(btn){\r\n\tvar self = this;\r\n\tbtn.addEventListener('click', function(){\r\n\t\tvar isMenuOpen = self.checkIfDataMenuOpen(this);\r\n\t\tif(!isMenuOpen){\r\n\t\t\tvar subPar = document.createElement('div');\r\n\t\t\tsubPar.setAttribute('class', 'terminus-queries-submenu');\r\n\t\t\tif(self.propertyMetaDataRes && self.propertyMetaDataRes.hasBindings()){\r\n\t\t\t\tfor(var i = 0; i<self.propertyMetaDataRes.bindings.length; i++){\r\n\t\t\t\t\tvar text = self.propertyMetaDataRes.bindings[i]['v:Label']['@value'];\r\n\t\t\t\t\tvar val = self.propertyMetaDataRes.bindings[i]['v:Property'];\r\n\t\t\t\t\tsubPar.appendChild(self.getSubDataMenu('Show data of chosen property', text, val));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbtn.appendChild(subPar);\r\n\t\t}\r\n\t})\r\n}\r\n\r\nQueryPane.prototype.addCheveronIcon = function(btn){\r\n\tvar i = document.createElement('i');\r\n\ti.setAttribute('class', 'fa fa-chevron-right terminus-query-section');\r\n\tbtn.appendChild(i);\r\n}\r\n\r\n// data queries\r\nQueryPane.prototype.getDataSection = function(d){\r\n\tvar section = this.getSection('Data Queries');\r\n\td.appendChild(section);\r\n\t// div to populate submenu on data of type\r\n\tvar bd = document.createElement('div');\r\n\tbd.setAttribute('class', 'terminus-query-submenu');\r\n\td.appendChild(bd);\r\n\tvar btn = this.getQueryMenu('Show data of type');\r\n\tbd.appendChild(btn);\r\n\tthis.addCheveronIcon(btn);\r\n\tthis.showDataOfTypeEvent(btn);\r\n\t// div to populate submenu on property of type\r\n\tvar bd = document.createElement('div');\r\n\tbd.setAttribute('class', 'terminus-query-submenu');\r\n\td.appendChild(bd);\r\n\tvar btn = this.getQueryMenu('Show data for property');\r\n\tbd.appendChild(btn);\r\n\tthis.showPropertyOfTypeEvent(btn);\r\n\tthis.addCheveronIcon(btn);\r\n\tvar btn = this.getQueryMenu('Show All Data');\r\n\td.appendChild(btn);\r\n}\r\n\r\nQueryPane.prototype.fireDocumentEvent = function(document){\r\n\tlet WOQL = TerminusClient.WOQL;\r\n\tvar query = WOQL.query().documentProperties(document);\r\n\tthis.getResults(query);\r\n}\r\n\r\nQueryPane.prototype.getEnterDocumentIdDOM = function(){\r\n\tvar sp = document.createElement('span');\r\n\tsp.setAttribute('class', 'terminus-display-flex');\r\n\tvar inp = document.createElement('input');\r\n\tinp.setAttribute('class', 'terminus-doc-id-input');\r\n\tinp.setAttribute('placeholder', 'doc:myDocId');\r\n\tvar sub = document.createElement('button');\r\n\tsub.setAttribute('class', 'terminus-btn terminus-doc-id-input-submit');\r\n\tsub.appendChild(document.createTextNode('Submit'));\r\n\tvar self = this;\r\n\tsub.addEventListener('click', function(){\r\n\t\tself.fireDocumentEvent(inp.value);\r\n\t})\r\n\tsp.appendChild(inp);\r\n\tsp.appendChild(sub);\r\n\treturn sp;\r\n}\r\n\r\n// document queries\r\nQueryPane.prototype.getDocumentSection = function(d){\r\n\tvar section = this.getSection('Document Queries');\r\n\td.appendChild(section);\r\n\tvar btn = this.getQueryMenu('Show all documents');\r\n\td.appendChild(btn);\r\n\td.appendChild(this.getEnterDocumentIdDOM());\r\n}\r\n\r\n// bottom color transaprent\r\nQueryPane.prototype.getQueryMenuBlock = function(){\r\n\tvar d = document.createElement('div');\r\n\td.setAttribute('class', 'terminus-load-queries');\r\n\tthis.getSchemaSection(d);\r\n\tthis.getDataSection(d);\r\n\tthis.getDocumentSection(d);\r\n\treturn d;\r\n}\r\n\r\nQueryPane.prototype.getSampleQueriesDOM = function(){\r\n\tvar i = document.createElement('icon');\r\n\ti.setAttribute('class', 'fa fa-ellipsis-v terminus-ellipsis-icon');\r\n\ti.setAttribute('title', 'Click to load sample Queries');\r\n\ti.setAttribute('value', false);\r\n\ti.appendChild(document.createTextNode(\" Saved Queries \"))\r\n\tthis.sampleQueryDOM = i;\r\n\tvar self = this;\r\n\ti.addEventListener('click', function(e){\r\n\t\tif(e.target !== this) return;\r\n\t\tif(this.children.length) {\r\n\t\t\tHTMLHelper.removeChildren(this);\r\n\t\t\tthis.appendChild(document.createTextNode(\" Saved Queries \"))\r\n\t\t}\r\n\t\telse{\r\n\t\t\tvar d = self.getQueryMenuBlock();\r\n\t\t\tthis.appendChild(d);\r\n\t\t}\r\n\t})\r\n\treturn i;\r\n}\r\n\r\nQueryPane.prototype.getAsDOM = function(){\r\n\tif(this.intro){\r\n\t\tthis.container.appendChild(UTILS.getHeaderDom(this.intro));\r\n\t}\r\n\tif(this.showQuery) {\r\n\t\tthis.fireDefaultQueries();\r\n\t\tvar configspan = document.createElement(\"span\");\r\n\t\tconfigspan.setAttribute(\"class\", \"pane-config-icons\");\r\n\t\tthis.querySnippet = configspan;\r\n\t\tthis.container.appendChild(configspan);\r\n\t\tvar mode = (this.editQuery ? \"edit\" : \"view\");\r\n\t\tthis.input = this.createInput(mode);\r\n\t\tvar ipdom = this.input.getAsDOM(true);\r\n\t\tvar ispan = document.createElement(\"span\");\r\n\t\tispan.setAttribute(\"class\", \"query-pane-config\");\r\n\t\tvar ic = document.createElement(\"i\");\r\n\t\t//ic.setAttribute('style', 'margin:10px;')\r\n\t\tconfigspan.appendChild(ic);\r\n\t\tvar self = this;\r\n\t\tfunction showQueryConfig(){\r\n\t\t\tif(self.showQuery != \"always\"){\r\n\t\t\t\tconfigspan.title=\"Click to Hide Query\";\r\n\t\t\t\tic.setAttribute(\"class\", \"fas fa fa-times-circle\");\r\n\t\t\t}\r\n\t\t\tconfigspan.classList.remove('terminus-click-to-view-query');\r\n\t\t\tif(configspan.nextSibling){\r\n\t\t\t\tself.container.insertBefore(ipdom, configspan.nextSibling);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tself.container.appendChild(ipdom);\r\n\t\t\t}\r\n\t\t\tvar qicon = self.getSampleQueriesDOM();\r\n\t\t\tvar sqd = document.createElement(\"span\");\r\n\t\t\tsqd.setAttribute(\"class\", \"sample-queries-pane\");\r\n\t\t\tsqd.appendChild(qicon);\r\n\t\t\tipdom.appendChild(sqd);\r\n\t\t\tself.input.stylizeSnippet();\r\n\t\t}\r\n\t\tfunction hideQueryConfig(){\r\n\t\t\tconfigspan.title=\"Click to View Query\";\r\n            ic.setAttribute(\"class\", \"fas fa fa-search terminus-query-view-icon\");\r\n\t\t\tconfigspan.classList.add('terminus-click-to-view-query');\r\n\t\t\tself.container.removeChild(ipdom);\r\n\t\t}\r\n\t\tconfigspan.addEventListener(\"click\", () => {\r\n\t\t\tif(this.showingQuery) hideQueryConfig();\r\n\t\t\telse showQueryConfig();\r\n\t\t\tthis.showingQuery = !this.showingQuery;\r\n\t\t});\r\n\t\tshowQueryConfig();\r\n\t\tif(this.showQuery == \"icon\") hideQueryConfig();\r\n\t}\r\n\tthis.resultDOM = document.createElement(\"span\");\r\n\tif(this.showQuery){\r\n\t\tthis.resultDOM.setAttribute(\"class\", \"terminus-query-results-full\");\r\n\t}\r\n\telse {\r\n\t\tthis.resultDOM.setAttribute(\"class\", \"terminus-query-results\");\r\n\t}\r\n\tthis.resultDOM.appendChild(this.messages);\r\n\tif(this.views.length == 0){\r\n\t\tthis.addView(TerminusClient.View.table(), this.defaultResultView);\r\n\t}\r\n\t//this is where we want to put in the view headers in the case of the query page\r\n\tfor(var i = 0; i<this.views.length; i++){\r\n\t\tvar vdom = this.views[i].getAsDOM();\r\n\t\tif(vdom){\r\n\t\t\tif(this.showHeader){\r\n\t\t\t\tvar closable = (this.views.length != 1);\r\n\t\t\t\t//var qhdr = this.getResultPaneHeader(closable);\r\n\t\t\t\t//vdom.prepend(qhdr);\r\n\t\t\t}\r\n\t\t\tthis.resultDOM.appendChild(vdom);\r\n\t\t}\r\n\t}\r\n\tthis.container.appendChild(this.resultDOM);\r\n\tif(this.addViews) this.container.appendChild(this.getAddViewControl());\r\n\treturn this.container;\r\n}\r\n\r\n\r\nQueryPane.prototype.getResultPaneHeader = function(closable){\r\n\tvar c = document.createElement('div');\r\n\tvar savePaneButton = document.createElement('button');\r\n\tsavePaneButton.setAttribute('class', 'terminus-btn terminus-query-btn');\r\n\tsavePaneButton.appendChild(document.createTextNode('Save'));\r\n\tc.appendChild(savePaneButton);\r\n\tif(closable){\r\n\t\tvar closePaneButton = document.createElement('button');\r\n\t\tclosePaneButton.setAttribute('class', 'terminus-btn terminus-query-btn');\r\n\t\tclosePaneButton.appendChild(document.createTextNode('Close'));\r\n\t\tc.appendChild(closePaneButton);\r\n\t}\r\n\tvar collapsePaneButton = document.createElement('button');\r\n\tcollapsePaneButton.setAttribute('class', 'terminus-btn terminus-query-btn');\r\n\tcollapsePaneButton.appendChild(document.createTextNode('Collapse'));\r\n\tc.appendChild(collapsePaneButton);\r\n\treturn c;\r\n}\r\n\r\nQueryPane.prototype.createInput = function(mode){\r\n    let input = new TerminusCodeSnippet(\"woql\", mode, null, 800);\r\n    if(this.query){\r\n    \tinput.setQuery(this.query);\r\n\t}\r\n\tvar self = this;\r\n\tinput.submit = function(qObj){\r\n\t\tself.submitQuery(qObj);\r\n\t};\r\n\treturn input;\r\n}\r\n\r\nQueryPane.prototype.updateQuery = function(qObj){\r\n\tthis.query = qObj;\r\n\tif(this.input) this.input.setQuery(this.query);\r\n}\r\n\r\nQueryPane.prototype.updateResult = function(result){\r\n\tthis.result = result;\r\n\tthis.updateQuery(result.query);\r\n\tthis.refreshViews();\r\n}\r\n\r\nQueryPane.prototype.addView = function(config, options){\r\n\tvar nrp = new ResultPane(this.client, this, config).options(options);\r\n\tif(this.result){\r\n\t\tnrp.setResult(this.result);\r\n\t}\r\n\tthis.views.push(nrp);\r\n\treturn nrp;\r\n}\r\n\r\nQueryPane.prototype.empty = function(){\r\n\treturn (typeof this.query == \"undefined\");\r\n}\r\n\r\nQueryPane.prototype.clearMessages = function(){\r\n\tif(this.messages.children.length) HTMLHelper.removeChildren(this.messages);\r\n}\r\n\r\nQueryPane.prototype.getBusyLoader = function(){\r\n     var pbc = document.createElement('div');\r\n     pbc.setAttribute('class', 'term-progress-bar-container');\r\n     var pbsa = document.createElement('div');\r\n     pbsa.setAttribute('class', 'term-progress-bar term-stripes animated reverse slower');\r\n     pbc.appendChild(pbsa);\r\n     var pbia = document.createElement('span');\r\n     pbia.setAttribute('class', 'term-progress-bar-inner');\r\n     pbsa.appendChild(pbia);\r\n\t return pbc;\r\n}\r\n\r\nQueryPane.prototype.showBusy = function(msg){\r\n\tvar msgHolder = document.createElement('div');\r\n\tmsgHolder.setAttribute('class', 'terminus-busy-msg')\r\n\tmsgHolder.appendChild(document.createTextNode(msg));\r\n\tmsgHolder.appendChild(this.getBusyLoader());\r\n\tthis.messages.appendChild(msgHolder);\r\n}\r\n\r\nQueryPane.prototype.showError = function(e){\r\n\tthis.showMessage(e, \"error\");\r\n}\r\n\r\nQueryPane.prototype.showMessage = function(m, type){\r\n\tvar md = document.createElement('div');\r\n\tmd.setAttribute('class', 'terminus-show-msg-' + type);\r\n\tmd.appendChild(document.createTextNode(m));\r\n\tthis.messages.appendChild(md);\r\n}\r\n\r\nQueryPane.prototype.showNoBindings = function(){\r\n\tnor = document.createElement('div');\r\n\tnor.setAttribute('class', 'terminus-show-msg-warning');\r\n\tnor.appendChild(document.createTextNode(\"No results available for this query\"));\r\n\tthis.clearMessages();\r\n\tthis.messages.appendChild(nor);\r\n}\t\r\n\r\nQueryPane.prototype.submitQuery = function(qObj){\r\n\tthis.clearMessages();\r\n\tif(!qObj){\r\n\t\tthis.showError(\"Query could not be extracted from input box - remember that the last element in the query must be a WOQL object\")\r\n\t}\r\n\tif(typeof qObj == 'string'){\r\n\t\tthis.showError(qObj);\r\n\t\treturn;\r\n\t}\r\n    this.query = qObj;\r\n\tthis.showBusy('Fetching results ...');\r\n\tvar self = this;\r\n\tvar start = Date.now();\r\n    qObj.execute(this.client).then((results) => {\r\n\t\tvar r = new TerminusClient.WOQLResult(results, qObj);\r\n\t\tthis.result = r;\r\n\t\tthis.clearMessages();\r\n\t\tif(this.result.hasBindings()){\r\n\t\t\tvar delta = Date.now() - start;\r\n\t\t\tthis.showMessage(\"Query returned \" + this.result.count() + \" results in \" + (delta/1000) + \" seconds\", \"info\");\r\n\t\t\tthis.refreshViews();\r\n\t\t}\r\n\t\telse this.showNoBindings();\r\n\t}).catch((error) => {\r\n\t\tthis.clearMessages();\r\n\t\tif(error.data && error.data['terminus:witnesses']){\r\n\t\t\tthis.showViolations(error.data['terminus:witnesses']);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.showError(error);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nQueryPane.prototype.refreshViews = function(){\r\n\tfor(var i = 0; i<this.views.length; i++){\r\n\t\tthis.views[i].updateResult(this.result);\r\n\t}\r\n}\r\n\r\nQueryPane.prototype.showViolations = function(vios){\r\n    var nvios = new TerminusViolations(vios, this); \r\n\tthis.messages.appendChild(nvios.getAsDOM(\"\"));\r\n}\r\n\r\nQueryPane.prototype.getAddViewControl = function(){\r\n\tvar vd = document.createElement('div');\r\n\tvd.setAttribute('class', 'terminus-add-view-selector');\r\n\tvar self = this;\r\n\tvar WOQL = TerminusClient.WOQL;\r\n\tvar newView = function(val){\r\n\t\tself.selector.value = \"\";\r\n\t\tvar c= eval('WOQL.' + val + \"()\");\r\n\t\tvar nv = self.addView(c, self.defaultResultView);\r\n\t\tif(self.result){\r\n\t\t\tnv.setResult(self.result);\r\n\t\t}\r\n\t\tvar vdom = nv.getAsDOM();\r\n\t\tif(vdom){\r\n\t\t\tself.resultDOM.appendChild(vdom);\r\n\t\t}\r\n\t}\r\n\tvar opts = [\r\n\t\t{ value: \"\", label: \"Add another view of results\"},\r\n\t\t{ value: \"table\", label: \"Add Table View\"},\r\n\t\t{ value: \"stream\", label: \"Add Stream View\"},\r\n\t\t{ value: \"graph\", label: \"Add Graph View\"},\r\n\t\t{ value: \"chooser\", label: \"Add Drop-down View\"},\r\n\t\t{ value: \"map\", label: \"Add Map View\"}\r\n\t];\r\n\tvar sel = HTMLHelper.getSelectionControl(\"view\", opts, false,newView);\r\n\tthis.selector = sel;\r\n\tvd.appendChild(sel);\r\n\treturn vd;\r\n}\r\n\r\nmodule.exports = QueryPane;","const TerminusCodeSnippet = require('./query/TerminusCodeSnippet');\r\nconst Datatypes = require(\"./Datatypes\");\r\nconst DatatypeRenderers = require(\"./DatatypeRenderers\");\r\n\r\nconst SimpleTable = require(\"./table/SimpleTable\");\r\nconst SimpleGraph = require(\"./graph/SimpleGraph\");\r\nconst SimpleStream = require(\"./stream/SimpleStream\");\r\nconst SimpleChooser = require(\"./chooser/SimpleChooser\");\r\nconst HTMLHelper = require('./HTMLHelper');\r\n\r\n/**\r\n * Result Pane is defined by a WOQL configuration object\r\n * Visually it consists of a single rule editor (showing the current state of the configuration object) which may be collapsed behind a configuration link\r\n * and a single result view which shows the result of the rule when applied to the current results.\r\n *\r\n */\r\nfunction ResultPane(client, querypane, config){\r\n    this.client = client;\r\n    this.qp = querypane;\r\n    this.config = config;\r\n\tthis.container = document.createElement('span');\r\n    this.container.setAttribute('class', 'terminus-result-pane');\r\n}\r\n\r\nResultPane.prototype.options = function(opts){\r\n\tthis.showConfig = (opts && typeof opts.showConfig != \"undefined\" ? opts.showConfig : false);\r\n    this.editConfig = (opts && typeof opts.editConfig != \"undefined\" ? opts.editConfig : false);\r\n    this.changeViewType = (opts && typeof opts.changeViewType != \"undefined\" ? opts.changeViewType : true);\r\n    this.intro = (opts && typeof opts.intro != \"undefined\" ? opts.intro : false);\r\n    this.renderers =  (opts && opts.renderers ? opts.renderers : {\r\n\t\ttable: new SimpleTable(),\r\n\t\tgraph: new SimpleGraph(),\r\n\t\tstream: new SimpleStream(),\r\n\t\tchooser: new SimpleChooser()\r\n    });\r\n    if(this.config){\r\n        this.viewers = [this.config];\r\n    }\r\n    this.viewers =  (opts && typeof opts.viewers != \"undefined\" ? this.viewers.concat(opts.viewers) : this.viewers);\r\n    this.currentViewer = 0;\r\n    return this;\r\n}\r\n\r\nResultPane.prototype.getRenderer = function(){\r\n    if(this.config && this.config.renderer()){\r\n        return this.config.renderer();\r\n    }\r\n    else {\r\n        if(this.config.type && this.renderers[this.config.type]){\r\n            return this.renderers[this.config.type];\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nResultPane.prototype.getAsDOM = function(){\r\n    if(this.intro){\r\n        var di = (typeof this.intro == \"string\" ? document.createTextNode(this.intro) : this.intro);\r\n\t\tthis.container.appendChild(di);\r\n\t}\r\n    var configspan = document.createElement(\"span\");\r\n    configspan.setAttribute(\"class\", \"pane-config-icons\");\r\n    this.container.appendChild(configspan);\r\n\tthis.resultDOM = document.createElement('span');\r\n\tthis.resultDOM.setAttribute('class', 'terminus-result-view');\r\n\tif(this.result){\r\n\t\tthis.resultDOM.appendChild(this.getResultDOM());\r\n\t}\r\n\tthis.container.appendChild(this.resultDOM);\r\n\tif(this.showConfig){\r\n        this.showingQuery = (this.showConfig != \"icon\");\r\n\t\tvar mode = (this.editConfig ? \"edit\" : \"view\");\r\n\t\tthis.input = this.createInput(mode);\r\n\t\tvar ipdom = this.input.getAsDOM();\r\n        var ispan = document.createElement(\"span\");\r\n        ispan.addEventListener('mouseover', function(){\r\n            this.style.cursor = \"pointer\";\r\n\t\t});\r\n\t\tispan.setAttribute(\"class\", \"result-pane-config\");\r\n\t\tvar ic = document.createElement(\"i\");\r\n\t\tispan.appendChild(ic);\r\n\t\tconfigspan.appendChild(ispan);\r\n\t\tvar self = this;\r\n\t\tfunction showQueryConfig(){\r\n\t\t\tconfigspan.title=\"Click to Hide View Configuration\";\r\n\t\t\tic.setAttribute(\"class\", \"fas fa fa-times-circle\");\r\n            if(configspan.nextSibling){\r\n                self.container.insertBefore(ipdom, configspan.nextSibling);\r\n                if(self.input.snippet.value)\r\n\t\t\t\t\tself.input.stylizeSnippet();\r\n            }\r\n            else{\r\n                self.container.appendChild(ipdom);\r\n                if(self.input.snippet.value)\r\n\t\t\t\t\tself.input.stylizeSnippet();\r\n            }\r\n\t\t}\r\n\t\tfunction hideQueryConfig(){\r\n\t\t\tconfigspan.title=\"Click to View Configuration\";\r\n            ic.setAttribute(\"class\", \"terminus-result-icons terminus-result-view-icon \" + self.getViewConfigIconClass());\r\n\t\t\tself.container.removeChild(ipdom);\r\n\t\t}\r\n\t\tispan.addEventListener(\"click\", () => {\r\n\t\t\tif(this.showingQuery) hideQueryConfig();\r\n\t\t\telse showQueryConfig();\r\n\t\t\tthis.showingQuery = !this.showingQuery;\r\n        });\r\n        showQueryConfig();\r\n\t\tif(this.showConfig == \"icon\") hideQueryConfig();\r\n    }\r\n    if(this.changeViewType){\r\n        cvicons = this.getViewTypeIconDOM(ipdom);\r\n        if(cvicons) configspan.prepend(cvicons);\r\n    }\r\n\treturn this.container;\r\n}\r\n\r\nResultPane.prototype.getViewConfigIconClass = function(){\r\n    if(this.changeViewType && this.viewers.length > 1){\r\n        return \"fas fa fa-vial\";\r\n    }\r\n    if(this.viewers[this.currentViewer].icon){\r\n        return this.viewers[this.currentViewer].icon;\r\n    }\r\n    var def = this.getDefaultViewerIcon(this.viewers[this.currentViewer]);\r\n    return def.icon;\r\n}\r\n\r\n\r\nResultPane.prototype.getViewTypeIconDOM = function(sp, ipdom){\r\n    var bsp = document.createElement('span');\r\n    bsp.setAttribute('class', 'terminus-result-icons');\r\n    if(this.viewers.length > 1){\r\n        for(var i = 0; i<this.viewers.length; i++){\r\n            var isp = this.getIconForViewer(this.viewers[i], i, bsp);\r\n            bsp.appendChild(isp);\r\n        }\r\n    }\r\n    return bsp;\r\n}\r\n\r\nResultPane.prototype.changeViewerType = function(viewer, index){\r\n    this.currentViewer = index;\r\n    this.config = viewer;\r\n    if(this.input){\r\n        this.input.setQuery(viewer);\r\n        this.input.submit(this.input.qObj);\r\n    }\r\n    else {\r\n        this.updateView(viewer);\r\n    }    \r\n}\r\n\r\n\r\nResultPane.prototype.getDefaultViewerIcon = function(viewer){\r\n    var view_types = {\r\n        table: {label: \"Table\", icon: \"fa fa-table\"},\r\n\t\tgraph: {label: \"Graph\", icon: \"fas fa-code-branch\"},\r\n\t\tchooser: {label: \"Drop-down List\", icon: \"fas fa-caret-down\"},\r\n\t\tstream: {label: \"Result Stream\", icon: \"fa fa-list\"}\r\n    }\r\n    return view_types[viewer.type];\r\n}\r\n\r\n\r\nResultPane.prototype.getIconForViewer = function(viewer, index, container){\r\n    var isp = document.createElement('span');\r\n    var icon = document.createElement(\"i\");\r\n    var def = this.getDefaultViewerIcon(viewer);\r\n    icon.title = (viewer.label) ? viewer.label : def.label;\r\n    var ic = (viewer.icon ? viewer.icon : def.icon);\r\n    icon.setAttribute(\"class\", ic);\r\n    icon.classList.add('terminus-result-view-icon');\r\n    //icon.classList.add('circle-icon');\r\n    isp.appendChild(icon);\r\n    if(this.currentViewer == index){\r\n        isp.setAttribute(\"class\", \"result-icon-selected selected terminus-result-selected\");\r\n        icon.classList.add('terminus-view-selected');\r\n    }\r\n    else {\r\n        isp.setAttribute(\"class\", \"result-icon-selectable selectable\");\r\n        isp.addEventListener('mouseover', function(){\r\n            this.style.cursor = \"pointer\";\r\n\t\t});\r\n    }\r\n    isp.addEventListener(\"click\", () => {\r\n        this.changeViewerType(viewer, index);\r\n        HTMLHelper.removeChildren(container);\r\n        for(var i = 0; i<this.viewers.length; i++){\r\n            var isp = this.getIconForViewer(this.viewers[i], i, container);\r\n            container.appendChild(isp);\r\n        }\r\n    });\r\n    return isp;\r\n}\r\n\r\nResultPane.prototype.createInput = function(mode){\r\n    let input = new TerminusCodeSnippet(\"rule\", mode);\r\n    if(this.config){\r\n    \tinput.setQuery(this.config);\r\n\t}\r\n\tvar self = this;\r\n\tinput.submit = function(config){\r\n\t\tself.updateView(config);\r\n\t};\r\n\treturn input;\r\n}\r\n\r\nResultPane.prototype.setResult = function(wres){\r\n\tthis.result = wres;\r\n}\r\n\r\nResultPane.prototype.updateResult = function(wres){\r\n\tthis.result = wres;\r\n\tHTMLHelper.removeChildren(this.resultDOM);\r\n\tthis.resultDOM.appendChild(this.getResultDOM());\r\n}\r\n\r\nResultPane.prototype.updateView = function(config){\r\n\tthis.config = config;\r\n\tHTMLHelper.removeChildren(this.resultDOM);\r\n\tif(this.result){\r\n\t\tthis.resultDOM.appendChild(this.getResultDOM());\r\n\t}\r\n}\r\n\r\nResultPane.prototype.getResultDOM = function(){\r\n\tlet span = document.createElement(\"span\");\r\n\tspan.setAttribute(\"class\", \"terminus-query-results\");\r\n    let viewer = this.config.create(this.client);\r\n    viewer.datatypes = new DatatypeRenderers();\r\n    Datatypes.initialiseDataRenderers(viewer.datatypes);\r\n    var self = this;\r\n    viewer.notify = function(r){\r\n        self.qp.updateResult(r);\r\n    }\r\n\tthis.result.first();\r\n    viewer.setResult(this.result);\r\n    \r\n    var html_renderer = this.getRenderer();\r\n\r\n\tspan.appendChild(html_renderer.render(viewer));\r\n\treturn span;\r\n}\r\n\r\nmodule.exports = ResultPane;\r\n","const HTMLHelper = require('../HTMLHelper');\r\n\r\nfunction HTMLStringViewer(options){\r\n\tthis.options(options);\t\r\n}\r\n\r\nHTMLStringViewer.prototype.options = function(options){\r\n\tthis.size = ((options && options.size) ? options.size : false);\r\n\tthis.css = ((options && options.css) ? \"terminus-literal-value \" + options.css : \"terminus-literal-value\");\r\n\tthis.max_word_size = (options && options.max_word_size ? options.max_word_size : false);\r\n\tthis.max_cell_size = (options && options.max_cell_size ? options.max_cell_size : false);\r\n\tthis.show_types = (options && options.show_types ? options.show_types : false);\r\n}\r\n\r\nHTMLStringViewer.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar value = frame.get();\r\n\treturn this.render(value);\r\n}\r\n\r\nHTMLStringViewer.prototype.renderValue = function(dataviewer){\r\n\treturn this.render(dataviewer.value());\r\n}\r\n\r\nHTMLStringViewer.prototype.render = function(value){\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', this.css);\r\n\tinput.setAttribute('data-value', value);\r\n\tif(this.show_types && this.type != \"id\"){\r\n\t\tvalue += \" (\" + this.type + \")\";\r\n\t}\r\n\tif(this.max_word_size || this.max_cell_size){\r\n\t\tHTMLHelper.wrapShortenedText(input, value, this.max_cell_size, this.max_word_size);\r\n\t}\r\n\telse {\r\n\t\tvalue = document.createTextNode(value);\r\n\t\tinput.appendChild(value);\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLStringViewer}\r\n\r\n\r\n","function HTMLStringEditor(options){\r\n\tthis.options(options);\t\r\n}\r\n\r\nHTMLStringEditor.prototype.options = function(options){\t\r\n\tthis.css = ((options && options.css) ? \"terminus-literal-value \" + options.css : \"terminus-literal-value\");\r\n\tthis.opts = options;\r\n}\r\n\r\nHTMLStringEditor.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar value = frame.get();\r\n\tvar big = ((this.opts && typeof this.opts.big != \"undefined\") ? this.opts.big : this.isBigType(this.type, value));\r\n\tif(big){\r\n\t\tvar input = document.createElement(\"textarea\");\r\n\t\tthis.css += \" terminus-literal-big-value\";\t\t\r\n\t}\r\n\telse {\r\n\t\tvar size = ((this.opts && typeof this.opts.size != \"undefined\") ? this.opts.size : this.getTypeSize(this.type, value));\r\n\t\tvar input = document.createElement(\"input\");\r\n\t\tinput.setAttribute('type', \"text\");\r\n\t\tinput.setAttribute('size', size);\r\n\t}\r\n\tinput.setAttribute('class', this.css);\r\n\tinput.setAttribute(\"data-value\", value);\r\n\t\r\n\tinput.value = value;\r\n\tvar self = this;\r\n\tinput.addEventListener(\"input\", function(){\r\n\t\tframe.set(this.value);\r\n\t});\r\n\treturn input;\r\n}\r\n\r\nHTMLStringEditor.prototype.isBigType = function(ty, value){\r\n\tif(value && value.length && value.length > 100) return true;\r\n\tvar longs = [\"xdd:coordinatePolyline\", \"xdd:coordinatePolygon\", \"xsd:base64Binary\", \"xdd:html\", \"xdd:json\", \"rdf:XMLLiteral\"];\r\n\tif(longs.indexOf(ty) == -1) return false;\r\n\treturn true;\r\n}\r\n\r\nHTMLStringEditor.prototype.getTypeSize = function(ty, value){\r\n\tif(value && value.length && value.length > 40) return 80;\r\n\tvar bigs = [\"xdd:url\", \"xdd:coordinate\", \"xsd:anyURI\"];\r\n\tvar smalls = [\"xsd:gYearMonth\", \"xdd:gYearRange\", \"xsd:decimal\", \"xsd:float\", \"xsd:time\", \"xsd:date\", \r\n\t\t\"xsd:dateTimeStamp\",\"xsd:gYearMonth\", \"xsd:gMonthDay\", \"xsd:duration\", \"xsd:yearMonthDuration\", \"xsd:dayTimeDuration\", \r\n\t\t\"xsd:nonNegativeInteger\", \"xsd:positiveInteger\", \"xsd:negativeInteger\",\t\"xsd:nonPositiveInteger\", \"xsd:integer\",\"xsd:unsignedInt\"];\r\n\tvar tinys = [\"xsd:boolean\", \"xsd:gYear\", \"xsd:gMonth\", \"xsd:gDay\", \"xsd:byte\", \"xsd:short\", \"xsd:unsignedByte\", \"xsd:language\"];\r\n\tif(bigs.indexOf(ty) != -1) return 80;\r\n\tif(smalls.indexOf(ty) != -1) return 16;\r\n\tif(tinys.indexOf(ty) != -1) return 8;\r\n\treturn 32;\r\n}\r\n\r\nmodule.exports={HTMLStringEditor}\r\n\r\n\r\n","function HTMLBooleanViewer(options){\r\n\tthis.options(options);\r\n}\r\n\r\nHTMLBooleanViewer.prototype.options = function(options){\r\n\tthis.css = \"terminus-literal-value terminus-literal-value-boolean \" + ((options && options.css) ?  options.css : \"\");\r\n}\r\n\r\nHTMLBooleanViewer.prototype.renderFrame = function(frame, dataviewer){\r\n\treturn this.render(frame.get());\r\n}\r\n\r\nHTMLBooleanViewer.prototype.renderValue = function(dataviewer){\r\n\treturn this.render(dataviewer.value());\t\r\n}\r\n\r\nHTMLBooleanViewer.prototype.render = function(value){\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', this.css);\r\n\tif(value){\r\n\t\tvar vallab = document.createTextNode(value);\r\n\t\tinput.appendChild(vallab);\r\n\t}\r\n\treturn input;\r\n}\r\n\r\n\r\nmodule.exports={HTMLBooleanViewer}\r\n\r\n","function HTMLBooleanEditor(options){\r\n\tthis.options(options);\r\n}\r\n\r\nHTMLBooleanEditor.prototype.options = function(options){\t\r\n\tthis.css = \"terminus-literal-value terminus-literal-value-range \" + ((options && options.css) ?  options.css : \"\");\r\n}\r\n\r\nHTMLBooleanEditor.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar value = frame.get();\r\n\tvar input = document.createElement(\"input\");\r\n\tinput.setAttribute('type', \"checkbox\");\r\n\tif(value){\r\n\t\tinput.setAttribute(\"checked\", \"checked\");\t\t\t\t\t\r\n\t}\r\n\tinput.addEventListener(\"change\", function(){\r\n\t\tif(value){\r\n\t\t\tframe.set(\"\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tframe.set(\"true\");\r\n\t\t}\r\n\t});\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLBooleanEditor}\r\n\r\n","const TerminusClient = require('@terminusdb/terminus-client');\r\n\r\nfunction HTMLChoiceViewer(options){};\r\nHTMLChoiceViewer.prototype.options = function(options){}\r\n\r\nHTMLChoiceViewer.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar value = frame.get();\r\n\tif(frame.frame && frame.frame.elements){\r\n\t\tthis.elements = frame.frame.elements;\r\n\t}\r\n\treturn this.render(value);\r\n}\r\n\r\nHTMLChoiceViewer.prototype.renderValue = function(dataviewer){\r\n\treturn this.render(dataviewer.value());\r\n}\r\n\r\nHTMLChoiceViewer.prototype.render = function(value){\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-choice-value\");\r\n\tinput.setAttribute('data-value', value);\r\n\tvar lab = false;\r\n\tif(value && this.elements){\r\n\t\tfor(var i = 0; i<this.elements.length; i++){\r\n\t\t\tvar elt = this.elements[i];\r\n\t\t\tif(elt.class == value){\r\n\t\t\t\tif(elt.label && elt.label[\"@value\"]){\r\n\t\t\t\t\tlab = elt.label[\"@value\"];\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\t\t\t\t\r\n\t\t}\r\n\t}\r\n\tif(value && !lab){\r\n\t\tlab = TerminusClient.UTILS.labelFromURL(value);\t\t\t\t\t\r\n\t}\r\n\tif(lab){\r\n\t\tinput.appendChild(document.createTextNode(lab));\t\t\r\n\t}\r\n\treturn input\r\n}\r\n\r\nmodule.exports={HTMLChoiceViewer}\r\n\r\n\r\n","const HTMLHelper = require('../HTMLHelper');\r\n\r\nfunction HTMLChoiceEditor(options){};\r\n\r\nHTMLChoiceEditor.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar value = frame.get();\r\n\tvar optInput = document.createElement(\"select\");\r\n\toptInput.setAttribute('class', \"terminus-choice-picker\");\r\n\tvar foptions = frame.getChoiceOptions();\r\n\tfoptions.unshift({ value: \"\", label: \"Not Specified\"});\r\n\tvar callback = function(val){\r\n\t\tframe.set(val);\r\n\t}\r\n\tvar sel = HTMLHelper.getSelectionControl(\"select-choice\", foptions, value, callback);\r\n\treturn sel;\r\n}\r\n\r\nmodule.exports={HTMLChoiceEditor}\r\n\r\n","function HTMLCoordinateViewer(options){\r\n\tthis.inputs = [];\r\n}\r\n\r\nHTMLCoordinateViewer.prototype.parseValue = function(value){\r\n\ttry {\r\n\t\tvar parsed = (value ? JSON.parse(value) : false);\r\n\t\tif(parsed && this.type == \"xdd:coordinate\"){\r\n\t\t\tparsed = [parsed];\r\n\t\t}\r\n\t\treturn parsed;\r\n\t}\r\n\tcatch(e){\r\n\t\tthis.error = this.type + \" value \" + value + \" failed to parse as json\", e.toString();\r\n\t\treturn [];\r\n\t}\r\n}\r\n\r\n\r\nHTMLCoordinateViewer.prototype.renderFrame = function(frame, dataviewer){\r\n\treturn this.render(frame.get());\r\n}\r\n\r\nHTMLCoordinateViewer.prototype.renderValue = function(dataviewer){\r\n\treturn this.render(dataviewer.value());\r\n}\r\n\r\nHTMLCoordinateViewer.prototype.render = function(value){ \r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-coordinate\");\r\n\tif(value){\r\n\t\tinput.setAttribute('data-value', value);\t\t\r\n\t\tvar parsed = this.parseValue(value);\r\n\t\tif(parsed){\r\n\t\t\tfor(var i = 0; i < parsed.length; i++){\r\n\t\t\t\tvar lldom = document.createElement(\"span\");\r\n\t\t\t\tlldom.setAttribute(\"class\", \"latlong\");\r\n\t\t\t\tlldom.appendChild(document.createTextNode(\"Latitude: \"));\r\n\t\t\t\tlldom.appendChild(document.createTextNode(parsed[i][0] + \" °\" + \" \"));\r\n\t\t\t\tlldom.appendChild(document.createTextNode(\"Longitude: \"));\r\n\t\t\t\tlldom.appendChild(document.createTextNode(parsed[i][1] + \" °\" ));\r\n\t\t\t\tinput.appendChild(lldom);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinput.setAttribute(\"title\", this.error);\r\n\t\t}\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLCoordinateViewer}\r\n\r\n","function HTMLCoordinateEditor(options){\r\n\tthis.inputs = [];\r\n}\r\n\r\nHTMLCoordinateEditor.prototype.getInputDOMs = function(lat, long, change){\r\n\tvar latdom = document.createElement(\"input\");\r\n\tlatdom.setAttribute(\"type\", \"text\");\r\n\tlatdom.value = lat;\r\n\tvar longdom = document.createElement(\"input\");\r\n\tlongdom.setAttribute(\"type\", \"text\");\r\n\tlongdom.value = long;\r\n\tlatdom.addEventListener(\"change\", change);\r\n\tlongdom.addEventListener(\"change\", change);\r\n\treturn [latdom, longdom];\r\n}\r\n\r\nHTMLCoordinateEditor.prototype.getLatLongDOM = function(lat, long, ty, index, parent){\r\n\tvar lldom = document.createElement(\"span\");\r\n\tlldom.setAttribute(\"class\", \"terminus-lat-long\");\r\n\tvar firstcol = document.createElement(\"span\");\r\n\tfirstcol.setAttribute(\"class\", \"terminus-lat-long-col\");\r\n\tlldom.appendChild(firstcol);\r\n\tif(index > 2 || (ty == \"xdd:coordinatePolyline\" && index > 1)){\r\n\t\tvar delbut = document.createElement(\"button\");\r\n\t\tdelbut.setAttribute(\"class\", \"delete-coordinate\");\r\n\t\tdelbut.appendChild(document.createTextNode(\"Remove\"));\r\n\t\tdelbut.addEventListener(\"click\", function(){\r\n\t\t\tlong.value = \"\";\r\n\t\t\tlat.value = \"\";\r\n\t\t\tparent.removeChild(lldom);\r\n\t\t});\r\n\t\tfirstcol.appendChild(delbut);\r\n\t}\r\n\tlldom.appendChild(document.createTextNode(\"Latitude: \"));\r\n\tlldom.appendChild(lat);\r\n\tlldom.appendChild(document.createTextNode(\" °\" + \" \"));\r\n\tlldom.appendChild(document.createTextNode(\"  Longitude: \"));\r\n\tlldom.appendChild(long);\r\n\tlldom.appendChild(document.createTextNode(\" ° \" ));\r\n\treturn lldom;\r\n}\r\n\r\n\r\nHTMLCoordinateEditor.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar value = frame.get();\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-coordinate\");\r\n\tinput.setAttribute('data-value', value);\r\n\ttry {\r\n\t\tvar parsed = (value ? JSON.parse(value) : false);\r\n\t}\r\n\tcatch(e){\r\n\t\tthis.error = this.type + \" failed to parse as json\", e.toString();\r\n\t\tvar parsed = false;\r\n\t}\r\n\tvar self = this;\r\n\tvar updateValueFromForm = function(){\r\n\t\tvar vals = [];\r\n\t\tfor(var i = 0; i<self.inputs.length; i++){\r\n\t\t\tif(self.inputs[i][0].value && self.inputs[i][1].value){\r\n\t\t\t\tvar val = \"[\" + self.inputs[i][0].value + \",\" + self.inputs[i][1].value + \"]\";\r\n\t\t\t\tvals.push(val);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(vals.length == 0){\r\n\t\t\tframe.set(\"\");\r\n\t\t}\r\n\t\telse if(this.type == \"xdd:coordinate\"){\r\n\t\t\tframe.set(vals[0]);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar op = \"[\";\r\n\t\t\tfor(var i = 0; i<vals.length; i++){\r\n\t\t\t\top += vals[i];\r\n\t\t\t\tif(i+1 < vals.length) op += \",\";\r\n\t\t\t}\r\n\t\t\top += \"]\";\r\n\t\t\tframe.set(op);\r\n\t\t}\r\n\t};\r\n\tif(!parsed){\r\n\t\tif(this.type == \"xdd:coordinate\") parsed = [\"\",\"\"];\r\n\t\telse {\r\n\t\t\tparsed = [[\"\",\"\"],[\"\",\"\"]];\r\n\t\t\tif(this.type == \"xdd:coordinatePolygon\") parsed.push([\"\",\"\"]);\r\n\t\t}\r\n\t}\r\n\tif(this.type == \"xdd:coordinate\"){\r\n\t\tparsed = [parsed];\r\n\t}\r\n\tfor(var i = 0; i < parsed.length; i++){\r\n\t\tthis.inputs.push(this.getInputDOMs(parsed[i][0], parsed[i][1], updateValueFromForm))\r\n\t}\r\n\tvar lldoms = document.createElement(\"span\");\r\n\tfor(var i = 0; i < this.inputs.length; i++){\r\n\t\tvar lldom = this.getLatLongDOM(this.inputs[i][0], this.inputs[i][1], this.type, i, lldoms);\r\n\t\tlldoms.appendChild(lldom);\r\n\t}\r\n\tinput.appendChild(lldoms);\r\n\tvar self = this;\r\n\tif(this.type != \"xdd:coordinate\"){\r\n\t\tvar butspan = document.createElement(\"span\");\r\n\t\tbutspan.setAttribute(\"class\", \"terminus-add-coordinate\")\r\n\t\tvar addbut = document.createElement(\"button\");\r\n\t\taddbut.setAttribute(\"class\", \"terminus-add-coordinate\");\r\n\t\taddbut.appendChild(document.createTextNode(\"Add\"));\r\n\t\taddbut.addEventListener(\"click\", function(){\r\n\t\t\tvar ipdoms = self.getInputDOMs(\"\", \"\", updateValueFromForm);\r\n\t\t\tvar lldom = self.getLatLongDOM(ipdoms[0], ipdoms[1], this.type, self.inputs.length, lldoms);\r\n\t\t\tlldoms.appendChild(lldom);\r\n\t\t\tself.inputs.push(ipdoms);\r\n\t\t});\r\n\t\tbutspan.appendChild(addbut);\r\n\t\tinput.appendChild(butspan);\t\t\t\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLCoordinateEditor}","const DateHelper = require('./DateHelper');\r\nconst TerminusClient = require('@terminusdb/terminus-client');\r\n\r\nfunction HTMLDateViewer(options){\r\n\tthis.options(options);\r\n}\r\n\r\nHTMLDateViewer.prototype.options = function(options){\r\n\tthis.max = (options && options.max ? options.max : false);\r\n\tthis.min = (options && options.min ? options.min : false);\r\n\tthis.allowbce = (options && options.allowbce ? options.allowbce : false);\r\n\tthis.date_spacer = \"/\";\r\n\tthis.time_spacer = \":\";\r\n\tthis.datetime_separator = \", \";\r\n\tthis.helper = new DateHelper.HTMLDateHelper();\r\n}\r\n\r\nHTMLDateViewer.prototype.renderFrame = function(frame, dataviewer){\r\n\treturn this.render(frame.get());\r\n}\r\n\r\nHTMLDateViewer.prototype.renderValue = function(dataviewer){\r\n\treturn this.render(dataviewer.value());\r\n}\r\n\r\nHTMLDateViewer.prototype.render = function(value){\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-date\");\r\n\tinput.setAttribute('data-value', value);\r\n\tif(value){\r\n\t\tvar parsed = TerminusClient.UTILS.DateHelper.parseDate(this.type, value);\r\n\t\tvar datepart = this.getDateComponentDOM(parsed);\r\n\t\tvar timepart = this.getTimeComponentDOM(parsed);\r\n\t\tif(timepart) input.appendChild(timepart);\r\n\t\tif(timepart && datepart) input.appendChild(document.createTextNode(this.datetime_separator));\r\n\t\tif(datepart) input.appendChild(datepart);\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nHTMLDateViewer.prototype.getTimeComponentDOM = function(parsed, ty){\r\n\tvar hdom = (parsed.hour ? document.createElement(\"span\") : false);\r\n\tif(hdom){\r\n\t\thdom.setAttribute(\"class\", \"terminus-time-hour\");\r\n\t\thdom.appendChild(document.createTextNode(parsed.hour));\r\n\t}\r\n\tvar mdom = (typeof parsed.minute != \"undefined\" ? document.createElement(\"span\") : false);\r\n\tif(mdom){\r\n\t\tmdom.setAttribute(\"class\", \"terminus-time-minute\");\r\n\t\tvar mlab = (parsed.minute < 10 ? parsed.minute : parsed.minute);\r\n\t\tmdom.appendChild(document.createTextNode(mlab));\r\n\t}\r\n\tvar sdom = (typeof parsed.second != \"undefined\" ? document.createElement(\"span\") : false);\r\n\tif(sdom){\r\n\t\tsdom.setAttribute(\"class\", \"terminus-time-second\");\r\n\t\tvar slab = (parsed.second < 10 ? parsed.second : parsed.second);\r\n\t\tsdom.appendChild(document.createTextNode(slab));\r\n\t}\r\n\tvar tz = (parsed.timezone ? document.createElement(\"span\") : false);\r\n\tif(tz){\r\n\t\tsdom.setAttribute(\"class\", \"terminus-time-timezone\");\r\n\t\tsdom.appendChild(document.createTextNode(parsed.timezone));\r\n\t}\r\n\tif(hdom || mdom || sdom || tz){\r\n\t\tvar dadom = document.createElement(\"span\");\r\n\t\tdadom.setAttribute(\"class\", \"terminus-time-components time-\"+ty);\r\n\t\tif(hdom) dadom.appendChild(hdom); \r\n\t\tif(mdom) {\r\n\t\t\tif(hdom) dadom.appendChild(document.createTextNode(this.time_spacer));\r\n\t\t\tdadom.appendChild(mdom); \r\n\t\t}\r\n\t\tif(sdom) {\r\n\t\t\tif(mdom || hdom) dadom.appendChild(document.createTextNode(this.time_spacer));\r\n\t\t\tdadom.appendChild(sdom); \r\n\t\t}\r\n\t\tif(tz){\r\n\t\t\tdadom.appendChild(document.createTextNode(\" (Timezone: \")); \r\n\t\t\tdadom.appendChild(sdom); \r\n\t\t\tdadom.appendChild(document.createTextNode(\")\")); \t\t\t\r\n\t\t}\r\n\t\treturn dadom;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLDateViewer.prototype.getDateComponentDOM = function(parsed, ty){\r\n\tvar ydom = (parsed.year ? document.createElement(\"span\") : false);\r\n\tif(ydom){\r\n\t\tydom.setAttribute(\"class\", \"terminus-date-year\");\r\n\t\tydom.appendChild(document.createTextNode(parsed.year));\r\n\t}\r\n\tvar mdom = (parsed.month ? document.createElement(\"span\") : false);\r\n\tif(mdom){\r\n\t\tmdom.setAttribute(\"class\", \"terminus-date-month\");\r\n\t\tmdom.appendChild(document.createTextNode(this.helper.getMonthName(parsed.month)));\t\t\r\n\t}\r\n\tvar ddom = (parsed.day ? document.createElement(\"span\") : false );\r\n\tif(ddom){\r\n\t\tddom.setAttribute(\"class\", \"terminus-date-day\");\r\n\t\tddom.appendChild(document.createTextNode(parsed.day));\t\t\r\n\t}\r\n\tif(ydom || mdom || ddom){\r\n\t\tvar dadom = document.createElement(\"span\");\r\n\t\tif(ddom) dadom.appendChild(ddom); \r\n\t\tif(mdom) {\r\n\t\t\tif(ddom) dadom.appendChild(document.createTextNode(this.date_spacer));\r\n\t\t\tdadom.appendChild(mdom); \r\n\t\t}\r\n\t\tif(ydom) {\r\n\t\t\tif(mdom || ddom) dadom.appendChild(document.createTextNode(this.date_spacer));\r\n\t\t\tdadom.appendChild(ydom); \r\n\t\t}\r\n\t\treturn dadom;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nmodule.exports={HTMLDateViewer}","const DateHelper = require('./DateHelper');\r\nconst TerminusClient = require('@terminusdb/terminus-client');\r\n\r\nfunction HTMLDateEditor(options){\r\n\tthis.options(options);\r\n}\r\n\r\nHTMLDateEditor.prototype.options = function(options){\r\n\tthis.max = (options && options.max ? options.max : false);\r\n\tthis.min = (options && options.min ? options.min : false);\r\n\tthis.allowbce = (options && options.allowbce ? options.allowbce : false);\r\n\tthis.date_spacer = \"/\";\r\n\tthis.time_spacer = \":\";\r\n\tthis.datetime_separator = \", \";\r\n\tthis.helper = new DateHelper.HTMLDateHelper();\r\n}\r\n\r\nHTMLDateEditor.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar value = frame.get();\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-date\");\r\n\tinput.setAttribute('data-value', value);\r\n\tif(value){\r\n\t\tthis.parsed = TerminusClient.UTILS.DateHelper.parseDate(this.type, value);\r\n\t}\r\n\telse this.parsed = {};\r\n\tvar datepart = this.getDateComponentDOM(this.parsed, this.type, frame);\r\n\tvar timepart = this.getTimeComponentDOM(this.parsed, this.type, frame);\r\n\tif(timepart) input.appendChild(timepart);\r\n\tif(timepart && datepart) input.appendChild(document.createTextNode(this.datetime_separator));\r\n\tif(datepart) input.appendChild(datepart);\r\n\treturn input;\r\n}\r\n\r\nHTMLDateEditor.prototype.set = function(part, val, frame, ty){\r\n\tthis.parsed[part] = val;\r\n\tvar xsd = TerminusClient.UTILS.DateHelper.xsdFromParsed(this.parsed, ty);\r\n\tif(xsd){\r\n\t\tframe.set(xsd);\r\n\t}\r\n}\r\n\r\nHTMLDateEditor.prototype.getTimeComponentDOM = function(parsed, ty, frame){\r\n\tif([\"xsd:dateTime\", \"xsd:dateTimeStamp\", \"xsd:time\"].indexOf(ty) == -1){\r\n\t\treturn false;\r\n\t}\r\n\tvar self = this;\r\n\tvar hdom = document.createElement(\"input\");\r\n\thdom.setAttribute(\"class\", \"terminus-hour-input terminus-hour-\"+ty);\r\n\thdom.setAttribute(\"size\", 2);\r\n\thdom.setAttribute(\"placeholder\", \"HH\");\r\n\thdom.value = (parsed.hour ? parsed.hour : \"\");\r\n\thdom.addEventListener(\"input\", function(){\r\n\t\tself.set(\"hour\", this.value, frame, ty);\r\n\t});\r\n\tvar mdom = document.createElement(\"input\");\r\n\tmdom.setAttribute(\"class\", \"terminus-minute-input terminus-minute-\"+ty);\r\n\tmdom.setAttribute(\"size\", 2);\r\n\tmdom.setAttribute(\"placeholder\", \"MM\");\r\n\tmdom.value = (parsed.minute ? parsed.minute: \"\");\r\n\tmdom.addEventListener(\"input\", function(){\r\n\t\tself.set(\"minute\", this.value, frame, ty);\r\n\t});\r\n\tvar sdom = document.createElement(\"input\");\r\n\tsdom.setAttribute(\"class\", \"terminus-second-input terminus-second-\"+ty);\r\n\tsdom.setAttribute(\"size\", 8);\r\n\tsdom.setAttribute(\"placeholder\", \"SS.sss...\");\r\n\tsdom.value = (parsed.second ? parsed.second: \"\");\r\n\tsdom.addEventListener(\"input\", function(){\r\n\t\tself.set(\"second\", this.value, frame, ty);\r\n\t})\r\n\tvar tdom = document.createElement(\"span\");\r\n\ttdom.appendChild(hdom);\r\n\ttdom.appendChild(document.createTextNode(this.time_spacer));\r\n\ttdom.appendChild(mdom);\r\n\ttdom.appendChild(document.createTextNode(this.time_spacer));\r\n\ttdom.appendChild(sdom);\r\n\treturn tdom;\r\n}\r\n\r\nHTMLDateEditor.prototype.getDateComponentDOM = function(parsed, ty, frame){\r\n\tvar self = this;\r\n\tif([\"xsd:date\", \"xsd:dateTime\", \"xsd:gYear\", \"xsd:gYearMonth\", \"xsd:dateTimeStamp\"].indexOf(ty) != -1){\r\n\t\tvar ydom = document.createElement(\"input\");\r\n\t\tydom.setAttribute(\"class\", \"terminus-year-input terminus-year-\"+ty);\r\n\t\tydom.setAttribute(\"size\", 6);\r\n\t\tydom.setAttribute(\"placeholder\", \"YYYY\");\r\n\t\tydom.value = (parsed.year ? parsed.year : \"\");\r\n\t\tydom.addEventListener(\"input\", function(){\r\n\t\t\tself.set(\"year\", this.value, frame, ty);\r\n\t\t})\r\n\t}\r\n\tif([\"xsd:date\", \"xsd:dateTime\", \"xsd:gYearMonth\", \"xsd:dateTimeStamp\", \"xsd:gMonth\", \"xsd:gMonthDay\"].indexOf(ty) != -1){\r\n\t\tvar mdom = document.createElement(\"select\");\r\n\t\tmdom.setAttribute(\"class\", \"terminus-month-input terminus-month-\"+ty);\r\n\t\tfor(var i = 0; i<this.helper.months.length; i++){\r\n\t\t\tvar opdom = document.createElement(\"option\");\r\n\t\t\topdom.value = i+1;\r\n\t\t\topdom.appendChild(document.createTextNode(this.helper.months[i]));\r\n\t\t\tif(parsed.month && parsed.month == i+1){\r\n\t\t\t\topdom.selected = true;\r\n\t\t\t}\r\n\t\t\tmdom.appendChild(opdom);\r\n\t\t}\r\n\t\tmdom.addEventListener(\"change\", function(){\r\n\t\t\tself.set(\"month\", this.value, frame, ty);\r\n\t\t})\r\n\t}\t\r\n\tif([\"xsd:date\", \"xsd:dateTime\", \"xsd:dateTimeStamp\", \"xsd:gDay\", \"xsd:gMonthDay\"].indexOf(ty) != -1){\r\n\t\tvar ddom = document.createElement(\"input\");\r\n\t\tddom.setAttribute(\"class\", \"terminus-day-input terminus-day-\"+ty);\r\n\t\tddom.setAttribute(\"size\", 2);\r\n\t\tddom.setAttribute(\"placeholder\", \"DD\");\r\n\t\tddom.value = (parsed.day ? parsed.day : \"\");\t\r\n\t\tddom.addEventListener(\"input\", function(){\r\n\t\t\tself.set(\"day\", this.value, frame, ty);\r\n\t\t})\r\n\t}\t\r\n\tif(ydom || mdom || ddom){\r\n\t\tvar dadom = document.createElement(\"span\");\r\n\t\tif(ddom) dadom.appendChild(ddom); \r\n\t\tif(mdom) {\r\n\t\t\tif(ddom) dadom.appendChild(document.createTextNode(this.date_spacer));\r\n\t\t\tdadom.appendChild(mdom); \r\n\t\t}\r\n\t\tif(ydom) {\r\n\t\t\tif(mdom || ddom) dadom.appendChild(document.createTextNode(this.date_spacer));\r\n\t\t\tdadom.appendChild(ydom); \r\n\t\t}\r\n\t\treturn dadom;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nmodule.exports={HTMLDateEditor}","const HTMLHelper = require('../HTMLHelper');\r\n\r\nfunction HTMLEntityViewer(options){\r\n\tthis.options(options);\r\n}\r\n\r\nHTMLEntityViewer.prototype.options = function(options){\r\n\tthis.onclick = (options && options.onclick ? options.onclick: false);\r\n}\r\n\r\nHTMLEntityViewer.prototype.renderFrame = function(frame, dataviewer){\r\n\t//this.client = dataviewer.getClient();\r\n\treturn this.render(frame.get());\t\r\n}\r\n\r\nHTMLEntityViewer.prototype.renderValue = function(dataviewer){\r\n\t//this.client = dataviewer.getClient();\r\n\treturn this.render(dataviewer.value());\r\n}\r\n\r\nHTMLEntityViewer.prototype.render = function(value){\r\n\tvar holder = document.createElement(\"span\");\r\n\tholder.setAttribute(\"class\", \"terminus-literal-value terminus-entity-reference-value\");\r\n\tvar self = this;\r\n\tif(this.holder){\r\n\t\treturn this.holder;\r\n\t}\r\n\tif(value){\r\n\t\tvar dom = this.showValue(value)\r\n\t\tholder.appendChild(dom);\r\n\t}\r\n\treturn holder;\r\n}\r\n\r\nHTMLEntityViewer.prototype.showValue = function(value){\r\n\tif(this.onclick){\r\n\t\tvar self = this;\r\n\t\tvar a = document.createElement(\"a\");\r\n\t\ta.style.color = \"#0000aa\";\r\n\t\ta.appendChild(document.createTextNode(value));\r\n\t\ta.addEventListener(\"click\", function(event){\r\n\t\t\tself.onclick(value);\r\n\t\t});\r\n\t\ta.addEventListener(\"mouseover\", function(event){\r\n\t\t\ta.style.cursor = \"pointer\";\r\n\t\t});\r\n\t\treturn a; \t\r\n\t}\r\n\telse {\r\n\t\treturn document.createTextNode(value);\r\n\t}\r\n}\r\n\r\n\r\nHTMLEntityViewer.prototype.getEntityViewHTML = function(value, frame, dataviewer){\r\n\tvar span = document.createElement(\"span\");\r\n\tvar self = this;\r\n\tspan.setAttribute(\"class\", \"terminus-internal-link\");\r\n\tspan.appendChild(dataviewer.internalLink(value));\r\n\tif(controller = renderer.getController()){\r\n\t\tcontroller.getInstanceMeta(value).then(function(response){\r\n\t\t\tvar lab = self.getEntityLabel(value, response, dataviewer);\r\n\t\t\tif(lab){ \r\n\t\t\t\tHTMLHelper.removeChildren(span);\r\n\t\t\t\tspan.appendChild(lab);\r\n\t\t\t}\t\r\n\t\t});\r\n\t}\r\n\treturn span;\r\n}\r\n\r\nHTMLEntityViewer.prototype.getEntityLabel = function(url, response, dv){\r\n\tvar nspan = document.createElement(\"span\");\r\n\tif(response && (il = HTMLHelper.getVariableValueFromBinding(\"InstanceLabel\", response))){\r\n\t\tnspan.appendChild(dv.internalLink(url, il));\r\n\t\tvar rt = HTMLHelper.getVariableValueFromBinding(\"InstanceType\", response);\r\n\t\tvar tit = url + \" Type: \" + rt;\r\n\t\tvar ic = HTMLHelper.getVariableValueFromBinding(\"InstanceComment\", response);\r\n\t\tif(typeof ic == \"object\" && ic[\"@value\"]){\r\n\t\t\ttit += \" \" + ic[\"@value\"];\r\n\t\t}\r\n\t\tnspan.setAttribute(\"title\", tit);\r\n\t\treturn nspan;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nmodule.exports={HTMLEntityViewer}","function HTMLEntityEditor(options){}\r\nHTMLEntityEditor.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar value = frame.get();\r\n\tvar input = document.createElement(\"input\");\r\n\tinput.setAttribute(\"class\", \"terminus-literal-value terminus-entity-reference-value\");\r\n\tinput.setAttribute(\"type\", \"text\");\r\n\tinput.setAttribute('size', 80);\r\n\tinput.value = value;\r\n\tvar self = this;\r\n\tinput.addEventListener(\"change\", function(){\r\n\t\tvar url = this.value;\r\n\t\tif(url.indexOf(\"/\") == -1 && url.indexOf(\":\") == -1){\r\n\t\t\turl = \"doc:\" + url;\r\n\t\t}\r\n\t\tframe.set(url);\r\n\t});\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLEntityEditor}","function HTMLImageViewer(options){}\r\n\r\nHTMLImageViewer.prototype.options = function(options){}\r\n\r\n\r\nHTMLImageViewer.prototype.renderFrame = function(frame, dataviewer){\r\n\treturn this.render(frame.get());\r\n}\r\n\r\nHTMLImageViewer.prototype.renderValue = function(dataviewer){\r\n\treturn this.render(dataviewer.value());\r\n}\r\n\t\r\nHTMLImageViewer.prototype.render = function(value){\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-image-value\");\r\n\tinput.setAttribute('data-value', value);\r\n\tif(value){\r\n\t\tvar img = document.createElement(\"a\");\r\n\t\timg.setAttribute('src', value);\r\n\t\tinput.appendChild(img);\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLImageViewer}\r\n\r\n\r\n","function HTMLImageEditor(options){}\r\nHTMLImageEditor.prototype.renderFrame = function(frame, dataviewer){\r\n\tif(this.type == \"xsd:base64Binary\"){\r\n\t\tvar input = document.createElement(\"textarea\");\r\n\t\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-b64image-value\");\r\n\t\tinput.value = value;\r\n\t\tinput.addEventListener(\"change\", function(){\r\n\t\t\tframe.set(this.value);\r\n\t\t});\r\n\t\treturn input;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nmodule.exports={HTMLImageEditor}","function HTMLLinkViewer(options){\r\n\tthis.options(options);\r\n}\r\n\r\nHTMLLinkViewer.prototype.options = function(options){\r\n\tthis.css = \"terminus-literal-value terminus-literal-value-range \" + ((options && options.css) ?  options.css : \"\");\r\n}\r\n\r\nHTMLLinkViewer.prototype.renderFrame = function(frame, dataviewer){\r\n\treturn this.render(frame.get());\r\n}\r\n\r\nHTMLLinkViewer.prototype.renderValue = function(dataviewer){\r\n\treturn this.render(dataviewer.value());\r\n}\r\n\t\r\nHTMLLinkViewer.prototype.render = function(value){\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', this.css);\r\n\tinput.setAttribute('size', 80);\r\n\tinput.setAttribute('data-value', value);\r\n\tif(value){\r\n\t\tvar a = document.createElement(\"a\");\r\n\t\ta.setAttribute('href', value);\r\n\t\ta.appendChild(document.createTextNode(value));\r\n\t\tinput.appendChild(a);\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLLinkViewer}\r\n\r\n","const TerminusClient = require('@terminusdb/terminus-client');\r\n\r\nfunction HTMLNumberViewer(options){\r\n\tthis.options(options);\r\n}\r\n\r\nHTMLNumberViewer.prototype.options = function(options){\r\n\tthis.commas = (options && options.commas ? options.commas : true);\r\n}\r\n\r\nHTMLNumberViewer.prototype.renderFrame = function(frame, dataviewer){\r\n\treturn this.render(frame.get());\r\n}\r\n\r\nHTMLNumberViewer.prototype.renderValue = function(dataviewer){\r\n\treturn this.render(dataviewer.value());\r\n}\r\n\t\r\nHTMLNumberViewer.prototype.render = function(value){\r\n\tif(value === 0) value = \"0\";\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', 'terminus-number-value terminus-literal-value');\r\n\tinput.setAttribute('data-value', value);\r\n\tvalue = (this.commas ? TerminusClient.UTILS.TypeHelper.numberWithCommas(value) : value);\r\n\tinput.appendChild(document.createTextNode(value));\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLNumberViewer}\r\n","const TerminusClient = require('@terminusdb/terminus-client');\r\n\r\nfunction HTMLRangeViewer(options){\r\n\tthis.options(options);\r\n}\r\n\r\nHTMLRangeViewer.prototype.options = function(options){\r\n\tthis.commas = (options && options.commas ? options.commas : true);\r\n\tthis.css = \"terminus-literal-value terminus-literal-value-range \" + ((options && options.css) ?  options.css : \"\");\r\n\tthis.delimiter = (options && options.delimiter ? options.delimiter : false);\r\n}\r\n\r\nHTMLRangeViewer.prototype.renderFrame = function(frame, dataviewer){\r\n\treturn this.render(frame.get());\r\n}\r\n\r\nHTMLRangeViewer.prototype.renderValue = function(dataviewer){\r\n\treturn this.render(dataviewer.value());\r\n}\r\n\t\r\nHTMLRangeViewer.prototype.render = function(value){\r\n\tvar vals = TerminusClient.UTILS.TypeHelper.parseRangeValue(value, this.delimiter);\r\n\tvar d = document.createElement(\"span\");\r\n\td.setAttribute(\"class\", this.css);\r\n\tvar rvals = document.createElement(\"span\");\r\n\trvals.setAttribute(\"class\", \"terminus-range-value-left\");\r\n\tvar svals = document.createElement(\"span\");\r\n\tsvals.setAttribute(\"class\", \"terminus-range-value-right\");\r\n\tvar x = (this.useCommas() ? TerminusClient.UTILS.TypeHelper.numberWithCommas(vals[0]) : vals[0]);\r\n\tvar tnode = document.createTextNode(x);\r\n\trvals.appendChild(tnode);\r\n\td.appendChild(rvals);\t\r\n\tif(vals.length == 2){\r\n\t\td.appendChild(getRangeSymbolDOM());\r\n\t\tvar x2 = (this.useCommas(renderer) ? TerminusClient.UTILS.TypeHelper.numberWithCommas(vals[1]) : vals[1]);\r\n\t\tvar t2node = document.createTextNode(x2);\r\n\t\tsvals.appendChild(t2node);\r\n\t\td.appendChild(svals);\t\r\n\t}\r\n\treturn d;\r\n}\r\n\r\nHTMLRangeViewer.prototype.useCommas = function(){\r\n\tif([\"xdd:gYearRange\", \"xdd:dateRange\"].indexOf(this.type) != -1) return false;\r\n\treturn this.commas;\r\n}\r\n\r\nfunction getRangeSymbolDOM(){\r\n\tvar d = document.createElement(\"span\");\r\n\td.setAttribute(\"class\", \"terminus-range-indicator\");\r\n\td.setAttribute(\"title\", \"The value is uncertain, it lies somewhere in this range\");\r\n\td.appendChild(document.createTextNode(\" ... \"));\r\n\treturn d;\r\n}\r\n\r\nmodule.exports={HTMLRangeViewer}\r\n","const TerminusClient = require('@terminusdb/terminus-client');\r\nconst HTMLHelper = require('../HTMLHelper');\r\n\r\nfunction HTMLRangeEditor(options){\r\n\tthis.options(options);\r\n}\r\n\r\nHTMLRangeEditor.prototype.options = function(options){\r\n\tthis.commas = (options && options.commas ? options.commas : true);\r\n\tthis.css = \"terminus-literal-value terminus-literal-value-range \" + ((options && options.css) ?  options.css : \"\");\r\n\tthis.delimiter = (options && options.delimiter ? options.delimiter : false);\r\n}\r\n\r\nHTMLRangeEditor.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar value = frame.get();\r\n\tvar vals = TerminusClient.UTILS.TypeHelper.parseRangeValue(value, this.delimiter);\r\n\tvar d = document.createElement(\"span\");\r\n\td.setAttribute(\"class\", this.css);\r\n\tvar rvals = document.createElement(\"span\");\r\n\tvar svals = document.createElement(\"span\");\r\n\tvar data1 = (vals.length > 0 ? vals[0] : \"\");\r\n\tvar data2 = (vals.length > 1 ? vals[1] : \"\");\r\n\tvar firstip = document.createElement(\"input\");\r\n\tfirstip.setAttribute('type', \"text\");\r\n\tfirstip.setAttribute('size', 16);\r\n\tif(data1){\r\n\t\tfirstip.value = data1;\r\n\t}\r\n\tvar secondip = document.createElement(\"input\");\r\n\tsecondip.setAttribute('type', \"text\");\r\n\tsecondip.setAttribute('size', 16);\r\n\tif(data2){\r\n\t\tthis.showing_range = true;\r\n\t\tsecondip.value = data2;\r\n\t}\r\n\trvals.appendChild(firstip);\r\n\td.appendChild(rvals);\t\r\n\tif(this.showing_range){\r\n\t\tsvals.appendChild(getRangeSymbolDOM());\r\n\t\tsvals.appendChild(secondip);\r\n\t}\r\n\td.appendChild(svals);\t\r\n\tvar but = document.createElement(\"button\");\r\n\tbut.setAttribute(\"class\", \"terminus-change-range\");\r\n\tvar txt = this.showing_range ? \"Change to Simple Value\" : \"Change to Uncertain Range\";\r\n\tbut.appendChild(document.createTextNode(txt));\r\n\td.appendChild(but);\t\r\n\tvar self = this;\r\n\tbut.addEventListener(\"click\", function(){\r\n\t\tif(self.showing_range){\r\n\t\t\tself.showing_range = false;\r\n\t\t\tsecondip.value = \"\";\t\t\t\t\r\n\t\t\tHTMLHelper.removeChildren(svals);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.showing_range = true;\r\n\t\t\tsecondip.value = \"\";\t\t\t\t\r\n\t\t\tsvals.appendChild(getRangeSymbolDOM());\r\n\t\t\tsvals.appendChild(secondip);\r\n\t\t}\r\n\t\tvar txt = self.showing_range ? \"Change to Simple Value\" : \"Change to Uncertain Range\";\r\n\t\tbut.innerText = txt;\r\n\t\tchangeHandler();\r\n\t});\r\n\tvar changeHandler = function(){\r\n\t\tif(self.showing_range && secondip.value){\r\n\t\t\tif(firstip.value) frame.set(\"[\" + firstip.value + \",\" + secondip.value + \"]\");\t\t\t\t\r\n\t\t\telse frame.set(secondip.value);\t\t\t\t\r\n\t\t}\r\n\t\telse {\r\n\t\t\tframe.set(firstip.value);\r\n\t\t}\r\n\t}\r\n\tfirstip.addEventListener(\"change\", changeHandler);\r\n\tsecondip.addEventListener(\"change\", changeHandler);\r\n\treturn d;\r\n}\r\n\r\nfunction getRangeSymbolDOM(){\r\n\tvar d = document.createElement(\"span\");\r\n\td.setAttribute(\"class\", \"terminus-range-indicator\");\r\n\td.setAttribute(\"title\", \"The value is uncertain, it lies somewhere in this range\");\r\n\td.appendChild(document.createTextNode(\" ... \"));\r\n\treturn d;\r\n}\r\n\r\nmodule.exports={HTMLRangeEditor}\r\n","const GoogleMapHelper = require(\"./GoogleMapHelper\")\r\nfunction GoogleMapEditor(options){}\r\n\r\nGoogleMapEditor.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar mapcontainer = document.createElement(\"div\");\r\n\tmapcontainer.setAttribute('class', \"gmap-window gmap-editor\");\r\n\tvar self = this;\r\n\tvar ghelper = new GoogleMapHelper();\r\n\tvar map = ghelper.initMap(mapcontainer, value, this.type);\r\n    if(ty == \"xdd:coordinate\"){\r\n\t    google.maps.event.addListener(map, 'click', function(event) {\r\n\t    \tvar position = event.latLng;\r\n\t    \tvar coo = \"[\" + position.lat() + \",\" + position.lng() + \"]\";\r\n\t    \trenderer.set(coo);\r\n\t        ghelper.clearMarkers();\r\n\t        var init = {\r\n\t    \t\tposition: position, \r\n\t    \t\tmap: map\r\n\t    \t}\r\n\t    \tvar marker = new google.maps.Marker(init);\r\n\t    \tghelper.markers.push(marker);\r\n\t  \t});\r\n\t}\r\n    else {\r\n    \tgoogle.maps.event.addListener(map, 'click', function(event) {\r\n        \tvar path = ghelper.polyline.getPath();\r\n        \tpath.push(event.latLng);\r\n      \t    var position = event.latLng;\r\n      \t    ghelper.addMarker(position, map, frame, '#' + path.getLength(), this.type);\r\n      \t});\r\n    }\r\n    return mapcontainer;\r\n}\r\n\r\nmodule.exports={GoogleMapEditor};","const GoogleMapHelper = require(\"./GoogleMapHelper\")\r\n\r\nfunction GoogleMapViewer(options){}\r\n\r\nGoogleMapViewer.prototype.renderFrame = function(frame, dataviewer){\r\n\treturn this.render(frame.get());\r\n}\r\n\r\nGoogleMapViewer.prototype.renderValue = function(dataviewer){\r\n\treturn this.render(dataviewer.value());\r\n}\r\n\t\r\nGoogleMapViewer.prototype.render = function(value){\r\n\tvar map = document.createElement(\"div\");\r\n\tmap.setAttribute('class', \"gmap-window gmap-viewer\");\r\n\tvar self = this;\r\n\tvar ghelper = new GoogleMapHelper();\r\n\tghelper.initMap(map, value, this.type);\t\t\r\n    return map;\r\n}\r\n\r\nmodule.exports={GoogleMapViewer};","function HTMLMarkupEditor(options){}\r\n\r\nHTMLMarkupEditor.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar value = frame.get();\r\n\tvar input = document.createElement(\"div\");\r\n\tinput.setAttribute('class', \"html-wysiwyg\");\r\n\tvar inner = document.createElement(\"span\");\r\n\tinner.setAttribute('class', \"html-literal literal-value\");\r\n\tinner.innerHTML=value;\r\n\tinput.appendChild(inner);\r\n\tif(typeof Quill != \"undefined\"){\r\n\t\tvar quill = new Quill(inner, { theme: 'snow' });\r\n\t\tquill.on(\"text-change\", function(){\r\n\t\t\tframe.set(quill.root.innerHTML);\r\n\t\t});\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLMarkupEditor}","function S2EntityEditor(options){}\r\n\r\nS2EntityEditor.prototype.renderFrame = function(frame, dataviewer){\r\n\tvar value = frame.get();\r\n\tvar cls = frame.range();\r\n\tvar cback = frame.set;\r\n\tvar ctl = dataviewer.getClient();\r\n\tvar d2ch = new TerminusDocumentChooser(ctl, cls, value);\r\n\td2ch.change = function(val){\r\n\t\tframe.set(val);\r\n\t}\r\n\td2ch.view = \"label\";\r\n\tvar d2dom = d2ch.getAsDOM();\r\n\treturn d2dom;\r\n}\r\n\r\n\r\nmodule.exports={S2EntityEditor}","const HTMLHelper = require('../HTMLHelper');\r\n\r\nfunction SimpleTable(){\r\n\tthis.holder = document.createElement(\"div\");\r\n\tthis.holder.setAttribute('class', 'terminus-simple-table-holder')\r\n}\r\n\r\nSimpleTable.prototype.options = function(options){\r\n\tfor(var k in options){\r\n\t\tthis[k] = options[k];\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n\r\nSimpleTable.prototype.render = function(woqltable){\r\n\tif(woqltable) this.woqltable = woqltable;\r\n\tHTMLHelper.removeChildren(this.holder);\r\n\tvar ctls = this.getControlsDOM();\r\n\tvar tab = this.getTableDOM();\r\n\tif(ctls) this.holder.appendChild(ctls)\r\n\tthis.holder.appendChild(tab);\r\n\treturn this.holder;\r\n}\r\n\r\nSimpleTable.prototype.getControlsDOM = function(result){\r\n\tvar ctrls = document.createElement(\"span\");\r\n\tif(this.woqltable.config.pager()){\r\n\t\tvar paging = this.getPaging(result);\r\n\t\tif(paging) ctrls.appendChild(paging);\r\n\t}\r\n\treturn ctrls;\r\n}\r\n\r\nSimpleTable.prototype.getTableDOM = function(){\r\n\tconst columns = this.woqltable.getColumnsToRender();\r\n\tvar tab = document.createElement(\"table\");\r\n\ttab.setAttribute(\"class\", \"terminus-hover-table terminus-simple-table\");\r\n\tvar thead = this.getTableHeader(columns);\r\n\ttab.appendChild(thead);\r\n\tvar tbody = this.getTableBody(columns);\r\n\ttab.appendChild(tbody);\r\n\treturn tab;\r\n}\r\n\r\nSimpleTable.prototype.getTableHeader = function(cols){\r\n\tvar thead = document.createElement(\"thead\");\r\n\tvar thr = document.createElement(\"tr\");\r\n\tfor(var i = 0; i<cols.length; i++){\r\n\t\tvar th = this.getColumnHeader(cols[i]);\r\n\t\tthr.appendChild(th);\r\n\t}\r\n\tthead.appendChild(thr);\r\n\treturn thead;\r\n}\r\n\r\nSimpleTable.prototype.getColumnHeader = function(colid){\r\n\tvar th = document.createElement(\"th\");\r\n\tth.setAttribute('class', 'terminus-table-header-full-css');\r\n\tvar clab = this.woqltable.getColumnHeaderContents(colid);\r\n\tth.appendChild(clab);\r\n\treturn th;\r\n}\r\n\r\nSimpleTable.prototype.getTableBody = function(cols){\r\n\tvar tbody = document.createElement(\"tbody\");\r\n\twhile(row = this.woqltable.next()){\r\n\t\tvar tr = this.getHTMLRow(row, cols);\r\n\t\tif(tr) tbody.appendChild(tr);\r\n\t}\r\n\treturn tbody;\r\n}\r\n\r\nSimpleTable.prototype.getHTMLRow = function(row, cols){\r\n\tvar tr = document.createElement(\"tr\");\r\n\tfor(var i = 0; i<cols.length; i++){\r\n\t\tvar td = this.getCell(cols[i], row);\r\n\t\ttr.appendChild(td);\r\n\t}\r\n\tvar self = this;\r\n\tif(this.woqltable.hasRowClick(row)){\r\n\t\tvar rc = this.woqltable.getRowClick(row);\r\n\t\ttr.addEventListener(\"click\", function(){\r\n\t\t\trc(row);\r\n\t\t});\r\n\t\ttr.addEventListener(\"mouseover\", function(){\r\n\t\t\tthis.style.cursor = \"pointer\";\r\n\t\t});\r\n\t}\r\n\tif(this.woqltable.hasRowHover(row)){\r\n\t\tvar rc = this.woqltable.getRowHover(row);\r\n\t\ttr.addEventListener(\"mouseover\", function(){\r\n\t\t\trc(row);\r\n\t\t});\r\n\t}\r\n\treturn tr;\r\n}\r\n\r\nSimpleTable.prototype.getCell = function(key, row){\r\n\tvar td = document.createElement(\"td\");\r\n\tif(this.woqltable.hasCellClick(row, key)){\r\n\t\tvar rc = this.woqltable.getCellClick(row, key);\r\n\t\ttd.addEventListener(\"click\", function(){\r\n\t\t\trc(row);\r\n\t\t});\r\n\t\ttd.addEventListener(\"mouseover\", function(){\r\n\t\t\tthis.style.cursor = \"pointer\";\r\n\t\t});\r\n\t}\r\n\tif(this.woqltable.hasCellHover(row, key)){\r\n\t\tvar rc = this.woqltable.getCellHover(row, key);\r\n\t\ttr.addEventListener(\"mouseover\", function(){\r\n\t\t\trc(row);\r\n\t\t});\r\n\t}\r\n\tvar c = this.getCellData(key, row);\r\n\tif(c) td.appendChild(c);\r\n\treturn td;\r\n}\r\n\r\nSimpleTable.prototype.getCellData = function(key, row){\r\n\tvar renderer = this.woqltable.getRenderer(key, row);\r\n\tif(renderer && typeof renderer == \"function\"){\r\n\t\treturn renderer(row[key], key, row);\r\n\t}\r\n\telse if(renderer && typeof renderer == \"object\"){\r\n\t\treturn this.woqltable.renderValue(renderer, row[key], key, row);\r\n\t}\r\n\tvar val = row[key]\r\n\tif(val && val['@value']) val = val['@value'];\r\n\treturn document.createTextNode(val);\r\n}\r\n\r\nSimpleTable.prototype.getPaging = function(){\r\n\tif(this.woqltable.result.query.isPaged()){\r\n\t\tvar pdom = document.createElement(\"div\");\r\n\t\tpdom.setAttribute(\"class\", \"table-page-size\");\r\n\t\tif(this.woqltable.config.pagesize()){\r\n\t\t\tlet psdom = this.getPageSize();\r\n\t\t\tif(psdom) pdom.appendChild(psdom);\r\n\t\t}\r\n\t\tif(this.woqltable.canChangePage()){\r\n\t\t\tvar pn = this.woqltable.result.query.getPage();\r\n\t\t\tif(pn > 2){\r\n\t\t\t\tpdom.appendChild(this.getFirst());\r\n\t\t\t}\r\n\t\t\tif(pn > 1){\r\n\t\t\t\tpdom.appendChild(this.getPrev(pn));\r\n\t\t\t}\r\n\t\t\tif(this.woqltable.config.page()) pdom.appendChild(this.getPageNumber(pn));\r\n\t\t\tpdom.appendChild(this.getNext(this.woqltable.result));\r\n\t\t}\r\n\t\treturn pdom;\r\n\t}\r\n}\r\n\r\nSimpleTable.prototype.showPaging = function(){\r\n\tif(this.woqltable.result.query.isPaged() && this.woqltable.config.pager() && this.woqltable.canChangePage()) return true;\r\n\treturn false;\r\n}\r\n\r\n\r\nSimpleTable.prototype.getPageSize = function(){\r\n\tif(this.showPaging()){\r\n\t\tvar chunk = document.createElement(\"span\");\r\n\t\tchunk.setAttribute(\"class\", \"woql-table-pagesize\");\r\n\t\tclabel = document.createElement(\"span\");\r\n\t\tclabel.appendChild(document.createTextNode(\"Page Size\"));\r\n\t\tchunk.appendChild(clabel);\r\n\t\tif(this.woqltable.config.change_pagesize){\r\n\t\t\tvar ctl = document.createElement(\"input\");\r\n\t\t\tctl.setAttribute(\"size\", 6);\r\n\t\t\tvar self = this;\r\n\t\t\tctl.value = this.woqltable.getPageSize();\r\n\t\t\tctl.addEventListener(\"blur\", function(){\r\n\t\t\t\tvar pval = (this.value ? parseInt(this.value) : false);\r\n\t\t\t\tself.woqltable.setPageSize(pval);\r\n\t\t\t});\r\n\t\t\tchunk.appendChild(ctl);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchunk.appendChild(document.createTextNode(this.woqltable.getPageSize()));\r\n\t\t}\r\n\t\treturn chunk;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nSimpleTable.prototype.getPageNumber = function(){\r\n\tvar ctl = document.createElement(\"input\");\r\n\tctl.setAttribute(\"size\", 4);\r\n\tctl.value = this.woqltable.result.query.getPage();\r\n\tvar self = this;\r\n\tctl.addEventListener(\"blur\", function(){\r\n\t\tvar pval = (this.value ? parseInt(this.value) : false);\r\n\t\tself.woqltable.setPage(pval);\r\n\t});\r\n\treturn ctl;\r\n}\r\n\r\nSimpleTable.prototype.getNext = function(result){\r\n\tvar ctl = document.createElement(\"button\");\r\n\tvar self = this;\r\n\tctl.appendChild(document.createTextNode(\"next\"));\r\n\tif(!this.woqltable.canAdvancePage(result)){\r\n\t\tctl.setAttribute(\"disabled\", \"disabled\");\r\n\t}\r\n\telse {\r\n\t\tctl.addEventListener(\"click\", function(){\r\n\t\t\tself.woqltable.nextPage();\r\n\t\t});\r\n\t}\r\n\treturn ctl;\r\n}\r\n\r\nSimpleTable.prototype.getPrev = function(result){\r\n\tvar ctl = document.createElement(\"button\");\r\n\tctl.appendChild(document.createTextNode(\"previous\"));\r\n\tvar self = this;\r\n\tif(!this.woqltable.canRetreatPage(result)){\r\n\t\tctl.setAttribute(\"disabled\", \"disabled\");\r\n\t}\r\n\telse {\r\n\t\tctl.addEventListener(\"click\", function(){\r\n\t\t\tself.woqltable.previousPage();\r\n\t\t});\r\n\t}\r\n\treturn ctl;\r\n}\r\n\r\nSimpleTable.prototype.getFirst = function(result){\r\n\tvar ctl = document.createElement(\"button\");\r\n\tctl.appendChild(document.createTextNode(\"first\"));\r\n\tvar self = this;\r\n\tif(!this.woqltable.canRetreatPage(result) || this.woqltable.getPage() <= 2){\r\n\t\tctl.setAttribute(\"disabled\", \"disabled\");\r\n\t}\r\n\telse {\r\n\t\tctl.addEventListener(\"click\", function(){\r\n\t\t\tself.woqltable.firstPage();\r\n\t\t});\r\n\t}\r\n\treturn ctl;\r\n}\r\n\r\nmodule.exports = SimpleTable;\r\n","const HTMLHelper = require('../HTMLHelper');\r\nconst GraphResultsViewer = require('./GraphResultsViewer');\r\n\r\n\r\nfunction SimpleGraph(){\r\n\tthis.holder = document.createElement(\"div\");\r\n}\r\n\r\nSimpleGraph.prototype.setResult = function(result){\r\n\tthis.result = result;\r\n}\r\n\r\nSimpleGraph.prototype.render = function(wgraph){\r\n\tthis.graph = wgraph;\r\n\tHTMLHelper.removeChildren(this.holder);\r\n\t//var ctls = this.getControlsDOM(result);\r\n\tvar tab = this.getGraphDOM(this.result);\r\n\t//if(ctls) this.holder.appendChild(ctls)\r\n\tthis.holder.appendChild(tab);\r\n\treturn this.holder;\r\n}\r\n\r\n\r\nSimpleGraph.prototype.getGraphDOM = function(){\r\n\tthis.gviz = new GraphResultsViewer(this.graph.config);\r\n\tvar gdom = this.gviz.getAsDOM();\r\n\tvar h = this.graph.config.height() ? this.graph.config.height() : 800;\r\n\tvar w = this.graph.config.width() ? this.graph.config.width() : 800;\r\n\tgdom.setAttribute(\"style\", \"border: 1px solid #aaa; width: \" + w + \"px; height: \" + h + \"px; \" + this.graph.config.width() + \"px\");\r\n\tthis.gviz.setData(this.graph);\r\n\tthis.gviz.initDOM(gdom);\r\n\treturn gdom;\r\n}\r\n\r\nmodule.exports = SimpleGraph;\r\n","function GraphResultsViewer(config) {\r\n\tthis.svg;\r\n\tthis.visid = randomString(8);\r\n\tthis.currentDate = Date.now() / 1000; // nowish\r\n\t// Individual links, nodes and text graphical elements\r\n\tthis.link_elements;\r\n\tthis.node_elements;\r\n\t// DOM object that this this is directly drawn into\r\n\tthis.container = false;\r\n\t// Map of ids to loaded nodes for ease\r\n\tthis.loadedNodes = {};\r\n\tthis.focusNodes = [];\r\n\t// Currently displayed nodes and links\r\n\tthis.nodes;\r\n\tthis.links;\r\n\t// Var for selecting and deselecting elements\r\n\tthis.selected_id;\r\n\tthis.setConfigOptions(config);\r\n}\r\n\r\n/*\r\n * Loads the graph with new data and optionally starts the animation\r\n */\r\nGraphResultsViewer.prototype.load = function(show) {\r\n\tthis.initD3(this.d3DOM);\r\n\tthis.loadNewData();\r\n\tthis.updateGraph();\r\n\tif(show){\r\n\t\tthis.updateSimulation(\"init\");\r\n\t}\r\n}\r\n\r\n/*\r\n * Called to issue a new set of datapoints\r\n */\r\nGraphResultsViewer.prototype.setData = function(dqr, show){\r\n\t//this.setFocusNodeFromResult(dqr);\r\n\tif(this.result){\r\n\t\tthis.clear();\r\n\t}\r\n\tthis.result = dqr;\r\n\t//if(this.svg){\r\n\t\tthis.load(show);\r\n\t//}\r\n}\r\n\r\nGraphResultsViewer.prototype.loadNewData = function(){\r\n\tthis.nodes = jQuery.extend(true, [], this.result.getNodes());\r\n\tfor(var i = 0 ; i<this.nodes.length; i++){\r\n\t\tthis.loadedNodes[this.nodes[i].id] = this.nodes[i];\r\n\t}\r\n\tthis.links = this.result.getEdges();\r\n\t//this.browser.rebuildController();\r\n}\r\n\r\n\r\n/*\r\n * Called to indicate that the current set of datapoints has been updated\r\n */\r\nGraphResultsViewer.prototype.updateData = function(dqr, show) {\r\n\tthis.setFocusNodeFromResult(dqr);\r\n\tthis.result = dqr;\r\n\tthis.reload(show, \"update\", this.fix_nodes);\r\n}\r\n\r\nGraphResultsViewer.prototype.setFocusNodeFromResult = function(dqr) {\r\n\tvar fn = dqr.getFocusNode();\r\n\tif(fn){\r\n\t\tthis.selected_id = fn;\r\n\t\tthis.focusNodes.push(fn);\r\n\t}\r\n}\r\n\r\n/*\r\n * Called to indicate that the filter setting has been changed on the current datapoints\r\n */\r\nGraphResultsViewer.prototype.setFilter = function(dqr, show){\r\n\tthis.simulation.stop();\r\n\tthis.reload(show, \"filter\", true);\r\n}\r\n\r\nGraphResultsViewer.prototype.wake = function() {\r\n\tif(this.simulation)\tthis.updateSimulation(\"wake\");\r\n}\r\n\r\nGraphResultsViewer.prototype.hibernate = function() {\r\n\tthis.simulation.stop();\r\n}\r\n\r\n/*\r\n * Called when more data is added to the result but the query remains the same\r\n */\r\nGraphResultsViewer.prototype.reload = function(show, mode, no_animate) {\r\n\tfor(var i = 0 ; i<this.nodes.length; i++){\r\n\t\tthis.loadedNodes[this.nodes[i].id] = this.nodes[i];\r\n\t}\r\n\tvar nnodes = jQuery.extend(true, [], this.result.getNodesAndFringes());\r\n\tthis.nodes = [];\r\n\tvar snode = this.loadedNodes[this.selected_id];\r\n\tfor(var i = 0 ; i<nnodes.length; i++){\r\n\t\tvar nnode = nnodes[i];\r\n\t\tif(this.loadedNodes[nnode.id]){\r\n\t\t\tif(nnode.id == this.selected_id){\r\n\t\t\t\tthis.loadedNodes[nnode.id].fx = this.loadedNodes[nnode.id].x;\r\n\t\t\t\tthis.loadedNodes[nnode.id].fy = this.loadedNodes[nnode.id].y;\r\n\t\t\t}\r\n\t\t\telse if(!no_animate) {\r\n\t\t\t\tthis.loadedNodes[nnode.id].fx = null;\r\n\t\t\t\tthis.loadedNodes[nnode.id].fy = null;\r\n\t\t\t}\r\n\t\t\telse if(this.loadedNodes[nnode.id].x){\r\n\t\t\t\tthis.loadedNodes[nnode.id].fx = this.loadedNodes[nnode.id].x;\r\n\t\t\t\tthis.loadedNodes[nnode.id].fy = this.loadedNodes[nnode.id].y;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(this.explode_out && snode.x){\r\n\t\t\t\tnnode.x = snode.x;\r\n\t\t\t\tnnode.y = snode.y;\r\n\t\t\t}\r\n\t\t\tthis.loadedNodes[nnode.id] = nnode;\r\n\t\t}\r\n\t\tthis.nodes.push(this.loadedNodes[nnode.id]);\r\n\t}\r\n\tthis.links = this.result.getLinks();\r\n\tthis.updateGraph();\r\n\tif(show){\r\n\t\t//this.browser.rebuildController();\r\n\t\tthis.updateSimulation(mode);\r\n\t}\r\n}\r\n\r\nGraphResultsViewer.prototype.clear = function() {\r\n\tthis.nodes = [];\r\n\tthis.loadedNodes = {};\r\n\tthis.links = [];\r\n\tthis.updateGraph();\r\n\tjQuery(this.d3DOM).empty();\r\n\tthis.scale_factor = 1;\r\n}\r\n\r\n/*\r\n * Called to initialise the DOM when it is first loaded (called after setData)\r\n */\r\nGraphResultsViewer.prototype.initDOM = function(vdom) {\r\n\tif(!this.width) this.width = this.setWidth();\r\n\tif(!this.height) this.height = this.setHeight();\r\n\tthis.d3DOM = vdom;\r\n\tif(this.result){\r\n\t\tthis.load(true);\r\n\t}\r\n}\r\n\r\n/*\r\n * Generate the div that contains the visualisation panel\r\n */\r\nGraphResultsViewer.prototype.getAsDOM = function() {\r\n\tvar vdom = document.createElement(\"div\");\r\n\tvdom.setAttribute(\"class\", \"terminus-gviz-panel\");\r\n\tvdom.setAttribute(\"id\", this.visid);\r\n\tvdom.setAttribute(\"width\", \"100%\");\r\n\tthis.container = vdom;\r\n\treturn vdom;\r\n}\r\n\r\n/*\r\n * Calculates the width of the container area available for the SVG\r\n */\r\nGraphResultsViewer.prototype.setWidth = function() {\r\n\tif(this.container && this.container.clientWidth){\r\n\t\tthis.width = this.container.clientWidth;\r\n\t}\r\n\telse if(this.container.parentNode && this.container.parentNode.clientWidth){\r\n\t\tthis.width = this.container.parentNode.clientWidth;\r\n\t}\r\n\telse {\r\n\t\tvar w = jQuery(this.container).width();\r\n\t\tif(w == 0){\r\n\t\t\tw = jQuery(this.container.parentNode).width();\r\n\t\t}\r\n\t\tif(w == 0) {\r\n\t\t\tw = 800;\r\n\t\t}\r\n\t\tthis.width = w;\r\n\t}\r\n\treturn this.width;\r\n}\r\n\r\nGraphResultsViewer.prototype.setHeight = function() {\r\n\tif(this.container && this.container.clientHeight){\r\n\t\tthis.height = this.container.clientHeight;\r\n\t}\r\n\telse if(this.container.parentNode && this.container.parentNode.clientHeight){\r\n\t\tthis.height = this.container.parentNode.clientHeight;\r\n\t}\r\n\telse {\r\n\t\tvar w = jQuery(this.container).height();\r\n\t\tif(w == 0){\r\n\t\t\tw = jQuery(this.container.parentNode).height();\r\n\t\t}\r\n\t\tif(w == 0) {\r\n\t\t\tw = 400;\r\n\t\t}\r\n\t\tthis.height = w;\r\n\t}\r\n\treturn this.height;\r\n}\r\n\r\n\r\nGraphResultsViewer.prototype.initD3 = function(jqid) {\r\n\tvar self = this;\r\n\r\n\t/********************* Seed the data **************************/\r\n\tthis.svg = d3.select(jqid).append(\"svg\")\r\n\t\t.attr(\"width\", this.width)\r\n\t\t.attr(\"height\", this.height);\r\n\r\n\tvar distanceFun = function(link){\r\n\t\treturn self.getLinkDistance(link);\r\n\t}\r\n\r\n\t// create the force object\r\n\tthis.simulation  = d3.forceSimulation()\r\n\t\t//link distance varies with link type\r\n\t    .force(\"link\", d3.forceLink().distance(distanceFun).id(function(link) { return link.id; }))\r\n\t    //charge is the same for all nodes\r\n\t    .force('charge', d3.forceManyBody().strength(function(node){ return self.getCharge(node)}))\r\n\t    //collision radius changes with node type\r\n\t    .force('collision', d3.forceCollide().radius(function(node) {\r\n\t    \treturn (self.getCollisionRadius(node));\r\n\t    }))\r\n\t\t.force(\"center\", d3.forceCenter(this.width / 2, this.height / 2));\r\n\r\n\t// node drag\r\n\tthis.drag_drop = d3.drag()\r\n\t\t.on('start', function(node) {\r\n\t\t\tnode.fx = node.x\r\n\t\t\tnode.fy = node.y\r\n\t\t})\r\n\t\t.on('drag', function(node) {\r\n\t\t\tself.simulation.restart()\r\n\t\t\tnode.fx = d3.event.x;\r\n\t\t\tnode.fy = d3.event.y;\r\n\t\t})\r\n\t\t.on('end', function(node) {\r\n\t\t\tnode.fx = null;\r\n\t\t\tnode.fx = null;\r\n\t\t\tself.simulation.stop()\r\n\t\t});\r\n\r\n\tthis.svg.append(\"rect\")\r\n\t   .attr(\"width\", this.width)\r\n\t   .attr(\"height\", this.height)\r\n\t   .style(\"fill\", \"none\")\r\n\t   .style(\"pointer-events\", \"all\")\r\n\t   .call(d3.zoom().on(\"zoom\", function(){self.zoomed()}));\r\n\r\n\t// Append graphic element to svg which are groups for graph elements\r\n\tthis.link_group = this.svg.append(\"g\").classed(\"links\", true);\r\n\tthis.node_group = this.svg.append(\"g\").classed(\"nodes\", true);\r\n}\r\n\r\nGraphResultsViewer.prototype.zoomed = function() {\r\n\tthis.current_transform = d3.event.transform;\r\n\tif(this.node_elements)\r\n\t\tthis.node_elements.attr(\"transform\", d3.event.transform);\r\n    if(this.link_elements)\r\n    \tthis.link_elements.attr(\"transform\", d3.event.transform);\r\n}\r\n\r\n/***\r\n * updates the svg with the current nodes and links\r\n */\r\nGraphResultsViewer.prototype.updateGraph = function(nodes, links) {\r\n\tvar self = this;\r\n\r\n\tvar follow_node_wrapper = function(graph_node){\r\n\t\tself.nodeSelected(graph_node);\r\n\t}\r\n\tvar zoomed = function(){\r\n\t\tself.zoomed();\r\n\t}\r\n\r\n\tnodes = (typeof nodes != \"undefined\" ? nodes : this.nodes);\r\n\tlinks = (typeof links != \"undefined\" ? links : this.links);\r\n\tthis.node_elements  = this.node_group.selectAll(\"g\").data(nodes);\r\n\tthis.node_elements.exit().remove();\r\n\r\n\t/*Create and place the \"blocks\" containing the circle and the text */\r\n    var node_enter = this.node_elements.enter().append(\"g\");\r\n\r\n\t// enter and create new ones\r\n\tnode_enter.append(\"circle\")\r\n\t\t.style('opacity', 0.99)\r\n\t\t.attr('r', function(node){return self.getRadius(node)})\r\n\t\t.attr(\"cx\",  function(node){ return node.x})\r\n\t\t.attr(\"cy\",  function(node){ return node.y})\r\n\t\t.attr(\"type\", function(node) {return self.isFringe(node) ? \"fringe\" : \"node\"})\r\n\t\t.call(self.drag_drop)\r\n\t\t.on(\"mouseover\", function(d){ d3.select(this).style(\"cursor\", \"pointer\"); })\r\n\t\t.on(\"mouseout\", function(d){ d3.select(this).style(\"cursor\", \"default\"); })\r\n\t\t.on('click', follow_node_wrapper);\r\n\r\n    node_enter.append(\"text\")\r\n\t\t.attr(\"x\",  function(node){ return node.x})\r\n\t\t.attr(\"y\",  function(node){ return node.y})\r\n\t\t.text(function(node) { return self.getNodeIconUnicode(node)})\r\n\t\t.call(self.drag_drop)\r\n\t\t.on(\"mouseover\", function(d){ d3.select(this).style(\"cursor\", \"pointer\"); })\r\n\t\t.on(\"mouseout\", function(d){ d3.select(this).style(\"cursor\", \"default\"); })\r\n\t\t.on('click', follow_node_wrapper);\r\n\r\n\t// merge new and old nodes\r\n\tthis.node_elements = node_enter.merge(this.node_elements);\r\n\r\n\tthis.styleNodeElements();\r\n\r\n\t// update LINKS ********************************************\r\n\tthis.link_elements  = this.link_group.selectAll(\"line\").data(links);\r\n\r\n\t// remove old links\r\n\tthis.link_elements.exit().remove();\r\n\t// enter and create new ones\r\n\tvar link_enter = this.link_elements.enter().append(\"line\");\r\n\r\n\t// merge new and old links\r\n\tthis.link_elements = link_enter.merge(this.link_elements)\r\n\r\n\tthis.styleLinkElements();\r\n\r\n\t//execute the current state of the pan-zoom transform\r\n\tif(this.current_transform){\r\n\t\tif(this.node_elements)\r\n\t\t\tthis.node_elements.attr(\"transform\", this.current_transform);\r\n\t    if(this.link_elements)\r\n\t    \tthis.link_elements.attr(\"transform\", this.current_transform);\r\n\t}\r\n}\r\n\r\nGraphResultsViewer.prototype.updateSimulation = function(mode) {\r\n\tvar self = this;\r\n\t//move all of the graphical elements corresponding to the nodes with each tick\r\n\tvar ticker = function(){\r\n\t\tself.node_elements.selectAll(\"circle\")\r\n\t\t\t.attr(\"cx\",  function(node){ return node.x})\r\n\t\t\t.attr(\"cy\",  function(node){ return node.y});\r\n\t\tself.node_elements.selectAll(\"text\")\r\n\t\t\t.attr(\"x\",  function(node){ return node.x})\r\n\t\t\t.attr(\"y\",  function(node){ return node.y});\r\n\t\tself.link_elements\r\n\t\t\t.attr('x1', function(link){ return link.source.x})\r\n\t\t\t.attr('y1', function(link){ return link.source.y})\r\n\t\t\t.attr('x2', function(link){ return link.target.x})\r\n\t\t\t.attr('y2', function(link){ return link.target.y});\r\n\t}\r\n\tif(this.show_force){\r\n\t\tthis.simulation.nodes(this.nodes).on('tick', ticker).force('link').links(this.links);\r\n\t}\r\n\telse {\r\n\t\tthis.simulation.nodes(this.nodes).on('end', ticker).force('link').links(this.links);\r\n\t}\r\n\tif(this.nodes.length){\r\n\t\tif(mode == \"wake\" || mode == \"init\"){\r\n\t\t\tthis.simulation.restart();\r\n\t\t}\r\n\t\telse if(mode == \"filter\"){\r\n\t\t\tthis.simulation.restart();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.simulation.alpha(1).restart();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nGraphResultsViewer.prototype.styleNodeElements = function() {\r\n\tvar self = this;\r\n\tif(this.node_elements){\r\n\t\tthis.node_elements.each(function(node){\r\n\t\t\tvar g = d3.select(this);\r\n\t\t\tvar sel = g.select(\"circle\");\r\n\t\t\tsel.select(\"title\").remove();\r\n\t\t\tsel.style(\"fill\", self.getNodeColour(node));\r\n\t\t\tsel.attr('r', self.getRadius(node));\r\n\t\t\tsel.classed(\"highlighted\", function(node) { return self.focusNodes.indexOf(node.id) != -1});\r\n\t\t\tsel.append(\"title\")\r\n\t\t\t\t.classed(\"terminus-gnode-title\", true)\r\n\t\t\t\t.text(self.getNodeText(node));\r\n\t\t\tvar txt = g.select(\"text\");\r\n\t\t\ttxt.select(\"title\").remove();\r\n\t\t\ttxt.attr('text-anchor', 'middle')\r\n\t\t\t\t.attr(\"title\", self.getNodeText(node))\r\n\t\t\t\t.attr('dominant-baseline', 'central')\r\n\t\t\t\t.style('font-family', \"'\" + self.fontfam + \"'\")\r\n\t\t\t\t.style('font-weight', self.getNodeIconWeight(node))\r\n\t\t\t\t.style('font-size', self.getNodeIconSize(node))\r\n\t\t\t\t.style(\"fill\", self.getNodeIconColour(node))\r\n\t\t\t\t.text(self.getNodeIconUnicode(node))\r\n\t\t\t\t.append(\"title\")\r\n\t\t\t\t\t.classed(\"terminus-gnode-title\", true)\r\n\t\t\t\t\t.text(self.getNodeText(node));\r\n\t\t});\r\n\t}\r\n}\r\n\r\nGraphResultsViewer.prototype.styleLinkElements = function() {\r\n\tvar self = this;\r\n\tif(this.link_elements){\r\n\t\tthis.link_elements.each(function(link){\r\n\t\t\tvar sel = d3.select(this);\r\n\t\t\tsel.select(\"title\").remove();\r\n\t\t\tsel.attr(\"stroke-width\", self.getLineWidth(link));\r\n\t\t\tsel.attr(\"marker-end\", self.getEdgeArrow(link));\r\n\t\t\tsel.style(\"stroke\", self.getEdgeColour(link));\r\n\t\t\tsel.append(\"title\")\r\n\t\t\t\t.classed(\"terminus-glink-title\", true)\r\n\t\t\t\t.text(self.getLinkText(link));\r\n\t\t});\r\n\t}\r\n}\r\n\r\nGraphResultsViewer.prototype.getEdgeArrow = function(edge) {\r\n\tif(edge){\r\n\t\tvar dir = this.getEdgeDirection(edge);\r\n\t\t//if(dir){\r\n\t\t\tvar col = this.getEdgeColour(edge);\r\n\t\t\tvar reference;\r\n\t\t\tthis.svg.append(\"svg:defs\").selectAll(\"marker\")\r\n\t\t\t\t.data([reference])\r\n\t\t\t\t.enter().append(\"svg:marker\")\r\n\t\t\t\t.attr(\"id\", String)\r\n\t\t\t\t.attr(\"viewBox\", \"0 -5 10 10\")\r\n\t\t\t\t.attr(\"refX\", 22)  // This sets how far back it sits, kinda\r\n\t\t\t\t.attr(\"refY\", 0)\r\n\t\t\t\t.attr(\"markerWidth\", this.getArrowWidth(edge))\r\n\t\t\t\t.attr(\"markerHeight\", this.getArrowHeight(edge))\r\n\t\t\t\t.attr(\"orient\", \"auto\")\r\n\t\t\t\t.attr(\"markerUnits\", \"userSpaceOnUse\")\r\n\t\t\t\t.append(\"svg:path\")\r\n\t\t\t\t\t.attr(\"d\", dir)\r\n\t\t\t\t\t.style(\"fill\", col);\r\n\t\t\t\treturn \"url(#\" + reference + \")\";\r\n\t\t//}\r\n\t}\r\n\treturn \"\";\r\n}\r\n\r\n\r\nGraphResultsViewer.prototype.nodeSelected = function(selected_node) {\r\n\tvar self = this;\r\n\tif(this.selected_id == selected_node.id && this.selection_grows){\r\n\t\tthis.selection_grows = false;\r\n\t\tthis.styleNodeElements();\r\n\t}\r\n\telse {\r\n\t\tthis.selection_grows = true;\r\n\t\tthis.selected_id = selected_node.id;\r\n\t\tthis.styleNodeElements();\r\n\t\t//this.browser.nodeSelected(selected_node);\r\n\t\tif(this.isFringe(selected_node)){\r\n\t\t\t//this.browser.followNode(selected_node);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nGraphResultsViewer.prototype.getScaleTransform = function(x, y, scale_factor){\r\n\treturn \"scale(\"+ scale_factor + \") translate(\" + x + \",\" + y + \")\";\r\n}\r\n\r\nGraphResultsViewer.prototype.scale = function(min_ratio) {\r\n    // the new dimensions of the molecule\r\n    new_mol_width = this.width * min_ratio;\r\n    new_mol_height = this.height * min_ratio;\r\n\r\n    var y_trans = (this.height - new_mol_height) ;\r\n\r\n    var x_trans = (this.width - new_mol_width);\r\n    // do the actual moving\r\n    var self = this;\r\n    if(this.node_elements)\r\n    \tthis.node_elements.transition()\r\n        .duration(750).attr(\"transform\", function(node){ return self.getScaleTransform(x_trans, y_trans, min_ratio)});\r\n    if(this.link_elements)\r\n        this.link_elements.transition()\r\n        .duration(750).attr(\"transform\", function(node){ return self.getScaleTransform(x_trans, y_trans, min_ratio)});\r\n\tthis.scale_factor = min_ratio;\r\n\tthis.svg.selectAll(\"marker\").attr(\"markerWidth\", this.getArrowWidth())\r\n\t\t\t.attr(\"markerHeight\", this.getArrowHeight());\r\n}\r\n\r\n\r\nGraphResultsViewer.prototype.scaleToFit = function() {\r\n    // Center the view on the molecule(s) and scale it so that everything\r\n    // fits in the window\r\n    //no molecules, nothing to do\r\n    if (this.nodes.length === 0)\r\n        return;\r\n\r\n    // Get the bounding box\r\n    min_x = d3.min(this.nodes.map(function(d) {return d.x;}));\r\n    min_y = d3.min(this.nodes.map(function(d) {return d.y;}));\r\n    max_x = d3.max(this.nodes.map(function(d) {return d.x;}));\r\n    max_y = d3.max(this.nodes.map(function(d) {return d.y;}));\r\n\r\n    // The width and the height of the graph\r\n    mol_width = max_x - min_x;\r\n    mol_height = max_y - min_y;\r\n\r\n    mol_width = mol_width * 1.05;\r\n    mol_height = mol_height * 1.05;\r\n    // how much larger the drawing area is than the width and the height\r\n    width_ratio = this.width / mol_width;\r\n    height_ratio = this.height / mol_height;\r\n\r\n    // we need to fit it in both directions, so we scale according to\r\n    // the direction in which we need to scale the most\r\n    min_ratio = Math.min(width_ratio, height_ratio);\r\n    if(min_ratio < 1){\r\n    \tthis.scale(min_ratio);\r\n    }\r\n};\r\n\r\n// recentre graph\r\nGraphResultsViewer.prototype.recentre = function(graph_node) {\r\n\tthis.translated = true;\r\n\t// get the x and y you need to transform the nodes by\r\n\tthis.dcx = (this.width/2-graph_node.x);\r\n\tthis.dcy = (this.height/2-graph_node.y);\r\n\t//zoom.translate([dcx,dcy]); If we do zooming we'll need to do something here\r\n\tthis.node_elements.attr(\"transform\", \"translate(\"+ this.dcx + \",\" + this.dcy  + \")\");\r\n\tthis.link_elements.attr(\"transform\", \"translate(\"+ this.dcx + \",\" + this.dcy  + \")\");\r\n\tthis.text_elements.attr(\"transform\", \"translate(\"+ this.dcx + \",\" + this.dcy  + \")\");\r\n}\r\n\r\n\r\nGraphResultsViewer.prototype.setConfigOptions = function(config) {\r\n\t//configuration options for different types of behaviour\r\n\t// Need to explicitly know font family name for unicode glyphs\r\n\tthis.fontfam = (config && (config.fontfamily()) ? config.fontfamily() : 'Font Awesome 5 Free');\r\n\tthis.selected_grows = (config && typeof config.selected_grows() != \"undefined\" ? config.selected_grows() : true);\r\n\tthis.show_force = (config && typeof config.show_force() != \"undefined\" ? config.show_force() : true);\r\n\tthis.fix_nodes = (config && typeof config.fix_nodes() != \"undefined\" ? config.fix_nodes() : false);\r\n\tthis.explode_out = (config && typeof config.explode_out() != \"undefined\" ? config.explode_out(): false);\r\n\tthis.width = (config && config.width() ? config.width(): false);\r\n\tthis.height = (config && config.height() ? config.height(): false);\r\n\tthis.defaults = {\r\n\t\tedge: {\r\n\t\t\ttype: \"edge\",\r\n\t\t\tdistance: (config && config.edge && config.edge.distance ? config.edge.distance : 70),\r\n\t\t\tarrow: (config && config.edge && config.edge.arrow ? config.edge.arrow : { width: 36, height: 16}),\r\n\t\t\tsymmetric: (config && config.edge && config.edge.symmetric ? config.edge.symmetric : true),\r\n\t\t\tcolor: (config && config.edge && config.edge.color ? config.edge.color : [150,150,255]),\r\n\t\t\tweight: (config && config.edge && config.edge.weight ? config.edge.weight : 0.3),\r\n\t\t\tsize: (config && config.edge && config.edge.size ? config.edge.size : 4)\r\n\t\t},\r\n\t\tnode: {\r\n\t\t\ttype: \"node\",\r\n\t\t\tradius: (config && config.node && config.node.radius ? config.node.radius : 14),\r\n\t\t\tcharge: (config && config.node && config.node.charge ? config.node.charge : -60),\r\n\t\t\tcollisionRadius: (config && config.node && config.node.collisionRadius ? config.node.collisionRadius : 20),\r\n\t\t\tcolor: (config && config.node && config.node.color ? config.node.color : [0,255,255]),\r\n\t\t\ticon: {\r\n\t\t\t\tweight: (config && config.node && config.node.icon && config.node.icon.weight ? config.node.icon.weight : 900),\r\n\t\t\t\tcolor: (config && config.node && config.node.icon && config.node.icon.color ? config.node.icon.color : [0,0,255]),\r\n\t\t\t\tunicode: (config && config.node && config.node.icon && config.node.icon.unicode ? config.node.icon.unicode : \"\\uf4fb\"),\r\n\t\t\t\tsize: (config && config.node && config.node.icon && config.node.icon.size ? config.node.icon.size : 10),\r\n\t\t\t\tfaclass: (config && config.node && config.node.icon && config.node.icon.faclass ? config.node.icon.faclass : \"fas fa-user-astronaut\")\r\n\t\t\t},\r\n\t\t\ttext: {\r\n\t\t\t\tcolor: (config && config.node && config.node.text && config.node.text.color ? config.node.text.color : [0,0,0]),\r\n\t\t\t\tsize: (config && config.node && config.node.icon && config.node.text.size ? config.node.text.size : 10)\r\n\t\t\t},\r\n\t\t\tborder: {\r\n\t\t\t\tcolor: (config && config.node && config.node.border && config.node.border.color ? config.node.border.color : [0,0,0]),\r\n\t\t\t\tsize: (config && config.node && config.node.border && config.node.border.size ? config.node.border.size : 10)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/*\r\n * Dimensions / forces / etc all settable with a scale factor - for zooming\r\n */\r\nGraphResultsViewer.prototype.getMultiplier = function(node) {\r\n\tvar mult = (node && node.size ? node.size : 1);\r\n\tif(node.id == this.selected_id && this.selection_grows){\r\n\t\tmult = mult * 2;\r\n\t}\r\n\treturn mult;\r\n}\r\n\r\nGraphResultsViewer.prototype.getRadius = function(node) {\r\n\tvar radius = (node && node.radius ? node.radius : this.defaults.node.radius);\r\n\tvar r = (this.scale_factor ? Math.min(this.scale_factor * radius, radius) : radius);\r\n\tr = r * this.getMultiplier(node);\r\n\treturn r;\r\n}\r\n\r\nGraphResultsViewer.prototype.getCollisionRadius = function(node) {\r\n\tvar colrad = (node && node.collisionRadius ? node.collisionRadius : this.defaults.node.collisionRadius );\r\n\tvar v = (this.scale_factor ? Math.min(this.scale_factor * colrad, colrad) : colrad);\r\n\treturn v * this.getMultiplier(node);\r\n}\r\n\r\nGraphResultsViewer.prototype.getCharge = function(node) {\r\n\tvar charge = (node && node.charge ? node.charge : this.defaults.node.charge);\r\n\tif(charge < 0){\r\n\t\tvar v = (this.scale_factor ? Math.max(this.scale_factor * charge, charge) : charge);\r\n\t}\r\n\telse {\r\n\t\tvar v = (this.scale_factor ? Math.min(this.scale_factor * charge, charge) : charge);\r\n\t}\r\n\treturn v * this.getMultiplier(node);\r\n}\r\n\r\nGraphResultsViewer.prototype.getLinkDistance = function(link) {\r\n\tvar linkDistance = (link && link.distance ? link.distance : this.defaults.edge.distance);\r\n\tvar x = (this.scale_factor ? Math.min(this.scale_factor * linkDistance, linkDistance) : linkDistance);\r\n\treturn x;\r\n}\r\n\r\nGraphResultsViewer.prototype.getNodeIconSize = function(node) {\r\n\tif(node && node.icon && node.icon.size){\r\n\t\treturn node.icon.size + \"em\";\r\n\t}\r\n\treturn (this.getMultiplier(node) + \"em\");\r\n}\r\n\r\nGraphResultsViewer.prototype.getNodeColour = function(node) {\r\n\tvar col = (node && node.color ? node.color : this.defaults.node.color);\r\n\tif(this.isFringe(node)){\r\n\t\treturn \"rgba(\"+col.join(\",\")+\",0.25)\";\r\n\t}\r\n\telse {\r\n\t\treturn \"rgb(\"+col.join(\",\")+\")\";\r\n\t}\r\n}\r\n\r\nGraphResultsViewer.prototype.getNodeIcon = function(node) {\r\n\tvar fac = (node && node.icon && node.icon.faclass ? node.icon.faclass : this.defaults.node.icon.faclass);\r\n\treturn fac;\r\n}\r\n\r\nGraphResultsViewer.prototype.getNodeIconUnicode= function(node) {\r\n\tif(node && typeof node.icon != \"undefined\"){\r\n\t\tif(node.icon.unicode){\r\n\t\t\treturn node.icon.unicode;\r\n\t\t}\r\n\t\tif(node.icon.label === true)\treturn this.getNodeText(node);\r\n\t\telse if(node.icon.label) return node.icon.label;\r\n\t}\r\n\treturn this.defaults.node.icon.unicode;\r\n}\r\n\r\nGraphResultsViewer.prototype.getNodeIconWeight = function(node) {\r\n\treturn (node && node.icon && node.icon.weight ? node.icon.weight : this.defaults.node.icon.weight );\r\n}\r\n\r\nGraphResultsViewer.prototype.getNodeIconColour = function(node) {\r\n\tvar col = (node && node.icon && node.icon.color ? node.icon.color : this.defaults.node.icon.color );\r\n\tif(this.isFringe(node)){\r\n\t\treturn \"rgba(\"+col.join(\",\")+\",0.25)\";\r\n\t}\r\n\telse {\r\n\t\treturn \"rgb(\"+col.join(\",\")+\")\";\r\n\t}\r\n}\r\n\r\nGraphResultsViewer.prototype.getEdgeColour = function(edge) {\r\n\tvar col = (edge && edge.color ? edge.color : this.defaults.edge.color );\r\n\tvar weight = (edge && edge.weight ? edge.weight : this.defaults.edge.weight);\r\n\tvar nc = col.concat([weight]);\r\n\treturn \"rgba(\"+nc.join(\",\")+\")\";\r\n}\r\n\r\nGraphResultsViewer.prototype.getEdgeDirection = function(edge) {\r\n\tif(edge && edge.symmetric){\r\n\t\treturn \"M10,-5 L0,0 L10,5\";\r\n\t}\r\n\treturn \"M0,-5 L10,0 L0,5\";\r\n\treturn false;\r\n}\r\n\r\nGraphResultsViewer.prototype.getLineWidth = function(link) {\r\n\tvar x = (link && link.size ? link.size : this.defaults.edge.size);\r\n\treturn x;\r\n}\r\n\r\n\r\nGraphResultsViewer.prototype.getNodeText = function(node) {\r\n\tif(node && node.text) return node.text;\r\n\treturn node.id;\r\n}\r\n\r\nGraphResultsViewer.prototype.getLinkText = function(edge) {\r\n\tif(edge && edge.text) return edge.text;\r\n\tif(edge && edge.id) return edge.id;\r\n\treturn \"\";\r\n}\r\n\r\nGraphResultsViewer.prototype.getArrowWidth = function(edge) {\r\n\tvar w = (edge && edge.arrow && edge.arrow.width ? edge.arrow.width : this.defaults.edge.arrow.width);\r\n\treturn (this.scale_factor ? Math.min(this.scale_factor * w, w) : w);\r\n}\r\n\r\nGraphResultsViewer.prototype.getArrowHeight = function(edge) {\r\n\tvar w = (edge && edge.arrow && edge.arrow.height ? edge.arrow.height : this.defaults.edge.arrow.height );\r\n\treturn (this.scale_factor ? Math.min(this.scale_factor * w, w) : w);\r\n}\r\n\r\nGraphResultsViewer.prototype.isNeighbourLink = function(node, link) {\r\n\treturn link.target.id === node.id || link.source.id === node.id;\r\n}\r\n\r\nGraphResultsViewer.prototype.isFringe = function(node){\r\n\tif(this.result && this.result.added && this.result.added.upgraded){\r\n\t\tif(this.result.added.upgraded.indexOf(node.id) != -1){\r\n\t\t\tnode.type = \"node\";\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn node.type && node.type == \"fringe\";\r\n}\r\n\r\nfunction randomString(length) {\r\n    var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz'.split('');\r\n    if (! length) {\r\n        length = Math.floor(Math.random() * chars.length);\r\n    }\r\n    var str = '';\r\n    for (var i = 0; i < length; i++) {\r\n        str += chars[Math.floor(Math.random() * chars.length)];\r\n    }\r\n    return str;\r\n}\r\n\r\nmodule.exports = GraphResultsViewer;\r\n","const HTMLHelper = require('../HTMLHelper');\r\n\r\nfunction SimpleStream(){\t\r\n\tthis.holder = document.createElement(\"div\");\r\n}\r\n\r\nSimpleStream.prototype.options = function(options){\r\n\tfor(var k in options){\r\n\t\tthis[k] = options[k];\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n\r\nSimpleStream.prototype.render = function(stream){\r\n\tif(stream) this.stream = stream;\r\n\tHTMLHelper.removeChildren(this.holder);\r\n\t//var ctls = this.getControlsDOM();\r\n\t//var tab = this.getTableDOM();\r\n\t//if(ctls) this.holder.appendChild(ctls)\r\n\t//this.holder.appendChild(tab);\r\n\treturn this.holder;\r\n}\r\n\r\nmodule.exports = SimpleStream;","function SimpleChooser(){}\r\n\r\nSimpleChooser.prototype.options = function(options){\r\n\tthis.options = options;\r\n\treturn this;\r\n}\r\n\r\nSimpleChooser.prototype.render = function(chooser){\r\n\tif(chooser) this.chooser = chooser;\r\n\tif(this.chooser.config.show_empty() == false && this.chooser.count() < 1) return false;\r\n\tvar ccdom = document.createElement(\"span\");\r\n\tccdom.setAttribute(\"class\", \"woql-chooser\");\r\n\tvar ccsel = document.createElement(\"select\");\r\n\tccsel.setAttribute(\"class\", \" woql-chooser\");\r\n\tvar self = this;\r\n\tccsel.addEventListener(\"change\", function(){\r\n\t\tself.chooser.set(this.value);\r\n\t});\r\n\tvar opts = [];\r\n\tif(this.chooser.config.show_empty()){\r\n\t\topts.push(this.getEmptyOption())\r\n\t}\r\n\tthis.chooser.first();\r\n\twhile(choice = this.chooser.next()){\r\n\t\tvar opt = this.createOptionFromChoice(choice);\r\n\t\topts.push(opt);\r\n\t}\r\n\tfor(var i = 0; i<opts.length; i++){\r\n\t\tccsel.appendChild(opts[i]);\r\n\t}\r\n\tccdom.appendChild(ccsel);\r\n\treturn ccdom;\r\n}\r\n\r\nSimpleChooser.prototype.getEmptyOption = function(){\r\n\tvar choice = { id: \"\", label: this.chooser.config.show_empty()};\r\n\treturn this.createOptionFromChoice(choice);\r\n}\r\n\r\nSimpleChooser.prototype.createOptionFromChoice = function(choice){\r\n\tvar opt = document.createElement(\"option\");\r\n\topt.setAttribute(\"class\", \"terminus-woql-chooser-choice\");\r\n\topt.value = choice.id;\r\n\tif(choice.selected) opt.selected = true;\r\n\tif(typeof choice.label == \"string\"){\r\n\t\topt.appendChild(document.createTextNode(choice.label));\r\n\t}\r\n\telse if(choice.label){\r\n\t\topt.appendChild(choice.label);\r\n\t}\r\n\tif(choice.title){\r\n\t\topt.setAttribute(\"title\", choice.title);\r\n\t}\r\n\treturn opt;\r\n}\r\n\r\nmodule.exports = SimpleChooser;","const TerminusCodeSnippet = require('./query/TerminusCodeSnippet');\r\nconst UTILS = require('../Utils');\r\nconst HTMLHelper = require('./HTMLHelper');\r\n//const TerminusFrame = require(\"../old/viewer/TerminusFrame\");\r\nconst TerminusClient = require('@terminusdb/terminus-client');\r\nconst SimpleFrameViewer = require(\"./document/SimpleFrameViewer\");\r\nconst Datatypes = require(\"./Datatypes\");\r\nconst DatatypeRenderers = require(\"./DatatypeRenderers\");\r\n\r\n\r\nfunction DocumentPane(client, docid, clsid){\r\n\tthis.client = client;\r\n\tthis.container = document.createElement('span');\r\n\tthis.container.setAttribute('class', 'terminus-document-cont');\r\n\tthis.defaultPaneView = { showConfig: false, editConfig: false, intro: false, loadSchema: false };\r\n\tthis.docid = (docid ? docid : false);\r\n\tthis.clsid = (clsid ? clsid : false);\r\n\tthis.datatypes = new DatatypeRenderers();\r\n    //Datatypes.initialiseDataRenderers(this.datatypes);\r\n}\r\n\r\nDocumentPane.prototype.load = function(){\r\n\tif(this.docid || this.clsid){\r\n\t\tthis.frame = new TerminusClient.DocumentFrame(this.client, this.view);\r\n\t\tthis.frame.owner = this;\r\n\t}\r\n\tif(this.docid){\r\n\t\treturn this.frame.load(this.docid, this.clsid)\r\n\t\t.then(() => this.filterFrame());\r\n\t}\r\n\tif(this.clsid){\r\n\t\treturn this.frame.load(false, this.clsid).then(() => {\r\n\t\t\tthis.frame.document.fillFromSchema(\"_:\");\r\n\t\t\tthis.filterFrame();\r\n\t});\t\r\n\t}\r\n\treturn Promise.reject(\"Either document id or class id must be specified before loading a document\");\r\n}\r\n\r\nDocumentPane.prototype.options = function(opts){\r\n\tthis.showQuery = (opts && typeof opts.showQuery != \"undefined\" ? opts.showQuery : false);\r\n\tthis.showConfig = (opts && typeof opts.showConfig != \"undefined\" ? opts.showConfig : false);\r\n\tthis.editConfig = (opts && typeof opts.editConfig != \"undefined\" ? opts.editConfig : false);\r\n\tthis.intro = (opts && typeof opts.intro != \"undefined\" ? opts.intro : false);\r\n\tthis.documentLoader = (opts && typeof opts.loadDocument != \"undefined\" ? opts.loadDocument : false);\r\n\tthis.loadSchema = (opts && typeof opts.loadSchema != \"undefined\" ? opts.loadSchema : false);\r\n\tthis.viewers = (opts && typeof opts.viewers != \"undefined\" ? opts.viewers : false);\r\n    Datatypes.initialiseDataRenderers(this.datatypes, false, opts);\r\n    return this;\r\n}\r\n\r\nDocumentPane.prototype.filterFrame = function(){\r\n\tvar self = this;\r\n\tvar myfilt = function(frame, rule){\r\n\t\tif(typeof rule.render() != \"undefined\"){\r\n\t\t\tframe.render = rule.render();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(rule.renderer()){\r\n\t\t\t\tvar renderer = self.loadRenderer(rule.renderer(), frame, rule.args);\t\t\r\n\t\t\t}\r\n\t\t\tif(renderer && renderer.render){\r\n\t\t\t\tframe.render = function(fframe){\r\n\t\t\t\t\treturn renderer.render(fframe);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(rule.compare()){\r\n\t\t\tframe.compare = rule.compare();\r\n\t\t}\r\n\t}\r\n\tthis.frame.applyRules(false, false, myfilt);\r\n}\r\n\r\nDocumentPane.prototype.loadDocument = function(docid, config){\r\n\tthis.docid = docid;\r\n\tthis.view = config;\r\n\treturn this.load();\r\n}\r\n\r\nDocumentPane.prototype.loadClass = function(cls, config){\r\n\tthis.clsid = cls;\r\n\tthis.docid = false;\r\n\tthis.view = config;\r\n\treturn this.load();\r\n}\r\n\r\n\r\n\r\nDocumentPane.prototype.setClassLoader = function(cloader){\r\n\tthis.classLoader = cloader;\r\n\tif(this.queryPane){\r\n\t\tthis.queryPane.appendChild(this.classLoader);\r\n\t}\r\n\treturn this;\r\n}\r\n\r\nDocumentPane.prototype.getQueryPane = function(){\r\n\tvar pane = document.createElement(\"div\");\r\n\tpane.setAttribute(\"class\", \"terminus-document-query\");\r\n\tif(this.documentLoader){\r\n\t\tpane.appendChild(this.documentLoader);\r\n\t}\r\n\tif(this.classLoader){\r\n\t\tpane.appendChild(this.classLoader);\r\n\t}\r\n\treturn pane;\r\n}\r\n\r\nDocumentPane.prototype.getAsDOM = function(){\r\n\tif(this.intro){\r\n\t\tthis.container.appendChild(UTILS.getHeaderDom(this.intro));\r\n\t}\r\n\tvar configspan = document.createElement(\"span\");\r\n\tconfigspan.setAttribute(\"class\", \"pane-config-icons\");\r\n\tthis.container.appendChild(configspan);\r\n\tif(this.showQuery && (this.documentLoader || this.classLoader)){\r\n\t\tvar ipdom = this.getQueryPane();\r\n\t\tvar ispan = document.createElement(\"span\");\r\n\t\tispan.setAttribute(\"class\", \"document-pane-config\");\r\n\t\tvar ic = document.createElement(\"i\");\r\n\t\tispan.appendChild(ic);\r\n\t\tif(this.showQuery != \"always\") configspan.appendChild(ispan);\r\n\t\tvar self = this;\r\n\t\tfunction showQueryConfig(){\r\n\t\t\tispan.title=\"Click to Hide Query\";\r\n\t\t\tic.setAttribute(\"class\", \"fas fa fa-times-circle\");\r\n\t\t\tif(configspan.nextSibling) self.container.insertBefore(ipdom, configspan.nextSibling);\r\n\t\t\telse self.container.appendChild(ipdom);\r\n\t\t}\r\n\t\tfunction hideQueryConfig(){\r\n\t\t\tispan.title=\"Click to View Query\";\r\n            ic.setAttribute(\"class\", \"fas fa fa-search\");\r\n\t\t\tself.container.removeChild(ipdom);\r\n\t\t}\r\n\t\tispan.addEventListener(\"click\", () => {\r\n\t\t\tif(this.showingQuery) hideQueryConfig();\r\n\t\t\telse showQueryConfig();\r\n\t\t\tthis.showingQuery = !this.showingQuery;\r\n\t\t});\r\n\t\tshowQueryConfig();\r\n\t\tif(this.showQuery == \"icon\") hideQueryConfig();\r\n\t\tthis.queryPane = ipdom;\r\n\t}\r\n\tif(this.showConfig){\r\n        this.showingConfig = (this.showConfig != \"icon\");\r\n\t\tvar mode = (this.editConfig ? \"edit\" : \"view\");\r\n\t\tthis.input = this.createInput(mode);\r\n\t\tvar ndom = this.input.getAsDOM();\r\n        var nspan = document.createElement(\"span\");\r\n        nspan.addEventListener('mouseover', function(){\r\n            this.style.cursor = \"pointer\";\r\n\t\t});\r\n\t\tnspan.setAttribute(\"class\", \"result-pane-config\");\r\n\t\tvar nc = document.createElement(\"i\");\r\n\t\tnspan.appendChild(nc);\r\n\t\tconfigspan.appendChild(nspan);\r\n\t\tvar self = this;\r\n\t\tfunction showDocConfig(){\r\n\t\t\tnspan.title=\"Click to Hide View Configuration\";\r\n\t\t\tnc.setAttribute(\"class\", \"fas fa fa-times-circle\");\r\n\t\t\tif(configspan.nextSibling) self.container.insertBefore(ndom, configspan.nextSibling);\r\n\t\t\telse self.container.appendChild(ndom);\r\n\t\t\t//stylize only after ta or pre have been appended\r\n\t\t\tif((self.input.snippet.value) || (self.input.snippet.innerHTML))\r\n\t\t\t\tself.input.stylizeSnippet();\r\n\t\t}\r\n\t\tfunction hideDocConfig(){\r\n\t\t\tnspan.title=\"Click to View Configuration\";\r\n            nc.setAttribute(\"class\", \"fas fa fa-vial\");\r\n\t\t\tself.container.removeChild(ndom);\r\n\t\t}\r\n\t\tnspan.addEventListener(\"click\", () => {\r\n\t\t\tif(this.showingConfig) hideDocConfig();\r\n\t\t\telse showDocConfig();\r\n\t\t\tthis.showingConfig = !this.showingConfig;\r\n        });\r\n        showDocConfig();\r\n\t\tif(this.showConfig == \"icon\") hideDocConfig();\r\n\t}\r\n\tthis.resultDOM = document.createElement(\"span\");\r\n\tthis.resultDOM.setAttribute(\"class\", \"terminus-document-results\");\r\n\t//var form = (this.input.format == \"js\" ? \"javascript\" : \"json\");\r\n\t//UTILS.stylizeEditor(ui, this.input.snippet, {width: this.input.width, height: this.input.height}, form);\r\n\tthis.container.appendChild(this.resultDOM);\r\n\tthis.renderResult();\r\n\treturn this.container;\r\n}\r\n\r\nDocumentPane.prototype.renderResult = function(){\r\n\tif(this.resultDOM){\r\n\t\tHTMLHelper.removeChildren(this.resultDOM);\r\n\t}\r\n\telse {\r\n\t\tthis.resultDOM = document.createElement(\"span\");\r\n\t\tthis.resultDOM.setAttribute(\"class\", \"terminus-document-results\");\r\n\t\t//var form = (this.input.format == \"js\" ? \"javascript\" : \"json\");\r\n\t\t//UTILS.stylizeEditor(ui, this.input.snippet, {width: this.input.width, height: this.input.height}, form);\r\n\t\tthis.container.appendChild(this.resultDOM);\r\n\t}\r\n\tif(this.frame && this.frame.document.render){\r\n\t\tvar fpt = this.frame.document.render();\r\n\t\tif(fpt){\r\n\t\t\tthis.resultDOM.appendChild(fpt);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nDocumentPane.prototype.loadRenderer = function(rendname, frame, args, termframe){\r\n\tvar evalstr = \"new \" + rendname + \"(\";\r\n\tif(args) evalstr += JSON.stringify(args);\r\n\tevalstr += \");\";\r\n\ttry {\r\n\t\tvar nr = eval(evalstr);\r\n\t\tnr.frame = frame;\r\n\t\tnr.datatypes = this.datatypes;\r\n\t\treturn nr;\r\n\t}\r\n\tcatch(e){\r\n\t\tconsole.log(\"Failed to load \" + rendname + e.toString());\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n\r\nDocumentPane.prototype.createInput = function(mode){\r\n    let input = new TerminusCodeSnippet(\"rule\", mode);\r\n    if(this.view){\r\n    \tinput.setQuery(this.view);\r\n\t}\r\n\tvar self = this;\r\n\tinput.submit = function(qObj){\r\n\t\tself.updateView(qObj);\r\n\t};\r\n\treturn input;\r\n}\r\n\r\nDocumentPane.prototype.updateView = function(docview){\r\n\tthis.view = docview;\r\n\tthis.frame.options(this.view);\r\n\tif(this.input) this.input.setQuery(this.view);\r\n\tthis.frame.applyRulesToDocument(this.frame.document, this.frame.config);\r\n\tthis.frame.renderer = this.frame.document;\r\n\tthis.renderResult();\r\n}\r\n\r\nDocumentPane.prototype.updateResult = function(result){\r\n\tthis.result = result;\r\n\tthis.updateQuery(result.query);\r\n\tthis.refreshViews();\r\n}\r\n\r\nDocumentPane.prototype.empty = function(){\r\n\treturn (typeof this.view == \"undefined\");\r\n}\r\n\r\nDocumentPane.prototype.clearMessages = function(){}\r\nDocumentPane.prototype.showError = function(){}\r\n\r\nDocumentPane.prototype.submitQuery = function(qObj){\r\n\tthis.clearMessages();\r\n\ttdv.owner = this;\r\n\ttdv.setDatatypes(Datatypes.initialiseDataRenderers);\r\n\ttdv.loadDocument(id).then(() => {\r\n\t\tlet dom = tdv.render();\r\n\t\tif(dom) holder.appendChild(dom);\r\n\t});\r\n\treturn holder;   \r\n}\r\n\r\nmodule.exports = DocumentPane;\r\n","const HTMLHelper = require(\"../HTMLHelper\");\r\n\r\nfunction SimpleFrameViewer(){}\r\n\r\nSimpleFrameViewer.prototype.getScope = function(frame){\r\n\tif(frame.isProperty()) return \"property\";\r\n\tif(frame.isObject()) return \"object\";\r\n\tif(frame.isData()) return \"data\";\r\n}\r\n\r\nSimpleFrameViewer.prototype.setDatatypeViewers = function(datatypes){\r\n\tthis.datatypes = datatypes;\r\n}\r\n\r\n\r\nSimpleFrameViewer.prototype.getDatatypeViewer = function(frame, mode){\r\n\tvar dv = frame.display_options.dataviewer;\r\n\tif(!dv){\r\n\t\tif(frame.isChoice()) var t = \"oneOf\";\r\n\t\telse if(frame.isDocument()) var t = \"document\";\r\n\t\telse t = frame.getType();\r\n\t\tif(mode && mode == \"edit\"){\r\n\t\t\tvar r = this.datatypes.getEditor(t);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar r = this.datatypes.getRenderer(t);\r\n\t\t}\r\n\t\tdv = r.name;\r\n\t}\r\n\tif(frame.display_options.args){\r\n\t\tvar args = frame.display_options.args ;\r\n\t}\r\n\telse {\r\n\t\tif(r && r.args){\r\n\t\t\t args = r.args;\r\n\t\t}\r\n\t\telse args = false;\r\n\t}\r\n\treturn this.datatypes.createRenderer(dv, args);\r\n}\r\n\r\nSimpleFrameViewer.prototype.render = function(frame){\r\n\tif(!frame) frame = this.frame;\r\n\tif(!frame) return;\r\n\r\n\tvar scope = this.getScope(frame);\r\n\tif(frame.display_options.header_features && frame.display_options.header_features.length){\r\n\t\tvar hfeatures = this.getFeaturesDOM(frame.display_options.header_features, scope, frame, frame.display_options.mode);\r\n\t}\r\n\telse var hfeatures = false;\r\n\tif(frame.display_options.features && frame.display_options.features.length){\r\n\t\tvar features = this.getFeaturesDOM(frame.display_options.features, scope, frame, frame.display_options.mode);\r\n\t}\r\n\telse var features = false;\r\n\tvar orient = (scope == \"object\" || scope == \"property\") ? \"page\" : \"line\";\r\n\tvar ndom = HTMLHelper.getFrameDOM(scope, frame, orient, hfeatures, features);\r\n\tif(!ndom) return false;\r\n\tif(this.framedom){\r\n\t\tthis.framedom.replaceWith(ndom);\r\n\t}\r\n\tthis.framedom = ndom;\r\n\tif(frame.display_options.style){\r\n\t\tthis.framedom.setAttribute(\"style\", frame.display_options.style);\t\t\t\t\r\n\t}\r\n\treturn this.framedom;\r\n}\t\r\n\r\nSimpleFrameViewer.prototype.getFeaturesDOM = function(flist, scope, frame, mode){\r\n\tvar features = document.createElement(\"span\");\r\n\tfeatures.setAttribute(\"class\", \"terminus-features terminus-\" + scope + \"-features features-\" + featuresToCSS(flist));\r\n\tfor(var i = 0; i<flist.length; i++){\r\n\t\tlet render = false;\r\n\t\tlet style = false;\r\n\t\tlet args = false;\r\n\t\tlet fid = flist[i];\r\n\t\tif(typeof fid == \"object\"){\r\n\t\t\tfid = Object.keys(flist[i])[0];\r\n\t\t\tif(flist[i][fid].hidden) continue;\r\n\t\t\tif(flist[i][fid].style) style = flist[i][fid].style;\r\n\t\t\tif(flist[i][fid].render) render = flist[i][fid].render;\r\n\t\t\tif(flist[i][fid].args){\r\n\t\t\t\targs = flist[i][fid].args;\r\n\t\t\t} \r\n\t\t}\r\n\t\telse if(typeof fid != \"string\") continue;\r\n\t\tif(render){\r\n\t\t\tvar dom = render(frame, fid, scope, mode, args);\r\n\t\t\tif(style) dom.setAttribute(\"style\", style);\r\n\t\t\tif(dom)\tfeatures.appendChild(dom);\r\n\t\t}\r\n\t\telse if(fid == \"value\"){\r\n\t\t\tif(scope == \"data\"){\r\n\t\t\t\tvar dv = this.getDatatypeViewer(frame, mode, args);\r\n\t\t\t\tif(dv) {\r\n\t\t\t\t\tvar dom = dv.renderFrame(frame, this);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvar dom = document.createTextNode(frame.get());\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\tif(dom){\r\n\t\t\t\t\tif(style) dom.setAttribute(\"style\", style);\t\t\t\r\n\t\t\t\t\tfeatures.appendChild(dom);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif(scope == 'object'){\r\n\t\t\t\t\tvar vals = frame.renderProperties();\r\n\t\t\t\t\tfor(var j = 0; j<vals.length; j++){\r\n\t\t\t\t\t\tif(style) vals[j].setAttribute(\"style\", style);\r\n\t\t\t\t\t\tfeatures.appendChild(vals[j]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvar vals = frame.renderValues();\t\t    \r\n\t\t\t\t\tvar cont = document.createElement(\"span\");\r\n\t\t\t\t\tif(style) cont.setAttribute(\"style\", style);\r\n\t\t\t\t\tfor(var j = 0; j<vals.length; j++){\r\n\t\t\t\t\t\tcont.appendChild(vals[j]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfeatures.appendChild(cont);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(fid == \"id\" && mode == \"edit\" && scope == \"object\" && frame.isNew()){\r\n\t\t\t\tvar rend = this.datatypes.createRenderer(\"HTMLStringEditor\", args);\r\n\t\t\t\tvar dom = rend.renderFrame(frame, this);\r\n\t\t\t}\r\n\t\t\telse var dom = false;\r\n\t\t\tvar dom = HTMLHelper.getFeatureDOM(frame, fid, scope, mode, args, dom);\r\n\t\t\tif(dom){\r\n\t\t\t\tif(style) dom.setAttribute(\"style\", style);\t\t\t\r\n\t\t\t\tfeatures.appendChild(dom);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn features;\r\n}\t\t\t\t\t\r\n\t\r\n\r\nfunction featuresToCSS(flist){\r\n\tvar s = \"\";\r\n\tfor(var i = 0; i<flist.length; i++){\r\n\t\tif(typeof flist[i] == \"object\"){\r\n\t\t\ts += Object.keys(flist[i])[0] + \"-\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\ts += flist[i] + \"-\";\r\n\t\t}\r\n\t}\r\n\treturn s.substring(0, s.length-1);\r\n}\r\n\r\n\r\n\r\nmodule.exports = SimpleFrameViewer;","const TerminusClient = require('@terminusdb/terminus-client');\r\nconst ScriptPane = require(\"./html/ScriptPane\");\r\nconst HTMLHelper = require('./html/HTMLHelper');\r\nconst TerminusViewer = require(\"./html/TerminusViewer\");\r\n\r\nfunction TerminusQueryViewer(ui, options){\r\n\tthis.ui = ui;\r\n\tthis.tv = new TerminusViewer(ui.client);\r\n\tthis.options = options;\r\n\tthis.panes = [];\r\n\tthis.new_pane = false;\r\n\tthis.new_pane_type = false;\r\n\tthis.meta = {};\r\n\tthis.container = document.createElement(\"div\");\r\n\tthis.container.setAttribute(\"class\", \"terminus-query-page\");   \r\n}\r\n\r\nTerminusQueryViewer.prototype.newPaneOptions = function(){ \r\n\tvar opts = {\r\n\t\tshowQuery: \"always\", \r\n\t\teditQuery: true,\r\n\t\tshowHeader: true, \r\n\t\tcss: \"terminus-full-query-pane\"\r\n\t};\r\n\treturn opts;\r\n} \r\n\r\nTerminusQueryViewer.prototype.defaultResultOptions = function(){ \r\n\tvar opts = {\r\n\t\tshowConfig: \"icon\", \r\n\t\teditConfig: true,\r\n\t\tshowHeader: false, \r\n\t\tviewers: [new TerminusClient.View.graph()],\r\n\t};\r\n\treturn opts;\r\n} \r\n\r\nTerminusQueryViewer.prototype.getNewQueryPane = function(){\r\n\tlet table = TerminusClient.View.table();\r\n\tlet qpane = this.tv.getQueryPane(false, [table], false, [this.defaultResultOptions()], this.newPaneOptions());\r\n\treturn qpane;\r\n}\r\n\r\nTerminusQueryViewer.prototype.addQueryPane = function(){\r\n\tvar qpane = this.getNewQueryPane();\r\n\tthis.panes.push(qpane);\r\n\treturn qpane;\r\n}\r\n\r\nTerminusQueryViewer.prototype.addScriptPane = function(q){\r\n\tlet qpane = new ScriptPane(this.ui.client, q);\r\n\tthis.panes.push(qpane);\r\n\treturn qpane;\r\n}\r\n\r\nTerminusQueryViewer.prototype.addScriptPaneDOM = function(){\r\n\tlet qpane = new ScriptPane(this.ui.client);\r\n\tthis.addNewPaneDOM(qpane);\r\n}\r\n\r\nTerminusQueryViewer.prototype.addQueryPaneDOM = function(){\r\n\tlet qpane = this.addQueryPane();\r\n\tthis.addNewPaneDOM(qpane);\r\n}\r\n\r\nTerminusQueryViewer.prototype.setNewDocumentPaneDOM = function(){\r\n\tthis.new_pane = this.tv.getDocumentPane();\r\n\t//this.new_pane = new DocumentPane(this.ui.client).options({showQuery: true, editQuery: true});\r\n\tthis.new_pane_type = \"document\";\r\n}\r\n\r\nTerminusQueryViewer.prototype.addNewPaneDOM = function(qpane){\r\n\tvar lpane = this.panes[this.panes.length-1];\r\n\t//if(lpane && lpane.empty()){\r\n\t//\tthis.panes[this.panes.length-1] = qpane;\r\n\t//\tthis.paneDOM.removeChild(this.paneDOM.lastChild)\t\t \r\n\t//}\r\n\t//else {\r\n\t\tthis.panes.push(qpane);\r\n\t//}\r\n\tvar qdom = qpane.getAsDOM();\r\n\tvar qhdr = this.getPaneHeader();\r\n\tqdom.prepend(qhdr);\r\n\tthis.paneDOM.appendChild(qdom);\r\n}\r\n\r\nTerminusQueryViewer.prototype.getAsDOM = function(q){\r\n\tHTMLHelper.removeChildren(this.container);\r\n\tif(!this.paneDOM) this.paneDOM = this.getPanesDOM();\r\n\tthis.container.appendChild(this.paneDOM);\r\n\tthis.controlDOM = this.getControlsDOM();\r\n\t//this.container.appendChild(this.controlDOM);\r\n\tvar cont = document.createElement(\"span\");\r\n\tcont.setAttribute(\"class\", \"terminus-new-query-pane\");\r\n\tvar newPaneButton = document.createElement('button');\r\n\t\tnewPaneButton.setAttribute('class', 'terminus-btn terminus-query-btn');\r\n\t\tnewPaneButton.appendChild(document.createTextNode('Add New Query'));\r\n\t\tnewPaneButton.addEventListener('click', () => this.addQueryPaneDOM());\t   \r\n\tcont.appendChild(newPaneButton); \r\n\tthis.container.appendChild(cont);\r\n\treturn this.container;\r\n}\r\n\r\nTerminusQueryViewer.prototype.getPanesDOM = function(q){\r\n\tthis.panesDOM = document.createElement(\"div\");\r\n\tthis.panesDOM.setAttribute(\"class\", \"terminus-query-panes\");\r\n\tfor(var i = 0; i<this.panes.length; i++){\r\n\t\tvar pd = this.panes[i].getAsDOM();\r\n\t\tvar qhdr = this.getPaneHeader();\r\n\t\tpd.prepend(qhdr);\r\n\t\tthis.panesDOM.appendChild(pd);\r\n\t}\r\n\tif(!this.new_pane){\r\n\t\tthis.new_pane = this.getNewQueryPane();\r\n\t}\r\n\tvar npd = this.new_pane.getAsDOM();\r\n\tvar nqhdr = this.getNewPaneHeader();\r\n\tthis.new_pane.headerDOM = nqhdr;\r\n\tthis.new_pane.paneDOM = npd;\r\n\tnpd.prepend(nqhdr);\r\n\tthis.panesDOM.appendChild(npd);\r\n\treturn this.panesDOM;\r\n}\r\n\r\nTerminusQueryViewer.prototype.removePane = function(pane, index){\r\n\tHTMLHelper.removeChildren(pane.paneDOM);\r\n\tpane.paneDOM.appendChild(pane.headerDOM);\r\n\tif(this.panes[i]){\r\n\t\tthis.panes.splice(i, 1);\r\n\t}\r\n}\r\n\r\nTerminusQueryViewer.prototype.showPane = function(pane){\r\n\t//HTMLHelper.removeChildren(pane.paneDOM);\r\n\t//var pd = pane.getAsDOM();\r\n\t//var qhdr = this.getPaneHeader();\r\n\t//pd.prepend(qhdr);\r\n\t//pane.headerDOM = qhdr;\t\r\n}\r\n\r\nTerminusQueryViewer.prototype.hidePane = function(pane){\r\n\t\r\n}\r\n\r\n\r\n\r\nTerminusQueryViewer.prototype.getPaneHeader = function(){\r\n\tvar hdr = document.createElement(\"div\");\r\n\t//hdr.appendChild(this.getControlsDOM());\r\n\treturn hdr;\r\n}\r\n\r\nTerminusQueryViewer.prototype.getNewPaneHeader = function(){\r\n\tvar hdr = document.createElement(\"div\");\r\n\t//hdr.appendChild(this.getControlsDOM(\"new\"));\r\n\treturn hdr;\r\n}\r\n\r\nTerminusQueryViewer.prototype.getControlsDOM = function(isnew){\r\n\tvar c = document.createElement(\"div\");\r\n\tc.setAttribute(\"class\", \"terminus-query-page-controls\");    \r\n\tif(isnew == \"new\"){\r\n\t\tvar newPaneButton = document.createElement('button');\r\n\t\tnewPaneButton.setAttribute('class', 'terminus-btn terminus-query-btn');\r\n\t\tnewPaneButton.appendChild(document.createTextNode('WOQL Query'));\r\n\t\t//newPaneButton.addEventListener('click', () => this.addQueryPaneDOM());\t    \r\n\t\tc.appendChild(newPaneButton);\r\n\t\tvar newScriptButton = document.createElement('button');\r\n\t\tnewScriptButton.setAttribute('class', 'terminus-btn terminus-query-btn');\r\n\t\tnewScriptButton.appendChild(document.createTextNode('Script'));\r\n\t\t//newScriptButton.addEventListener('click', () => this.addScriptPaneDOM());\t    \r\n\t\tc.appendChild(newScriptButton);\r\n\t\tvar newDocButton = document.createElement('button');\r\n\t\tnewDocButton.setAttribute('class', 'terminus-btn terminus-query-btn');\r\n\t\tnewDocButton.appendChild(document.createTextNode('Document Query'));\r\n\t\tnewDocButton.addEventListener('click', () => this.setNewDocumentPaneDOM());\t    \r\n\t\tc.appendChild(newDocButton);\r\n\t}\r\n\telse {\r\n\t\tvar savePaneButton = document.createElement('button');\r\n\t\tsavePaneButton.setAttribute('class', 'terminus-btn terminus-query-btn');\r\n\t\tsavePaneButton.appendChild(document.createTextNode('Save'));\r\n\t\tc.appendChild(savePaneButton);\r\n\t\tvar closePaneButton = document.createElement('button');\r\n\t\tclosePaneButton.setAttribute('class', 'terminus-btn terminus-query-btn');\r\n\t\tclosePaneButton.appendChild(document.createTextNode('Close'));\r\n\t\tc.appendChild(closePaneButton);\r\n\t\tvar collapsePaneButton = document.createElement('button');\r\n\t\tcollapsePaneButton.setAttribute('class', 'terminus-btn terminus-query-btn');\r\n\t\tcollapsePaneButton.appendChild(document.createTextNode('Collapse'));\t\t\r\n\t\tc.appendChild(collapsePaneButton);\r\n\t}\r\n\treturn c;\r\n}\r\n\r\n\r\nmodule.exports=TerminusQueryViewer\r\n","const TerminusClient = require('@terminusdb/terminus-client');\r\nconst TerminusCodeSnippet = require('./query/TerminusCodeSnippet');\r\nconst UTILS = require('../Utils');\r\nconst HTMLHelper = require('./HTMLHelper');\r\n\r\n\r\nfunction ScriptPane(client, script){\r\n\tthis.client = client;\r\n\tthis.script = (script ? script : \"\");\r\n\tthis.container = document.createElement('div');\r\n    this.container.setAttribute('class', 'terminus-script-pane-cont');\r\n}\r\n\r\nScriptPane.prototype.empty = function(){\r\n\treturn this.script == \"\";\r\n}\r\n\r\n\r\nScriptPane.prototype.createInput = function(ui){\r\n\tlet input = new TerminusCodeSnippet(\"code\", \"edit\");\r\n\tif(this.script){\r\n\t\tinput.setQuery(this.script);\r\n\t}\r\n\tvar self = this;\r\n\tinput.submit = function(qObj){\r\n\t\tself.executeScript(qObj, ui);\r\n\t};\r\n\treturn input;\r\n}\r\n\r\n\r\nScriptPane.prototype.executeScript = function(script, ui){\r\n    if(ui) ui.clearMessages();\r\n    this.script = script;\r\n\tvar client = this.client;\r\n\tvar WOQL = TerminusClient.WOQL;\r\n\ttry {\r\n\t\tvar res = eval(script);\r\n\t\tif(res){\r\n\t\t\tthis.updateResult(res);\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//executed ok message \r\n\t\t}\r\n\t}\r\n\tcatch(e){\r\n\t\tif(ui) ui.showError(e);\r\n\t\tconsole.error(e);\r\n\t}\r\n}\r\n\r\nScriptPane.prototype.showOKMessage = function(){\r\n    var msg = document.createTextNode(\"Script executed ok\");\r\n    this.updateResult(msg);\r\n}\r\n\r\nScriptPane.prototype.updateResult = function(res){\r\n    HTMLHelper.removeChildren(this.resultDOM);\r\n    this.resultDOM.appendChild(res);\r\n}\r\n\r\n\r\nScriptPane.prototype.getAsDOM = function(ui){\r\n\tthis.container.appendChild(UTILS.getHeaderDom('Enter Script'));\r\n\tthis.input = this.createInput(ui);\r\n\tthis.container.appendChild(this.input.getAsDOM());\r\n\tthis.resultDOM = document.createElement(\"div\");\r\n\tthis.resultDOM.setAttribute(\"class\", \"terminus-script-results\"); \r\n\t//var form = (this.input.format == \"js\" ? \"javascript\" : \"json\");\r\n\t//UTILS.stylizeEditor(ui, this.input.snippet, {width: this.input.width, height: this.input.height}, form);\r\n\tif(this.result){\r\n        this.resultDOM.appendChild(this.result);\r\n    }\r\n\tthis.container.appendChild(this.resultDOM);\r\n\treturn this.container;\r\n}\r\n\r\n\r\nmodule.exports = ScriptPane;\r\n","/*\r\n * Draws the screen for viewing and updating the schema\r\n * and provides wrappers around the client's schema API\r\n */\r\nconst UTILS=require('./Utils')\r\nconst TerminusClient = require('@terminusdb/terminus-client');\r\nconst HTMLHelper = require('./html/HTMLHelper');\r\nconst TerminusViewer = require('./html/TerminusViewer');\r\n\r\n\r\nfunction TerminusSchemaViewer(ui){\r\n\tthis.ui = ui;\r\n\tthis.tv = new TerminusViewer(ui.client);\r\n\r\n\tthis.mode = \"view\";\r\n\tthis.format = \"turtle\";\r\n\tthis.confirm_before_update = false;\r\n\tthis.woql = TerminusClient.WOQL;\r\n\tthis.views = { \r\n\t\tclasses: {\r\n\t\t\ttitle: \"Classes\"\r\n\t\t}, \r\n\t\tproperties: {\r\n\t\t\ttitle: \"Properties\"\r\n\t\t}, \r\n\t\towl: {\r\n\t\t\ttitle: \"OWL\"\t\r\n\t\t}\r\n\t}\r\n\tthis.views_dom = document.createElement(\"div\");\r\n\tthis.current_view = \"classes\";\r\n\tthis.retrieveViews();\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getClassesPane = function() {\r\n\tlet WOQL = TerminusClient.WOQL;\r\n\tlet query = this.woql.from(this.ui.client.connectionConfig.dbURL())\r\n\t\t.limit(100)\r\n\t\t\t.start(0)\r\n\t\t\t.and(\r\n\t\t\t\tWOQL.quad(\"v:Class\", \"rdf:type\", \"owl:Class\", \"db:schema\"),\r\n\t\t\t\tWOQL.opt().quad(\"v:Class\", \"rdfs:label\", \"v:Label\", \"db:schema\"),\r\n\t\t\t\tWOQL.opt().quad(\"v:Class\", \"rdfs:subClassOf\", \"v:Parent\", \"db:schema\"),\r\n\t\t\t\tWOQL.opt().quad(\"v:Child\", \"rdfs:subClassOf\", \"v:Class\", \"db:schema\"),\r\n\t\t\t\tWOQL.opt().quad(\"v:Class\", \"rdfs:comment\", \"v:Comment\", \"db:schema\"),\r\n\t\t\t\tWOQL.opt().quad(\"v:Class\", \"tcs:tag\", \"v:Abstract\", \"db:schema\")\r\n\t);\t\r\n\t\r\n\tvar table = TerminusClient.View.table();\r\n\ttable.column_order(\"Class\", \"Label\", \"Comment\", \"Parent\", \"Child\", \"Abstract\")\r\n\ttable.column('Comment').header('Description');\r\n\ttable.column('Class').header('Class ID');\r\n\ttable.column('Label').header('Name');\r\n\ttable.column('Child').header('Subclasses');\r\n\ttable.column('Parent').header('Parent Classes');\r\n\ttable.column('Range').header('Type');\r\n\r\n\tvar graph = TerminusClient.View.graph();\r\n\tgraph.edges([\"v:Class\", \"v:Parent\"], [\"v:Child\", \"v:Class\"], [\"v:Class\", \"v:Abstract\"]);\r\n\t\r\n\t\r\n\tgraph.height(800);\r\n\tgraph.width(1200);\r\n\tgraph.edge(\"v:Class\", \"v:Parent\").text(\"Parent Class\").distance(120);\r\n\tgraph.edge(\"v:Child\", \"v:Class\").text(\"Parent Class\").distance(120);\r\n\tgraph.edge(\"v:Class\", \"v:Abstract\").text(\"Abstract Class\").weight(2).color([0,0,0]);\r\n\tgraph.node(\"Parent\").size(20).color([180, 220, 250]).icon({label: true, size: 0.7, color: [90, 90, 140]});\r\n\tgraph.node(\"Class\").text(\"v:Label\").size(32).collisionRadius(80).icon({label: true, size: 0.7, color: [24, 34, 89]});\r\n\r\n\tvar rpc = { viewers: [graph] }\r\n    var qp = this.tv.getQueryPane(query, [table], false, [rpc]);\r\n\t//var qp = this.tv.getQueryPane(query, [graph, table]);\r\n\r\n\treturn qp;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getPropertiesPane = function() {\r\n\tlet query = this.woql.from(this.ui.client.connectionConfig.dbURL())\r\n\t   .limit(100)\r\n\t   .start(0)\r\n\t   .propertyMetadata();\r\n\r\n    var table = TerminusClient.View.table();\r\n\ttable.column_order(\"Property\", \"Label\", \"Range\", \"Domain\", \"Comment\")\r\n\ttable.column('Comment').header('Description');\r\n\ttable.column('Property').header('Property ID');\r\n\ttable.column('Label').header('Name');\r\n\ttable.column('Domain').header('Domain');\r\n\ttable.column('Range').header('Type');\r\n\r\n\tvar graph = TerminusClient.View.graph();\r\n\tgraph.height(800);\r\n\tgraph.width(1200);\r\n\tgraph.edges([\"Domain\", \"Property\"], [\"Property\", \"Range\"]);\r\n\tgraph.edge(\"Domain\", \"Property\").text(\"Domain Class\").color([20, 200, 20]).distance(120);\r\n\tgraph.edge(\"Property\", \"Range\").text(\"Property Type\").distance(100);\r\n\tgraph.node(\"Type\").hidden(true);\r\n\tgraph.node(\"Range\").text(\"v:Range\").size(20).collisionRadius(100).color([220, 250, 180]).icon({label: true, size: 0.8, color: [50, 60, 40]});\r\n\tgraph.node(\"Range\").v(\"Type\").in(\"owl:datatypeProperty\").hidden(true);\r\n\tgraph.node(\"Property\").text(\"v:Label\").size(24).collisionRadius(100).color([180, 220, 250]).icon({label: true, size: 0.8, color: [50, 60, 40]});\r\n\tgraph.node(\"Domain\").color([220, 250, 180]).size(20).collisionRadius(100).icon({label: true, size: 0.7, color: [24, 34, 89]});\r\n\tvar rpc = { viewers: [graph] }\r\n\tvar qp = this.tv.getQueryPane(query, [table], false, [rpc]);\r\n\t//var qp = this.tv.getQueryPane(query, [graph, table]);\r\n\treturn qp;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.refreshPanes = function(){\r\n\tif(this.views.classes.pane) this.views.classes.pane.load();\r\n\tif(this.views.properties.pane) this.views.properties.pane.load();\r\n}\r\n\r\nTerminusSchemaViewer.prototype.retrieveViews = function(){\r\n\tif(!this.views.classes.pane){\r\n\t\tlet pane = this.getClassesPane();\r\n\t\tthis.views.classes.pane = pane;\r\n\t\tlet dom = pane.getAsDOM();\r\n\t\tif(this.current_view != \"classes\") dom.style.display = \"none\";\r\n\t\tthis.views_dom.appendChild(dom);\r\n\t\tpane.load();\r\n\t\tthis.views.classes.dom = dom;\r\n\t}\r\n\tif(!this.views.properties.pane){\r\n\t\tlet pane = this.getPropertiesPane();\r\n\t\tthis.views.properties.pane = pane;\r\n\t\tlet dom = pane.getAsDOM();\r\n\t\tif(this.current_view != \"properties\") dom.style.display = \"none\";\r\n\t\tthis.views_dom.appendChild(dom);\r\n\t\tthis.views.properties.dom = dom;\r\n\t\tpane.load();\r\n\t}\r\n\tif(!this.views.owl.dom){\r\n\t\tthis.views.owl.dom = this.getOWLView();\r\n\t\tthis.views_dom.appendChild(this.views.owl.dom);\r\n\t\tif(this.current_view != \"owl\") this.views.owl.dom.style.display = \"none\";\t\t\r\n\t}\r\n}\r\n\r\n\r\n/*\r\n * Retrieves schema from API and writes the response into the page\r\n */\r\nTerminusSchemaViewer.prototype.getAsDOM = function(){\r\n\r\n\tthis.holder = document.createElement(\"div\");\r\n\tthis.controldom = document.createElement(\"div\");\r\n\tthis.controldom.setAttribute(\"class\", \"terminus-schema-controls\");\r\n\tthis.controldom.appendChild(this.getTabsDOM());\r\n\tthis.view = document.createElement(\"div\");\r\n\tthis.view.setAttribute(\"class\", \"terminus-schema-view\");\r\n\tthis.view.appendChild(this.views_dom);\r\n\tthis.pagedom = document.createElement(\"div\");\r\n\tthis.pagedom.setAttribute(\"class\", \"terminus-schema-viewer\");\r\n\tthis.holder.appendChild(this.controldom);\r\n\tthis.pagedom.appendChild(this.view);\r\n\tthis.holder.appendChild(this.pagedom);\r\n\treturn this.holder;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getOWLView = function(){\r\n\tvar owldom = document.createElement(\"div\");\r\n\tthis.loadSchema();\r\n\treturn owldom;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.updateOWLContents = function(){\r\n\tvar owldom = this.views.owl.dom;\r\n\tHTMLHelper.removeChildren(owldom);\r\n\tif(this.mode == 'view'){\r\n\t\towldom.appendChild(this.getSchemaEditButton());\r\n\t\towldom.appendChild(this.getSchemaViewDOM());\r\n\t}\r\n\telse if(this.mode == \"edit\"){\r\n\t\towldom.appendChild(this.getSchemaSaveButtons());\r\n\t\towldom.appendChild(this.getSchemaEditDOM());\r\n\t\towldom.appendChild(this.getSchemaSaveButtons());\r\n\t}\r\n}\r\n\r\n\r\nTerminusSchemaViewer.prototype.getTabsDOM = function(){\r\n\tvar ul = document.createElement('ul');\r\n\tul.setAttribute('class', 'terminus-ul-horizontal');\r\n\tfor(var k in this.views){\r\n\t\tvar a = this.getTabDOM(k, this.views[k].title);\r\n\t\tul.appendChild(a);\r\n\t\tif(k == this.current_view) \tUTILS.setSelectedSubMenu(a);\r\n\t}\r\n\treturn ul;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getTabDOM = function(view, title){\r\n\tvar a = document.createElement('a');\r\n    a.setAttribute('class', 'terminus-a terminus-hz-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n    var self = this;\r\n    a.addEventListener(\"click\", function(){\r\n        self.switchView(this, view);\r\n    })\r\n\ta.appendChild(document.createTextNode(title));\r\n    return a;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.switchView = function(a, view){\r\n\tUTILS.setSelectedSubMenu(a);\r\n\tif(view != this.current_view){\r\n\t\tthis.current_view = view;\r\n\t\tthis.toggleTabs();\r\n\t}\r\n}\r\n\r\nTerminusSchemaViewer.prototype.toggleTabs = function(){\r\n\tfor(var k in this.views){\r\n\t\tif(this.views[k].dom && k == this.current_view) this.views[k].dom.style.display = \"block\";\r\n\t\telse if(this.views[k].dom) this.views[k].dom.style.display = \"none\";\r\n\t}\r\n}\r\n\r\nTerminusSchemaViewer.prototype.loadSchema = function(msg, msgtype){\r\n\tvar self = this;\r\n\tthis.ui.showBusy(\"Fetching Database Schema\");\r\n\treturn this.ui.client.getSchema(false, {\"terminus:encoding\": \"terminus:\" + this.format})\r\n\t.then(function(response){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.schema = response;\r\n\t\tself.updateOWLContents() \r\n\t})\r\n\t.catch(function(error){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.ui.showError(error);\r\n\t});\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaSaveButtons = function(){\r\n\tvar ssb = document.createElement(\"span\");\r\n\tssb.setAttribute(\"class\", \"terminus-schema-save-buttons\");\r\n\tssb.appendChild(this.getCancelButton());\r\n\tssb.appendChild(this.getSaveButton());\r\n\treturn ssb;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getCancelButton = function(is_import){\r\n\tvar self = this;\r\n\tvar func = function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tself.mode = \"view\";\r\n\t\tself.updateOWLContents();\r\n\t}\r\n\treturn this.getSchemaButton(\"Cancel\", \"cancel_update\", func);\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSaveButton = function(){\r\n\tvar self = this;\r\n\tvar func = function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tvar text = self.schema_edit_dom.value;\r\n\t\tif(typeof(self.schema) == \"object\"){\r\n\t\t\ttext = JSON.parse(text);\r\n\t\t}\r\n\t\tvar opts = {};\r\n\t\topts['terminus:encoding'] =  'terminus:' + self.format;\r\n\t\tif(!(TerminusClient.UTILS.empty(self.schema_edit_dom_name)))\r\n\t\t\topts['schemaId'] = self.ui.client.connectionConfig.dbURL() + '/' + self.schema_edit_dom_name.value;\r\n\t\telse opts['schemaId'] = self.ui.client.connectionConfig.dbURL() + '/' + 'schema';\r\n\t\treturn self.updateSchema(text, opts);\r\n\t}\r\n\treturn this.getSchemaButton(\"Save\", \"update_schema\", func);\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaEditButton = function(){\r\n\tvar ssb = document.createElement(\"span\");\r\n\tssb.setAttribute(\"class\", \"terminus-schema-save-buttons\");\r\n\tvar self = this;\r\n\tvar func = function(){\r\n\t\tself.mode = \"edit\";\r\n\t\tself.updateOWLContents();\r\n\t}\r\n\tvar but = this.getSchemaButton(\"Edit\", \"update_schema\", func);\r\n\tssb.appendChild(but);\r\n\treturn ssb;\r\n}\r\n\r\n/*\r\n * Updates schema, then fetches updated version and updates the page with it\r\n */\r\nTerminusSchemaViewer.prototype.updateSchema  = function(text, opts) {\r\n\tthis.ui.showBusy(\"Updating Database Schema\");\r\n\tvar self = this;\r\n\treturn this.ui.client.updateSchema(false, text, opts)\r\n\t.then(function(response){\r\n\t\tif(response['terminus:status'] && response['terminus:status'] == \"terminus:success\"){\r\n\t\t\tself.ui.showBusy(\"Retrieving updated schema\");\r\n\t\t\tself.mode = \"view\";\r\n\t\t\tself.loadSchema(\"Successfully Updated Schema\");\r\n\t\t\tself.refreshPanes();\r\n\t\t\tself.updateOWLContents();\r\n\t\t}\r\n\t\telse if(response['terminus:status'] && response['terminus:status'] == \"terminus:failure\"){\r\n\t\t\tself.ui.clearBusy();\r\n\t\t\tself.ui.showViolations(response['terminus:witnesses'], \"schema\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error(\"Update Schema returned no terminus:status code\");\r\n\t\t}\r\n\t})\r\n\t.catch(function(error){\r\n\t\tself.ui.clearBusy();\r\n\t\tif(error.data && error.data['terminus:witnesses']){\r\n\t\t\tself.ui.showViolations(error.data['terminus:witnesses'], \"schema\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.ui.showError(error);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaEditDOM = function(){\r\n\tvar np = document.createElement(\"div\");\r\n\tnp.setAttribute(\"class\", \"terminus-schema-page terminus-schema-edit-page\");\r\n\tif(this.ui.showControl(\"add_new_library\")) var sid = this.getSchemaNameInputDOM(np);\r\n\tvar ipval = document.createElement(\"textarea\");\r\n\tipval.setAttribute(\"class\", \"terminus-schema-edit terminus-schema-textarea\");\r\n\tipval.setAttribute(\"width\", \"100%\");\r\n\tipval.setAttribute(\"style\", \"min-width: 400px; min-height: 400px;\");\r\n\tif(typeof(this.schema) == \"string\"){\r\n\t\tipval.innerHTML = this.schema;\r\n\t}\r\n\telse if(typeof (this.schema) == \"object\") {\r\n\t\tipval.innerHTML = JSON.stringify(this.schema, 0, 4);\r\n\t}\r\n\tif(this.ui.showControl(\"add_new_library\")) this.schema_edit_dom_name = sid;\r\n\tthis.schema_edit_dom = ipval;\r\n\tnp.appendChild(ipval);\r\n\tUTILS.stylizeEditor(this.ui, ipval, 'schema', 'turtle');\r\n\treturn np;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaViewDOM = function(){\r\n\tvar self = this;\r\n\tvar np = document.createElement(\"div\");\r\n\tnp.setAttribute(\"class\", \"terminus-schema-page terminus-schema-view-page\");\r\n\tvar ipval = document.createElement(\"pre\");\r\n\tipval.setAttribute(\"class\", \"terminus-schema-view terminus-scheme-pre\");\r\n\tif(typeof(this.schema) == \"string\"){\r\n\t\tvar txt = this.schema.replace(/&/g, \"&amp;\")\r\n         .replace(/</g, \"&lt;\")\r\n         .replace(/>/g, \"&gt;\")\r\n         .replace(/\"/g, \"&quot;\")\r\n         .replace(/'/g, \"&#039;\");\r\n\t\tipval.innerHTML = txt;\r\n\t}\r\n\telse if(typeof (this.schema) == \"object\") {\r\n\t\tipval.innerHTML = JSON.stringify(this.schema, 0, 4);\r\n\t}\r\n\tvar cm = UTILS.stylizeCodeDisplay(this.ui, ipval, np, 'turtle');\r\n\tif(!cm) np.appendChild(ipval);\r\n\treturn np;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaButton = function(label, action, func){\r\n\tvar opt = document.createElement(\"button\");\r\n\topt.appendChild(document.createTextNode(label));\r\n\topt.setAttribute(\"class\", \"terminus-btn terminus-control-button terminus-schema-\" + action);\r\n\topt.addEventListener(\"click\", func);\r\n\treturn opt;\r\n}\r\n\r\n\r\nmodule.exports=TerminusSchemaViewer\r\n","/* User interface elements that relate to server context\r\n *\r\n * TerminusServerController is a control widget that invokes server actions\r\n * TerminusServerViewer is a window that displays server actions and server screens\r\n *\r\n */\r\n const Datatables = require('./plugins/datatables.terminus');\r\n const UTILS =require('./Utils');\r\n const HTMLHelper = require('./html/HTMLHelper');\r\n \r\n function TerminusServerController(ui){\r\n\t this.ui = ui;\r\n }\r\n\r\nTerminusServerController.prototype.getAsDOM = function(){\r\n\tvar rsc = document.createElement(\"div\");\r\n\trsc.setAttribute(\"class\", \"terminus-server-controller\");\r\n\tvar self = this;\r\n\tif(this.ui && this.ui.server()){\r\n\t\tvar scd = document.createElement(\"div\");\r\n\t\tscd.setAttribute(\"class\", \"terminus-server-connection\");\r\n        var nav = document.createElement('div');\r\n        nav.setAttribute('class', 'span3');\r\n        var ul = document.createElement('ul');\r\n        ul.setAttribute('class', 'terminus-ul');\r\n        nav.appendChild(ul);\r\n        rsc.appendChild(nav);\r\n        // connected to server\r\n        // change server\r\n        if(this.ui.showControl(\"change-server\")){\r\n            var a = document.createElement('a');\r\n            a.setAttribute('class', 'terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n            var self = this;\r\n            a.addEventListener(\"click\", function(){\r\n\t\t\t\tUTILS.activateSelectedNav(this, self);\r\n\t\t\t\tself.ui.clearMessages();\r\n                self.ui.showLoadURLPage();\r\n            })\r\n            var icon = document.createElement('i');\r\n            icon.setAttribute('class', 'terminus-menu-icon fa fa-link');\r\n            a.appendChild(icon);\r\n            var txt = document.createTextNode('Change Server');\r\n            a.appendChild(txt);\r\n            ul.appendChild(a);\r\n        }\r\n        // view databases\r\n        if(this.ui.showControl(\"db\")){\r\n            var a = document.createElement('a');\r\n            a.setAttribute('class', 'terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n            var self = this;\r\n            a.addEventListener(\"click\", function(){\r\n                UTILS.activateSelectedNav(this, self);\r\n                if(self.ui.db()){\r\n                    self.ui.clearDB();\r\n\t\t\t\t\tself.ui.redrawControls();\r\n                }\r\n\t\t\t\tself.ui.clearMessages();\r\n                self.ui.showServerMainPage();\r\n            })\r\n            var icon = document.createElement('i');\r\n            icon.setAttribute('class', 'terminus-menu-icon fa fa-home');\r\n            a.appendChild(icon);\r\n            var txt = document.createTextNode('Home');\r\n            a.appendChild(txt);\r\n            ul.appendChild(a);\r\n        }\r\n\t\tif(this.ui.showControl(\"create_database\")){\r\n            var a = document.createElement('a');\r\n            a.setAttribute('class', 'terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n            var self = this;\r\n            a.addEventListener(\"click\", function(){\r\n               UTILS.activateSelectedNav(this, self);\r\n                if(self.ui.db()){\r\n                    self.ui.clearDB();\r\n\t\t\t\t\tself.ui.redrawControls();\r\n\t\t\t\t}\r\n\t\t\t\tself.ui.clearMessages();\r\n                self.ui.showCreateDBPage();\r\n            })\r\n            var icon = document.createElement('i');\r\n            icon.setAttribute('class', 'terminus-menu-icon fa fa-plus');\r\n            a.appendChild(icon);\r\n            var txt = document.createTextNode('Create Database');\r\n            a.appendChild(txt);\r\n            ul.appendChild(a);\r\n        }\r\n        if(this.ui.showControl(\"collaborate\")){\r\n            var a = document.createElement('a');\r\n            a.setAttribute('class', 'terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n            var self = this;\r\n            a.addEventListener(\"click\", function(){\r\n               UTILS.activateSelectedNav(this, self);\r\n                if(self.ui.db()){\r\n                    self.ui.clearDB();\r\n\t\t\t\t\tself.ui.redrawControls();\r\n                }\r\n\t\t\t\tself.ui.clearMessages();\r\n                self.ui.showCollaboratePage();\r\n            })\r\n            var icon = document.createElement('i');\r\n            icon.setAttribute('class', 'terminus-menu-icon fa fa-share-alt');\r\n            a.appendChild(icon);\r\n            var txt = document.createTextNode('Collaborate');\r\n            a.appendChild(txt);\r\n            ul.appendChild(a);\r\n\t\t}\r\n\t}\r\n\treturn rsc;\r\n}\r\n\r\nTerminusServerController.prototype.getServerLabelDOM = function(){\r\n\tvar srec = this.ui.client.connection.getServerRecord();\r\n\tvar lab = (srec && srec['rdfs:label'] && srec['rdfs:label'][\"@value\"] ? srec['rdfs:label'][\"@value\"] : this.ui.server());\r\n\tvar desc = (srec && srec['rdfs:comment'] && srec['rdfs:comment'][\"@value\"] ? srec['rdfs:comment'][\"@value\"] : \"\");\r\n\tdesc += \" Server URL: \"+ this.ui.server();\r\n\tvar val = document.createElement(\"span\");\r\n\tval.setAttribute(\"class\", \"terminus-server-value\");\r\n\tval.setAttribute(\"title\", desc);\r\n\tval.appendChild(document.createTextNode(lab));\r\n    val =  document.createElement('div');\r\n\treturn val;\r\n}\r\n\r\nfunction TerminusServerViewer(ui){\r\n\tthis.ui = ui;\r\n\tthis.server = this.ui.server();\r\n\tthis.max_cell_size = 500;\r\n\tthis.max_word_size = 40;\r\n\tthis.css_base = \"https://terminusdb.github.io/terminus-dashboard/dist/\";\r\n\r\n}\r\n\r\nTerminusServerViewer.prototype.getAsDOM = function(selected){\r\n\tvar self = this;\r\n\tvar pd = document.createElement(\"span\");\r\n\tpd.setAttribute(\"class\", \"terminus-server-home-page\");\r\n\tif(this.ui.server()){\r\n\t\tvar scd = document.createElement(\"span\");\r\n\t\tscd.setAttribute(\"class\", \"terminus-server-home\");\r\n\t\tif(this.ui.showView(\"server\")){\r\n\t\t\tscd.appendChild(this.getServerDetailsDOM());\r\n\t\t}\r\n\t\tif(this.ui.showView(\"change-server\")){\r\n\t\t\tvar csbut = document.createElement(\"button\");\r\n\t\t\tcsbut.setAttribute(\"class\", \"terminus-control-button terminus-change-server-button terminus-btn\")\r\n\t\t\tcsbut.appendChild(document.createTextNode(\"Disconnect\"));\r\n\t\t\tcsbut.addEventListener(\"click\", function(){\r\n\t\t\t\tif(self.ui.db()){\r\n\t\t\t\t\tself.ui.clearDB();\r\n\t\t\t\t}\r\n\t\t\t\tself.ui.showLoadURLPage();\r\n\t\t\t})\r\n\t\t\t// 11092019 scd.appendChild(csbut);\r\n\t\t}\r\n\t\tif(this.ui.showView(\"create_database\")){\r\n\t\t\tvar crbut = document.createElement(\"button\");\r\n\t\t\tcrbut.setAttribute(\"class\", \"terminus-control-button terminus-create-db-button terminus-btn\")\r\n\t\t\tcrbut.appendChild(document.createTextNode(\"Create New Database\"));\r\n\t\t\tcrbut.addEventListener(\"click\", function(){\r\n\t\t\t\tif(self.ui.db()){\r\n\t\t\t\t\tself.ui.clearDB();\r\n\t\t\t\t}\r\n\t\t\t\tself.ui.clearMessages();\r\n\t\t\t\tself.ui.showCreateDBPage();\r\n\t\t\t})\r\n\t\t}\r\n\t\tif(this.ui.showView(\"db\")){\r\n\t\t\tscd.appendChild(this.getDBListDOM());\r\n\t\t}\r\n\t\tpd.appendChild(scd);\r\n\t}\r\n\telse {\r\n\t\tself.ui.showLoadURLPage();\r\n\t}\r\n\treturn pd;\r\n}\r\n\r\nTerminusServerViewer.prototype.getServerDetailsDOM = function(){\r\n\tvar scd = document.createElement(\"div\");\r\n\tscd.setAttribute(\"class\", \"terminus-server-details terminus-welcome-box terminus-no-res-alert\");\r\n\tvar icon = document.createElement(\"img\");\r\n\ticon.setAttribute(\"class\", \"terminus-server-main-logo\")\r\n\tvar url = this.css_base + \"css/img/TerminusDB_Logo_Original.png\" \r\n\ticon.setAttribute(\"src\", url);\r\n\tscd.appendChild(icon);\r\n\tvar scl = document.createElement(\"p\");\r\n\tscl.setAttribute(\"class\", \"terminus-server-running\")\r\n\tscl.appendChild(document.createTextNode(\"Terminus Server running at \"))\r\n\tscl.appendChild(document.createTextNode(this.ui.server()))\r\n\tscd.appendChild(scl);\r\n\treturn scd;\r\n}\r\n\r\nTerminusServerViewer.prototype.wrapTableLinkCell = function(tdElement,dbid, text){\r\n\tvar self = this;\r\n\tvar wrap = document.createElement(\"p\");\r\n//\twrap.setAttribute(\"href\", \"#\");\r\n\twrap.setAttribute(\"class\", \"terminus-table-content\");\r\n\tHTMLHelper.wrapShortenedText(wrap, text, this.max_cell_size, this.max_word_size);\r\n\ttdElement.addEventListener(\"click\", function(){\r\n\t\tself.ui.connectToDB(dbid);\r\n\t\tself.ui.showDBMainPage();\r\n\t});\r\n\treturn wrap;\r\n}\r\n\r\nTerminusServerViewer.prototype.getDBListDOM = function(){\r\n\t//var self = this;\r\n\tvar sec = document.createElement(\"div\");\r\n\tsec.setAttribute(\"class\", \"terminus-db-list\");\r\n\t//sec.appendChild(UTILS.getHeaderDom('Databases'));\r\n\tvar scd = document.createElement(\"table\");\r\n\tscd.setAttribute(\"class\", \"terminus-db-list terminus-db-size terminus-hover-table terminus-margin-top\");\r\n\tvar thead = document.createElement(\"thead\");\r\n\tvar thr = document.createElement(\"tr\");\r\n\tvar th1 = document.createElement(\"th\");\r\n\tth1.appendChild(document.createTextNode(\"Database ID\"));\r\n\tth1.setAttribute(\"class\", \"terminus-db-id terminus-table-header-full-css\");\r\n\tth1.style.width = \"20%\";\r\n\tvar th2 = document.createElement(\"th\");\r\n\tth2.appendChild(document.createTextNode(\"Title\"));\r\n\tth2.setAttribute(\"class\", \"terminus-db-title terminus-table-header-full-css\");\r\n\tth2.style.width = \"30%\";\r\n\tvar th3 = document.createElement(\"th\");\r\n\tth3.appendChild(document.createTextNode(\"Description\"));\r\n\tth3.setAttribute(\"class\", \"terminus-db-description terminus-table-header-full-css\");\r\n\tth3.style.width = \"50%\";\r\n\tvar th4 = document.createElement(\"th\");\r\n\tth4.setAttribute(\"class\", \"terminus-db-size terminus-table-header-full-css\");\r\n\tth4.appendChild(document.createTextNode(\"Size\"));\r\n\tvar th5 = document.createElement(\"th\");\r\n\tth5.setAttribute(\"class\", \"terminus-db-created terminus-table-header-full-css\");\r\n\tth5.appendChild(document.createTextNode(\"Created\"));\r\n\tvar th6 = document.createElement(\"th\");\r\n\tth6.appendChild(document.createTextNode(\"Delete\"));\r\n\tth6.setAttribute(\"class\", \"terminus-db-delete terminus-table-header-full-css\");\r\n\tthr.appendChild(th1);\r\n\tthr.appendChild(th2);\r\n\tthr.appendChild(th3);\r\n\t//thr.appendChild(th4);\r\n\t//thr.appendChild(th5);\r\n\t//thr.appendChild(th6);\r\n\tthead.appendChild(thr);\r\n\tscd.appendChild(thead);\r\n\tvar tbody = document.createElement(\"tbody\");\r\n\tvar dbrecs = this.ui.client.connection.getServerDBRecords();\r\n\tfor(let fullid in dbrecs){\r\n\t\tlet dbrec = dbrecs[fullid];\r\n\t\tconst dbid = fullid.split(\":\")[1];\r\n\t\tlet tr = document.createElement(\"tr\");\r\n\t\tvar td1 = document.createElement(\"td\");\r\n\t\ttd1.appendChild(this.wrapTableLinkCell(td1,dbid, dbid));\r\n\t\ttd1.setAttribute(\"class\", \"terminus-db-id terminus-db-pointer\");\r\n\t\tvar td2 = document.createElement(\"td\");\r\n\t\ttd2.setAttribute(\"class\", \"terminus-db-title terminus-db-pointer\");\r\n\t\tvar txt = (dbrec && dbrec['rdfs:label'] && dbrec['rdfs:label']['@value'] ? dbrec['rdfs:label']['@value'] : \"\");\r\n\t\ttd2.appendChild(this.wrapTableLinkCell(td2,dbid, txt));\r\n\t\tvar td3 = document.createElement(\"td\");\r\n\t\ttd3.setAttribute(\"class\", \"terminus-db-description terminus-db-pointer\");\r\n\t\tvar txt = (dbrec && dbrec['rdfs:comment'] && dbrec['rdfs:comment']['@value'] ? dbrec['rdfs:comment']['@value'] : \"\");\r\n\t\ttd3.appendChild(this.wrapTableLinkCell(td3,dbid, txt));\r\n\t\tvar td4 = document.createElement(\"td\");\r\n\t\ttd4.setAttribute(\"class\", \"terminus-db-size terminus-db-pointer\");\r\n\t\tvar txt = (dbrec && dbrec['terminus:size'] && dbrec['terminus:size']['@value'] ? dbrec['terminus:size']['@value'] : \"\");\r\n\t\ttd4.appendChild(this.wrapTableLinkCell(td4,dbid, txt));\r\n\t\tvar td5 = document.createElement(\"td\");\r\n\t\ttd5.setAttribute(\"class\", \"terminus-db-created terminus-db-pointer\");\r\n\t\tvar txt = (dbrec && dbrec['terminus:last_updated'] && dbrec['terminus:last_updated']['@value'] ? dbrec['terminus:last_updated']['@value'] : \"\");\r\n\t\ttd5.appendChild(this.wrapTableLinkCell(td5,dbid, txt));\r\n\t\tvar td6 = document.createElement(\"td\");\r\n\t\ttd6.setAttribute(\"class\", \"db-delete\");\r\n\t\tvar delbut = this.ui.getDeleteDBButton(dbid);\r\n\t\tif(delbut) td6.appendChild(delbut);\r\n\r\n\t\ttr.appendChild(td1);\r\n\t\ttr.appendChild(td2);\r\n\t\ttr.appendChild(td3);\r\n\t\t//tr.appendChild(td4);\r\n\t\t//tr.appendChild(td5);\r\n\t\t//tr.appendChild(td6);\r\n\t\ttbody.appendChild(tr);\r\n\t}\r\n\tscd.appendChild(tbody);\r\n\tsec.appendChild(scd);\r\n\r\n\tif(this.ui.pluginAvailable(\"datatables\")){\r\n        var dt = new Datatables.CspDatatables(this.ui);\r\n\t\tvar tab = dt.draw(scd);\r\n\t}\r\n\treturn sec;\r\n}\r\n\r\n\r\nmodule.exports = {TerminusServerViewer,TerminusServerController}\r\n","const TerminusClient = require('@terminusdb/terminus-client');\r\nconst HTMLHelper = require('../html/HTMLHelper');\r\nconst UTILS= require('../Utils')\r\n\r\n/*** client side processing ***/\r\nfunction CspDatatables(ui){\r\n    this.ui = ui;\r\n}\r\n\r\nCspDatatables.prototype.convertToDatatable = function(tab){\r\n    var dt = this;\r\n    var table = jQuery(tab).DataTable({\r\n         searching : false,\r\n         pageLength: 25,\r\n         lengthMenu: [10, 25, 50, 75, 100],\r\n         paging    : true,\r\n         select    : true,\r\n         initComplete: function(settings) {\r\n                        var ict =settings.oInstance.api();\r\n                        ict.$('td').each(function(){\r\n                            this.setAttribute('title', $(this).html())\r\n                        })},\r\n         columnDefs:[{targets:'_all',className:\"truncate\"}],\r\n         createdRow: function(row) {\r\n                            var td = $(row).find(\".truncate\");\r\n                            td.attr(\"title\", td.html());}\r\n    }); //jQuery(tab)\r\n\r\n    // on click of row connect to db, on click of 5th column delete db\r\n    jQuery(tab, 'tbody').on('click', 'td', function(){\r\n        if(table.cell(this).index().column == 5){\r\n            var dbInfo = table.row(jQuery(this).parents('tr')).data();\r\n            var dbId = UTILS.extractValueFromCell(dbInfo[0]);\r\n            dt.ui.deleteDatabase(dbId);\r\n            return;\r\n        }\r\n        else dt.ui.showDBMainPage();\r\n     }); // on click\r\n\r\n    tab.setAttribute('class'      , 'stripe dataTable terminus-db-size');\r\n    tab.setAttribute('cellpadding', '1');\r\n    tab.setAttribute('cellspacing', '0');\r\n    tab.setAttribute('border'     , '0');\r\n    return tab;\r\n}\r\n\r\nCspDatatables.prototype.draw = function(dtResult){\r\n    return(this.convertToDatatable(dtResult));\r\n}\r\n\r\n/*** server side processing ***/\r\nfunction Datatables(wResViewer, qPage){\r\n   this.wrViewer = wResViewer;\r\n   this.wQuery = wResViewer.wQuery;\r\n   this.ui = wResViewer.ui;\r\n   this.qPage = qPage;\r\n   this.currDTSettings = wResViewer.settings;\r\n}\r\n\r\n/*\r\n    query: new woqlquery with current pagination changes\r\n    pageInfo: current drawCallBack page change info\r\n    resultDOM: result dom on veiwer page\r\n*/\r\nDatatables.prototype.executeQuery = function(qObj, pageInfo, resultDOM){\r\n    var self = this;\r\n    // return this.wQuery.execute(query)\r\n    return qObj.execute(this.ui.client)\r\n    .then(function(result){\r\n      var dtResult = {};\r\n      var wqRes = new TerminusClient.WOQLResult(result, qObj);\r\n      dtResult = self.wrViewer.formatResultsForDatatableDisplay(result.bindings, pageInfo)\r\n      return dtResult.data;\r\n    })\r\n    .catch(function(err){\r\n      console.error(err);\r\n      self.ui.showError(err);\r\n    });\r\n}\r\n\r\n/* get query string based on datatable pagination and current query */\r\n/*Datatables.prototype.getQueryOnPagination = function(wq, settings){\r\n    switch(settings.query){\r\n        case 'Show_All_Documents':\r\n            return wq.getAllDocumentQuery(null, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_All_Data':\r\n            return wq.getEverythingQuery(null, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_All_Schema_Elements':\r\n            return wq.getElementMetaDataQuery(null, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_Document_Classes':\r\n        \tvar sqp = wq.getConcreteDocumentClassPattern(\"Class\");\r\n            return wq.getClassMetaDataQuery(sqp);\r\n        break;\r\n        case 'Show_All_Properties':\r\n            return wq.getPropertyListQuery(null, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_All_Classes':\r\n            return wq.getClassMetaDataQuery(null, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_Data_Class':\r\n            return  wq.getDataOfChosenClassQuery(settings.chosenValue, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_Property_Class':\r\n            return wq.getDataOfChosenPropertyQuery(settings.chosenValue, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_Document_Info_by_Id':\r\n            return wq.getDocumentQuery(settings.chosenValue, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_All_Document_classes':\r\n            return wq.getClassesQuery(settings.pageLength, settings.start);\r\n        break;\r\n        default:\r\n            console.log('Invalid woql option passed');\r\n        break;\r\n\r\n    }\r\n}   */\r\n/*\r\n    pageInfo: current drawCallBack page change info\r\n*/\r\nDatatables.prototype.generateNewQueryOnPageChange = function(pageInfo){\r\n    if(this.qPage) UTILS.deleteStylizedEditor(this.ui, pageInfo.qTextDom);\r\n    var qObj = UTILS.getCurrentWoqlQueryObject(null, pageInfo);\r\n    //var query = this.getQueryOnPagination(this.wQuery, pageInfo)\r\n    if(this.qPage) {\r\n        if(pageInfo.queryMode.value == 'woql')\r\n            pageInfo.qTextDom.value = JSON.stringify(qObj.prettyPrint(), undefined, 2);\r\n        else pageInfo.qTextDom.value = JSON.stringify(qObj, undefined, 2);\r\n        UTILS.stylizeEditor(this.ui, pageInfo.qTextDom, 'query', 'javascript');\r\n    }\r\n    //return query;\r\n    return qObj;\r\n}\r\n\r\n/*\r\n    dt: Datatable reference\r\n    len : current number of records to display\r\n*/\r\nDatatables.prototype.getCallbackSettings = function(dt, dtAPIChangeSettings){\r\n    var pageInfo = {};\r\n    pageInfo.pageLength  = dtAPIChangeSettings._iDisplayLength;\r\n    pageInfo.start       = dtAPIChangeSettings._iDisplayStart;\r\n    pageInfo.draw        = dtAPIChangeSettings.iDraw;\r\n    pageInfo.qTextDom    = dt.qTextDom;\r\n    pageInfo.queryMode   = dt.queryMode;\r\n    if(this.qPage) pageInfo.query = dt.query;\r\n    else pageInfo.query = 'Show_All_Document_classes';\r\n    pageInfo.chosenValue = dt.chosenValue;\r\n    return pageInfo;\r\n}\r\n\r\n/*\r\n    tab: datatable table dom\r\n    settings : settings from woql txt generator\r\n    resultDOM: result dom of viewer\r\n*/\r\nDatatables.prototype.setUp = function(tab, settings, resultDOM){\r\n    // delete previous datatable\r\n    HTMLHelper.removeChildren(this.dtdom);\r\n    this.dtdom = document.createElement('div');\r\n    this.dtdom.appendChild(tab);\r\n    resultDOM.appendChild(this.dtdom);\r\n    // saving query text box dom to change limit value on change of datatable page length\r\n    this.qTextDom = settings.qTextDom;\r\n    this.query = settings.query;\r\n    this.chosenValue = settings.chosenValue;\r\n    this.queryMode = settings.queryMode;\r\n}\r\n\r\n// update datatables settings so it can be reused in WOQLTextboxGenerator to re write query in woql/ jsonld\r\nDatatables.prototype.updateCurrDTSettings = function(pageInfo){\r\n    this.currDTSettings.pageLength = pageInfo.pageLength;\r\n    this.currDTSettings.start      = pageInfo.start;\r\n}\r\n\r\nDatatables.prototype.getNewDataOnChange = function(drawnTab, aSettings, resultDOM){\r\n    var pageInfo = this.getCallbackSettings(this, aSettings);\r\n    this.updateCurrDTSettings(pageInfo);\r\n   // var query = this.generateNewQueryOnPageChange(pageInfo);\r\n    var qObj = this.generateNewQueryOnPageChange(pageInfo);\r\n    return this.executeQuery(qObj, pageInfo, resultDOM);\r\n    //return this.executeQuery(query, pageInfo, resultDOM);\r\n    //return  dtResult.result.data;\r\n}\r\n\r\nDatatables.prototype.getDataFromServer = function(dtResult, resultDOM){\r\n    var dt = this;\r\n    var tab = dtResult.tab;\r\n    this.setUp(tab, this.wrViewer.settings, resultDOM);\r\n    // initialize datatables\r\n    var table = jQuery(tab).DataTable({\r\n         searching   : false,\r\n         pageLength  : dt.wrViewer.settings.pageLength,\r\n         serverSide  : true,\r\n         processing  : true,\r\n         lengthMenu  : [25, 50, 75, 100],\r\n         dom         : 'RBlftip',\r\n         columns     : dtResult.result.columns,\r\n         paging      : true,\r\n         select      : true,\r\n         autoWidth   : true,\r\n         ajax        : function (data, callback, settings) {\r\n                            if(Object.entries(dtResult.result.data).length > 0){\r\n                                // first draw is loaded\r\n                                var res = dtResult.result.data;\r\n                                dtResult.result.data = {};\r\n                                callback(res);\r\n                            }\r\n                            else{\r\n                                dt.getNewDataOnChange(this, settings, resultDOM)\r\n                                    .then(function(result){\r\n                                     callback(result);\r\n                                })\r\n                            }\r\n                       },\r\n         buttons     : [{ extend: 'copy', text: 'Copy to clipboard' },\r\n                        { extend: 'excel', text: 'Export to Excel' }],\r\n         columnDefs  : [{ targets:'_all',\r\n                          className:\"truncate\"}],\r\n         createdRow  : function(row){\r\n                            var td = $(row).find(\".truncate\");\r\n                            td.attr(\"title\", td.html());},\r\n         scrollX     : true\r\n    }); //jQuery(tab)\r\n\r\n    // on click of doc\r\n    jQuery(tab, 'tbody').on('click', 'td', function(){\r\n        if(table.cell(this).data){\r\n            if(this.innerText.substring(0, 4) == \"doc:\"){\r\n                if(dt.wrViewer.result.ui) {\r\n        \t\t\tdt.wrViewer.result.ui.showDocument(this.innerText);\r\n        \t\t\tdt.wrViewer.result.ui.redraw();\r\n        \t\t\tdt.wrViewer.selectDocumentNavBar(dt.ui);\r\n        \t\t}\r\n            }\r\n        }\r\n     }); // on click\r\n\r\n    //styling\r\n    tab.setAttribute('class'      , 'stripe dataTable');\r\n    tab.setAttribute('style'      , 'margin: 0!important');\r\n    tab.setAttribute('cellpadding', '1');\r\n    tab.setAttribute('cellspacing', '1');\r\n    tab.setAttribute('border'     , '0');\r\n\r\n    return tab;\r\n}\r\n\r\n/*\r\nserverside: true or false\r\n*/\r\nDatatables.prototype.draw = function(dtResult, resultDOM){\r\n    return(this.getDataFromServer(dtResult, resultDOM));\r\n}\r\n\r\nmodule.exports={Datatables, CspDatatables}\r\n","const UTILS = require(\"./Utils.js\");\r\n\r\nfunction TerminusURLLoader(ui, val){\r\n\tthis.ui = ui;\r\n\tthis.val = val;\r\n\tthis.url_input = false;\r\n\tthis.key_input = false;\r\n}\r\n\r\nTerminusURLLoader.prototype.getLabelDOM = function(){\r\n\treturn document.createTextNode(\"Connect\");\r\n}\r\n\r\nTerminusURLLoader.prototype.getFormFieldDOM = function(ip, fname, ltxt, pholder){\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-horizontal terminus-control-group terminus-form-field-spacing terminus-display-flex terminus-field-\"+fname);\r\n\tvar lab = document.createElement(\"span\");\r\n\tlab.setAttribute(\"class\", \"terminus-control-label terminus-form-label terminus-form-field-label terminus-label-\"+fname);\r\n\tlab.appendChild(document.createTextNode(ltxt))\r\n\tip.setAttribute(\"type\", \"text\");\r\n\tip.setAttribute(\"placeholder\", pholder);\r\n\tsci.appendChild(lab);\r\n\tsci.appendChild(ip);\r\n\treturn sci;\r\n}\r\n\r\nTerminusURLLoader.prototype.getAsDOM = function(){\r\n\tvar scd = document.createElement(\"div\");\r\n\tscd.setAttribute(\"class\", \"terminus-form terminus-url-loader\");\r\n\tscd.appendChild(UTILS.getHeaderDom('Connect To Terminus Server'));\r\n\tvar mfd = document.createElement('div');\r\n\tmfd.setAttribute('class', 'terminus-form-border terminus-margin-top');\r\n\tscd.appendChild(mfd);\r\n\tthis.url_input = document.createElement(\"input\");\r\n\tthis.url_input.setAttribute(\"class\", \"terminus-form-value terminus-form-url terminus-form-field-input terminus-input-text\");\r\n\tif(this.val){\r\n\t\tthis.url_input.value = this.val;\r\n\t}\r\n\tvar dht = document.createElement('div');\r\n\tdht.setAttribute('class', 'terminus-form-margin-top');\r\n\tmfd.appendChild(dht);\r\n\tmfd.appendChild(this.getFormFieldDOM(this.url_input, \"connect\", \"URL\", \"Terminus DB URL\"));\r\n\tthis.key_input = document.createElement(\"input\");\r\n\tthis.key_input.setAttribute(\"class\", \"terminus-form-value terminus-value terminus-input-text\");\r\n\tmfd.appendChild(this.getFormFieldDOM(this.key_input, \"connect\", \"Key\", \"Server API Key\"));\r\n\tvar loadbuts = document.createElement(\"div\");\r\n\tloadbuts.setAttribute(\"class\", \"terminus-control-buttons\");\r\n\tvar loadbut = document.createElement(\"button\");\r\n\tloadbut.setAttribute(\"class\", \"terminus-control-button terminus-url-load terminus-btn terminus-btn-float-right\");\r\n\tloadbut.appendChild(document.createTextNode(\"Connect\"));\r\n\tvar self = this;\r\n\tloadbut.addEventListener(\"click\", function(){\r\n\t\tif(self.url_input.value){\r\n\t\t\tself.ui.load(self.url_input.value, self.key_input.value);\r\n\t\t}\r\n\t});\r\n\tloadbuts.appendChild(loadbut);\r\n\tmfd.appendChild(loadbuts);\r\n\treturn scd;\r\n}\r\n\r\n\r\nmodule.exports=TerminusURLLoader\r\n"],"sourceRoot":""}
{"version":3,"sources":["webpack://TerminusDashboard/webpack/bootstrap","webpack://TerminusDashboard/./src/query/WOQLQuery.js","webpack://TerminusDashboard/./src/Utils.js","webpack://TerminusDashboard/./src/plugins/TerminusPlugin.js","webpack://TerminusDashboard/./src/query/WOQLResultsViewer.js","webpack://TerminusDashboard/./src/client/RenderingMap.js","webpack://TerminusDashboard/./src/client/HTMLFrameHelper.js","webpack://TerminusDashboard/./src/client/TerminusClassChooser.js","webpack://TerminusDashboard/./src/client/TerminusDocument.js","webpack://TerminusDashboard/./src/plugins/datatables.terminus.js","webpack://TerminusDashboard/./src/client/ObjectViewer.js","webpack://TerminusDashboard/./src/client/viewers/String.js","webpack://TerminusDashboard/./src/client/viewers/DateHelper.js","webpack://TerminusDashboard/./src/client/PropertyViewer.js","webpack://TerminusDashboard/./src/client/DataViewer.js","webpack://TerminusDashboard/./src/client/TerminusDocumentChooser.js","webpack://TerminusDashboard/./src/index.js","webpack://TerminusDashboard/./src/TerminusUI.js","webpack://TerminusDashboard/./src/ApiExplorer.js","webpack://TerminusDashboard/./src/plugins/codemirror.terminus.js","webpack://TerminusDashboard/./src/client/ObjectRenderer.js","webpack://TerminusDashboard/./src/client/viewers/StringEditor.js","webpack://TerminusDashboard/./src/client/viewers/Boolean.js","webpack://TerminusDashboard/./src/client/viewers/BooleanEditor.js","webpack://TerminusDashboard/./src/client/viewers/Choice.js","webpack://TerminusDashboard/./src/client/viewers/ChoiceEditor.js","webpack://TerminusDashboard/./src/client/viewers/Coordinate.js","webpack://TerminusDashboard/./src/client/viewers/CoordinateEditor.js","webpack://TerminusDashboard/./src/client/viewers/Date.js","webpack://TerminusDashboard/./src/client/viewers/DateEditor.js","webpack://TerminusDashboard/./src/client/viewers/Entity.js","webpack://TerminusDashboard/./src/client/viewers/EntityEditor.js","webpack://TerminusDashboard/./src/client/viewers/Image.js","webpack://TerminusDashboard/./src/client/viewers/ImageEditor.js","webpack://TerminusDashboard/./src/client/viewers/Link.js","webpack://TerminusDashboard/./src/client/viewers/Number.js","webpack://TerminusDashboard/./src/client/viewers/Range.js","webpack://TerminusDashboard/./src/client/viewers/RangeEditor.js","webpack://TerminusDashboard/./src/client/viewers/SanitizedHTML.js","webpack://TerminusDashboard/./src/client/ValueRenderer.js","webpack://TerminusDashboard/./src/client/TerminusDB.js","webpack://TerminusDashboard/./src/client/TerminusViolation.js","webpack://TerminusDashboard/./src/client/TerminusQuery.js","webpack://TerminusDashboard/./src/query/WOQLTextboxGenerator.js","webpack://TerminusDashboard/./src/client/TerminusPropertyChooser.js","webpack://TerminusDashboard/./src/query/WOQLGraphBrowserGenerator.js","webpack://TerminusDashboard/./src/query/WOQLTimePicker.js","webpack://TerminusDashboard/./src/client/TerminusMapping.js","webpack://TerminusDashboard/./src/client/TerminusSchema.js","webpack://TerminusDashboard/./src/client/TerminusServer.js","webpack://TerminusDashboard/./src/client/TerminusURL.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","WOQLResult","require","WOQLQuery","client","options","ui","this","default_limit","prefixes","connectionConfig","platformEndpoint","sid","server","substring","lastIndexOf","colid","dbid","serverURL","schemaURL","dbURL","docURL","pref","TerminusClient","FrameHelper","standard_urls","setPrefixes","shorten","url","length","execute","woql","wrapped","wrap","self","select","then","response","getConcreteDocumentClassPattern","varc","and","getSubclassQueryPattern","not","getAbstractQueryPattern","varname","quad","clsname","sub","queryWrappedWithLimit","query","limit","start","getAllDocumentQuery","constraint","triple","push","getEverythingQuery","wjson","getPropertyListQuery","opt","getElementMetaDataQuery","getClassListMetaDataQuery","getClassMetaDataQuery","getDataOfChosenClassQuery","chosen","getDataOfChosenPropertyQuery","getInstanceMeta","getDocumentQuery","id","getClassesQuery","Codemirror","getHeaderDom","text","hd","document","createElement","setAttribute","h","innerHTML","appendChild","stylizeCodeDisplay","txt","dom","cmConfig","pluginAvailable","pr","colorizePre","removeSelectedNavClass","el","getElementsByClassName","classList","remove","hideDocumentSubMenus","contains","add","tolggleContent","icon","content","style","display","stylizeEditor","view","cm","ar","colorizeTextArea","updateTextArea","deleteStylizedEditor","qip","nextElementSibling","removeChildren","showHttpResult","action","currForm","terminator","br","retHttpHeaders","headers","hdres","createTextNode","json","rd","data","JSON","stringify","pre","getResponse","getInfoAlertDom","type","label","msg","ald","str","getFunctionSignature","which","sigs","spec","descr","result","args","server_url","title","description","database_url","details","format","editmode","document_url","fail_on_id_denied","class","term","source","target","toggleVisibility","extractValueFromCell","cellValue","DOMParser","parseFromString","firstChild","activateSelectedNav","nav","showControl","checkDocumentSubMenus","TerminusPluginManager","preloaded","loaded","loading","precluded","plugins","css","js","plugin","requires","setPluginOptions","opts","k","init","calculatePreloaded","toload","calculateRequiredInitPlugins","loadPlugins","pins","pid","indexOf","getDefaultPlugins","needed_pins","loading_order","getAvailablePlugins","pl","version_check","pluginmeta","version","jQuery","isFunction","fn","slider","Quill","JSONEditor","CodeMirror","fontAwesomeCheck","dataTable","select2","google","maps","ol","Map","d3","console","log","Error","element","span","className","body","insertBefore","window","getComputedStyle","getPropertyValue","replace","removeChild","ticker","cback","loadPlugin","pug","cssid","loadDynamicCSS","scripts","splice","loadDynamicScript","loadPluginScripts","loadPageCSS","cssfid","cssdom","getElementById","parentNode","cssurl","pluginLoadable","pluginLoadedOrLoading","disabled","obj","getPluginDOM","plugid","a","cl","cbox","checked","clab","addEventListener","togglePlugin","redraw","unloadPlugin","drawPlugins","num","getAsDOM","dm","clh","showPlugins","Datatables","res","bindings","WOQLResultsViewer","wresult","settings","pman","count","hasBindings","showTable","show_table","orderColumns","sample","ordered","unshift","resultDOM","displayResultHeader","rs","rh","getTableDOM","dtResult","getTable","tab","draw","formatResultsForDatatableDisplay","columns","colDataData","formattedResult","ordered_headings","validURL","labelFromURL","j","lab","getDocumentLocalLink","recordsTotal","recordsFiltered","getTableBody","tbody","tr","td","showDocument","dtPlugin","thead","thr","th","ObjectViewer","HTMLStringViewer","HTMLStringEditor","HTMLBooleanViewer","HTMLBooleanEditor","HTMLChoiceViewer","HTMLChoiceEditor","HTMLCoordinateViewer","HTMLCoordinateEditor","HTMLDateViewer","HTMLDateEditor","HTMLEntityViewer","HTMLEntityEditor","HTMLImageViewer","HTMLImageEditor","HTMLLinkViewer","HTMLNumberViewer","HTMLRangeViewer","HTMLRangeEditor","SantizedHTMLViewer","RenderingMap","registeredDataViewers","registeredDataEditors","registeredPropertyViewers","registeredPropertyEditors","registeredObjectViewers","registeredObjectEditors","getValidDataViewerList","frametype","valids","concat","getValidDataEditorList","nftypes","getValidPropertyViewerList","proptype","proprange","propdom","getValidPropertyEditorList","getViewer","vi","renderers","viewer","eval","e","alert","toString","getAvailablePropertyViewers","renderer","viewers","nviewers","sets","getAvailablePropertyEditors","getAvailableDataViewers","getAvailableDataEditors","getViewerForDataFrame","vals","getEditorForDataFrame","registerViewerForTypes","types","registerEditorForTypes","registerEditorForFrameType","registerViewerForFrameType","registerViewerForProperties","properties","registerEditorForProperties","HTMLPropertyViewer","patternMatchesRenderer","pattern","FramePattern","checkRenderer","compiled_options","compileOptions","parent","facets","getDefaultFacets","facet","deffacet","getDefaultFacet","hide_disabled_buttons","features","controls","viewerType","viewerOptions","header","header_viewer","HTMLObjectHeaderViewer","filter","sort","rules","output","frame_type","subject","subjectClass","range","children","depth","index","status","rtype","getRendererType","illegalRuleType","checkFrameType","checkLabel","checkSubject","checkSubjectClass","checkProperty","checkDepth","checkRange","checkValue","checkParent","checkChildren","checkIndex","checkStatus","rsubj","IDsMatch","found","prop","values","isUpdated","isNew","numberMatch","propertyIDsMatch","valuesMatch","rangeIDsMatch","rcls","classIDsMatch","frame","ftype","renderder","getLabel","stringMatch","ida","idb","compareIDs","vala","valb","RegExp","test","constructor","renderer_type","HTMLFrameHelper","control","callback","dpropDOM","button","selected","sel","viewsDOM","setMode","getActionControl","cancel","location","href","loc","split","sh","getShorthand","bits","htmlid","help","input","infoDOM","linfo","lspacer","lval","TerminusClassChooser","choice","show_single","setRoot","root","setFilter","change","cls","ccdom","ccsel","wq","getResultsAsOptions","clist","choices","empty_choice","opt1","added","bclass","getVariableValueFromBinding","Renderers","TerminusDocumentViewer","db","editor","load_schema","config_options","getBuiltInViewerOptions","classmeta","instancemeta","Class","refreshPage","elid","getClassMeta","loadCreateDocument","showBusy","page_config","loadDocumentSchema","clearBusy","setLabel","error","showError","loadDocument","getDocument","loadDataFrames","ncls","unshorten","getClassFrame","loadSchemaFrames","deleteDocument","URL","createDocument","extr","extract","updateDocument","durl","subjid","dataframes","domain","ObjectFrame","classframes","loadClassFrames","newDoc","fillFromSchema","render","getOptionsFromPageConfig","ObjectRenderer","controller","FrameConfig","pageconf","getClient","docid","labdom","dfs","getDataFrames","getStdURL","pagedom","rends","holder","controldom","getDocumentPageControls","dpc","UTILS","convertToDatatable","table","DataTable","searching","pageLength","lengthMenu","paging","columnDefs","targets","createdRow","row","$","find","attr","html","on","cell","column","showDBMainPage","dbInfo","parents","dbId","deleteDatabase","executeQuery","dcb","dt","pageInfo","wquery","rtab","getDataFromServer","err","getQueryOnPagination","sqp","chosenValue","generateNewQueryOnPageChange","qTextDom","getCallbackSettings","len","setUp","dtdom","serverSide","processing","ajax","buttons","extend","colReorder","addFixed","liveDrag","scrollX","drawCallback","info","page","serverside","HTMLObjectViewer","headerViewer","getObjectHeaderViewer","renderedDOM","getObjectDOM","replaceWith","getObjectIDMarker","getObjectBodyDOM","orientation","getContentOrientation","pcls","sp","vholder","getFeatureDOM","feature","hasFeatureViewer","featureViewer","redrawHeader","nheader","redrawBody","nbody","addRenderedProperty","renderedprop","clear","goTo","subj","goToName","idm","sumDOM","controlsDOM","objDOM","showFeature","facetDOM","getObjectFacetDOM","getObjectLabelDOM","idDOM","getObjectIDDOM","typeDOM","getObjectTypeDOM","getObjectStatusDOM","viewDOM","getViewPropertyDOM","hideDOM","getViewerSelectorDOM","getObjectControlsDOM","getObjectSummaryDOM","sum","getSummary","getInfoboxDOM","addDOM","getAddPropertyDOM","getModeSelectorDOM","getObjectDeleteDOM","cpropDOM","getObjectCloneDOM","rpropDOM","getObjectResetDOM","upropDOM","getObjectUpdateDOM","showDOM","getObjectShowDOM","getObjectHideDOM","viewables","getAvailableFacets","mpropDOM","getSelectionControl","currentFacet","val","setFacet","isNewDocument","isClassChoice","cs","getAvailableClassChoices","mlabDOM","changeClass","cmt","Label","Comment","addables","getAddableProperties","cardControlAllows","addNewProperty","getViewableProperties","goToProperty","clone","reset","getAvailableViewers","currentViewer","setViewer","hide","show","save","size","getDOM","dataviewer","HTMLDateHelper","months","getMonthName","getPropertyHeaderViewer","HTMLPropertyHeaderViewer","block","propDOM","npropDOM","getPropertyDOM","getPropertyIDMarker","getPropertyBodyDOM","addRenderedValue","renderedval","wrapper","expModeMenu","getPropertyControlsDOM","getPropertyLabelDOM","statDOM","getPropertyStatusDOM","prepend","getPropertySummaryDOM","prelude","getPropertyFacetDOM","getViewValueDOM","getPropertyIDDOM","getPropertyRangeDOM","hasCardinalityRestriction","getPropertyCardinalityDOM","getPropertyCommentDOM","getComment","restriction","getRestriction","min","max","getActionControlDOM","settingsDOM","getPropertyDeleteDOM","getAddValueDOM","getPropertyResetDOM","getPropertyUpdateDOM","getPropertyShowDOM","getPropertyHideDOM","getSettingsControlDOM","addClass","getViewableValues","goToValue","showValue","HTMLDataViewer","getValueHeaderViewer","HTMLDataHeaderViewer","JSONObjectViewer","valDOM","nvalDOM","getValueDOM","getValueIDMarker","getValueBodyDOM","vdom","getDataValueViewer","getSummaryDOM","HTMLTerminusClient","internalLink","link","onclick","preventDefault","load","onClick","getValueFacetDOM","getValueTypeDOM","getValueStatusDOM","getValueControlsDOM","getValueDeleteDOM","getValueCloneDOM","getValueResetDOM","getValueUpdateDOM","getValueShowDOM","getValueHideDOM","TerminusDocumentChooser","show_button","getS2DOM","getIDDOM","docchooser","cfilter","termcc","new_class","tdom","s2config","dataType","params","contentType","delay","cache","placeholder","width","dcip","keyCode","dbut","toggleView","getChangeViewText","TerminusUI","TerminusConfig","pconfig","messages","explorer","nlocation","ApiExplorer","TerminusDBsdk","TerminusViolations","TerminusQueryViewer","TerminusMappingViewer","TerminusSchemaViewer","TerminusServersdk","TerminusURLLoader","WOQLClient","setOptions","connect","getDBRecord","connectToDB","showView","schema","showSchemaPage","showQueryPage","showExplorer","showServerMainPage","createDatabase","dbdets","Promise","reject","getBadArguments","myserver","dbdoc","generateNewDatabaseDocument","getSchema","updateSchema","refreshDBList","crec","connection","getCrashString","showMessage","delrec","lid","dbn","removeDB","dets","doc","rdfs","terminus","fname","getConnectionEndpoint","clearServer","clearDB","removeDBFromConnection","TerminusServerViewer","redrawMainPage","showLoadURLPage","TerminusDBViewer","showCreateDBPage","TerminusDBCreator","showMappingPage","mapping","getDocViewerOptions","showCreateDocument","getDocCreatorOptions","main","showResult","clearMessages","clearMainPage","setMessageDOM","setbuttonControls","setControllerDOM","setExplorerDOM","setPluginsDOM","setViewerDOM","comps","slocation","drawControls","toggleControl","toggleDashboardWidget","widget","drawExplorer","loadControls","ncontrol","nd","exp","ae","sc","TerminusServerController","TerminusDBController","show_controls","pseudoCapability","capabilitiesPermit","show_views","busy","getBusyLoader","bsyDom","pd","pbc","pbsa","pbia","md","msgHolder","showViolations","vios","nvios","cmsg","views","document_options","schema_options","piman","getClassFrameOptions","viewdoc_options","apiNavConfig","mainNav","navText","defaultSelected","database","subNav","getClassFrames","viewDocument","update","use_fetch","return_full_response","aec","getApiNav","getApiExplorerDom","setSelectedNavMenu","setSelectedSubMenu","navOnSelect","createNavs","navConfig","ul","navDom","cont","api","apiCont","getConnectExplorer","getDatabaseExplorer","getSchemaApi","getDocumentApi","getQueryApi","changeSubApiDom","curSubMenu","getDatabaseDom","getShowApiDom","getQueryApiDom","subNavOnSelect","subMenuConfig","createSubNavs","b","getSignature","getForm","getServerForm","form","fd","inpLabel","cd","inpId","keyLabel","resd","gatherips","curApi","urlPlaceholder","formDoc","urlLabel","inpUrl","docUrlLabel","inpDocUrl","encLabel","inpEnc","optTurt","optJld","inpKey","docLabel","inpDoc","inp","docUrl","enc","getApiSendButton","getApiForm","schurl","buttonSelf","connected_mode","gtxtar","txtar","dcurl","schemaUrlDom","payload","htmlEditor","getValue","parse","sg","ic","sig","config","textdom","darkMode","jsonldCheck","fromTextArea","firstLineNumber","lineNumbers","styleActiveLine","lineWrapping","smartIndent","indentWithTabs","newlineAndIndent","autoCloseBrackets","matchBrackets","afterCursor","extraKeys","refresh","setCodemirrorSize","defaultCharWidth","setOption","setSize","setTimeout","runMode","innerText","theme","ValueRenderer","PropertyViewer","PropertyRenderer","predicate","cframe","objframe","getPropertyClassFrame","originalValues","changed","originalProperties","newProperties","TerminusDashboard","decorateRenderer","getOptionsForChild","getOptionsForValue","df","getOptionsForObject","x","buildValueRenderers","getViewerForProperty","adorig","isData","getDataFramesToRender","vr","kids","getChildrenToRender","kidf","viewIncludesChildren","allkids","getChildren","extracts","updated","childUpdated","hasRestriction","cf","getClassChoices","clsmeta","deleteProperty","addProperty","setNew","addPropertyClass","newb","nvals","deletePropertyValue","removePropertyValue","addPropertyValue","rest","currentnum","new_property","hideDisabledControls","hide_disabled_controls","nocascade","parentFacetChange","multiline","line","summary","containsPage","isObject","setView","nukeViewer","ptype","ret","valcount","vsum","getFeaturesForFacet","getOptionsForProperty","buildPropertyRenderers","getViewerForObject","props","getPropertiesToRender","renders","parentObject","copy","nkid","genBNID","parentobj","newrend","demandid","inputID","dval","nprops","removeProperty","ctl","getController","new_object","isPartOfNewDocument","isnew","keys","pfacet","vrend","ty","propcount","nviewer","getFilledPropertyList","getMissingPropertyList","standardSort","map","patterns","sorted","rdft","rdfc","extractLDO","full","extractJSONLD","jsonld_context","extracted","empty","big","isBigType","getTypeSize","set","vallab","els","elements","foptions","getChoiceOptions","inputs","parsed","badData","lldom","getInputDOMs","lat","long","latdom","longdom","getLatLongDOM","firstcol","delbut","updateValueFromForm","op","lldoms","butspan","addbut","ipdoms","DateHelper","allowbce","date_spacer","time_spacer","datetime_separator","helper","parseDate","datepart","getDateComponentDOM","timepart","getTimeComponentDOM","hdom","hour","mdom","minute","mlab","sdom","second","slab","tz","timezone","dadom","ydom","year","month","ddom","day","part","xsd","xsdFromParsed","opdom","getEntityViewHTML","getEntityLabel","dv","nspan","InstanceLabel","tit","InstanceType","InstanceComment","img","commas","numberWithCommas","delimiter","parseRangeValue","rvals","svals","tnode","getRangeSymbolDOM","x2","t2node","data1","data2","firstip","secondip","showing_range","but","changeHandler","dataframe","originalValue","isDocument","nf","nvr","inline","getAPIURL","DBURL","getEntityReference","entities","bd","new_value","text_summary_length","v","nrend","getViewerForValue","isDatatypeProperty","objlit","isString","lang","isChoice","getViewerForDataValue","getTypeShorthand","ft","dbc","scd","dbrec","nm","item","getControlHTML","displayDocumentSubMenus","getDocumentChooserDOM","getDocumentCreatorDOM","showSubMenus","gd","nbut","mcls","d2ch","nlab","click","nbuts","tcdom","gb","bi","bt","nlabs","ccDOM","sth","banner","dhp","scs","getDeleteOnHomePage","getDBSummary","getClassesDOM","getDbInfoBox","charAt","toUpperCase","slice","del","q","sct","mfd","sci","idip","titip","descip","schem","datip","butfield","cancbut","loadbut","TerminusViolation","vio","context_msg","getPropertyAsDOM","pdom","ldom","WOQLTextboxGenerator","WOQLGraphBrowserGenerator","meta","generator","gentype","generators","gbrowse","loadGenerator","hasGeneratorOptions","changeGenerator","ng","redrawGenerator","inputDOM","getQueryButtonsDOM","nquery","Element","getResultViewDom","qbox","getQueryCreatorChoiceDOM","qtHolder","qTextBox","getQueryTextAreaDOM","buttonsDOM","qcc","gen","box","TerminusPropertyChooser","tq","qman","datatable","gatherDatatableSettings","txtArea","queryName","getQueryButtonGroups","qGroupQueries","qrow","g","srcElement","textContent","nodeName","qeb","ch","setDatatableSettings","eqh","qbut","qval","qbuts","qexs","qh","qcGroup","nqbut","aqbut","qvalue","ebut","pbut","prbut","qdGroup","termpc","qdocGroup","docch","docdom","d2dom","clGroup","dtGroup","docGroup","cprop","Property","WOQLTimePicker","DCOGBrowser","model","myowner","default_viewport","current_viewport","viewports","viewportDOMs","browserid","randomString","query_timeslice","current_result","focus_node","show_filter","entity_count","default_display","icon_unicode","color","forward","backward","getSliderDOM","DCOGQueryFilter","DCOGTimePicker","getViewportAsDOM","vpdom","newQuery","success","getQuery","setBusy","untell","DCOGQueryResult","containsData","setViewportData","node","getNodeOrFringe","from_node","nodeCount","fillInfoBoxes","nodeSelected","rebuildController","tellUser","moreResults","nfocus","addMoreResults","updateViewportData","showBusyOverlay","insert_patterns","browser","dqr","qstruct","to_node","source_node","target_node","current_relationships","relationships","current_depth","max_path_length","current_threshold","filters","shareholding_threshold","server_side","timeslice","date","wake","initData","qstr","groupID","initDOM","setData","updateData","setViewportFilter","sections","getNodeInfoSections","followNode","setFocusNode","setPathSearch","node_from","node_to","changeTimeSlice","valto","force","isTemporalSuperset","setFilterTimeslice","setQueryTimeslice","getTimeslice","getControllerAsDOM","cdom","getControllerViewButtonsAsDOM","toolboxDOM","getUserToolboxDOM","filterDOM","legendDOM","getControllerFilterAsDOM","fdom","getRelationshipFilterAsDOM","ndom","getQueryParameterDOM","ipfield","getSliderTypeDOM","gobut","toggleFilterVisibility","getLegendAsDOM","userMessageDOM","msgdom","dlc","bdoms","bdom","legend","getNodeRelativeSize","nconf","getNodeDisplaySettings","getLineWidth","getModelElementDisplaySettings","elt","modeldisplay","isBidirectional","edge","typeID","conf","getRelationshipClass","nick","getGraphElementDisplaySettings","nds","getLinkDisplaySettings","getElementIcon","getClassIcon","getElementIconUnicode","getElementColour","setUpIPGSpecials","reldisptypes","entdisptypes","rid","disptype","eid","slidertype","from","to","ss","years","toggleServerSideFiltering","getSliderParameters","end","pointInit","slide","event","tt","tickToTime","rangeInit","val2","noshow","showCurrentPick","ticknum","nval","seconds_ago","Date","getTime","timeToTick","timeval","y","getFullYear","thisy","changeSliderType","ntype","updateSliderDOM","dcd","cb","lb","slideDOM","TopAxisDOM","curdate","cursdate","curedate","LabelDOM","PayloadDOM","L2DOM","getSliderAxisDOM","sconfig","getTimesliceAsTicks","vtf","vtt","fy","adjustOffset","tval","tick","unit","offsetWidth","off","sd","Y2Time","tsel","o1","o2","ff","getFormFieldDOM","getFormField","queries","submit","jsonip","map_source","map_target","confirm_before_update","loadSchema","msgtype","resetControlDOM","getSchemaSaveButtons","getSchemaImportActionButtons","getShowSchemaButton","getClassFrameChooser","getSchemaEditButton","getImportButton","getFormatChoices","fc","tc","tj","refreshMainPage","getSchemaViewDOM","getSchemaEditDOM","getSchemaImportDOM","getClassFrameDOM","ssb","getCancelButton","getSaveButton","getImportSaveButton","getSchemaButton","getImportPreviewButton","doImport","schema_edit_dom","func","newschema","appendSchema","showConfirmPage","s2","nschema","np","docviewer","ipval","klab","modes","overwrite","append","rsc","getServerLabelDOM","srec","getServerRecord","desc","csbut","crbut","getDBListDOM","getServerDetailsDOM","scl","wrapTableLinkCell","sec","lihed","th1","th2","th3","th4","th5","th6","dbrecs","getServerDBRecords","fullid","td1","td2","td3","td4","td5","td6","deleteDBPermitted","delDB","url_input","key_input","getLabelDOM","ip","ltxt","pholder","stit","loadbuts"],"mappings":"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","file":"terminus-dashboard.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 15);\n","const WOQLResult = require('./WOQLResultsViewer');\r\n\r\nfunction WOQLQuery(client, options, ui){\r\n\tthis.client = client;\r\n\tthis.options = options;\r\n\tthis.ui = ui;\r\n\tthis.default_limit = 1000;\r\n\tthis.prefixes = {};\r\n\tif(client.connectionConfig.platformEndpoint()){\r\n\t\tvar sid = client.connectionConfig.server.substring(0, client.connectionConfig.server.lastIndexOf(\"platform\"));\r\n\t\tthis.sid = sid;\r\n\t\tvar colid = client.connectionConfig.server.substring(0, client.connectionConfig.server.lastIndexOf(\"platform\")) + client.connectionConfig.dbid;\r\n\t\tthis.prefixes['s'] = colid + \"/ontology/main#\";\r\n\t\tthis.prefixes['g'] = sid;\r\n\t\tthis.prefixes['db'] = colid + \"/\";\r\n\t\tthis.prefixes['doc'] = colid + \"/candidate/\";\r\n\t\tthis.prefixes['dg'] = colid + \"/graph/main/\";\r\n\t}\r\n\telse {\r\n\t\tthis.sid = client.connectionConfig.serverURL();\r\n\t\tthis.prefixes['s'] = client.connectionConfig.schemaURL() + \"#\";\r\n\t\tthis.prefixes['dg'] = client.connectionConfig.dbURL() + \"/schema\";\r\n\t\tthis.prefixes['doc'] = client.connectionConfig.docURL();\r\n\t\tthis.prefixes['db'] = client.connectionConfig.dbURL() + \"/\";\r\n\t\tthis.prefixes['g'] = client.connectionConfig.serverURL();\r\n\t}\r\n\tfor(var pref in TerminusClient.FrameHelper.standard_urls){\r\n\t\tthis.prefixes[pref] = TerminusClient.FrameHelper.standard_urls[pref];\r\n\t}\r\n}\r\n\r\nWOQLQuery.prototype.setPrefixes = function(prefixes){\r\n\tthis.prefixes = prefixes;\r\n}\r\n\r\n\r\nWOQLQuery.prototype.shorten = function(url){\r\n\tfor(var pref in this.prefixes){\r\n\t\tif(this.prefixes[pref] == url.substring(0, this.prefixes[pref].length)){\r\n\t\t\treturn ( pref + \":\" + url.substring(this.prefixes[pref].length));\r\n\t\t}\r\n\t}\r\n\treturn url;\r\n}\r\n\r\nWOQLQuery.prototype.execute = function(woql){\r\n\tvar wrapped = this.wrap(woql);\r\n\tvar self = this;\r\n\treturn this.client.select(false, wrapped)\r\n\t.then(function(response){\r\n\t\tvar res = new WOQLResult.WOQLResult(response, self, self.options, self.ui);\r\n\t\treturn res;\r\n\t});\r\n}\r\n\r\nWOQLQuery.prototype.wrap = function(woql){\r\n\tvar wjson = {\r\n\t\t\"@context\" : this.prefixes,\r\n\t\t\"from\": [\r\n\t\t\tthis.client.connectionConfig.dbURL(),\r\n\t\t\twoql\r\n\t\t]\r\n\t};\r\n\treturn wjson;\r\n}\r\n\r\nWOQLQuery.prototype.getConcreteDocumentClassPattern = function(varc){\r\n\tvar varc = varc || \"v:Class\";\r\n\tvar pat = {\r\n\t\tand: [\r\n\t\t\tthis.getSubclassQueryPattern(varc, \"tcs:Document\"),\r\n\t\t\t{\r\n\t\t\t\tnot: [this.getAbstractQueryPattern(varc)]\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n\treturn pat;\r\n}\r\n\r\nWOQLQuery.prototype.getAbstractQueryPattern = function(varname){\r\n\tvar qp = {\r\n\t\tquad: [varname, \"tcs:tag\", \"tcs:abstract\", \"db:schema\"]\r\n\t}\r\n\treturn qp;\r\n}\r\n\r\nWOQLQuery.prototype.getSubclassQueryPattern = function(varname, clsname){\r\n\tvar sqp = {sub: [varname, clsname]};\r\n\treturn sqp;\r\n}\r\n\r\nWOQLQuery.prototype.queryWrappedWithLimit = function(query, limit, start){\r\n\tlimit = limit ? limit : this.default_limit ;\r\n\tstart = start ? start : 0;\r\n\tvar wjson = {\r\n\t\tlimit: [limit, {\r\n\t\t\tstart: [start, query]\r\n\t\t}]\r\n\t};\r\n\treturn wjson;\r\n}\r\n\r\n\r\nWOQLQuery.prototype.getAllDocumentQuery = function(constraint, limit, start){\r\n\tvar query = {\r\n\t\tand: [\r\n\t\t\t{\r\n\t\t\t\ttriple: [\"v:Document\", \"rdf:type\", \"v:Type\"]\r\n\t\t\t},\r\n\t\t\tthis.getSubclassQueryPattern(\"v:Type\", \"tcs:Document\")\r\n\t\t]\r\n\t}\r\n\tif(constraint){\r\n\t\tquery.and.push(constraint);\r\n\t}\r\n\treturn this.queryWrappedWithLimit(query, limit, start);\r\n}\r\n\r\nWOQLQuery.prototype.getEverythingQuery = function(constraint, limit, start){\r\n\tvar wjson = {triple: [\"v:Subject\", \"v:Predicate\", \"v:Object\"]};\r\n\tif(constraint){\r\n\t\twjson = {and: [wjson, constraint]};\r\n\t}\r\n\treturn this.queryWrappedWithLimit(wjson, limit, start);\r\n}\r\n\r\nWOQLQuery.prototype.getPropertyListQuery = function(constraint, limit, start){\r\n\tvar wjson = {\r\n\t\tand: [{quad: [\"v:Property\", \"rdfs:range\", \"v:Range\", \"db:schema\"]},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Property\", \"rdf:type\", \"v:Type\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Property\", \"rdfs:label\", \"v:Label\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Property\", \"rdfs:comment\", \"v:Comment\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Property\", \"rdfs:domain\", \"v:Domain\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t]\r\n\t}\r\n\tif(constraint){\r\n\t\twjson = {and: [wjson, constraint]};\r\n\t}\r\n\treturn this.queryWrappedWithLimit(wjson, limit, start);\r\n}\r\n\r\n\r\nWOQLQuery.prototype.getElementMetaDataQuery = function(constraint, limit, start){\r\n\tvar wjson = {\r\n\t\tand: [{quad: [\"v:Element\", \"rdf:type\", \"v:Type\", \"db:schema\"]},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Element\", \"rdfs:label\", \"v:Label\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Element\", \"rdfs:comment\", \"v:Comment\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Element\", \"tcs:tag\", \"v:Abstract\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Element\", \"rdfs:domain\", \"v:Domain\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Element\", \"rdfs:range\", \"v:Range\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t]\r\n\t}\r\n\tif(constraint){\r\n\t\twjson = {and: [wjson, constraint]};\r\n\t}\r\n\treturn this.queryWrappedWithLimit(wjson, limit, start);\r\n}\r\n\r\nWOQLQuery.prototype.getClassListMetaDataQuery = function(constraint, limit, start){\r\n\tvar wjson = {\r\n\t\tand: [{quad: [\"v:Element\", \"rdf:type\", \"owl:Class\", \"db:schema\"]},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Element\", \"rdfs:label\", \"v:Label\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Element\", \"rdfs:comment\", \"v:Comment\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Element\", \"tcs:tag\", \"v:Abstract\", \"db:schema\"]}]\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n\tif(constraint){\r\n\t\twjson = {and: [wjson, constraint]};\r\n\t}\r\n\treturn this.queryWrappedWithLimit(wjson, limit, start);\r\n}\r\n\r\nWOQLQuery.prototype.getClassMetaDataQuery = WOQLQuery.prototype.getClassListMetaDataQuery;\r\n\r\nWOQLQuery.prototype.getDataOfChosenClassQuery = function(chosen, limit, start){\r\n\tvar wjson = {\r\n\t\tand: [{triple: [\"v:Document\", \"rdf:type\", chosen]},\r\n\t\t\t{\r\n\t\t\t\topt: [{triple: [\"v:Document\", \"v:Property\", \"v:Value\"]}]\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n\treturn this.queryWrappedWithLimit(wjson, limit, start);\r\n}\r\n\r\nWOQLQuery.prototype.getDataOfChosenPropertyQuery = function(chosen, limit, start){\r\n\tvar wjson = {\r\n\t\tand: [{triple: [\"v:Document\", chosen, \"v:Value\"]},\r\n\t\t\t{\r\n\t\t\t\topt: [{triple: [\"v:Document\", \"rdfs:label\", \"v:Label\"]}]\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n\treturn this.queryWrappedWithLimit(wjson, limit, start);\r\n}\r\n\r\nWOQLQuery.prototype.getInstanceMeta = function(url, limit, start){\r\n\tvar wjson = {\r\n\t\tand: [\r\n\t\t\t{triple: [url, \"rdfs:label\", \"v:InstanceLabel\"]},\r\n\t\t\t{triple: [url, \"rdf:type\", \"v:InstanceType\"]},\r\n\t\t\t{\r\n\t\t\t\topt: [{triple: [url, \"rdfs:comment\", \"v:InstanceComment\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:InstanceType\", \"rdfs:label\", \"v:ClassLabel\", \"db:schema\"]}]\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n\treturn this.queryWrappedWithLimit(wjson, limit, start);\r\n}\r\n\r\n\r\nWOQLQuery.prototype.getDocumentQuery = function(id, limit, start){\r\n\tvar wjson = {\r\n\t\tand: [\r\n\t\t\t{triple: [id, \"v:Property\", \"v:Property_Value\"]},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Property\", \"rdfs:label\", \"v:Property_Label\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Property\", \"rdf:type\", \"v:Property_Type\", \"db:schema\"]}]\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n\treturn this.queryWrappedWithLimit(wjson, limit, start);\r\n}\r\n\r\nWOQLQuery.prototype.getClassesQuery = function(){\r\n\tvar wjson = {\r\n\t\tand: [\r\n\t\t\t{triple: [\"v:ID\", \"rdf:type\", \"v:Class\"]},\r\n\t\t\t{\r\n\t\t\t\topt: [{triple: [\"v:ID\", \"rdfs:label\", \"v:Label\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{triple: [\"v:ID\", \"rdfs:comment\", \"v:Comment\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\topt: [{quad: [\"v:Class\", \"rdfs:label\", \"v:Type\", \"db:schema\"]}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsub: ['v:Class', 'tcs:Document']\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n\treturn wjson;\r\n}\r\n\r\nmodule.exports=WOQLQuery\r\n","/**\r\n * @file Javascript Api explorer tool\r\n * @author Kitty Jose\r\n * @license Copyright 2018-2019 Data Chemist Limited, All Rights Reserved. See LICENSE file for more\r\n *\r\n * @summary Set of functions used across scripts\r\n */\r\nconst Codemirror= require('./plugins/codemirror.terminus');\r\n// function to read Files\r\nfunction readFile(file){\r\n  if (window.XMLHttpRequest){\r\n    // code for IE7+, Firefox, Chrome, Opera, Safari\r\n    xmlhttp=new XMLHttpRequest();\r\n  }\r\n  else{\r\n    // code for IE6, IE5\r\n    xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n  }\r\n  xmlhttp.open(\"GET\",file,false);\r\n  xmlhttp.send();\r\n  xmlDoc=xmlhttp.responseText;\r\n  return xmlDoc;\r\n} // readFile()\r\n\r\n// function to write api call signatures from woql client\r\nfunction getFunctionSignature(which){\r\n  var sigs = {};\r\n  sigs.connect = {\r\n    spec   : \"WOQLClient.connect(server_url, key)\",\r\n    descr  : \"\\n\\nConnect to a Terminus server at the given URI with an API key\"\r\n                + \"Stores the terminus:ServerCapability document returned in the connection register\"\r\n                + \"which stores, the url, key, capabilities, and database meta-data for the connected server\"\r\n                + \"If the curl argument is false or null, the this.server will be used if present,\"\r\n                + \" or the promise will be rejected.\",\r\n    result : \"HTTP 200 on success, 409 for already existing database, otherwise error code\",\r\n    args   : {server_url : 'url', key: 'Api key'},\r\n    options: { title: \"\", description: \"\" }\r\n  };\r\n  sigs.create = {\r\n    spec    : \"WOQLClient.createDatabase(database_url, details, key)\",\r\n    descr   : \"\\n\\nCreate a Terminus Database by posting a terminus:\"\r\n                + \"The dburl argument can be \\n1) a valid URL of a terminus database or \\n2) a valid Terminus \"\r\n                + \"database id or \\n3) can be omitted\"\r\n                + \"\\nin case 2) the current server will be used, \"\r\n    \t\t        + \"\\nin case 3) the database id will be set from the @id field of the terminuse:Database document.\"\r\n                + \"\\nThe second (details) argument contains a \\nterminus:Database document with a mandatory \"\r\n                + \"\\nrdfs:label field and an optional rdfs:comment field.\"\r\n                +  \"\\nThe third (key) argument contains an optional API key \",\r\n    result : \"HTTP 200 on success, 409 for already existing database, otherwise error code\",\r\n    args   : {database_url : 'url', details: '', key: ' Api key'},\r\n    options: { title: \"\", description: \"\" }\r\n  };\r\n  sigs.delete = {\r\n      spec  : \"WOQLClient.deleteDatabase(database_url, options)\",\r\n      descr : \"\\n\\nDeletes a Database\"\r\n                + \"\\nThe first (dburl) argument can \\n1) a valid URL of a terminus database or \\n2) a valid database id\"\r\n                + \" or \\n3) ommitted in case \\n2) the current server will be used, and in case \\n3) the current server \"\r\n                + \"and database will be used. \\nThe second argument (opts) is an options json - no options are\"\r\n                + \" currently supported for this function\",\r\n      result: \"HTTP 200 on success, otherwise error code\",\r\n  };\r\n  sigs.getSchema = {\r\n    spec   : \"WOQLClient.getSchema(schema_url, options)\",\r\n    descr  : \"\\n\\nGets the schema of a database. \\nThe first (schurl) argument can be \"\r\n              + \"\\n1) a valid URL of a terminus database or \\n2) a valid database id or \"\r\n              + \"\\n3) omitted, \\nin case 2) the current server will be used, and \\nin case 3) the current server and\"\r\n              + \"database will be used the second argument (opts) is an options json - \"\r\n              + \"\\nopts.format is optional and defines which format is requested (*json / turtle)\"\r\n              + \"\\nopts.key is an optional API key\",\r\n    result : \"Ontology Document on success (HTTP 200), 409 for already existing database, otherwise error code\",\r\n    options: { format: \"turtle\" }\r\n  };\r\n  sigs.getClassFrames = {\r\n    spec   : \"WOQLClient.getClassFrame = function(cfurl, cls, opts)\",\r\n    descr  : \"\\n\\nRetrieves a WOQL query on the specified database which updates the state and returns the results\"\r\n              +  \"\\nThe first (cfurl) argument can be\"\r\n              + \"\\n1) a valid URL of a terminus database or\"\r\n              +  \"\\n2) omitted - the current database will be used\"\r\n              +  \"\\nthe second argument (cls) is the URL / ID of a document class that exists in the database schema\"\r\n              +  \"\\nthe third argument (opts) is an options json - opts.key is an optional API key\",\r\n    result : \"Ontology Document on success (HTTP 200), 409 for already existing database, otherwise error code\",\r\n    options: { format: \"turtle\" }\r\n  };\r\n  sigs.updateSchema = {\r\n    spec    : \"WOQLClient.updateSchema(schema_url, docs, options)\",\r\n    descr   : \"\\n\\nUpdates the Schema of the specified database\"\r\n              + \"\\nThe first (schurl) argument can be \\n1) a valid URL of a terminus database or \\n2)\"\r\n              + \" a valid database id or \\n3) omitted, \\nin case 2) the current server will be used,\"\r\n              + \" and \\nin case 3) the current server and database will be used\"\r\n              + \"\\nThe second argument (doc) is a valid owl ontology in json-ld or turtle format\"\r\n              + \"\\nthe third argument (opts) is an options json - \"\r\n     \t\t      + \"opts.format is used to specify which format is being used (*json / turtle)\"\r\n     \t\t      + \"opts.key is an optional API key\",\r\n    result : \"Ontology Document on success (HTTP 200), 409 for already existing database, otherwise error code\",\r\n    args   : {document : 'doc'},\r\n    options: { format: \"turtle\", editmode: \"replace\"}\r\n  };\r\n  sigs.createDocument = {\r\n    spec   : \"WOQLClient.createDocument(document_url, document, options)\",\r\n    descr  : \"\\n\\nCreates a new document in the specified database\"\r\n              + \"\\nThe first (docurl) argument can be\"\r\n              + \"\\n1) a valid URL of a terminus database (an id will be randomly assigned) or\"\r\n              + \"\\n2) a valid URL or of a terminus document (the document will be given the passed URL) or\"\r\n              + \"\\n3) a valid terminus document id (the current server and database will be used)\"\r\n              + \"\\n4) can be ommitted (the URL will be taken from the document if present)\"\r\n              + \"\\nThe second argument (doc) is a valid document in json-ld\"\r\n              + \"\\nthe third argument (opts) is an options json - opts.key is an optional API key\",\r\n    result : \"Created Document on success (HTTP 200), Violation Report Otherwise (HTTP 400+)\",\r\n    args   : {document_url : 'url', document: \"doc\"},\r\n    options: { format: \"turtle\", fail_on_id_denied: false}\r\n  };\r\n  sigs.viewDocument = {\r\n    spec    : \"WOQLClient.getDocument(document_url, options)\",\r\n    descr   : \"\\n\\nRetrieves a document from the specified database\"\r\n              + \"\\nThe first (docurl) argument can be\"\r\n              + \"\\n1) a valid URL of a terminus document or\"\r\n              + \"\\n2) a valid ID of a terminus document in the current database\"\r\n              + \"\\nthe second argument (opts) is an options json - \"\r\n              + \"\\nopts.key is an optional API key\"\r\n              + \"\\nopts.shape is frame | *document \",\r\n    result : \"Document (HTTP 200), Violation Report Otherwise (HTTP 400+)\",\r\n    args   : {document_url : 'url'},\r\n    options: { format: \"turtle\"}\r\n  };\r\n  sigs.updateDocument = {\r\n    spec   : \"WOQLClient.updateDocument(document_url, document, options)\",\r\n    descr  : \"\\n\\nUpdates a document in the specified database with a new version\"\r\n              + \"\\nThe first (docurl) argument can be\"\r\n              + \"\\n1) a valid URL of a terminus document or \"\r\n              + \"\\n2) a valid ID of a terminus document in the current database or\"\r\n              + \"\\n3) ommitted in which case the id will be taken from the document @id field\"\r\n              + \"\\nthe second argument (doc) is a document in json-ld format\"\r\n              + \"\\nthe third argument (opts) is an options json - opts.key is an optional API key\",\r\n    result : \"Ontology Document on success (HTTP 200), 409 for already existing database, otherwise error code\",\r\n    args   : {document_url : 'url', document: \"doc\"},\r\n    options: { format: \"turtle\", editmode: \"replace\"}\r\n  };\r\n  sigs.deleteDocument = {\r\n    spec  : \"WOQLClient.deleteDocument(document_url, options)\",\r\n    descr : \"\\n\\nDeletes a document from the specified database\"\r\n            + \"\\nThe first (docurl) argument can be\"\r\n            + \"\\n1) a valid URL of a terminus document or\"\r\n            + \"\\n2) a valid ID of a terminus document in the current database\"\r\n            + \"\\n3) omitted - the current document will be used\"\r\n            + \"\\nthe second argument (opts) is an options json - opts.key is an optional API key\",\r\n    result: \"Ontology Document on success (HTTP 200), 409 for already existing database, otherwise error code\",\r\n    args  : {document_url : 'url'},\r\n  };\r\n  sigs.select = {\r\n    spec: \"WOQLClient.select(database_url, woql, options)\",\r\n    descr: \"\\n\\nExecutes a read-only WOQL query on the specified database and returns the results\"\r\n              + \"\\nThe first (qurl) argument can be \"\r\n              + \"\\n1) a valid URL of a terminus database or \"\r\n              + \"\\n2) omitted - the current database will be used \"\r\n              + \"\\nthe second argument (woql) is a woql select statement encoded as a string\"\r\n              + \"\\nthe third argument (opts) is an options json - opts.key is an optional API key\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {woql: 'woql'},\r\n  };\r\n  sigs.update = {\r\n    spec  : \"WOQLClient.update(database_url, woql, options)\",\r\n    descr : \"\\n\\nExecutes a WOQL query on the specified database which updates the state and returns the results\"\r\n            + \"\\nThe first (qurl) argument can be \"\r\n            + \"\\n1) a valid URL of a terminus database or \"\r\n            + \"\\n2) omitted - the current database will be used \"\r\n            + \"\\nthe second argument (woql) is a woql select statement encoded as a string\"\r\n            + \"\\nthe third argument (opts) is an options json - opts.key is an optional API key\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args  : {woql: 'woql'},\r\n  };\r\n  sigs.lookup = {\r\n    spec: \"WOQLClient.lookup(database_url, woql, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {class: 'url', term: 'string'},\r\n  };\r\n  sigs.map = {\r\n    spec: \"WOQLClient.lookup(source, target, woql, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {source: 'json', target: \"json\", woql: 'json'},\r\n  };\r\n  sigs.getClassFrame = {\r\n    spec: \"WOQLClient.getClassFrame(class, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {class: 'url'},\r\n  };\r\n  sigs.getPropertyFrame = {\r\n    spec: \"WOQLClient.getPropertyFrame(class, property, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {class: 'url', property: 'url'},\r\n  };\r\n  sigs.getFilledPropertyFrame = {\r\n    spec: \"WOQLClient.getPropertyFrame(document_url, property, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {document_url: 'url', property: 'url'},\r\n  };\r\n  sigs.getSubClasses = {\r\n    spec: \"WOQLClient.getSubClasses(class, options)\",\r\n    result: \"WOQL Result (HTTP 200), otherwise error code\",\r\n    args: {class: 'url'},\r\n  };\r\n  return sigs[which];\r\n}//getFunctionSignature\r\n\r\n// returns dom element for header text\r\nfunction getHeaderDom(text){\r\n  var hd = document.createElement('div');\r\n  hd.setAttribute('class', 'terminus-module-head');\r\n  var h = document.createElement('h3');\r\n  h.innerHTML = text;\r\n  hd.appendChild(h);\r\n  return hd;\r\n} // getHeaderTextDom\r\n\r\n// returns dom for alert banner\r\nfunction getInfoAlertDom(type, label, msg){\r\n  var ald = document.createElement('div');\r\n  if(type == 'info') ald.setAttribute('class', 'terminus-alert terminus-alert-success');\r\n  else ald.setAttribute('class', 'alert');\r\n  var str = document.createElement('STRONG');\r\n  str.innerHTML = label;\r\n  ald.appendChild(str);\r\n  var txt = document.createTextNode(msg);\r\n  ald.appendChild(txt);\r\n  return ald;\r\n} // getInfoAlertDom()\r\n\r\n// formats response results from platform\r\nfunction getResponse(currForm, action, response, terminator){\r\n\r\n  var rd = document.createElement('div');\r\n\r\n  // get header result\r\n  rd.appendChild(getHeaderDom('Result'));\r\n  var br = document.createElement('BR');\r\n  rd.appendChild(br);\r\n\r\n  var data = JSON.stringify(response, 0, 4);\r\n\r\n  var pre = document.createElement('pre');\r\n  pre.setAttribute('class', 'terminus-api-view terminus-scheme-pre');\r\n  pre.innerHTML = data;\r\n\r\n  var cm = stylizeCodeDisplay(terminator, pre, rd, 'javascript');\r\n  if(!cm) rd.appendChild(pre);\r\n\r\n  var br = document.createElement('BR');\r\n  rd.appendChild(br);\r\n\r\n  currForm.appendChild(rd);\r\n\r\n  return currForm;\r\n}\r\n\r\n// formats the response from fetch call and spits out Http header and result\r\nfunction showHttpResult(response, action, currForm, terminator){\r\n    //var currForm = document.createElement('div');\r\n\r\n    var br = document.createElement('BR');\r\n    currForm.appendChild(br);\r\n    var br = document.createElement('BR');\r\n    currForm.appendChild(br);\r\n\r\n    // get header result\r\n    currForm.appendChild(getHeaderDom('HTTP Header'));\r\n\r\n    var br = document.createElement('BR');\r\n    currForm.appendChild(br);\r\n\r\n     var retHttpHeaders  = '';\r\n\r\n     // iterate over all headers\r\n     for (let [key, value] of response.headers) {\r\n       retHttpHeaders = retHttpHeaders +  `${key} = ${value}` + '\\n';\r\n     }\r\n\r\n    // http header result\r\n    var hdres = document.createElement('pre');\r\n    hdres.setAttribute('class', 'terminus-api-signature-pre');\r\n    var txt = document.createTextNode(retHttpHeaders);\r\n    hdres.appendChild(txt);\r\n\r\n    var cm = stylizeCodeDisplay(terminator, hdres, currForm, 'message/http');\r\n    if(!cm) currForm.appendChild(hdres);\r\n\r\n    return response.json()\r\n    .then(function(response){\r\n      getResponse(currForm, action, response, terminator); // get return response\r\n    })\r\n\r\n} // UTILS.showHttpResult()\r\n\r\n\r\nfunction deleteStylizedEditor(ui, qip){\r\n    if(ui.pluginAvailable(\"codemirror\")){\r\n\t\tvar cm = qip.nextElementSibling;\r\n\t\tcm.setAttribute('class', 'terminus-hide');\r\n\t\tTerminusClient.FrameHelper.removeChildren(cm);\r\n\t}\r\n}\r\n\r\n/* ui: terminus ui reference\r\n   txt: text area to be stylized\r\n   view: defines the size of editor to appear in pages (schema/ query)\r\n   mode: format to be displayed in\r\n*/\r\nfunction stylizeEditor(ui, txt, view, mode){\r\n    var cmConfig = ui.pluginAvailable(\"codemirror\");\r\n    if(!(cmConfig)) return;\r\n\tvar cm = new Codemirror(txt, mode, cmConfig);\r\n\tvar ar = cm.colorizeTextArea(view);\r\n\tcm.updateTextArea(ar);\r\n}\r\n\r\n/* ui: terminus ui reference\r\n   txt: text area to be stylized\r\n   dom: stylized pre area is appended to dom\r\n   mode: format to be displayed in\r\n*/\r\nfunction stylizeCodeDisplay(ui, txt, dom, mode){\r\n    var cmConfig = ui.pluginAvailable(\"codemirror\");\r\n    if(!(cmConfig)) return false;\r\n    var cm = new Codemirror(txt, mode, cmConfig);\r\n    var pr = cm.colorizePre();\r\n    dom.appendChild(pr);\r\n    return true;\r\n}\r\n\r\n/* name: classname to find and remove classes from elements\r\n*/\r\nfunction removeSelectedNavClass(name){\r\n    var el = document.getElementsByClassName(name);\r\n    for(var i=0; i<el.length; i++){\r\n        el[i].classList.remove(name);\r\n    }\r\n}\r\n\r\n// toggles between contents\r\nfunction tolggleContent(icon, content){\r\n    if (content.style.display === \"block\"){\r\n        removeSelectedNavClass(\"fa-chevron-up\");\r\n        icon.classList.add(\"fa-chevron-down\");\r\n        content.style.display = \"none\";\r\n    }\r\n    else{\r\n        removeSelectedNavClass(\"fa-chevron-down\");\r\n        icon.classList.add(\"fa-chevron-up\");\r\n        content.style.display = \"block\";\r\n    }\r\n}\r\n\r\n// controls current selected nav bar\r\nfunction activateSelectedNav(nav, terminator){\r\n    removeSelectedNavClass(\"terminus-selected\");\r\n\tcheckDocumentSubMenus(terminator);\r\n\tnav.classList.add(\"terminus-selected\");\r\n}\r\n\r\nfunction hideDocumentSubMenus(el){\r\n\tif(el.classList.contains('terminus-display')){\r\n\t\tel.classList.remove('terminus-display');\r\n\t\tel.classList.add('terminus-hide');\r\n\t}\r\n}\r\n\r\nfunction checkDocumentSubMenus(terminator){\r\n\tif(terminator.ui.showControl(\"get_document\")) {\r\n\t\tvar gd = document.getElementsByClassName('terminus-get-doc');\r\n\t\thideDocumentSubMenus(gd[0]);\r\n\t}\r\n\tif(terminator.ui.showControl(\"create_document\")) {\r\n\t\tvar cd = document.getElementsByClassName('terminus-create-doc');\r\n\t\thideDocumentSubMenus(cd[0]);\r\n\t}\r\n}\r\n\r\nfunction toggleVisibility(el){\r\n\tif(el.classList.contains('terminus-display')){\r\n\t\tel.classList.remove('terminus-display');\r\n\t\tel.classList.add('terminus-hide');\r\n\t}\r\n    else if(el.classList.contains('terminus-hide')){\r\n        el.classList.remove('terminus-hide');\r\n\t\tel.classList.add('terminus-display');\r\n\t}\r\n}\r\n\r\nfunction extractValueFromCell(cellValue){\r\n    var ihtml = new DOMParser().parseFromString(cellValue, \"text/xml\");\r\n    return ihtml.firstChild.innerHTML;\r\n}\r\n\r\nmodule.exports={tolggleContent,\r\n               removeSelectedNavClass,\r\n               stylizeCodeDisplay,\r\n               stylizeEditor,\r\n               deleteStylizedEditor,\r\n               showHttpResult,\r\n               getHeaderDom,\r\n               getInfoAlertDom,\r\n               getFunctionSignature,\r\n               toggleVisibility,\r\n               extractValueFromCell,\r\n               activateSelectedNav}\r\n","//const FrameHelper = require('../FrameHelper');\r\n\r\nfunction TerminusPluginManager(){\r\n\tthis.preloaded = [];\r\n\tthis.loaded = [];\r\n\tthis.loading = [];\r\n\tthis.precluded = [];\r\n\tthis.plugins = {};\r\n\tthis.plugins[\"font-awesome\"] = {\r\n\t\tlabel: \"Font Awesome\",\r\n\t\tcss: [\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0-11/css/all.css\"]\r\n\t};\r\n\tthis.plugins[\"quill\"] = {\r\n\t\tlabel: \"Quill\",\r\n\t\tjs: [\"https://cdn.quilljs.com/1.3.6/quill.min.js\"],\r\n\t\tcss: [\"https://cdn.quilljs.com/1.3.6/quill.snow.css\"],\r\n\t\tplugin: \"quill.terminus.js\",\r\n\t};\r\n\tthis.plugins[\"codemirror\"] = {\r\n\t\tlabel : \"Code Mirror\",\r\n\t\tjs: [\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/codemirror.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/mode/xml/xml.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/mode/css/css.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/mode/turtle/turtle.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/mode/javascript/javascript.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/addon/hint/anyword-hint.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/addon/hint/show-hint.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/runmode/runmode.js\",\r\n\t\t  \t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/mode/http/http.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/edit/closebrackets.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/edit/matchbrackets.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/display/placeholder.js\"\r\n\t  ],\r\n\t\tcss: [\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/codemirror.css\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.2/addon/hint/show-hint.css\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/theme/neo.css\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/theme/erlang-dark.css\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/theme/eclipse.css\"\r\n\t\t]\r\n\t};\r\n\tthis.plugins[\"jquery\"] = {\r\n\t\tlabel: \"jQuery\",\r\n\t\tjs: [\"https://code.jquery.com/jquery-2.2.4.min.js\"]\r\n\t};\r\n\tthis.plugins[\"jqueryui\"] = {\r\n\t\tlabel: \"jQuery UI\",\r\n\t\tcss: [\"https://code.jquery.com/ui/1.12.0/themes/smoothness/jquery-ui.css\"],\r\n\t\tjs: [\"https://code.jquery.com/ui/1.12.0/jquery-ui.js\"],\r\n\t\trequires: ['jquery']\r\n\t};\r\n\tthis.plugins[\"datatables\"] = {\r\n\t\tlabel: \"Data Tables\",\r\n\t\tjs: [\"https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js\",\r\n\t\t\t \"https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-html5-1.5.1/datatables.min.js\"],\r\n\t\tcss: [\"https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css\"],\r\n\t\trequires: ['jquery']\r\n\t};\r\n\t/*this.plugins[\"prettify\"] = {\r\n\t\tlabel: \"Prettify\",\r\n\t\tjs: [\"https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js\"],\r\n\t\tcss: [\"https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.css\"],\r\n\t\trequires: ['jquery']\r\n\t};*/\r\n\tthis.plugins[\"gmaps\"] = {\r\n\t\tlabel: \"Google Maps\",\r\n\t\tjs: [\"https://maps.googleapis.com/maps/api/js\"],\r\n\t\tplugin: \"gmaps.terminus.js\"\r\n\t};\r\n\tthis.plugins[\"d3\"] = {\r\n\t\tlabel: \"d3\",\r\n\t\tjs: [\"https://code.jquery.com/jquery-2.2.4.min.js\"],\r\n\t\trequires: ['jquery']\r\n\t};\r\n\tthis.plugins[\"select2\"] = {\r\n\t\tlabel: \"Select 2\",\r\n\t\tjs: [\"https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js\"],\r\n\t\tcss: [\"https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css\"],\r\n\t\tplugin: \"select2.terminus.js\",\r\n\t\trequires: ['jquery']\r\n\t};\r\n\tthis.plugins[\"jsoneditor\"] = {\r\n\t\tlabel: \"JSON Editor\",\r\n\t\tjs: [\"plugins/libs/jsoneditor.min.js\"],\r\n\t\tcss: [\"plugins/libs/jsoneditor.min.css\"],\r\n\t\tplugin: \"jsoneditor.terminus.js\"\r\n\t};\r\n\t/*this.plugins[\"bootstrap\"] = {\r\n\t\tlabel: \"Bootstrap\",\r\n\t\tjs: [\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js\"],\r\n\t\tcss: [\"https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.2.2/css/bootstrap.min.css\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.2.2/css/bootstrap-responsive.min.css\"]\r\n\t};\r\n\tthis.plugins[\"flot\"] = {\r\n\t\tlabel: \"Flot\",\r\n\t\tjs: [\"https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.min.js\",\r\n\t\t\t\"https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.resize.min.js\"],\r\n\t\trequires: [\"jquery\"]\r\n\t};*/\r\n}\r\n\r\nTerminusPluginManager.prototype.setPluginOptions = function(opts){\r\n\tfor(var p in opts){\r\n\t\tif(!this.plugins[p]) continue;\r\n\t\tfor(var k in opts[p]){\r\n\t\t\tthis.plugins[p][k] = opts[p][k];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.init = function(opts, then){\r\n\tif(opts) this.setPluginOptions(opts);\r\n\tthis.calculatePreloaded();\r\n\tvar toload = this.calculateRequiredInitPlugins(opts);\r\n\tif(toload && toload[0].length) {\r\n\t\tif(toload[1].length){\r\n\t\t\tvar self = this;\r\n\t\t\tvar nthen = function(){\r\n\t\t\t\tself.loadPlugins(toload[1], then);\r\n\t\t\t}\r\n\t\t\tthis.loadPlugins(toload[0], nthen);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.loadPlugins(toload[0], then);\r\n\t\t}\r\n\t}\r\n\telse if(then){\r\n\t\tthen();\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.calculateRequiredInitPlugins = function(opts){\r\n\tif(opts){\r\n\t\tvar pins = [];\r\n\t\tfor(var pid in opts){\r\n\t\t\tif(opts[pid] && pins.indexOf(pid) == -1){\r\n\t\t\t\tif(typeof opts[pid] != \"object\" && opts[pid]){\r\n\t\t\t\t\tpins.push(pid);\r\n\t\t\t\t}\r\n\t\t\t\telse if(typeof opts[pid] == \"object\"){\r\n\t\t\t\t\tif(!(typeof opts[pid].loaded != \"undefined\" && !opts[pid].loaded)){\r\n\t\t\t\t\t\tpins.push(pid);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tvar pins = this.getDefaultPlugins();\r\n\t}\r\n\tvar needed_pins = [];\r\n\tfor(var i = 0; i<pins.length; i++){\r\n\t\tif(this.loaded.indexOf(pins[i]) == -1 && this.preloaded.indexOf(pins[i]) == -1 ){\r\n\t\t\tneeded_pins.push(pins[i])\r\n\t\t}\r\n\t}\r\n\tvar loading_order = [[], []];\r\n\tfor(var i = 0; i<needed_pins.length; i++){\r\n\t\tif(this.plugins[needed_pins[i]].requires && this.plugins[needed_pins[i]].requires.length){\r\n\t\t\tloading_order[1].push(needed_pins[i]);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tloading_order[0].push(needed_pins[i]);\r\n\t\t}\r\n\t}\r\n\treturn loading_order;\r\n}\r\n\r\nTerminusPluginManager.prototype.getAvailablePlugins = function(){\r\n\treturn this.plugins;\r\n}\r\n\r\nTerminusPluginManager.prototype.calculatePreloaded = function(){\r\n\tfor(var pl in this.plugins){\r\n\t\tif(this.pluginAvailable(pl)){\r\n\t\t\tthis.preloaded.push(pl);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.pluginAvailable = function(plugin, version_check){\r\n\tif(typeof this.plugins[plugin] == \"object\"){\r\n\t\tvar pluginmeta = this.plugins[plugin];\r\n\t\tif(pluginmeta.requires && pluginmeta.requires.length){\r\n\t\t\tfor(var i =0 ; i < pluginmeta.requires.length; i++){\r\n\t\t\t\tif(!this.pluginAvailable(pluginmeta.requires[i], version_check)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar required_version = (pluginmeta.version ? pluginmeta.version : false);\r\n\t\tswitch(plugin){\r\n\t\t\tcase \"jquery\": {\r\n\t\t\t\tif(typeof jQuery == \"undefined\") return false;\r\n\t\t\t\tif(version_check && required_version){}\r\n\t\t\t\treturn true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase \"jqueryui\": {\r\n\t\t\t\tif(typeof jQuery != \"undefined\" && jQuery.isFunction( jQuery.fn.slider )) return true;\r\n\t\t\t\treturn false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase \"quill\": {\r\n\t\t\t\tif(typeof Quill == \"undefined\") return false;\r\n\t\t\t\treturn true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase \"jsoneditor\": {\r\n\t\t\t\tif(typeof JSONEditor == \"undefined\") return false;\r\n\t\t\t\treturn true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase \"codemirror\": {\r\n\t\t\t\tif(typeof CodeMirror == \"undefined\") return false;\r\n\t\t\t\treturn this.plugins[plugin];  // sent plugin config with darkmode true/ false\r\n\t\t\t}\r\n\t\t\tcase \"font-awesome\": {\r\n\t\t\t\t//if(typeof CodeMirror != \"undefined\") return true;\r\n\t\t\t\treturn this.fontAwesomeCheck();\r\n\t\t\t}\r\n\t\t\tcase \"datatables\": {\r\n\t\t\t\t if(typeof jQuery != \"undefined\" && jQuery.isFunction( jQuery.fn.dataTable)) return true;\r\n\t\t\t\t return false;\r\n\t\t\t}\r\n\t\t\tcase \"select2\": {\r\n\t\t\t\t if(typeof jQuery != \"undefined\" && jQuery.isFunction( jQuery.fn.select2 )) return true;\r\n\t\t\t\t return false;\r\n\t\t\t}\r\n\t\t\tcase \"gmaps\": {\r\n\t\t\t\tif(typeof google == \"undefined\" || typeof google.maps == \"undefined\") return false;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tcase \"openlayers\": {\r\n\t\t\t\tif(typeof ol == \"undefined\" || typeof ol.Map == \"undefined\") return false;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tcase \"d3\": {\r\n\t\t\t\tif(typeof d3 == \"undefined\") return false;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tconsole.log(new Error(plugin + \" is not a supported plugin ID\"));\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nTerminusPluginManager.prototype.fontAwesomeCheck = function(){\r\n\tvar span = document.createElement('span');\r\n\tspan.className = 'fa';\r\n\tspan.style.display = 'none';\r\n\tif(document.body){\r\n\t\tdocument.body.insertBefore(span, document.body.firstChild);\r\n\t\tfunction css(element, property) {\r\n\t\t  return window.getComputedStyle(element, null).getPropertyValue(property);\r\n\t\t}\r\n\t\tvar loaded = false;\r\n\t\tvar fontAwsm = css(span, 'font-family');\r\n\t\tif (fontAwsm.replace(/\"/g, \"\") == 'Font Awesome 5 Free') { // remove double quotes\r\n\t\t\tloaded = true;\r\n\t\t}\r\n\t\tdocument.body.removeChild(span);\r\n\t\treturn loaded;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusPluginManager.prototype.getDefaultPlugins = function(){\r\n\tvar defplugs = [\"font-awesome\"];\r\n\treturn defplugs;\r\n}\r\n\r\nTerminusPluginManager.prototype.loadPlugins = function(plugins, then){\r\n\tvar ticker = plugins.length;\r\n\tvar cback = function(){\r\n\t\tif(--ticker <= 1 && then){\r\n\t\t\tthen();\r\n\t\t}\r\n\t};\r\n\tfor(var i = 0; i < plugins.length; i++){\r\n\t\tthis.loadPlugin(plugins[i], cback);\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.loadPlugin = function(plugin, then){\r\n\tvar pug = this.plugins[plugin];\r\n\tif(pug.css){\r\n\t\tfor(var i=0; i<pug.css.length; i++){\r\n\t\t\tvar cssid = plugin + \"_css_\" + i;\r\n\t\t\tTerminusClient.FrameHelper.loadDynamicCSS(cssid, pug.css[i]);\r\n\t\t}\r\n\t}\r\n\tvar scripts = (pug.js ? pug.js : []);\r\n\tif(plugin == \"gmaps\" && pug.key){\r\n\t\tscripts[0] += \"?key=\" + pug.key;\r\n\t}\r\n\tif(pug.plugin){\r\n\t\tscripts.push(\"plugins/\" + pug.plugin);\r\n\t}\r\n\tif(plugin == \"codemirror\"){\r\n\t\tvar cm = scripts[0];\r\n\t\tvar sid = plugin + \"_js_\" + (scripts.length -1);\r\n\t\tscripts.splice(0, 1);\r\n\t\tvar self = this;\r\n\t\tvar cback = function(){\r\n\t\t\tself.loadPluginScripts(plugin, scripts, then);\r\n\t\t}\r\n\t\tTerminusClient.FrameHelper.loadDynamicScript(sid, cm, cback);\r\n\t}\r\n\telse {\r\n\t\tthis.loadPluginScripts(plugin, scripts, then);\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.loadPluginScripts = function(plugin, scripts, then){\r\n\tvar ticker = scripts.length - 1;\r\n\tvar self = this;\r\n\tvar cback = function(){\r\n\t\tif(ticker == 0) {\r\n\t\t\tif(self.loaded.indexOf(plugin) == -1){\r\n\t\t\t\tself.loaded.push(plugin);\r\n\t\t\t}\r\n\t\t\tif(self.loading.indexOf(plugin) != -1){\r\n\t\t\t\tself.loading.splice(self.loading.indexOf(plugin), 1);\r\n\t\t\t}\r\n\t\t\tthen();\r\n\t\t}\r\n\t\tticker--;\r\n\t};\r\n\tif(scripts.length == 0){\r\n\t\tthis.loaded.push(plugin);\r\n\t}\r\n\telse {\r\n\t\tthis.loading.push(plugin);\r\n\t}\r\n\tfor(var i = 0; i<scripts.length; i++){\r\n\t\tvar sid = plugin + \"_js_\" + i;\r\n\t\tTerminusClient.FrameHelper.loadDynamicScript(sid, scripts[i], cback);\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.loadPageCSS = function(css){\r\n\tcssfid = \"terminus_client_css\";\r\n\tvar cssdom = document.getElementById(cssfid);\r\n\tif(cssdom){\r\n\t\tcssdom.parentNode.removeChild(cssdom);\r\n\t}\r\n\tif(css){\r\n\t\tcssurl = \"css/\" + css + \".css\";\r\n\t\tTerminusClient.FrameHelper.loadDynamicCSS(cssfid, cssurl);\r\n\t}\r\n}\r\n\r\nTerminusPluginManager.prototype.pluginLoadable = function(pid){\r\n\treturn (this.precluded.indexOf(pid) !== -1 || this.pluginLoadedOrLoading(pid));\r\n}\r\n\r\nTerminusPluginManager.prototype.pluginLoadedOrLoading = function(pid){\r\n\tif(this.loaded.indexOf(pid) != -1) return true;\r\n\tif(this.preloaded.indexOf(pid) != -1) return true;\r\n\tif(this.loading.indexOf(pid) != -1) return true;\r\n\treturn false;\r\n}\r\n\r\nTerminusPluginManager.prototype.disabled = function(pid, obj){\r\n\tif(this.precluded.indexOf(pid) != -1) return true;\r\n\tif(obj.requires){\r\n\t\tfor(var i = 0; i<obj.requires.length; i++){\r\n\t\t\tif(!this.pluginLoadedOrLoading(obj.requires[i])) return true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusPluginManager.prototype.getPluginDOM = function(plugid, obj, ui){\r\n\tvar a = document.createElement(\"a\");\r\n\tvar cl = document.createElement(\"span\");\r\n\ta.appendChild(cl);\r\n\tcl.setAttribute(\"class\", \"terminus-plugin-control\");\r\n\tvar cbox = document.createElement(\"input\");\r\n\tcbox.id = \"terminus-plugin-control-\" + plugid;\r\n\tcbox.type = \"checkbox\";\r\n\tif(this.preloaded.indexOf(plugid) != -1){\r\n\t\tcbox.checked = true;\r\n\t\tcbox.disabled = true;\r\n\t}\r\n\telse if(this.loaded.indexOf(plugid) != -1){\r\n\t\tcbox.checked = true;\r\n\t}\r\n\telse if(this.loading.indexOf(plugid) != -1){\r\n\t\tcbox.checked = true;\r\n\t}\r\n\telse if(this.disabled(plugid, obj)){\r\n\t\tcbox.disabled = true;\r\n\t}\r\n\tvar clab = document.createElement(\"label\");\r\n\tclab.setAttribute(\"class\", \"terminus-plugin-label terminus-pointer\");\r\n\tclab.setAttribute(\"for\", cbox.id);\r\n\tclab.appendChild(document.createTextNode(obj.label));\r\n\tcl.appendChild(clab);\r\n\tcl.appendChild(cbox);\r\n\tvar self = this;\r\n\tcbox.addEventListener(\"change\", function(){\r\n\t\tself.togglePlugin(plugid, ui);\r\n\t});\r\n\treturn a;\r\n}\r\n\r\nTerminusPluginManager.prototype.togglePlugin = function(plugid, ui){\r\n\tif(this.loaded.indexOf(plugid) == -1){\r\n\t\tvar then = function(){\r\n\t\t\tui.redraw();\r\n\t\t}\r\n\t\tthis.loadPlugin(plugid, then);\r\n\t}\r\n\telse {\r\n\t\tthis.unloadPlugin(plugid);\r\n\t}\r\n\tTerminusClient.FrameHelper.removeChildren(ui.plugins);\r\n\tui.drawPlugins();\r\n}\r\n\r\nTerminusPluginManager.prototype.unloadPlugin = function(plugid){\r\n\tif(!this.plugins[plugid] || this.loaded.indexOf(plugid) == -1) {\r\n\t\tconsole.log(new Error(plugid + \" plugin unload request when it is not loaded\"));\r\n\t\treturn false;\r\n\t}\r\n\tvar pug = this.plugins[plugid];\r\n\tvar num = (pug.js) ? pug.js.length : 0;\r\n\tif(pug.plugin) num++;\r\n\tfor(var i=0; i< num; i++){\r\n\t\tvar cssfid = plugid + \"_js_\" + i;\r\n\t\tvar cssdom = document.getElementById(cssfid);\r\n\t\tif(cssdom){\r\n\t\t\tcssdom.parentNode.removeChild(cssdom);\r\n\t\t}\r\n\t}\r\n\tnum = (pug.css ? pug.css.length : 0);\r\n\tfor(var i=0; i< num; i++){\r\n\t\tvar cssfid = plugid + \"_css_\" + i;\r\n\t\tvar cssdom = document.getElementById(cssfid);\r\n\t\tif(cssdom){\r\n\t\t\tcssdom.parentNode.removeChild(cssdom);\r\n\t\t}\r\n\t}\r\n\tthis.loaded.splice(this.loaded.indexOf(plugid), 1);\r\n}\r\n\r\nTerminusPluginManager.prototype.getAsDOM = function(ui){\r\n\tvar dm = document.createElement(\"span\");\r\n\tdm.setAttribute(\"class\", \"terminus-plugin-manager\");\r\n\tvar clh = document.createElement(\"span\");\r\n\tclh.setAttribute(\"class\", \"terminus-plugin-control-header terminus-plugin-nav terminus-pointer\");\r\n\tclh.appendChild(document.createTextNode(\"Plugins\"));\r\n\tdm.appendChild(clh);\r\n\tvar a = document.createElement('a');\r\n\tthis.showPlugins(a, ui);\r\n\tclh.appendChild(a);\r\n\ta.style.display = 'none';\r\n\tclh.addEventListener('click', function(){\r\n\t\tif(a.style.display == 'none')\r\n\t\t\ta.style.display = 'block';\r\n\t\telse a.style.display = 'none';\r\n\t})\r\n\treturn dm;\r\n}\r\n\r\nTerminusPluginManager.prototype.showPlugins = function(a, ui){\r\n\ta.setAttribute('style', 'background-color: #111;');\r\n\tfor(var pid in this.plugins){\r\n\t\ta.appendChild(this.getPluginDOM(pid, this.plugins[pid], ui));\r\n\t}\r\n}\r\n\r\nmodule.exports=TerminusPluginManager\r\n","const TerminusPluginManager = require('../plugins/TerminusPlugin');\r\nconst Datatables = require('../plugins/datatables.terminus');\r\n\r\nfunction WOQLResult(res, query, options, ui){\r\n\tthis.ui = ui;\r\n\tthis.query = query;\r\n\tthis.bindings = ((res && res.bindings) ? res.bindings : []);\r\n}\r\n\r\nWOQLResult.prototype.count = function(){\r\n\treturn this.bindings.length;\r\n}\r\n\r\nWOQLResult.prototype.shorten = function(url){\r\n\treturn this.query.shorten(url);\r\n}\r\n\r\nWOQLResult.prototype.hasBindings = function(result){\r\n\tif(result) return (result.bindings && result.bindings.length);\r\n\telse return (this.bindings && this.bindings.length);\r\n}\r\n\r\n\r\n\r\nfunction WOQLResultsViewer(ui, wresult, options, settings){\r\n\tthis.ui = ui;\r\n\tthis.result = wresult;\r\n\tthis.options = options;\r\n\t//this.wqlRes = new WOQLResult();\r\n\tthis.pman = new TerminusPluginManager();\r\n\tthis.settings = settings;\r\n}\r\n\r\nWOQLResultsViewer.prototype.showTable = function(){\r\n\tif(this.options && typeof this.options.show_table != \"undefined\") return this.options.show_table;\r\n\treturn true;\r\n}\r\n\r\nWOQLResultsViewer.prototype.orderColumns = function(sample){\r\n\tvar ordered = [];\r\n\tfor(var h in sample){\r\n\t\tif(ordered.indexOf(h) == -1){\r\n\t\t\tordered.unshift(h);\r\n\t\t}\r\n\t}\r\n\treturn ordered;\r\n}\r\n\r\nWOQLResultsViewer.prototype.getAsDOM = function(resultDOM, displayResultHeader){\r\n\tvar rs = document.createElement('div');\r\n\tresultDOM.appendChild(rs);\r\n\tif(displayResultHeader){\r\n\t\tvar rh = document.createElement('div');\r\n\t\trh.setAttribute(\"class\", \"terminus-margin-top-bottom terminus-module-head\");\r\n\t\trh.appendChild(document.createTextNode(\"Results\"));\r\n\t\trs.appendChild(rh);\r\n\t}\r\n\tif(this.result && this.result.hasBindings() && this.showTable()){\r\n\t\tthis.getTableDOM(this.result.bindings, rs);\r\n\t\treturn rs;\r\n\t}\r\n\telse {\r\n\t\tconsole.log(\"no bindings for query\");\r\n\t}\r\n}\r\n\r\nWOQLResultsViewer.prototype.getTableDOM = function(bindings, resultDOM){\r\n\tif(this.pman.pluginAvailable(\"datatables\")){\r\n\t\tvar dtResult = this.getTable(bindings, true);\r\n\t\tresultDOM.appendChild(dtResult.tab);\r\n    \tvar dt = new Datatables();\r\n\t\tdt.draw(true, dtResult, this.settings, this.ui, resultDOM);\r\n\t\tresultDOM.classList.add('terminus-expandable');\r\n\t\tresultDOM.classList.add('terminus-dt-result-cont');\r\n\t\treturn tab;\r\n    }\r\n\telse{\r\n\t\tvar tab = this.getTable(bindings, false);\r\n\t\tresultDOM.appendChild(tab);\r\n\t}\r\n}\r\n\r\nWOQLResultsViewer.prototype.formatResultsForDatatableDisplay = function(bindings){\r\n    var columns = [], colDataData = {}, data = [], formattedResult = {}, arr = [];\r\n\tvar dtResult = {};\r\n    var ordered_headings = this.orderColumns(bindings[0]);\r\n\t// get columns\r\n\tfor(var i = 0; i<ordered_headings.length; i++){\r\n\t\tvar clab = TerminusClient.FrameHelper.validURL(ordered_headings[i]) ? TerminusClient.FrameHelper.labelFromURL(ordered_headings[i]) : ordered_headings[i];\r\n        columns.push({data: clab});\r\n\t}\r\n\t// get data for respective columns\r\n\tfor(var i = 0; i<bindings.length; i++){\r\n\t\tcolDataData = {};\r\n\t\tfor(var j = 0; j<ordered_headings.length; j++){\r\n\t\t\tif(typeof bindings[i][ordered_headings[j]] == \"object\"){\r\n\t\t\t\tvar lab = (bindings[i][ordered_headings[j]]['@value'] ? bindings[i][ordered_headings[j]]['@value'] : \"Object?\");\r\n\t\t\t}\r\n\t\t\telse if(typeof bindings[i][ordered_headings[j]] == \"string\") {\r\n\t\t\t\tvar lab = this.result.shorten(bindings[i][ordered_headings[j]]);\r\n\t\t\t\tif(lab == \"unknown\") lab = \"\";\r\n\t\t\t\tif(lab.substring(0, 4) == \"doc:\"){\r\n\t\t\t\t\tlab = this.getDocumentLocalLink(lab);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar clab = TerminusClient.FrameHelper.validURL(ordered_headings[j]) ? TerminusClient.FrameHelper.labelFromURL(ordered_headings[j]) : ordered_headings[j];\r\n\t\t\tcolDataData[clab] = lab;\r\n\t\t}\r\n\t\tdata.push(colDataData);\r\n\t}\r\n\tdtResult.columns = columns;\r\n\tformattedResult.data = data;\r\n\tformattedResult.recordsTotal = '65';\r\n\tformattedResult.recordsFiltered = '25';\r\n\tformattedResult.draw = '1';\r\n\tdtResult.data = formattedResult;\r\n\treturn dtResult;\r\n}\r\n\r\nWOQLResultsViewer.prototype.getTableBody = function(bindings, ordered_headings){\r\n\tvar tbody = document.createElement(\"tbody\");\r\n\tvar self = this;\r\n\tfor(var i = 0; i<bindings.length; i++){\r\n\t\tvar tr = document.createElement(\"tr\");\r\n\t\tfor(var j = 0; j<ordered_headings.length; j++){\r\n\t\t\tvar td = document.createElement(\"td\");\r\n\t\t\tif(typeof bindings[i][ordered_headings[j]] == \"object\"){\r\n\t\t\t\tvar lab = (bindings[i][ordered_headings[j]]['@value'] ? bindings[i][ordered_headings[j]]['@value'] : \"Object?\");\r\n\t\t\t\ttd.appendChild(document.createTextNode(lab));\r\n\t\t\t}\r\n\t\t\telse if(typeof bindings[i][ordered_headings[j]] == \"string\") {\r\n\t\t\t\tvar lab = this.result.shorten(bindings[i][ordered_headings[j]]);\r\n\t\t\t\tif(lab == \"unknown\") lab = \"\";\r\n\t\t\t\tif(lab.substring(0, 4) == \"doc:\"){\r\n\t\t\t\t\tvar a = this.getDocumentLocalLink(lab);\r\n\t\t\t\t\ttd.appendChild(a);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttd.appendChild(document.createTextNode(lab));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttr.appendChild(td);\r\n\t\t}\r\n\t\ttbody.appendChild(tr);\r\n\t}\r\n\treturn tbody;\r\n}\r\n\r\nWOQLResultsViewer.prototype.getDocumentLocalLink = function(lab){\r\n\tvar a = document.createElement(\"a\");\r\n\ta.setAttribute(\"title\", lab);\r\n\ta.setAttribute(\"href\", '#');\r\n\tvar self = this;\r\n\ta.addEventListener(\"click\", function(){\r\n\t\tif(self.result.ui) {\r\n\t\t\tself.result.ui.showDocument(this.title);\r\n\t\t\tself.result.ui.redraw();\r\n\t\t}\r\n\t});\r\n\ta.appendChild(document.createTextNode(lab));\r\n\treturn a;\r\n}\r\n\r\nWOQLResultsViewer.prototype.getTable = function(bindings, dtPlugin){\r\n\tvar tab = document.createElement(\"table\");\r\n\ttab.setAttribute(\"class\", \"terminus-query-results-table\");\r\n\tvar thead = document.createElement(\"thead\");\r\n\tvar thr = document.createElement(\"tr\");\r\n\tvar ordered_headings = this.orderColumns(bindings[0]);\r\n\tfor(var i = 0; i<ordered_headings.length; i++){\r\n\t\tvar th = document.createElement(\"th\");\r\n\t\tth.setAttribute('class', 'terminus-table-header-full-css');\r\n\t\tvar clab = (ordered_headings[i].indexOf(\"http\") != -1) ? TerminusClient.FrameHelper.labelFromURL(ordered_headings[i]) : ordered_headings[i];\r\n\t\tth.appendChild(document.createTextNode(clab));\r\n\t\tthr.appendChild(th);\r\n\t}\r\n\tthead.appendChild(thr);\r\n\ttab.appendChild(thead);\r\n\tif(dtPlugin){\r\n\t\tvar tbody = document.createElement(\"tbody\");\r\n\t\ttab.appendChild(tbody);\r\n\t\tvar dtResult ={};\r\n\t\tdtResult.result = this.formatResultsForDatatableDisplay(bindings);\r\n\t\tdtResult.tab = tab;\r\n\t\treturn dtResult;\r\n\t}\r\n\telse {\r\n\t\tvar tbody = this.getTableBody(bindings , ordered_headings);\r\n\t\ttab.appendChild(tbody);\r\n\t\treturn tab;\r\n\t}\r\n}\r\n\r\n\r\nmodule.exports={WOQLResultsViewer, WOQLResult}\r\n","const ObjectViewer= require(\"./ObjectViewer\")\r\nconst HTMLStringViewer = require('./viewers/String');\r\nconst HTMLStringEditor = require('./viewers/StringEditor');\r\nconst HTMLBooleanViewer = require('./viewers/Boolean');\r\nconst HTMLBooleanEditor = require('./viewers/BooleanEditor');\r\nconst HTMLChoiceViewer = require('./viewers/Choice');\r\nconst HTMLChoiceEditor = require('./viewers/ChoiceEditor');\r\nconst HTMLCoordinateViewer = require('./viewers/Coordinate');\r\nconst HTMLCoordinateEditor = require('./viewers/CoordinateEditor');\r\nconst HTMLDateViewer = require('./viewers/Date');\r\nconst HTMLDateEditor = require('./viewers/DateEditor');\r\nconst HTMLEntityViewer = require('./viewers/Entity');\r\nconst HTMLEntityEditor = require('./viewers/EntityEditor');\r\nconst HTMLImageViewer = require('./viewers/Image');\r\nconst HTMLImageEditor = require('./viewers/ImageEditor');\r\nconst HTMLLinkViewer = require('./viewers/Link');\r\nconst HTMLNumberViewer = require('./viewers/Number');\r\nconst HTMLRangeViewer = require('./viewers/Range');\r\nconst HTMLRangeEditor = require('./viewers/RangeEditor');\r\nconst SantizedHTMLViewer = require('./viewers/SanitizedHTML');\r\n\r\nlet RenderingMap = {\r\n\tregisteredDataViewers: {},\r\n\tregisteredDataEditors: {},\t\r\n\tregisteredPropertyViewers: {},\r\n\tregisteredPropertyEditors: {},\r\n\tregisteredObjectViewers: {},\r\n\tregisteredObjectEditors: {},\r\n\tgetValidDataViewerList: function(type, frametype){\r\n\t\tvar valids = ['HTMLStringViewer'];\r\n\t\tif(frametype && typeof this.registeredDataViewers[frametype] != \"undefined\"){\r\n\t\t\tvalids = valids.concat(this.registeredDataViewers[frametype]);\r\n\t\t}\r\n\t\tif(typeof this.registeredDataViewers[type] != \"undefined\"){\r\n\t\t\tvalids = valids.concat(this.registeredDataViewers[type]);\r\n\t\t}\r\n\t\treturn valids;\r\n\t},\r\n\tgetValidDataEditorList: function(type, frametype){\r\n\t\tvar valids = ['HTMLStringEditor'];\r\n\t\tif(frametype && typeof this.registeredDataEditors[frametype] != \"undefined\"){\r\n\t\t\tvar nftypes = this.registeredDataEditors[frametype];\r\n\t\t\tif(nftypes){\r\n\t\t\t\tfor(var i = 0; i<nftypes.length; i++){\r\n\t\t\t\t\tif(valids.indexOf(nftypes[i]) == -1) valids.push(nftypes[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(typeof this.registeredDataEditors[type] != \"undefined\"){\r\n\t\t\tvalids = valids.concat(this.registeredDataEditors[type]);\r\n\t\t}\r\n\t\treturn valids;\r\n\t},\r\n\tgetValidPropertyViewerList: function(property, proptype, proprange, propdom){\r\n\t\tvar valids = ['HTMLPropertyViewer'];\r\n\t\tif(property && typeof this.registeredPropertyViewers[property] != \"undefined\"){\r\n\t\t\tvalids = valids.concat(this.registeredPropertyViewers[property]);\r\n\t\t}\r\n\t\tif(proprange && typeof this.registeredPropertyViewers[proprange] != \"undefined\"){\r\n\t\t\tvalids = valids.concat(this.registeredPropertyViewers[proprange]);\r\n\t\t}\r\n\t\tif(propdom && typeof this.registeredPropertyViewers[propdom] != \"undefined\"){\r\n\t\t\tvalids = valids.concat(this.registeredPropertyViewers[propdom]);\r\n\t\t}\r\n\t\tif(proptype && typeof this.registeredPropertyViewers[proptype] != \"undefined\"){\r\n\t\t\tvalids = valids.concat(this.registeredPropertyViewers[proptype]);\r\n\t\t}\r\n\t\treturn valids;\r\n\t},\r\n\tgetValidPropertyEditorList: function(property, proptype, proprange, propdom){\r\n\t\tvar valids = ['HTMLPropertyViewer'];\r\n\t\tif(property && typeof this.registeredPropertyEditors[property] != \"undefined\"){\r\n\t\t\tvalids = valids.concat(this.registeredPropertyEditors[property]);\r\n\t\t}\r\n\t\tif(proprange && typeof this.registeredPropertyEditors[proprange] != \"undefined\"){\r\n\t\t\tvalids = valids.concat(this.registeredPropertyEditors[proprange]);\r\n\t\t}\r\n\t\tif(propdom && typeof this.registeredPropertyEditors[propdom] != \"undefined\"){\r\n\t\t\tvalids = valids.concat(this.registeredPropertyEditors[propdom]);\r\n\t\t}\r\n\t\tif(proptype && typeof this.registeredPropertyEditors[proptype] != \"undefined\"){\r\n\t\t\tvalids = valids.concat(this.registeredPropertyEditors[proptype]);\r\n\t\t}\r\n\t\treturn valids;\r\n\t},\r\n\tgetViewer: function(type, options){\r\n\t\tvar vi = this.renderers[type];\r\n\t\toptions = (options ? options: {});\r\n\t\ttry {\r\n\t\t\tvar viewer = eval(\"new \" + type + \".\" + type + \"(\" + JSON.stringify(options) + \")\");\t\r\n\t\t\treturn viewer;\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\talert(\"failed on create \" + e.toString());\r\n\t\t}\r\n\t},\r\n\tgetAvailablePropertyViewers: function(type, renderer) {\r\n\t\tvar viewers = [];\r\n\t\tvar nviewers = []\r\n\t\tvar opts = this.getValidPropertyViewerList(type);\r\n\t\tfor(var i = 0; i<opts.length; i++){\r\n\t\t\tif(nviewers.indexOf(opts[i]) == -1) {\r\n\t\t\t\tnviewers.push(opts[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(var i = 0; i<nviewers.length; i++){\r\n\t\t\tif(this.renderers[nviewers[i]]){\r\n\t\t\t\tvar sets = this.renderers[nviewers[i]];\r\n\t\t\t\tviewers.push({value: nviewers[i], label: sets.label});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn viewers;\r\n\t},\r\n\tgetAvailablePropertyEditors: function(type, renderer) {\r\n\t\tvar viewers = [];\r\n\t\tvar nviewers = []\r\n\t\tvar opts = this.getValidPropertyEditorList();\r\n\t\tfor(var i = 0; i<opts.length; i++){\r\n\t\t\tif(nviewers.indexOf(opts[i]) == -1) {\r\n\t\t\t\tnviewers.push(opts[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(var i = 0; i<nviewers.length; i++){\r\n\t\t\tif(this.renderers[nviewers[i]]){\r\n\t\t\t\tvar sets = this.renderers[nviewers[i]];\r\n\t\t\t\tviewers.push({value: nviewers[i], label: sets.label});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn viewers;\r\n\t\t\r\n\t},\r\n\tgetAvailableDataViewers: function(type, frametype){\r\n\t\tvar viewers = [];\r\n\t\tvar nviewers = []\r\n\t\tvar opts = this.getValidDataViewerList(type, frametype);\r\n\t\tfor(var i = 0; i<opts.length; i++){\r\n\t\t\tif(nviewers.indexOf(opts[i]) == -1) {\r\n\t\t\t\tnviewers.push(opts[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(var i = 0; i<nviewers.length; i++){\r\n\t\t\tif(this.renderers[nviewers[i]]){\r\n\t\t\t\tvar sets = this.renderers[nviewers[i]];\r\n\t\t\t\tviewers.push({value: nviewers[i], label: sets.label});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn viewers;\r\n\t},\r\n\tgetAvailableDataEditors: function(type, frametype){\r\n\t\tvar viewers = [];\r\n\t\tvar nviewers = []\r\n\t\tvar opts = this.getValidDataEditorList(type, frametype);\r\n\t\tfor(var i = 0; i<opts.length; i++){\r\n\t\t\tif(nviewers.indexOf(opts[i]) == -1) {\r\n\t\t\t\tnviewers.push(opts[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(var i = 0; i<nviewers.length; i++){\r\n\t\t\tif(this.renderers[nviewers[i]]){\r\n\t\t\t\tvar sets = this.renderers[nviewers[i]];\r\n\t\t\t\tviewers.push({value: nviewers[i], label: sets.label});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn viewers;\r\n\t},\r\n\tgetViewerForDataFrame: function(type, frametype){\r\n\t\tvar vals = this.getValidDataViewerList(type, frametype);\r\n\t\treturn vals[vals.length-1];\r\n\t},\r\n\tgetEditorForDataFrame: function(type, frametype){\r\n\t\tvar vals = this.getValidDataEditorList(type, frametype);\r\n\t\treturn vals[vals.length-1];\r\n\t},\r\n\tregisterViewerForTypes: function(viewer, label, types){\r\n\t\tfor(var i = 0; i < types.length; i++){\r\n\t\t\tif(typeof this.registeredDataViewers[types[i]] == \"undefined\"){\r\n\t\t\t\tthis.registeredDataViewers[types[i]] = [];\r\n\t\t\t}\r\n\t\t\tif(this.registeredDataViewers[types[i]].indexOf(viewer) == -1){\r\n\t\t\t\tthis.registeredDataViewers[types[i]].push(viewer);\r\n\t\t\t\tthis.renderers[viewer] = {label: label};\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tregisterEditorForTypes: function(viewer, label, types){\r\n\t\tfor(var i = 0; i < types.length; i++){\r\n\t\t\tif(typeof this.registeredDataEditors[types[i]] == \"undefined\"){\r\n\t\t\t\tthis.registeredDataEditors[types[i]] = [];\r\n\t\t\t}\r\n\t\t\tif(this.registeredDataEditors[types[i]].indexOf(viewer) == -1){\r\n\t\t\t\tthis.registeredDataEditors[types[i]].push(viewer);\r\n\t\t\t\tthis.renderers[viewer] = {label: label};\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t},\r\n\tregisterEditorForFrameType: function(viewer, label, frametype){\r\n\t\tthis.renderers[viewer] = {label: label};\r\n\t\tif(typeof this.registeredDataEditors[frametype] == \"undefined\") this.registeredDataEditors[frametype] = [];\r\n\t\tif(this.registeredDataEditors[frametype].indexOf(viewer) == -1){\r\n\t\t\tthis.registeredDataEditors[frametype].push(viewer);\r\n\t\t}\r\n\t},\r\n\tregisterViewerForFrameType: function(viewer, label, frametype){\r\n\t\tthis.renderers[viewer] = {label: label};\r\n\t\tif(typeof this.registeredDataViewers[frametype] == \"undefined\") this.registeredDataViewers[frametype] = [];\r\n\t\tif(this.registeredDataViewers[frametype].indexOf(viewer) == -1){\r\n\t\t\tthis.registeredDataViewers[frametype].push(viewer);\r\n\t\t}\r\n\t},\r\n\tregisterViewerForProperties: function(viewer, label, properties){\r\n\t\tfor(var i = 0; i < properties.length; i++){\r\n\t\t\tif(typeof this.registeredPropertyViewers[properties[i]] == \"undefined\"){\r\n\t\t\t\tthis.registeredPropertyViewers[properties[i]] = [];\r\n\t\t\t}\r\n\t\t\tif(this.registeredPropertyViewers[properties[i]].indexOf(viewer) == -1){\r\n\t\t\t\tthis.registeredPropertyViewers[properties[i]].push(viewer);\r\n\t\t\t\tthis.renderers[viewer] = {label: label};\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tregisterEditorForProperties: function(viewer, label, properties){\r\n\t\tfor(var i = 0; i < properties.length; i++){\r\n\t\t\tif(typeof this.registeredPropertyEditors[properties[i]] == \"undefined\"){\r\n\t\t\t\tthis.registeredPropertyEditors[properties[i]] = [];\r\n\t\t\t}\r\n\t\t\tif(this.registeredPropertyEditors[properties[i]].indexOf(viewer) == -1){\r\n\t\t\t\tthis.registeredPropertyEditors[properties].push(viewer);\r\n\t\t\t\tthis.renderers[viewer] = {label: label};\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\trenderers: {\r\n\t\tHTMLStringViewer: { label: \"String Viewer\"},\r\n\t\tHTMLStringEditor: { label: \"String Editor\"},\r\n\t\tHTMLPropertyViewer: { label: \"HTML Property Viewer\"}\r\n\t},\r\n\tpatternMatchesRenderer: function(pattern, renderer){\r\n\t\tif(typeof pattern == \"object\" && pattern.length){ //multiple patterns are ANDed\r\n\t\t\tfor(var i = 0 ; i<pattern.length; i++){\r\n\t\t\t\tvar fp = new FramePattern(pattern[i]);\r\n\t\t\t\tif(!fp.checkRenderer(renderer)) return false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar fp = new FramePattern(pattern);\r\n\t\t\treturn fp.checkRenderer(renderer);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nRenderingMap.getAvailableObjectViewers = function(renderer){\r\n\tvar entries = ['html', 'json'];\r\n\treturn entries;\r\n}\r\n\r\nRenderingMap.decorateRenderer = function(options, renderer){\r\n\tvar compiled_options = this.compileOptions(options, renderer);\r\n\tif(compiled_options && compiled_options.mode){\r\n\t\trenderer.mode = compiled_options.mode;\r\n\t}\r\n\telse {\r\n\t\tif(renderer.parent && renderer.parent.mode) renderer.mode = renderer.parent.mode;\r\n\t\telse renderer.mode = \"view\";\r\n\t}\r\n\tif(compiled_options && compiled_options.view){\r\n\t\trenderer.view = compiled_options.view;\r\n\t}\r\n\telse {\r\n\t\tif(renderer.parent && renderer.parent.view) renderer.view = renderer.parent.view;\r\n\t\telse renderer.view = \"full\";\r\n\t}\r\n\tif(compiled_options && compiled_options.facets){\r\n\t\trenderer.facets = compiled_options.facets;\r\n\t}\r\n\telse {\r\n\t\trenderer.facets = renderer.getDefaultFacets();\r\n\t}\r\n\tif(compiled_options && compiled_options.facet && typeof renderer.facets[compiled_options.facet] == \"object\"){\r\n\t\trenderer.facet = compiled_options.facet;\r\n\t}\t\r\n\telse {\r\n\t\tvar deffacet = renderer.getDefaultFacet();\r\n\t\tif(typeof renderer.facets[deffacet] == \"object\"){\r\n\t\t\trenderer.facet = deffacet;\r\n\t\t}\r\n\t\telse {\r\n\t\t\trenderer.facet = key(renderer.facets);\r\n\t\t}\r\n\t}\r\n\tif(compiled_options && compiled_options.hide_disabled_buttons){\r\n\t\trenderer.hide_disabled_buttons = compiled_options.hide_disabled_buttons;\r\n\t}\r\n\telse if(renderer.parent) renderer.hide_disabled_buttons = parent.hide_disabled_buttons;\r\n\telse renderer.hide_disabled_buttons = true;\r\n\tif(compiled_options && typeof compiled_options.features == \"object\"){\r\n\t\trenderer.features = compiled_options.features;\r\n\t}\r\n\telse {\r\n\t\trenderer.features = renderer.facets[renderer.facet].features;\r\n\t\t//renderer.features = renderer.getDefaultFeatures(renderer.facet);\r\n\t}\r\n\tif(compiled_options && typeof compiled_options.controls == \"object\"){\r\n\t\trenderer.controls = compiled_options.controls;\r\n\t}\r\n\telse {\r\n\t\trenderer.controls = renderer.facets[renderer.facet].controls;\r\n\t\t//renderer.controls = renderer.getDefaultControls();\r\n\t}\r\n\tif(compiled_options && typeof compiled_options.viewerType != \"undefined\"){\r\n\t\trenderer.viewerType = compiled_options.viewerType;\r\n\t\tif(compiled_options.viewerOptions)\r\n\t\t\trenderer.viewerOptions = compiled_options.viewerOptions;\r\n\t}\r\n\tif(compiled_options && typeof compiled_options.header != \"undefined\"){}\r\n\telse {\r\n\t\trenderer.header_viewer = new ObjectViewer.HTMLObjectHeaderViewer();\r\n\t}\r\n\tif(compiled_options && typeof compiled_options.filter != \"undefined\"){}\r\n\telse {}\r\n\tif(compiled_options && typeof compiled_options.sort != \"undefined\"){}\r\n\telse {}\r\n\treturn options;\r\n}\t\r\n\r\nRenderingMap.compileOptions = function(options, renderer){\r\n\tvar compiled_options = {};\r\n\tvar rules = [];\r\n\tfor(var key in options){\r\n\t\tif(key != \"rules\"){\r\n\t\t\tcompiled_options[key] = options[key];\r\n\t\t}\r\n\t}\r\n\tif(options.rules){\r\n\t\tfor(var i = 0; i<options.rules.length; i++){\r\n\t\t\tvar match = (!options.rules[i].pattern || this.patternMatchesRenderer(options.rules[i].pattern, renderer));\r\n\t\t\tif(match && options.rules[i].output){\r\n\t\t\t\tfor(var k in options.rules[i].output){\r\n\t\t\t\t\tcompiled_options[k] = options.rules[i].output[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn compiled_options;\r\n}\r\n\r\n\r\nRenderingMap.registerViewerForTypes(\"HTMLBooleanViewer\", \"Checkbox Viewer\", [\"xsd:boolean\"]);\r\nRenderingMap.registerEditorForTypes(\"HTMLBooleanEditor\", \"Checkbox Editor\", [\"xsd:boolean\"]);\r\nRenderingMap.registerViewerForFrameType(\"HTMLChoiceViewer\", \"Choice Viewer\", \"oneOf\");\r\nRenderingMap.registerEditorForFrameType(\"HTMLChoiceEditor\", \"Choice Selector\", \"oneOf\");\r\nRenderingMap.registerViewerForTypes(\"HTMLCoordinateViewer\", \"Coordinate Viewer\", [\"xdd:coordinate\", \"xdd:coordinatePolyline\", \"xdd:coordinatePolygon\"]);\r\nRenderingMap.registerEditorForTypes(\"HTMLCoordinateEditor\", \"Coordinate Editor\", [\"xdd:coordinate\", \"xdd:coordinatePolyline\", \"xdd:coordinatePolygon\"]);\r\nRenderingMap.registerViewerForTypes(\"HTMLDateViewer\", \"Date Viewer\", [\"xsd:date\", \"xsd:dateTime\", \"xsd:gYear\", \r\n\t\"xsd:gYearRange\", \"xsd:gMonth\", \"xsd:gDay\", \"xsd:gYearMonth\", \"xsd:gMonthDay\", \"xsd:dateTimeStamp\"]);\r\nRenderingMap.registerEditorForTypes(\"HTMLDateEditor\", \"Date Editor\", [\"xsd:date\", \"xsd:dateRange\" ,\"xsd:dateTime\", \"xsd:gYear\", \r\n\t\"xsd:gYearRange\", \"xsd:gMonth\", \"xsd:gDay\", \"xsd:gYearMonth\", \"xsd:gMonthDay\", \"xsd:dateTimeStamp\"]);\r\nRenderingMap.registerViewerForFrameType(\"HTMLEntityViewer\", \"Document Viewer\", \"document\");\r\nRenderingMap.registerEditorForFrameType(\"HTMLEntityEditor\", \"Document Selector\", \"document\");\r\nRenderingMap.registerViewerForTypes(\"HTMLImageViewer\", \"Image Viewer\", [\"xdd:url\", \"xsd:anyURI\", \"xsd:base64Binary\"]);\r\nRenderingMap.registerEditorForTypes(\"HTMLImageEditor\", \"Image Editor\", [\"xsd:base64Binary\"]);\r\nRenderingMap.registerViewerForTypes(\"HTMLImageViewer\", \"Image Viewer\", [\"xdd:url\", \"xsd:anyURI\", \"xsd:base64Binary\"]);\r\nRenderingMap.registerEditorForTypes(\"HTMLImageEditor\", \"Image Editor\", [\"xsd:base64Binary\"]);\r\nRenderingMap.registerViewerForTypes(\"HTMLLinkViewer\", \"Link Viewer\", [\"xdd:url\", \"xsd:anyURI\"]);\r\nRenderingMap.registerViewerForTypes(\"HTMLNumberViewer\", \"Number with commas\", \r\n\t\t[\"xsd:decimal\", \"xsd:double\", \"xsd:float\", \"xsd:short\", \"xsd:integer\", \"xsd:long\", \r\n\t\t\t\"xsd:nonNegativeInteger\", \"xsd:positiveInteger\", \"xsd:negativeInteger\", \"xsd:nonPositiveInteger\"]);\r\nRenderingMap.registerViewerForTypes(\"HTMLRangeViewer\", \"Range Viewer\", [\"xdd:integerRange\", \"xdd:decimalRange\"]);\r\nRenderingMap.registerEditorForTypes(\"HTMLRangeEditor\", \"Range Editor\", [\"xdd:integerRange\", \"xdd:decimalRange\"]);\r\nRenderingMap.registerViewerForTypes(\"SantizedHTMLViewer\", \"Sanitized HTML\", [\"xsd:string\", \"xdd:html\"]);\r\n\r\n\r\nFramePattern = function(pattern){\r\n\tthis.renderer = (pattern.renderer ? pattern.renderer : false);\r\n\tthis.label = (pattern.value ? pattern.value : false);\r\n\tthis.frame_type = (pattern.frame_type ? pattern.frame_type : false);\r\n\tthis.subject = (pattern.subject ? pattern.subject : false);\r\n\tthis.subjectClass = (pattern.subjectClass ? pattern.subjectClass : false);\r\n\tthis.range = (pattern.range ? pattern.range : false);\r\n\tthis.property = (pattern.property ? pattern.property : false);\r\n\tthis.value = (pattern.value ? pattern.value : false);\r\n\tthis.parent = (pattern.parent ? new FramePattern(pattern.parent) : false);\r\n\tthis.children = [];\r\n\tif(pattern.children){\r\n\t\tfor(var i = 0 ; i < pattern.children.length ; i++){\r\n\t\t\tthis.children.push(new FramePattern(pattern.children[i]));\r\n\t\t}\r\n\t}\r\n\tthis.depth = (typeof pattern.depth != \"undefined\" ? pattern.depth : false);\r\n\tthis.index = (pattern.index ? pattern.index : false);\r\n\tthis.status = (pattern.status ? pattern.status : false);\r\n}\r\n\r\nFramePattern.prototype.checkRenderer = function(renderer){\r\n\tvar rtype = this.getRendererType(renderer);\r\n\tif(!rtype) return false;\r\n\tif(this.renderer && this.renderer != rtype) return false;\r\n\tif(this.illegalRuleType(rtype)) return false;\r\n\tif(this.frame_type && !this.checkFrameType(rtype, renderer)) return false;\r\n\tif(this.label && !this.checkLabel(rtype, renderer)) return false;\r\n\tif(this.subject && !this.checkSubject(rtype, renderer)) return false;\r\n\tif(this.subjectClass && !this.checkSubjectClass(rtype, renderer)) return false;\r\n\tif(this.property && !this.checkProperty(rtype, renderer)) return false;\r\n\tif(this.depth !== false && !this.checkDepth(rtype, renderer)) return false;\r\n\tif(this.range && !this.checkRange(rtype, renderer)) return false;\r\n\tif(this.value && !this.checkValue(rtype, renderer)) return false;\r\n\tif(this.parent && !this.checkParent(rtype, renderer)) return false;\r\n\tif(this.children && this.children.length && !this.checkChildren(rtype, renderer)) return false;\r\n\tif(this.index && !this.checkIndex(rtype, renderer)) return false;\r\n\tif(this.status && !this.checkStatus(rtype, renderer)) return false;\r\n\treturn true;\r\n} \r\n\r\nFramePattern.prototype.illegalRuleType = function(rtype){\r\n\tif(rtype == 'value' && (this.children.length || this.label)) return true;\r\n\tif(rtype == 'object' && this.range ) return true;\r\n\treturn false;\r\n}\r\n\r\n/* subject is an id or an array of ids, \r\n/* match is positive if the renderer's subject appears in the array or is the id\r\n */\r\nFramePattern.prototype.checkSubject = function(subject, renderer){\r\n\tif(typeof this.subject != \"object\" || !this.subject.length) this.subject = [this.subject];\r\n\tvar rsubj = renderer.subject();\r\n\tfor(var i = 0 ; i<this.subject.length; i++){\r\n\t\tif(this.IDsMatch(subject[i], rsubj)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n//at least one child must match all child rules\r\nFramePattern.prototype.checkChildren = function(rtype, renderer){\r\n\tfor(var i = 0 ; i<this.children.length; i++){\r\n\t\tvar found = false;\r\n\t\tif(rtype == \"object\"){\r\n\t\t\tfor(var prop in renderer.properties){\r\n\t\t\t\tif(this.children[i].checkRenderer(renderer.properties[prop])) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(rtype == \"property\"){\r\n\t\t\tfor(var j = 0; j <= renderer.values.length; j++){\r\n\t\t\t\tif(this.children[j].checkRenderer(renderer.values[j])) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!found) return false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nFramePattern.prototype.checkStatus = function(rtype, renderer){\r\n\tif(typeof this.status != \"object\" || this.status.length == 0) this.status = [this.status];\r\n\tfor(var i = 0; i<this.status.length; i++){\r\n\t\tif(this.status[i] == \"updated\" && !renderer.isUpdated()) return false;\r\n\t\tif(this.status[i] == \"new\" && !renderer.isNew()) return false;\r\n\t\tif(this.status[i] == \"unchanged\" && renderer.isUpdated()) return false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nFramePattern.prototype.checkDepth = function(rtype, renderer){\r\n\treturn this.numberMatch(this.depth, renderer.depth());\r\n}\r\n\r\nFramePattern.prototype.checkParent = function(rtype, renderer){\r\n\treturn this.parent.checkRenderer(renderer.parent);\r\n}\r\n\r\nFramePattern.prototype.checkIndex = function(rtype, renderer){\r\n\tif(rtype == 'value'){\r\n\t\treturn this.index == renderer.index;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nFramePattern.prototype.checkProperty  = function(rtype, renderer){\r\n\tif(typeof this.property != \"object\" || !this.property.length) this.property = [this.property];\r\n\tfor(var i = 0 ; i<this.property.length; i++){\r\n\t\tif(this.propertyIDsMatch(renderer.property(), this.property[i])){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n//returns true if any of the values are found\r\nFramePattern.prototype.checkValue = function(rtype, renderer){\r\n\tif(typeof this.value != \"object\" || !this.value.length) this.value = [this.value];\r\n\tfor(var i = 0 ; i<this.value.length; i++){\r\n\t\tif(rtype == \"value\"){\r\n\t\t\tif(this.valuesMatch(renderer.value(), this.value[i])){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(rtype == \"property\"){\r\n\t\t\tfor(var j = 0; j<= renderer.values.length;  j++){\r\n\t\t\t\tif(this.getRendererType(renderer.values[i]) == 'value' &&\r\n\t\t\t\t\t\tthis.valuesMatch(renderer.values[i].value(), this.value[i])){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(rtype == \"object\"){\r\n\t\t\tfor(var prop in renderer.properties){\r\n\t\t\t\tif(this.checkValue(this.getRendererType(renderer.properties[prop]), renderer.properties[prop])){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nFramePattern.prototype.checkRange  = function(rtype, renderer){\r\n\tif(typeof this.range != \"object\" || !this.range.length) this.range = [this.range];\r\n\tfor(var i = 0 ; i<this.range.length; i++){\r\n\t\tif(this.rangeIDsMatch(renderer.range(), this.range[i])){ \r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nFramePattern.prototype.checkSubjectClass = function(rtype, renderer){\r\n\tif(typeof this.subjectClass != \"object\" || !this.subjectClass.length) this.subjectClass = [this.subjectClass];\r\n\tvar rcls = renderer.subjectClass();\r\n\tfor(var i = 0 ; i<this.subjectClass.length; i++){\r\n\t\tif(this.classIDsMatch(this.subjectClass[i], rcls)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nFramePattern.prototype.checkFrameType = function (rtype, renderer){\r\n\tif(rtype == \"object\") return this.frame_type == \"object\";\r\n\tif(rtype == \"value\") {\r\n\t\tif(renderer.frame){\r\n\t\t\treturn this.frame_type == renderer.frame.ftype();\r\n\t\t}\r\n\t\telse {\r\n\t\t\talert(JSON.stringify(renderer));\r\n\t\t\talert(\"No frame\");\r\n\t\t}\r\n\t}\r\n\tif(rtype == \"property\") return false;\r\n}\r\n\r\nFramePattern.prototype.checkLabel = function(rtype, renderer){\r\n\tif(typeof renderder.getLabel != \"function\"){\r\n\t\tconsole.log(new Error(\"Rule passed to check label with broken renderer object - no getLabel\"));\r\n\t\treturn false;\r\n\t}\r\n\treturn this.stringMatch(this.label, renderer.getLabel());\r\n}\r\n\r\nFramePattern.prototype.IDsMatch = function(ida, idb){\r\n\treturn TerminusClient.FrameHelper.compareIDs(ida, idb);\r\n}\r\n\r\nFramePattern.prototype.classIDsMatch = function(ida, idb){\r\n\treturn this.IDsMatch(ida, idb);\r\n}\r\nFramePattern.prototype.propertyIDsMatch = function(ida, idb){\r\n\tvar match = this.IDsMatch(ida, idb);\r\n\treturn match;\r\n}\r\nFramePattern.prototype.rangeIDsMatch = function(ida, idb){\r\n\treturn this.IDsMatch(ida, idb);\r\n}\r\nFramePattern.prototype.valuesMatch = function(vala, valb){\r\n\treturn vala == valb;\r\n}\r\nFramePattern.prototype.numberMatch = function(vala, valb){\r\n\tif(typeof vala == \"string\"){\r\n\t\ttry {\r\n\t\t\treturn eval(valb + vala);\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn vala === valb;\r\n}\r\n\r\nFramePattern.prototype.stringMatch = function(vala, valb){\r\n\tvar pat = new RegExp(vala);\r\n\treturn pat.test(valb);\r\n}\r\n\r\nFramePattern.prototype.getRendererType = function(renderer){\r\n    if(renderer.constructor.name == \"ObjectRenderer\") return \"object\";\r\n    if(renderer.constructor.name == \"PropertyRenderer\") return \"property\";\r\n    if(renderer.constructor.name == \"ValueRenderer\") return \"value\";\r\n\tif(renderer.renderer_type) return renderer.renderer_type;\r\n\tconsole.log(new Error(\"frame configuration passed non-renderer type \" + renderer.constructor.name));\r\n\tconsole.log(renderer);\r\n\treturn false;\r\n}\r\n\r\n\r\n\r\nmodule.exports=RenderingMap\r\n\r\n\r\n","const TerminusPluginManager = require('../plugins/TerminusPlugin');\r\n\r\nlet HTMLFrameHelper = {};\r\n\r\nHTMLFrameHelper.getActionControl = function(type, control, label, callback, disabled){\r\n\tvar pman = new TerminusPluginManager();\r\n\tvar dpropDOM = document.createElement(\"span\");\r\n\tdpropDOM.setAttribute(\"class\", \"terminus-action-control \" + type + \"-\" + control);\r\n\tvar pman = new TerminusPluginManager();\r\n    /*if(pman.pluginAvailable(\"font-awesome\")){\r\n\t\tvar icon = document.createElement('icon');\r\n\t\tvar faic = this.getControlIcon(control);\r\n\t\tif(disabled){\r\n\t\t\ticon.setAttribute(\"class\", \"terminus-frame-control frame-control-action action-disabled fa fa\" + faic + \" \" + type + \"-\" + control + \"-disabled terminus-font-align\");\r\n\t\t\ticon.setAttribute(\"title\", disabled);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ticon.setAttribute(\"class\", \"terminus-frame-control frame-control-action frame-control-action fa fa\" + faic + \" \" + type + \"-\" + control + \" terminus-font-align\");\r\n\t\t\ticon.addEventListener(\"click\", function(){\r\n\t\t\t\tcallback(control);\r\n\t\t\t});\r\n\t\t}\r\n\t\tdpropDOM.appendChild(icon);\r\n\t}\r\n\telse{*/\r\n\t\tvar button = document.createElement(\"button\");\r\n\t\tbutton.appendChild(document.createTextNode(label));\r\n\t\tif(disabled){\r\n\t\t\tbutton.setAttribute(\"class\", \"terminus-frame-control terminus-btn frame-control-action action-disabled \" + type + \"-\" + control + \"-disabled\");\r\n\t\t\tbutton.setAttribute(\"title\", disabled);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tbutton.setAttribute(\"class\", \"terminus-frame-control terminus-btn frame-control-action \" + type + \"-\" + control);\r\n\t\t\tbutton.addEventListener(\"click\", function(){\r\n\t\t\t\tcallback(control);\r\n\t\t\t});\r\n\t\t}\r\n\t\tdpropDOM.appendChild(button);\r\n\t//}\r\n\treturn dpropDOM;\r\n}\r\n\r\nHTMLFrameHelper.getSettingsControl = function(view){\r\n\tvar pman = new TerminusPluginManager();\r\n\tif(pman.pluginAvailable(\"font-awesome\")){\r\n\t\tvar icon = document.createElement('icon');\r\n\t\tif(view == 'property') icon.setAttribute('class', 'fa fa-cog terminus-pointer');\r\n\t\telse if(view == 'data') icon.setAttribute('class', 'fa fa-edit terminus-pointer');\r\n\t\ticon.setAttribute('style', 'margin: 10px;')\r\n\t\treturn icon;\r\n\t}\r\n\telse{\r\n\t\tvar button = document.createElement(\"button\");\r\n\t\tbutton.setAttribute('class', 'terminus-btn');\r\n\t\tbutton.appendChild(document.createTextNode('Settings'));\r\n\t\treturn button;\r\n\t}\r\n}\r\n\r\nHTMLFrameHelper.getControlIcon = function(control){\r\n\tvar icon;\r\n\tswitch(control){\r\n\t\tcase 'delete':\r\n\t\t\ticon = '-alt-delete';\r\n\t\tbreak;\r\n\t\tcase 'add':\r\n\t\t\ticon = '-plus';\r\n\t\tbreak;\r\n\t\tcase 'reset':\r\n\t\t\ticon = '-undo';\r\n\t\tbreak;\r\n\t\tcase 'save':\r\n\t\t\ticon = '-save';\r\n\t\tbreak;\r\n\t\tcase 'hide':\r\n\t\t\ticon = '-eye-slash';\r\n\t\tbreak;\r\n\t}\r\n\treturn icon;\r\n}\r\n\r\nHTMLFrameHelper.getSelectionControl = function(type, options, selected, callback){\r\n\tvar sel = document.createElement(\"select\");\r\n\tsel.setAttribute(\"class\", \"terminus-frame-selector frame-control-selection \" + type);\r\n\tfor(var i = 0; i < options.length; i++){\r\n\t\tvar opt = document.createElement(\"option\");\r\n\t\tif(typeof options[i] == \"object\"){\r\n\t\t\topt.value = options[i].value;\r\n\t\t\tvar label = (options[i].label ?  document.createTextNode(options[i].label) : document.createTextNode(TerminusClient.FrameHelper.labelFromURL(options[i].value)));\r\n\t\t\topt.appendChild(label);\r\n\t\t}\r\n\t\telse {\r\n\t\t\topt.value = options[i];\r\n\t\t\tlabel = TerminusClient.FrameHelper.labelFromURL(opt.value);\r\n\t\t\topt.appendChild(document.createTextNode(label));\r\n\t\t}\r\n\t\tif(selected == opt.value){\r\n\t\t\topt.setAttribute(\"selected\", \"selected\");\r\n\t\t}\r\n\t\tsel.appendChild(opt);\r\n\t}\r\n\tsel.addEventListener(\"change\", function(){\r\n\t\tcallback(this.value);\r\n\t});\r\n\treturn sel;\r\n}\r\n\r\nHTMLFrameHelper.getModeSelectorDOM = function(which, renderer){\r\n\tvar viewsDOM = document.createElement(\"span\");\r\n\tviewsDOM.setAttribute(\"class\", \"terminus-mode terminus-\"+which+\"-mode\");\r\n\tif(renderer.mode == \"view\"){\r\n\t\tvar callback = function(){ renderer.setMode(\"edit\");}\r\n\t\tviewsDOM.appendChild(HTMLFrameHelper.getActionControl(\"terminus-mode terminus-\"+which+\"-mode\", \"edit\", \" Edit \", callback));\r\n\t}\r\n\telse if(renderer.isNew()){\r\n\t\treturn false;\r\n\t}\r\n\telse {\r\n\t\tvar callback = function(){ renderer.cancel();}\r\n\t\tviewsDOM.appendChild(HTMLFrameHelper.getActionControl(which, \"cancel\", \"Cancel\", callback));\r\n\t}\r\n\treturn viewsDOM;\r\n}\r\n\r\nHTMLFrameHelper.goToName = function(s, p, i){\r\n\tvar url = window.location.href;\r\n\tif(url){\r\n\t\tvar wbits = url.split(\"#\");\r\n\t\tvar loc = wbits[0];\r\n\t\tvar sh = TerminusClient.FrameHelper.getShorthand(s);\r\n\t    if(!sh) sh = s;\r\n\t\tvar bits = sh.split(\":\");\r\n\t\tif(bits.length > 1) sh = bits[1];\r\n\t\tvar htmlid = sh;\r\n\t\tif(p){\r\n\t\t\tvar prop = TerminusClient.FrameHelper.getShorthand(p);\r\n\t\t\tif(!prop ) prop = p;\r\n\t\t\tvar bits = prop.split(\":\");\r\n\t\t\tif(bits.length > 1) prop = bits[1];\r\n\t\t\thtmlid += \"_\" + prop;\r\n\t\t\tif(i){\r\n\t\t\t\thtmlid += \"_\" + i;\r\n\t\t\t}\r\n\t\t}\r\n\t\twindow.location = loc + \"#\" + htmlid;\r\n\t}\r\n}\r\n\r\n\r\n\r\n/*HTMLFrameHelper.getFrameRow = function(){\r\n\tvar row = document.createElement('div');\r\n\trow.setAttribute('class', 'terminus-frame-row');\r\n\treturn row;\r\n}\r\n\r\nHTMLFrameHelper.getFrameGroup = function(frow){\r\n\tvar fl = document.createElement('div');\r\n\tfl.setAttribute('class', 'terminus-frame-length');\r\n\tfrow.appendChild(fl);\r\n\r\n\tvar fg = document.createElement('div');\r\n\tfg.setAttribute('class', 'terminus-frame-group');\r\n\tfl.appendChild(fg);\r\n\treturn fl;\r\n}*/\r\n\r\nHTMLFrameHelper.getInfoboxDOM = function(type, label, value, help, input){\r\n\t/*var frow = this.getFrameRow();\r\n\tvar fgroup = this.getFrameGroup(frow);*/\r\n\tvar infoDOM = document.createElement(\"span\");\r\n\tinfoDOM.setAttribute(\"class\", \"terminus-frame-infobox-box \" + \"terminus-\" +type );\r\n\t//fgroup.appendChild(infoDOM);\r\n\tif(help){\r\n\t\tinfoDOM.setAttribute(\"title\", help);\r\n\t}\r\n\tif(label){\r\n\t\tvar linfo = document.createElement(\"span\");\r\n\t\tlinfo.setAttribute(\"class\", \"terminus-frame-infobox-label \" + \"terminus-\" +type + \"-label\");\r\n\t\tlinfo.appendChild(document.createTextNode(label));\r\n\t\tinfoDOM.appendChild(linfo);\r\n\t}\r\n\tvar lspacer = document.createElement(\"span\");\r\n\tlspacer.setAttribute(\"class\", \"terminus-frame-infobox-spacer \" + \"terminus-\" +type + \"-spacer\");\r\n\tlspacer.appendChild(document.createTextNode(\" \"));\r\n\tinfoDOM.appendChild(lspacer);\r\n\tvar lval = document.createElement(\"span\");\r\n\tlval.setAttribute(\"class\", \"terminus-frame-infobox-value \" + \"terminus-\" +type + \"-value terminus-property-label-align\");\r\n\tif(input){\r\n\t\tinput.value = value;\r\n\t\tlval.appendChild(input);\r\n\t}\r\n\telse if(value) {\r\n\t\tvar sh = TerminusClient.FrameHelper.getShorthand(value);\r\n        if(sh){\r\n    \t   \tvar bits = sh.split(\":\");\r\n            sh = bits[1];\r\n   \t\t\tlval.setAttribute(\"title\", value);\r\n\t\t\tlval.appendChild(document.createTextNode(sh));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlval.appendChild(document.createTextNode(value));\r\n\t\t}\r\n\t}\r\n\tinfoDOM.appendChild(lval);\r\n\treturn infoDOM;\r\n}\r\n\r\nmodule.exports=HTMLFrameHelper\r\n","/*\r\n * Utility class which runs a query against the schema and presents the returned classes as a drop-down / class filter list\r\n */\r\n//const FrameHelper = require('../FrameHelper');\r\nconst WOQLQuery = require('../query/WOQLQuery');\r\n\r\nTerminusClassChooser = function(ui, filter, chosen){\r\n\tthis.ui = ui;\r\n\tthis.choice = (chosen ? chosen : false);\r\n\tthis.filter = filter;\r\n\tthis.show_single = true;\r\n}\r\n\r\nTerminusClassChooser.prototype.setRoot = function(root){\r\n\tthis.root = root;\r\n}\r\n\r\nTerminusClassChooser.prototype.setFilter = function(filter){\r\n\tthis.filter = filter;\r\n}\r\n\r\nTerminusClassChooser.prototype.change = function(cls){\r\n\talert(\"Need to specify class chooser function (\" + cls + \")\");\r\n}\r\n\r\nTerminusClassChooser.prototype.getAsDOM = function(style){\r\n\tvar ccdom = document.createElement(\"span\");\r\n\tccdom.setAttribute(\"class\", \"terminus-class-chooser\");\r\n\tvar ccsel = document.createElement(\"select\");\r\n\tccsel.setAttribute(\"class\", style + \" terminus-type-select terminus-class-select\");\r\n\t// ccsel.setAttribute(\"class\", \"terminus-class-select terminus-type-select terminus-query-select\");\r\n\tvar self = this;\r\n\tccsel.addEventListener(\"change\", function(){\r\n\t\tif(this.value != this.choice){\r\n\t\t\tthis.choice = this.value;\r\n\t\t\tself.change(this.value);\r\n\t\t}\r\n\t});\r\n\tccdom.appendChild(ccsel);\r\n\tvar wq = new WOQLQuery(this.ui.client, {}, this.ui);\r\n\tvar woql = wq.getClassListMetaDataQuery(this.filter);\r\n\tvar self = this;\r\n\twq.execute(woql)\r\n\t.then(function(response){\r\n\t\tvar opts = self.getResultsAsOptions(response);\r\n\t\tif(opts){\r\n\t\t\tfor(var i = 0; i<opts.length; i++){\r\n\t\t\t\tccsel.appendChild(opts[i]);\r\n\t\t\t}\r\n\t\t\tself.options = opts;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tccdom.removeChild(ccsel);\r\n\t\t}\r\n\t});\r\n\treturn ccdom;\r\n}\r\n\r\nTerminusClassChooser.prototype.getResultsAsOptions = function(clist){\r\n\tvar choices = [];\r\n\tif(clist.bindings){\r\n\t\tif(this.show_single == false && clist.bindings.length < 2) return false;\r\n\t\tif(this.empty_choice){\r\n\t\t\tvar opt1 = document.createElement(\"option\");\r\n\t\t\topt1.setAttribute(\"class\", \"terminus-class-choice terminus-empty-choice\");\r\n\t\t\topt1.value = \"\";\r\n\t\t\topt1.appendChild(document.createTextNode(this.empty_choice));\r\n\t\t\tchoices.push(opt1);\r\n\t\t}\r\n\t\tvar added = [];\r\n\t\tfor(var i = 0; i<clist.bindings.length; i++){\r\n\t\t\tvar bclass = this.getVariableValueFromBinding(\"Element\", clist.bindings[i]);\r\n\t\t\tif(!bclass) bclass = this.getVariableValueFromBinding(\"Class\", clist.bindings[i]);\r\n\t\t\tif(bclass && added.indexOf(bclass) == -1){\r\n\t\t\t\tadded.push(bclass);\r\n\t\t\t\tvar opt = document.createElement(\"option\");\r\n\t\t\t\topt.setAttribute(\"class\", \"terminus-class-choice\");\r\n\t\t\t\topt.value = bclass;\r\n\t\t\t\tif(opt.value == this.choice){\r\n\t\t\t\t\topt.selected = true;\r\n\t\t\t\t}\r\n\t\t\t\tvar lab = this.getVariableValueFromBinding(\"Label\", clist.bindings[i]);\r\n\t\t\t\tif(!lab || lab == \"unknown\"){\r\n\r\n\t\t\t\t\tlab = TerminusClient.FrameHelper.labelFromURL(bclass);\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif(lab[\"@value\"]) lab = lab[\"@value\"];\r\n\t\t\t\topt.appendChild(document.createTextNode(lab));\r\n\t\t\t\tchoices.push(opt);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn choices;\r\n}\r\n\r\nTerminusClassChooser.prototype.getVariableValueFromBinding = function(varname, bind){\r\n\tfor(var key in bind){\r\n\t\tvar skey = key.substring(key.lastIndexOf(\"/\")+1);\r\n\t\tif(skey == varname){\r\n\t\t\treturn bind[key];\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nmodule.exports=TerminusClassChooser\r\n","const WOQLQuery = require('../query/WOQLQuery');\r\nconst Renderers = require('./ObjectRenderer');\r\n\r\nfunction TerminusDocumentViewer(ui, action, options){\r\n\tthis.ui = ui;\r\n\tthis.server = this.ui.server();\r\n\tthis.db = this.ui.db();\r\n\tthis.init();\r\n\tthis.mode = (options && options.mode ? options.mode : \"view\");\r\n\tthis.editor = (options && options.editor ? options.editor : false);\r\n\tthis.load_schema = (options && options.load_schema ? options.load_schema : true);\r\n\tthis.config_options = this.getBuiltInViewerOptions();\r\n\tthis.options = (options ? options : this.config_options[action]);\r\n\tthis.action = action;\r\n\tthis.document = false;\r\n}\r\n\r\nTerminusDocumentViewer.prototype.init = function(){\r\n\tvar wq = new WOQLQuery(this.ui.client, this.options, this.ui);\r\n\tvar woql = wq.getClassMetaDataQuery();\r\n\tvar self = this;\r\n\tself.classmeta = {};\r\n\tself.instancemeta = {};\r\n\twq.execute(woql).then(function(wresult){\r\n\t\tif(wresult && wresult.hasBindings()){\r\n\t\t\tfor(var i = 0; i<wresult.bindings.length; i++){\r\n\t\t\t\tvar cls = wresult.bindings[i].Class;\r\n\t\t\t\tif(cls && typeof self.classmeta[cls] == \"undefined\"){\r\n\t\t\t\t\tself.classmeta[cls] = wresult.bindings[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tself.refreshPage();\r\n\t\t}\r\n\t})\r\n\t.catch(function(e){\r\n\t\tconsole.log(e);\r\n\t});\r\n}\r\n\r\nTerminusDocumentViewer.prototype.getInstanceMeta = function(elid){\r\n\tvar self = this;\r\n\tif(self.instancemeta && typeof self.instancemeta[elid] != \"undefined\") return self.instancemeta[elid] ;\r\n\tvar wq = new WOQLQuery(this.ui.client, this.options, this.ui);\r\n\tvar woql = wq.getInstanceMeta(elid);\r\n\treturn wq.execute(woql).then(function(wresult){\r\n\t\tif(wresult && wresult.hasBindings()){\r\n\t\t\tvar res = wresult.bindings[0];\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\treturn false;\r\n\t})\r\n\t.catch(function(e){\r\n\t\tconsole.log(e);\r\n\t});\r\n}\r\n\r\nTerminusDocumentViewer.prototype.getClassMeta = function(cls){\r\n\tif(typeof this.classmeta[cls]){\r\n\t\treturn this.classmeta[cls];\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusDocumentViewer.prototype.loadCreateDocument = function(url){\r\n\tif(url){\r\n\t\tthis.ui.showBusy(\"Fetching frame for document class \" + url);\r\n\t\tvar self = this;\r\n\t\tthis.mode = \"edit\";\r\n\t\tthis.page_config = \"create\";\r\n\t\tif(url.indexOf(\"/\") == -1 && url.indexOf(\":\") == -1) {\r\n\t\t\turl = \"schema:\" + url;\r\n\t\t}\r\n\t\treturn this.loadDocumentSchema(url)\r\n\t\t.then(function(response){\r\n\t\t\tself.ui.clearBusy();\r\n\t\t\tself.setLabel();\r\n\t\t})\r\n\t\t.catch(function(error) {\r\n\t\t\tconsole.error(error);\r\n\t\t\tself.ui.clearBusy();\r\n\t\t\tself.ui.showError(error);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nTerminusDocumentViewer.prototype.loadDocument = function(url, cls){\r\n\tif(!url) return false;\r\n\tvar self = this;\r\n\tif(url.substring(0,4) == \"doc:\"){\r\n\t\turl = url.substring(4);\r\n\t}\r\n\tthis.page_config = \"view\";\r\n\turl = url.replace(\"/candidate\", \"/platform/document\");\r\n\tthis.ui.showBusy(\"Loading Document from \" + url);\r\n\treturn this.ui.client.getDocument(url, {\"terminus:encoding\": \"terminus:frame\"})\r\n\t.then(function(response){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.loadDataFrames(response);\r\n\t\tself.setLabel();\r\n\t\tself.refreshPage();\r\n\t\tif(self.load_schema){\r\n\t\t\treturn self.loadDocumentSchema(self.document.cls).then(function(){ self.refreshPage()}).catch(function(e){console.error(e)});\r\n\t\t}\r\n\t\treturn response;\r\n\t})\r\n\t.catch(function(error) {\r\n\t\tconsole.error(error);\r\n\t\tself.ui.clearBusy();\r\n\t\tself.ui.showError(error);\r\n\t});\r\n}\r\n\r\nTerminusDocumentViewer.prototype.loadDocumentSchema = function(cls){\r\n\tvar self = this;\r\n\tvar ncls = TerminusClient.FrameHelper.unshorten(cls);\r\n\treturn this.ui.client.getClassFrame(false, ncls)\r\n\t.then(function(response){\r\n\t\tself.loadSchemaFrames(response, cls);\r\n\t\tself.refreshPage();\r\n\t});\r\n}\r\n\r\nTerminusDocumentViewer.prototype.deleteDocument = function(URL){\r\n\tthis.document = false;\r\n\tvar self = this;\r\n\tthis.ui.showBusy(\"Deleting Document \" + URL);\r\n\treturn this.ui.client.deleteDocument(URL)\r\n\t.then(function(response){\r\n\t\tself.ui.clearBusy();\r\n\t}).catch(function(error){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.ui.showError(error);\r\n\t});\r\n}\r\n\r\nTerminusDocumentViewer.prototype.createDocument = function(id){\r\n\tvar self = this;\r\n\tvar extr = this.renderer.extract();\r\n\tvar opts = { \"terminus:encoding\": \"jsonld\" };\r\n\tthis.ui.showBusy(\"Creating document\");\r\n\treturn this.ui.client.createDocument(id, extr, opts)\r\n\t.then(function(response){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.ui.showDocument(id);\r\n\t}).catch(function(error){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.ui.showError(error);\r\n\t});\r\n}\r\n\r\nTerminusDocumentViewer.prototype.updateDocument = function(){\r\n\tvar durl = this.document.subjid;\r\n\tvar extr = this.renderer.extract();\r\n\tvar self = this;\r\n\tvar opts = { \"terminus:encoding\": \"jsonld\" };\r\n\tthis.ui.showBusy(\"Updating document \" + durl);\r\n\treturn this.ui.client.updateDocument(durl, extr, opts)\r\n\t.then(function(response){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.ui.showDocument(durl);\r\n\t}).catch(function(error){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.ui.showError(error);\r\n\t});\r\n}\r\n\r\nTerminusDocumentViewer.prototype.loadDataFrames = function(dataframes, cls){\r\n\tif(!cls){\r\n\t\tif(this.document) cls = this.document.cls;\r\n\t\telse {\r\n\t\t\tif(dataframes && dataframes.length && dataframes[0] && dataframes[0].domain){\r\n\t\t\t\tcls = dataframes[0].domain;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif(cls){\r\n\t\tif(!this.document){\r\n\t\t\tthis.document = new TerminusClient.ObjectFrame(cls, dataframes);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.document.loadDataFrames(dataframes);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\talert(\"Missing Class\" + \" \" + \"Failed to add dataframes due to missing class\");\r\n\t}\r\n}\r\n\r\n\r\nTerminusDocumentViewer.prototype.loadSchemaFrames = function(classframes, cls){\r\n\tif(!cls){\r\n\t\tif(classframes && classframes.length && classframes[0] && classframes[0].domain){\r\n\t\t\tcls = classframes[0].domain;\r\n\t\t}\r\n\t}\r\n\tif(cls){\r\n\t\tif(!this.document){\r\n\t\t\tthis.document = new TerminusClient.ObjectFrame(cls);\r\n\t\t}\r\n\t\tif(classframes){\r\n\t\t\tthis.document.loadClassFrames(classframes);\r\n\t\t\tif(!this.document.subjid){\r\n\t\t\t\tthis.document.newDoc = true;\r\n\t\t\t\tthis.document.fillFromSchema(\"_:\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis.error(\"Missing Class\", \"Failed to add class frames due to missing class\");\r\n\t}\r\n}\r\n\r\nTerminusDocumentViewer.prototype.render = function(){\r\n\tif(!this.renderer && this.document){\r\n\t\tif(this.page_config){\r\n\t\t\tthis.options = this.getOptionsFromPageConfig(this.page_config);\r\n\t\t}\r\n\t\ttry{\r\n\t\t\tthis.renderer = new Renderers.ObjectRenderer(this.document, false, this.options);\r\n\t\t\tthis.renderer.mode = this.mode;\r\n\t\t\tthis.renderer.controller = this;\r\n\t\t}catch(e){\r\n\t \t\tconsole.error('TerminusDocumentViewer render',e.toString())\r\n\t \t}\r\n\t}\r\n\tif(this.renderer){\r\n\t\treturn this.renderer.render();\r\n\t}\r\n}\r\n\r\nTerminusDocumentViewer.prototype.getBuiltInViewerOptions = function(){\r\n\treturn FrameConfig;\r\n}\r\n\r\nTerminusDocumentViewer.prototype.getOptionsFromPageConfig = function(pageconf){\r\n\tif(typeof this.config_options[pageconf] == \"object\") {\r\n\t\treturn this.config_options[pageconf];\r\n\t}\r\n\treturn this.options;\r\n}\r\n\r\n\r\nTerminusDocumentViewer.prototype.getClient = function(){\r\n\treturn this.ui.client;\r\n}\r\n\r\nTerminusDocumentViewer.prototype.extract = function(options){\r\n\treturn this.renderer.extract();\r\n}\r\n\r\nTerminusDocumentViewer.prototype.getLabel = function(){\r\n\tvar lab = (this.cls ? this.cls : false);\r\n\tif(!lab) lab = (this.docid ? this.docid : \"Void\");\r\n\treturn lab;\r\n}\r\n\r\nTerminusDocumentViewer.prototype.setLabel = function(){\r\n\tif(this.document && this.labdom){\r\n\t\tTerminusClient.FrameHelper.removeChildren(this.labdom);\r\n\t\tvar dfs = this.document.getDataFrames(TerminusClient.FrameHelper.getStdURL(\"rdfs\", \"label\"));\r\n\t\tfor(var i = 0; i< dfs.length; i++){\r\n\t\t\tvar lab = dfs[i].get();\r\n\t\t\tif(lab) {\r\n\t\t\t\tthis.labdom.appendChild(document.createTextNode(lab));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusDocumentViewer.prototype.refreshPage = function(){\r\n\tif(this.pagedom){\r\n\t\tTerminusClient.FrameHelper.removeChildren(this.pagedom);\r\n\t\tvar rends = this.render();\r\n\t\tif(rends){\r\n\t\t\tthis.pagedom.appendChild(rends);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusDocumentViewer.prototype.getAsDOM = function(){\r\n\tvar holder = document.createElement(\"div\");\r\n\tholder.setAttribute(\"class\", \"terminus-document-holder\");\r\n\tif(this.mode !== 'edit'){ // dont provide drop down on create mode\r\n\t\tthis.controldom = document.createElement(\"div\");\r\n\t\tthis.controldom.setAttribute(\"class\", \"terminus-document-controller\");\r\n\t\tthis.controldom.appendChild(this.getDocumentPageControls());\r\n\t\tholder.appendChild(this.controldom);\r\n\t}\r\n\tthis.pagedom = document.createElement(\"div\");\r\n\tthis.pagedom.setAttribute(\"class\", \"terminus-document-page\");\r\n\tvar rends = this.render();\r\n\tif(rends){\r\n\t\tthis.pagedom.appendChild(rends);\r\n\t}\r\n\tholder.appendChild(this.pagedom);\r\n\treturn holder;\r\n}\r\n\r\nTerminusDocumentViewer.prototype.getDocumentPageControls = function(){\r\n\tvar dpc = document.createElement(\"select\");\r\n\tdpc.setAttribute(\"class\", \"terminus-form-select terminus-document-config\");\r\n\tfor(var i in this.config_options){\r\n\t\tif(i === 'create') continue; // create docuemnt option from config is not taken in edit mode \r\n\t\tvar opt = document.createElement(\"option\");\r\n\t\topt.value = i;\r\n\t\tif(this.page_config == i){\r\n\t\t\topt.selected = true;\r\n\t\t}\r\n\t\topt.appendChild(document.createTextNode(this.config_options[i].label));\r\n\t\tdpc.appendChild(opt);\r\n\t}\r\n\tvar self = this;\r\n\tdpc.addEventListener(\"change\", function(){\r\n\t\tself.page_config = this.value;\r\n\t\tself.renderer = false;\r\n\t\tself.refreshPage();\r\n\t})\r\n\treturn dpc;\r\n}\r\n\r\nmodule.exports=TerminusDocumentViewer\r\n","const WOQLResultsViewer = require('../query/WOQLResultsViewer');\r\nconst WOQLQuery = require('../query/WOQLQuery');\r\nconst UTILS= require('../Utils')\r\n\r\nfunction Datatables(){}\r\n\r\nDatatables.prototype.convertToDatatable = function(tab, ui){\r\n    var table = jQuery(tab).DataTable({\r\n         searching : false,\r\n         pageLength: 25,\r\n         lengthMenu: [10, 25, 50, 75, 100],\r\n         paging    : true,\r\n         select    : true,\r\n         columnDefs:[{targets:'_all',className:\"truncate\"}],\r\n         createdRow: function(row) {\r\n                            var td = $(row).find(\".truncate\");\r\n                            td.attr(\"title\", td.html());}\r\n    }); //jQuery(tab)\r\n\r\n    // on click of row connect to db, on click of 5th column delete db\r\n    jQuery(tab, 'tbody').on('click', 'td', function(){\r\n        if(table.cell(this).index().column == 5){\r\n            var dbInfo = table.row(jQuery(this).parents('tr')).data();\r\n            var dbId = UTILS.extractValueFromCell(dbInfo[0]);\r\n            ui.deleteDatabase(dbId);\r\n            return;\r\n        }\r\n        else ui.showDBMainPage();\r\n     }); // on click\r\n\r\n    tab.setAttribute('class'      , 'stripe dataTable terminus-db-size');\r\n    tab.setAttribute('cellpadding', '1');\r\n    tab.setAttribute('cellspacing', '0');\r\n    tab.setAttribute('border'     , '0');\r\n    return tab;\r\n}\r\n\r\n/*\r\n    dcb: datatable drawCallBack reference\r\n    ui: terminus ui reference\r\n    dt: datatable reference\r\n    query: new woqlquery with current pagination changes\r\n    pageInfo: current drawCallBack page change info\r\n    resultDOM: result dom on veiwer page\r\n*/\r\nDatatables.prototype.executeQuery = function(dcb, ui, dt, query, pageInfo, resultDOM){\r\n    var self = this;\r\n    dcb.wquery.execute(query)\r\n      .then(function(result){\r\n          if(true || !self.result){\r\n              self.result = new WOQLResultsViewer.WOQLResultsViewer(ui, result, null, pageInfo);\r\n          }\r\n          var rtab = self.result.getTable(result.bindings);\r\n          if(rtab){\r\n              self.getDataFromServer(rtab, pageInfo, ui, resultDOM);\r\n          }\r\n      })\r\n      .catch(function(err){\r\n          console.error(err);\r\n          self.ui.showError(err);\r\n      });\r\n}\r\n\r\n/* get query string based on datatable pagination and current query */\r\nDatatables.prototype.getQueryOnPagination = function(wq, settings){\r\n    switch(settings.query){\r\n        case 'Show_All_Documents':\r\n            return wq.getAllDocumentQuery(null, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_All_Data':\r\n            return wq.getEverythingQuery(null, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_All_Schema_Elements':\r\n            return wq.getElementMetaDataQuery(null, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_Document_Classes':\r\n        \tvar sqp = wq.getConcreteDocumentClassPattern(\"Class\");\r\n            return wq.getClassMetaDataQuery(sqp);\r\n        break;\r\n        case 'Show_All_Properties':\r\n            return wq.getPropertyListQuery(null, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_All_Classes':\r\n            return wq.getClassMetaDataQuery(null, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_Data_Class':\r\n            return  wq.getDataOfChosenClassQuery(settings.chosenValue, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_Property_Class':\r\n            return wq.getDataOfChosenPropertyQuery(settings.chosenValue, settings.pageLength, settings.start);\r\n        break;\r\n        case 'Show_Document_Info_by_Id':\r\n            return wq.getDocumentQuery(settings.chosenValue, settings.pageLength, settings.start);\r\n        break;\r\n        default:\r\n            console.log('Invalid woql option passed');\r\n        break;\r\n\r\n    }\r\n}\r\n\r\n/*\r\n    dcb: datatable drawCallBack reference\r\n    ui: terminus ui reference\r\n    dt: datatable reference\r\n    pageInfo: current drawCallBack page change info\r\n*/\r\nDatatables.prototype.generateNewQueryOnPageChange = function(dcb, ui, dt, pageInfo){\r\n    dcb.wquery = new WOQLQuery(ui.client, {}, ui);\r\n    UTILS.deleteStylizedEditor(ui, pageInfo.qTextDom);\r\n    var query = dt.getQueryOnPagination(dcb.wquery, pageInfo)\r\n    pageInfo.qTextDom.value = JSON.stringify(query);\r\n    UTILS.stylizeEditor(ui, pageInfo.qTextDom, 'query', 'javascript');\r\n    return query;\r\n}\r\n\r\n/*\r\n    dt: Datatable reference\r\n    len : current number of records to display\r\n*/\r\nDatatables.prototype.getCallbackSettings = function(dt, len, start){\r\n    var pageInfo = {};\r\n    pageInfo.pageLength = len;\r\n    pageInfo.start      = start;\r\n    pageInfo.qTextDom   = dt.qTextDom;\r\n    pageInfo.query      = dt.query;\r\n    pageInfo.chosenValue = dt.chosenValue;\r\n    return pageInfo;\r\n}\r\n\r\n/*\r\n    tab: datatable table dom\r\n    settings : settings from woql txt generator\r\n    resultDOM: result dom of viewer\r\n*/\r\nDatatables.prototype.setUp = function(tab, settings, resultDOM){\r\n    // delete previous datatable\r\n    TerminusClient.FrameHelper.removeChildren(this.dtdom);\r\n    this.dtdom = document.createElement('div');\r\n    this.dtdom.appendChild(tab);\r\n    resultDOM.appendChild(this.dtdom);\r\n    // saving query text box dom to change limit value on change of datatable page length\r\n    this.qTextDom = settings.qTextDom;\r\n    this.query = settings.query;\r\n    this.chosenValue = settings.chosenValue;\r\n}\r\n\r\n\r\nDatatables.prototype.getDataFromServer = function(dtResult, settings, ui, resultDOM){\r\n    var dt = this;\r\n    var tab = dtResult.tab;\r\n    this.setUp(tab, settings, resultDOM);\r\n    console.log('columns',dtResult.result.columns);\r\n    console.log('dtResult.result.data',dtResult.result.data);\r\n    // initialize datatables\r\n    var table = jQuery(tab).DataTable({\r\n         searching   : false,\r\n         pageLength  : settings.pageLength,\r\n         serverSide  : true,\r\n         processing  : true,\r\n         lengthMenu  : [5, 10, 25, 50, 75, 100],\r\n         dom         : 'Blfrtip',\r\n         columns     : dtResult.result.columns,\r\n         paging      : true,\r\n         select      : true,\r\n         ajax        : function (data, callback, settings) {\r\n                        callback(\r\n                            dtResult.result.data\r\n                        );},\r\n         buttons     : [{ extend: 'copy', text: 'Copy to clipboard' },\r\n                        { extend: 'excel', text: 'Export to Excel' }],\r\n         columnDefs  :[{targets:'_all',className:\"truncate\"}],\r\n         createdRow  : function(row){\r\n                            var td = $(row).find(\".truncate\");\r\n                            td.attr(\"title\", td.html());},\r\n         colReorder  : {addFixed : true, liveDrag:true},\r\n         scrollX     : true,\r\n         drawCallback: function(settings) {\r\n                             // on change of page length\r\n                             $(this).on( 'length.dt', function (e, settings, len){\r\n                                  var info = table.page.info();\r\n                                  var pageInfo = dt.getCallbackSettings(dt, len, info.start);\r\n                                  var query = dt.generateNewQueryOnPageChange(this, ui, dt, pageInfo);\r\n                                  return dt.executeQuery(this, ui, dt, query, pageInfo, resultDOM);\r\n                             });\r\n                             // pagination\r\n                             $(this).on( 'page.dt', function () {\r\n                                var info = table.page.info();\r\n                                var pageInfo = dt.getCallbackSettings(dt, info.length, info.start);\r\n                                var query = dt.generateNewQueryOnPageChange(this, ui, dt, pageInfo);\r\n                                return dt.executeQuery(this, ui, dt, query, pageInfo, resultDOM);\r\n                             });\r\n        }\r\n    }); //jQuery(tab)\r\n\r\n    //styling\r\n    tab.setAttribute('class'      , 'stripe dataTable');\r\n    //tab.setAttribute('style'       , 'table-layout: fixed;')\r\n    tab.setAttribute('cellpadding', '1');\r\n    tab.setAttribute('cellspacing', '1');\r\n    tab.setAttribute('border'     , '0');\r\n\r\n    return tab;\r\n}\r\n\r\n/*\r\nserverside: true or false\r\n*/\r\nDatatables.prototype.draw = function(serverside, dtResult, settings, ui, resultDOM){\r\n    if(serverside)\r\n        return(this.getDataFromServer(dtResult, settings, ui, resultDOM));\r\n    else return(this.convertToDatatable(dtResult, ui));\r\n}\r\n\r\nmodule.exports=Datatables\r\n","/**\r\n * Object for producing a HTML view of a given object in a frame\r\n */\r\nconst HTMLFrameHelper = require('./HTMLFrameHelper');\r\n\r\nfunction HTMLObjectViewer(renderer){\r\n\tthis.renderer = renderer;\r\n\tthis.properties = [];\r\n\tthis.headerViewer = renderer.getObjectHeaderViewer();\r\n\t//this.featureViewers = {};\r\n}\r\n\r\n/**\r\n * Functions for rendering / re-rendering the object as header and body components\r\n */\r\nHTMLObjectViewer.prototype.render = function(){\r\n\tif(this.renderedDOM){\r\n\t\tvar renderedDOM = this.getObjectDOM();\r\n\t\tthis.renderedDOM.replaceWith(renderedDOM);\r\n\t\tthis.renderedDOM = renderedDOM;\r\n\t}\r\n\telse {\r\n\t\tthis.renderedDOM = this.getObjectDOM();\r\n\t}\r\n\tthis.renderedDOM.appendChild(this.getObjectIDMarker(this.renderer));\r\n\tif(this.headerViewer){\r\n\t\tthis.header = this.headerViewer.getAsDOM(this.renderer);\r\n\t\tif(this.header) this.renderedDOM.appendChild(this.header);\r\n\t}\r\n\tthis.body = this.getObjectBodyDOM();\r\n\tif(this.body) this.renderedDOM.appendChild(this.body);\r\n\treturn this.renderedDOM;\r\n}\r\n\r\nHTMLObjectViewer.prototype.getObjectDOM = function(){\r\n\tvar orientation = this.renderer.getContentOrientation();\r\n\tvar pcls = \"terminus-object-frame-\" + orientation;\r\n\tif(orientation == \"page\"){\r\n\t\tvar sp = document.createElement(\"div\");\r\n\t}\r\n\telse {\r\n\t\tvar sp = document.createElement(\"span\");\r\n\t}\r\n\tvar css = \"terminus-object-frame \" + pcls + (this.renderer.parent ? \"\" : \" terminus-root-frame\") + \" terminus-object-frame-\" + this.renderer.mode;\r\n\tsp.setAttribute(\"class\", css);\r\n\tsp.setAttribute(\"data-class\", this.renderer.subjectClass());\r\n\tsp.setAttribute(\"data-id\", this.renderer.subject());\r\n\treturn sp;\r\n}\r\n\r\nHTMLObjectViewer.prototype.getObjectBodyDOM = function(){\r\n\tvar orientation = this.renderer.getContentOrientation();\r\n\tvar pcls = \"terminus-object-properties-\" + orientation;\r\n\tif(orientation == \"page\"){\r\n\t\tvar vholder = document.createElement(\"div\");\r\n\t}\r\n\telse {\r\n\t\tvar vholder = document.createElement(\"span\");\r\n\t}\r\n    vholder.setAttribute('class', 'terminus-object-properties ' + pcls);\r\n    for(var prop in this.properties){\r\n\t\tif(this.properties[prop]) vholder.appendChild(this.properties[prop]);\r\n\t}\r\n\treturn vholder;\r\n}\r\n\r\nHTMLObjectViewer.prototype.getFeatureDOM = function(feature){\r\n\tif(this.hasFeatureViewer(feature)){\r\n\t\treturn this.featureViewer[feature](this.renderer, this);\r\n\t}\r\n}\r\n\r\nHTMLObjectViewer.prototype.redraw = function(){\r\n\tTerminusClient.FrameHelper.removeChildren(this.renderedDOM);\r\n\tthis.properties = [];\r\n\tthis.renderer.render(this);\r\n}\r\n\r\nHTMLObjectViewer.prototype.redrawHeader = function(){\r\n\tif(this.headerViewer && this.header) {\r\n\t\tvar nheader = this.headerViewer.getAsDOM(this.renderer);\r\n\t\tthis.header.replaceWith(nheader);\r\n\t\tthis.header = nheader;\r\n\t}\r\n}\r\n\r\nHTMLObjectViewer.prototype.redrawBody = function(){\r\n\tif(this.body){\r\n\t\tvar nbody = this.getObjectBodyDOM();\r\n\t\tthis.body.replaceWith(nbody);\r\n\t\tthis.body = nbody;\r\n\t}\r\n}\r\n\r\n/**\r\n * Adds a rendered version of a property to the internal properties array\r\n */\r\nHTMLObjectViewer.prototype.addRenderedProperty = function(prop, renderedprop){\r\n\tthis.properties[prop] = renderedprop;\r\n}\r\n\r\nHTMLObjectViewer.prototype.clear = function(){\r\n\tTerminusClient.FrameHelper.removeChildren(this.renderedDOM);\r\n\tthis.properties = {};\r\n}\r\n\r\n/**\r\n * Removes the object from the dom\r\n */\r\nHTMLObjectViewer.prototype.remove = function(){\r\n\tthis.renderedDOM.parentNode.removeChild(this.renderedDOM);\r\n}\r\n\r\nHTMLObjectViewer.prototype.goTo = function(subj, property){\r\n\tHTMLFrameHelper.goToName(subj, property);\r\n}\r\n\r\n/**\r\n * Generates a html anchor element to use as a marker to find the object on the page\r\n */\r\nHTMLObjectViewer.prototype.getObjectIDMarker = function(renderer){\r\n\tvar idm = document.createElement(\"a\");\r\n\tidm.setAttribute(\"class\", \"terminus-object-idmarker\");\r\n\tvar sh = TerminusClient.FrameHelper.getShorthand(renderer.subject());\r\n    if(!sh) sh = renderer.subject();\r\n    if(sh){\r\n\t\tvar bits = sh.split(\":\");\r\n\t\tif(bits.length > 1) sh = bits[1];\r\n\t\tidm.setAttribute(\"name\", sh);\r\n    }\r\n\treturn idm;\r\n}\r\n\r\nfunction HTMLObjectHeaderViewer(){}\r\n\r\nHTMLObjectHeaderViewer.prototype.getAsDOM = function(renderer){\r\n\tvar orientation = renderer.getContentOrientation();\r\n\tvar pcls = \"terminus-object-frame-btn terminus-object-header-\" + orientation;\r\n\tif(orientation == \"page\"){\r\n\t\tvar objDOM = document.createElement(\"div\");\r\n\t}\r\n\telse {\r\n\t\tvar objDOM = document.createElement(\"span\");\r\n\t}\r\n\tobjDOM.setAttribute(\"class\", \"terminus-object-header \" + pcls);\r\n\tif(renderer.showFeature(\"facet\")){\r\n\t\tvar facetDOM = this.getObjectFacetDOM(renderer);\r\n\t\tif(facetDOM) objDOM.appendChild(facetDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"label\")){\r\n\t\tvar sumDOM = this.getObjectLabelDOM(renderer);\r\n\t\tif(sumDOM) objDOM.appendChild(sumDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"id\")){\r\n\t\tvar idDOM = this.getObjectIDDOM(renderer);\r\n\t\tif(idDOM) objDOM.appendChild(idDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"type\")){\r\n\t\tvar typeDOM = this.getObjectTypeDOM(renderer);\r\n\t\tif(typeDOM) objDOM.appendChild(typeDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"status\")){\r\n\t\tvar sumDOM = this.getObjectStatusDOM(renderer);\r\n\t\tif(sumDOM) objDOM.appendChild(sumDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"view\")){\r\n\t\tvar viewDOM = this.getViewPropertyDOM(renderer);\r\n\t\tif(viewDOM) objDOM.appendChild(viewDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"viewer\")){\r\n\t\tvar hideDOM = this.getViewerSelectorDOM(renderer);\r\n\t\tif(hideDOM) objDOM.appendChild(hideDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"control\")){\r\n\t\tvar controlsDOM = this.getObjectControlsDOM(renderer);\r\n\t\tif(controlsDOM) objDOM.appendChild(controlsDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"summary\")){\r\n\t\tvar controlsDOM = this.getObjectSummaryDOM(renderer);\r\n\t\tif(controlsDOM) objDOM.appendChild(controlsDOM);\r\n\t}\r\n\treturn objDOM;\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectSummaryDOM = function(renderer){\r\n\tvar sum = renderer.getSummary();\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"object-summary\", false, sum.long, sum.status);\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectControlsDOM = function(renderer){\r\n\tvar controlsDOM = document.createElement(\"span\");\r\n\tcontrolsDOM.setAttribute(\"class\", \"terminus-object-controls\");\r\n\tif(renderer.showFeature(\"add\")){\r\n\t\tvar addDOM = this.getAddPropertyDOM(renderer);\r\n\t\tif(addDOM) controlsDOM.appendChild(addDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"mode\")){\r\n\t\tvar viewsDOM = HTMLFrameHelper.getModeSelectorDOM(\"object\", renderer);\r\n\t\tif(viewsDOM) controlsDOM.appendChild(viewsDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"delete\")){\r\n\t\tvar dpropDOM = this.getObjectDeleteDOM(renderer);\r\n\t\tif(dpropDOM) controlsDOM.appendChild(dpropDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"clone\")){\r\n\t\tvar cpropDOM = this.getObjectCloneDOM(renderer);\r\n\t\tif(cpropDOM) controlsDOM.appendChild(cpropDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"reset\")){\r\n\t\tvar rpropDOM = this.getObjectResetDOM(renderer);\r\n\t\tif(rpropDOM) controlsDOM.appendChild(rpropDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"update\")){\r\n\t\tvar upropDOM = this.getObjectUpdateDOM(renderer);\r\n\t\tif(upropDOM) controlsDOM.appendChild(upropDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"show\")){\r\n\t\tvar showDOM = this.getObjectShowDOM(renderer);\r\n\t\tif(showDOM) controlsDOM.appendChild(showDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"hide\")){\r\n\t\tvar hideDOM = this.getObjectHideDOM(renderer);\r\n\t\tif(hideDOM) controlsDOM.appendChild(hideDOM);\r\n\t}\r\n\treturn controlsDOM;\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectFacetDOM = function(renderer){\r\n\tvar viewables = renderer.getAvailableFacets();\r\n\tvar self = this;\r\n\tif(viewables && viewables.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-object-facet\");\r\n\t\tvar callback = function(val){\r\n\t\t\tif(val){\r\n\t\t\t\trenderer.setFacet(val);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar sel = HTMLFrameHelper.getSelectionControl(\"object-facet\", viewables, renderer.currentFacet(), callback);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectLabelDOM = function(renderer){\r\n\tvar lab = renderer.getLabel();\r\n\tif(lab){\r\n\t\treturn HTMLFrameHelper.getInfoboxDOM(\"object-label\", false, lab);\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectIDDOM = function(renderer){\r\n\tvar val = renderer.subject();\r\n\tvar input = false;\r\n\tif(renderer.mode == \"edit\" && renderer.isNewDocument()){\r\n\t\tif(renderer.idDOM) val = renderer.idDOM.value;\r\n\t\tinput = document.createElement(\"input\");\r\n\t\tinput.setAttribute(\"class\", \"terminus-object-id-input\");\r\n\t\tif(val == \"_:\") val = \"\";\r\n\t\trenderer.idDOM = input;\r\n\t}\r\n\telse {\r\n\t\tif(renderer.isNewDocument() && val == \"_:\") val = \"New Document\";\r\n\t}\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"object-id\", \"ID\", val, \"Every fragment of data is identified by a unique URL\", input);\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectTypeDOM = function(renderer){\r\n\tif(renderer.mode == \"edit\" && renderer.parent && renderer.parent.isClassChoice() && renderer.isNew()){\r\n\t\tvar cs = renderer.parent.getAvailableClassChoices();\r\n\t\tif(cs && cs.length){\r\n\t\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\t\tmpropDOM.setAttribute(\"class\", \"terminus-property-change-class\");\r\n\t\t\tvar mlabDOM = document.createElement(\"span\");\r\n\t\t\tmlabDOM.setAttribute(\"class\", \"terminus-property-change-label\");\r\n\t\t\tmlabDOM.appendChild(document.createTextNode(\"Type\"));\r\n\t\t\tmpropDOM.appendChild(mlabDOM);\r\n\t\t\tvar callback = function(cls){\r\n\t\t\t\tif(cls){\r\n\t\t\t\t\trenderer.changeClass(cls);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar sel = HTMLFrameHelper.getSelectionControl(\"change-class\", cs, renderer.subjectClass(), callback);\r\n\t\t\tmpropDOM.appendChild(sel);\r\n\t\t\treturn mpropDOM;\r\n\t\t}\r\n\t}\r\n\tvar cm = renderer.getClassMeta(renderer.subjectClass());\r\n\tvar lab = renderer.subjectClass();\r\n\tvar cmt = \"All objects have types, identified by a unique URL\";\r\n\tif(cm){\r\n\t\tlab = (cm.Label && cm.Label[\"@value\"] ? cm.Label[\"@value\"]: lab);\r\n\t\tcmt = (cm.Comment && cm.Comment[\"@value\"] ? renderer.subjectClass() + \" \" + cm.Comment[\"@value\"] : cmt);\r\n\t}\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"object-type\", \"Type\", lab, cmt);\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectStatusDOM = function(renderer){\r\n\tvar sum = renderer.getSummary();\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"status-\"+sum.status, false, sum.status, sum.status);\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getAddPropertyDOM = function(renderer){\r\n\tvar addables = renderer.getAddableProperties();\r\n\tif(addables && addables.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-object-add-property\");\r\n\t\taddables.unshift({ value: \"\", label: \"Add New Property\"});\r\n\t\tvar callback = function(add){\r\n\t\t\tif(add){\r\n\t\t\t\trenderer.addNewProperty(add);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar disabled = (renderer.cardControlAllows(\"add\") ? false : \"Cardinality Rules Forbid Add\");\r\n\t\tvar sel = HTMLFrameHelper.getSelectionControl(\"add-property\", addables, \"\", callback, disabled);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getViewPropertyDOM = function(renderer){\r\n\tvar viewables = renderer.getViewableProperties();\r\n\tvar self = this;\r\n\tif(viewables && viewables.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-object-view-property\");\r\n\t\tviewables.unshift({ value: \"\", label: \"View Property\"});\r\n\t\tvar callback = function(add){\r\n\t\t\tif(add){\r\n\t\t\t\trenderer.goToProperty(add);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar sel = HTMLFrameHelper.getSelectionControl(\"view-property\", viewables, \"\", callback);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectDeleteDOM = function(renderer){\r\n\tvar callback = function(){renderer.delete()};\r\n\tvar disabled = (renderer.cardControlAllows(\"delete\") ? false : \"Cardinality Rules Forbid Delete\");\r\n\treturn HTMLFrameHelper.getActionControl(\"object\", \"delete\", \"Delete\", callback, disabled);\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectCloneDOM = function(renderer){\r\n\tvar callback = function(){renderer.clone()};\r\n\tvar disabled = (renderer.cardControlAllows(\"clone\") ? false : \"Cardinality Rules Forbid Clone\");\r\n\treturn HTMLFrameHelper.getActionControl(\"object\", \"clone\", \"Clone\", callback, disabled);\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectResetDOM = function(renderer){\r\n\tvar callback = function(){renderer.reset()};\r\n\tvar disabled = (renderer.isUpdated() ? false : \"Nothing to reset\");\r\n\treturn HTMLFrameHelper.getActionControl(\"object\", \"reset\", \"Reset\", callback, disabled);\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getViewerSelectorDOM = function(renderer){\r\n\tvar viewers = renderer.getAvailableViewers();\r\n\tif(viewers && viewers.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-object-viewer\");\r\n\t\tvar callback = function(viewer){\r\n\t\t\tif(viewer){\r\n\t\t\t\trenderer.setViewer(viewer);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar selected = renderer.currentViewer();\r\n\t\tvar sel = HTMLFrameHelper.getSelectionControl('object-viewer', viewers, selected, callback);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectHideDOM = function(renderer){\r\n\tvar callback = function(){renderer.hide()};\r\n\treturn HTMLFrameHelper.getActionControl(\"object\", \"hide\", \"Hide\", callback);\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectShowDOM = function(renderer){\r\n\tvar callback = function(){renderer.show()};\r\n\treturn HTMLFrameHelper.getActionControl(\"object\", \"show\", \"Show\", callback);\r\n}\r\n\r\nHTMLObjectHeaderViewer.prototype.getObjectUpdateDOM = function(renderer){\r\n\tvar dpropDOM = document.createElement(\"span\");\r\n\tdpropDOM.setAttribute(\"class\", \"terminus-object-update\");\r\n\tif(renderer.isNewDocument()){\r\n\t\tvar disabled = false;//(renderer.isUpdated() ? false : \"No changes\");\r\n\t}\r\n\telse {\r\n\t\tvar disabled = (renderer.isUpdated() ? false : \"No changes\");\r\n\t}\r\n\tvar saveback = function(){renderer.save()};\r\n\tdpropDOM.appendChild(HTMLFrameHelper.getActionControl(\"object\", \"save\", \"Save\", saveback, disabled));\r\n\treturn dpropDOM;\r\n}\r\n\r\nmodule.exports={HTMLObjectViewer,HTMLObjectHeaderViewer}\r\n","function HTMLStringViewer(options){\r\n\tthis.size = ((options && options.size) ? options.size : false);\r\n\tthis.css = ((options && options.css) ? \"terminus-literal-value \" + options.css : \"terminus-literal-value\");\r\n}\r\n\r\nHTMLStringViewer.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', this.css);\r\n\tinput.setAttribute('data-value', value);\r\n\tvalue = document.createTextNode(value);\r\n\tinput.appendChild(value);\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLStringViewer}\r\n\r\n\r\n","function HTMLDateHelper(){\r\n\tthis.months = [\"January\", \"Februrary\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\r\n}\r\n\r\nHTMLDateHelper.prototype.getMonthName = function(num){\r\n\treturn this.months[num-1];\r\n}\r\n\r\nmodule.exports={HTMLDateHelper}","//const FrameHelper = require('../FrameHelper');\r\nconst HTMLFrameHelper = require('./HTMLFrameHelper');\r\n\r\n/**\r\n * Property Viewer\r\n */\r\nfunction HTMLPropertyViewer(renderer){\r\n\tthis.renderer = renderer;\r\n\tthis.values = [];\r\n\tthis.headerViewer = renderer.getPropertyHeaderViewer();\r\n}\r\n\r\n\r\n/**\r\n * Draws the property as header and body components\r\n */\r\nHTMLPropertyViewer.prototype.render = function(){\r\n\tvar block = document.createElement('div');\r\n\tblock.setAttribute('style', 'display: flex; margin: 10px 10px 0px 0px;');\r\n\tvar br = document.createElement('br');\r\n\tblock.appendChild(br);\r\n\tif(this.propDOM){\r\n\t\tvar npropDOM = this.getPropertyDOM();\r\n\t\tnpropDOM.setAttribute('style', 'display: flex; margin: 10px 10px 0px 0px;');\r\n\t\t\t//block.appendChild(npropDOM);\r\n\t\tthis.propDOM.replaceWith(npropDOM);\r\n\t\tthis.propDOM = npropDOM;\r\n\t\t//this.propDOM = block;\r\n\t}\r\n\telse {\r\n\t\t//block.appendChild(this.getPropertyDOM());\r\n\t\t//this.propDOM = block;\r\n\t\tthis.propDOM = this.getPropertyDOM();\r\n\t\tthis.propDOM.setAttribute('style', 'display: flex; margin: 10px 10px 0px 0px;');\r\n\t}\r\n\tthis.propDOM.appendChild(this.getPropertyIDMarker(this.renderer));\r\n\tif(this.headerViewer){\r\n\t\tthis.header = this.headerViewer.getAsDOM(this.renderer);\r\n\t\tif(this.header) this.propDOM.appendChild(this.header);\r\n\t}\r\n\tthis.body = this.getPropertyBodyDOM();\r\n\tif(this.body) this.propDOM.appendChild(this.body);\r\n\treturn this.propDOM;\r\n}\r\n\r\nHTMLPropertyViewer.prototype.getPropertyDOM = function(){\r\n\tvar orientation = this.renderer.getContentOrientation();\r\n\tvar pcls = \" terminus-property-frame-display terminus-property-frame-\" + orientation;\r\n\tif(orientation == \"label\"){\r\n\t\tvar sp = document.createElement(\"span\");\r\n\t}\r\n\telse {\r\n\t\tvar sp = document.createElement(\"div\");\r\n\t}\r\n\t//terminus-property-frame-spacer\r\n\r\n\tsp.setAttribute(\"class\", \"WHATER terminus-property-frame \"+ sp + \" terminus-property-frame-\" + this.renderer.mode + \" \" + pcls);\r\n\tsp.setAttribute('data-property', this.renderer.property());\r\n\treturn sp;\r\n}\r\n\r\nHTMLPropertyViewer.prototype.getPropertyBodyDOM = function(){\r\n\tvar orientation = this.renderer.getContentOrientation();\r\n\tvar pcls = \"terminus-property-values-\" + orientation;\r\n\tif(orientation == \"page\"){\r\n\t\tvar vholder = document.createElement(\"div\");\r\n\t}\r\n\telse {\r\n\t\tvar vholder = document.createElement(\"span\");\r\n\t}\r\n    vholder.setAttribute('class', 'terminus-property-values ' + pcls + ' terminus-property-values-align');\r\n\tfor(var i =0; i<this.values.length; i++){\r\n\t\tvholder.appendChild(this.values[i]);\r\n\t}\r\n\treturn vholder;\r\n}\r\n\r\nHTMLPropertyViewer.prototype.addRenderedValue = function(renderedval){\r\n\tthis.values.push(renderedval);\r\n}\r\n\r\nHTMLPropertyViewer.prototype.clear = function(){\r\n\tTerminusClient.FrameHelper.removeChildren(this.propDOM);\r\n\tthis.values = [];\r\n}\r\n\r\n\r\n/**\r\n * Removes the property from the dom\r\n */\r\nHTMLPropertyViewer.prototype.remove = function(){\r\n\tthis.propDOM.parentNode.removeChild(this.propDOM);\r\n}\r\n\r\n/**\r\n * Redraws the property to reflect an updated state\r\n */\r\nHTMLPropertyViewer.prototype.redraw = function(){\r\n\tvar npropDOM = this.getPropertyDOM();\r\n\tthis.propDOM.replaceWith(npropDOM);\r\n\tthis.propDOM = npropDOM;\r\n\tthis.values = [];\r\n\tthis.renderer.render(this);\r\n}\r\n\r\nHTMLPropertyViewer.prototype.redrawHeader = function(){\r\n\tif(this.headerViewer && this.header) {\r\n\t\tvar nheader = this.headerViewer.getAsDOM(this.renderer);\r\n\t\tthis.header.replaceWith(nheader);\r\n\t\tthis.header = nheader;\r\n\t}\r\n}\r\n\r\nHTMLPropertyViewer.prototype.redrawBody = function(){\r\n\tif(this.body){\r\n\t\tvar nbody = this.getPropertyBodyDOM();\r\n\t\tthis.body.replaceWith(nbody);\r\n\t\tthis.body = nbody;\r\n\t}\r\n}\r\n\r\n/**\r\n * Generates a html anchor element to use as a marker to find the property on the page\r\n */\r\nHTMLPropertyViewer.prototype.getPropertyIDMarker = function(renderer){\r\n\tvar idm = document.createElement(\"a\");\r\n\tidm.setAttribute(\"class\", \"terminus-property-idmarker\");\r\n\tvar subj = TerminusClient.FrameHelper.getShorthand(renderer.subject());\r\n\tif(!subj ) subj = renderer.subject();\r\n\tvar bits = subj .split(\":\");\r\n\tif(bits.length > 1) subj = bits[1];\r\n\tvar prop = TerminusClient.FrameHelper.getShorthand(renderer.property());\r\n\tif(!prop ) prop = renderer.property();\r\n\tvar bits = prop.split(\":\");\r\n\tif(bits.length > 1) prop = bits[1];\r\n\tidm.setAttribute(\"name\", subj + \"_\" + prop);\r\n\treturn idm;\r\n}\r\n\r\nHTMLPropertyViewer.prototype.goTo = function(subj, property, index){\r\n\tHTMLFrameHelper.goToName(subj, property, index);\r\n}\r\n\r\nfunction HTMLPropertyHeaderViewer(){}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getAsDOM = function(renderer){\r\n\tvar orientation = renderer.getContentOrientation();\r\n\tvar pcls = \"terminus-property-header-\" + orientation;\r\n\tif(orientation == \"page\"){\r\n\t\tvar objDOM = document.createElement(\"div\");\r\n\t}\r\n\telse {\r\n\t\tvar objDOM = document.createElement(\"span\");\r\n\t}\r\n\tobjDOM.setAttribute(\"class\", \"terminus-text terminus-property-header \" + pcls);\r\n\tvar wrapper = document.createElement(\"span\");\r\n\twrapper.setAttribute(\"class\", \"terminus-property-header-wrapper\");\r\n\tif(renderer.showFeature(\"control\")){\r\n\t\tvar expModeMenu = this.getPropertyControlsDOM(wrapper, renderer);\r\n\t\tif(orientation == 'page') this.expModeMenu = expModeMenu;\r\n\t\telse this.expModeMenu = null;\r\n\t}\r\n\tif(renderer.showFeature(\"label\")){\r\n\t\tvar sumDOM = this.getPropertyLabelDOM(renderer);\r\n\t\tif(renderer.showFeature(\"status\")){\r\n\t\t\tvar statDOM = this.getPropertyStatusDOM(renderer);\r\n\t\t\tif(statDOM) sumDOM.prepend(statDOM);\r\n\t\t}\r\n\t\tif(sumDOM) wrapper.appendChild(sumDOM);\r\n\t}\r\n\telse if(renderer.showFeature(\"status\")){\r\n\t\tvar statDOM = this.getPropertyStatusDOM(renderer);\r\n\t\tif(statDOM) wrapper.appendChild(statDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"summary\")){\r\n\t\tvar sumDOM = this.getPropertySummaryDOM(renderer);\r\n\t\tif(sumDOM) wrapper.appendChild(sumDOM);\r\n\t}\r\n\r\n\tvar prelude = document.createElement(\"span\");\r\n\tprelude.setAttribute(\"class\", \"terminus-property-header-info terminus-property-header-info-\"+renderer.currentFacet());\r\n\r\n\tif(renderer.showFeature(\"facet\")){\r\n\t\tvar facetDOM = this.getPropertyFacetDOM(renderer);\r\n\t\tif(facetDOM) prelude.appendChild(facetDOM);\r\n\t\t//if(facetDOM && this.expModeMenu) this.expModeMenu.appendChild(facetDOM);//\r\n\t}\r\n\tif(renderer.showFeature(\"view\")){\r\n\t\tvar viewDOM = this.getViewValueDOM(renderer);\r\n\t\tif(viewDOM) prelude.appendChild(viewDOM);\r\n\t\t//if(viewDOM && this.expModeMenu) this.expModeMenu.appendChild(viewDOM); //prelude.appendChild(viewDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"id\")){\r\n\t\tvar idDOM = this.getPropertyIDDOM(renderer);\r\n\t\tif(idDOM) prelude.appendChild(idDOM);\r\n\t\t//if(idDOM && this.expModeMenu) this.expModeMenu.appendChild(idDOM); //\r\n\t}\r\n\tif(renderer.showFeature(\"type\")){\r\n\t\tvar typeDOM = this.getPropertyRangeDOM(renderer);\r\n\t\tif(typeDOM)\tprelude.appendChild(typeDOM);\r\n\t\t/*if(typeDOM && this.expModeMenu){\r\n\t\t\tthis.expModeMenu.appendChild(typeDOM);//\r\n\t\t\ttypeDOM.style.display = 'block';\r\n\t\t}*/\r\n\t}\r\n\tif(renderer.showFeature(\"cardinality\") && renderer.hasCardinalityRestriction()){\r\n\t\tvar hideDOM = this.getPropertyCardinalityDOM(renderer);\r\n\t\tif(hideDOM) prelude.appendChild(hideDOM);\r\n\t\t//\tthis.expModeMenu.appendChild(hideDOM); \t\t\thideDOM.style.display = 'block';\r\n\t\t\r\n\t}\r\n\tif(renderer.showFeature(\"comment\")){\r\n\t\tvar sumDOM = this.getPropertyCommentDOM(renderer);\r\n\t\tif(sumDOM) prelude.appendChild(sumDOM);\r\n\t\t/*if(sumDOM && this.expModeMenu){\r\n\t\t\tthis.expModeMenu.appendChild(sumDOM); //\r\n\t\t\tsumDOM.style.display = 'block';\r\n\t\t}*/\r\n\t}\r\n\twrapper.appendChild(prelude);\r\n\tobjDOM.appendChild(wrapper);\r\n\treturn objDOM;\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyFacetDOM = function(renderer){\r\n\tvar viewables = renderer.getAvailableFacets();\r\n\tvar self = this;\r\n\tif(viewables && viewables.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-property-facet\");\r\n\t\tvar callback = function(val){\r\n\t\t\tif(val){\r\n\t\t\t\trenderer.setFacet(val);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar sel = HTMLFrameHelper.getSelectionControl(\"property-facet\", viewables, renderer.currentFacet(), callback);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyIDDOM = function(renderer){\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"property-id\", \"Property\", renderer.property(), \"This property is identified by this unique URL: \" + renderer.property());\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyRangeDOM = function(renderer){\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"property-type\", \"Type\", renderer.range(), \"The type of arguments that this property accepts\");\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertySummaryDOM = function(renderer){\r\n\tvar sum = renderer.getSummary();\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"property-summary\", false, sum.long, sum.status);\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyStatusDOM = function(renderer){\r\n\tvar sum = renderer.getSummary();\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"status-\"+sum.status, false, sum.status, sum.status);\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyLabelDOM = function(renderer){\r\n\tvar lab = renderer.getLabel();\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"property-label\", false, lab);\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyCommentDOM = function(renderer){\r\n\tvar lab = renderer.getComment();\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"property-comment\", false, lab);\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyCardinalityDOM = function(renderer){\r\n\tvar restriction = renderer.getRestriction();\r\n\tif(restriction.min && restriction.max){\r\n\t\tif(restriction.min == restriction.max){\r\n\t\t\tvar lab = restriction.min;\r\n\t\t\tvar help = \"Cardinality: \" + restriction.min;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar lab = restriction.min + \"-\" + restriction.max;\r\n\t\t\tvar help = \"Minimum Cardinality: \" + restriction.min;\r\n\t\t\thelp += \", Maximum Cardinality: \" + restriction.max;\r\n\t\t}\r\n\t}\r\n\telse if(restriction.min){\r\n\t\tvar lab = \">\"+(restriction.min-1);\r\n\t\tvar help = \"Minimum Cardinality: \" + restriction.min;\r\n\t}\r\n\telse if(restriction.max){\r\n\t\tvar lab = \"<\"+(restriction.max+1);\r\n\t\tvar help = \"Maximum Cardinality: \" + restriction.max;\r\n\t}\r\n\telse {\r\n\t\treturn false;\r\n\t}\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"property-cardinality\", \"Cardinality\", lab, help);\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getActionControlDOM = function(settingsDOM, renderer){\r\n\tif(renderer.showFeature(\"mode\")){\r\n\t\tvar viewsDOM = HTMLFrameHelper.getModeSelectorDOM(\"property\", renderer);\r\n\t\tif (viewsDOM) settingsDOM.appendChild(viewsDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"delete\")){\r\n\t\tvar dpropDOM = this.getPropertyDeleteDOM(renderer);\r\n\t\tif (dpropDOM) settingsDOM.appendChild(dpropDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"add\") && !renderer.isClassChoice()){\r\n\t\tvar addDOM = this.getAddValueDOM(renderer);\r\n\t\tif(addDOM) settingsDOM.appendChild(addDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"reset\")){\r\n\t\tvar rpropDOM = this.getPropertyResetDOM(renderer);\r\n\t\tif(rpropDOM) settingsDOM.appendChild(rpropDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"update\")){\r\n\t\tvar upropDOM = this.getPropertyUpdateDOM(renderer);\r\n\t\tif(upropDOM) settingsDOM.appendChild(upropDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"show\")){\r\n\t\tvar showDOM = this.getPropertyShowDOM(renderer);\r\n\t\tif(showDOM) settingsDOM.appendChild(showDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"hide\")){\r\n\t\tvar hideDOM = this.getPropertyHideDOM(renderer);\r\n\t\tif(hideDOM) settingsDOM.appendChild(hideDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"viewer\")){\r\n\t\tvar hideDOM = this.getViewerSelectorDOM(renderer);\r\n\t\tif(hideDOM) settingsDOM.appendChild(hideDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"add\") && renderer.isClassChoice()){\r\n\t\tvar addDOM = this.getAddValueDOM(renderer);\r\n\t\tif(addDOM) settingsDOM.appendChild(addDOM);\r\n\t}\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getSettingsControlDOM = function(controlsDOM, renderer){\r\n\tvar settings = document.createElement(\"div\");\r\n\tcontrolsDOM.appendChild(settings);\r\n\tvar orientation = renderer.getContentOrientation();\r\n\tif(false && orientation == 'page'){ // expert mode\r\n\t\tvar sControl = HTMLFrameHelper.getSettingsControl('property');\r\n\t\tvar menu = document.createElement('div');\r\n\t\tmenu.setAttribute('class', 'terminus-hide terminus-popup');\r\n\t\tmenu.appendChild(document.createTextNode('Edit property'));\r\n\t\tmenu.appendChild(document.createElement('BR'));\r\n\t\tsControl.appendChild(menu);\r\n\t\tsControl.addEventListener('click', function(e){\r\n\t\t\tvar target = e.target || e.srcElement,\r\n        \ttext = target.textContent || target.innerText;\r\n\t\t\tif((target.nodeName == 'ICON') || (target.nodeName == 'BUTTON')){\r\n\t\t\t\tif(this.children[0].style.display == 'none') this.children[0].style.display = 'block';\r\n\t\t\t\telse this.children[0].style.display = 'none';\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.getActionControlDOM(menu, renderer);\r\n\t    settings.appendChild(sControl);\r\n\t\treturn menu;\r\n\t}\r\n\telse this.getActionControlDOM(controlsDOM, renderer);\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyControlsDOM = function(wrapper, renderer){\r\n\tvar controlsDOM = document.createElement(\"span\");\r\n\tcontrolsDOM.setAttribute(\"class\", \"terminus-property-controls\");\r\n\tcontrolsDOM.setAttribute(\"style\", \"display: table-cell;\");\r\n\t// get settings icon or button\r\n\tvar expModeMenu = this.getSettingsControlDOM(controlsDOM, renderer);\r\n\twrapper.appendChild(controlsDOM);\r\n\treturn expModeMenu;\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getAddValueDOM = function(renderer){\r\n\tif(renderer.isClassChoice()){\r\n\t\tvar cs = renderer.getAvailableClassChoices();\r\n\t\tif(cs && cs.length){\r\n\t\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\t\tmpropDOM.setAttribute(\"class\", \"terminus-property-add-class\");\r\n\t\t\tcs.unshift({ value: \"\", label: \"Add Type\"});\r\n\t\t\tvar callback = function(cls){\r\n\t\t\t\tif(cls){\r\n\t\t\t\t\trenderer.addClass(cls);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar sel = HTMLFrameHelper.getSelectionControl(\"add-property\", cs, \"\", callback);\r\n\t\t\tmpropDOM.appendChild(sel);\r\n\t\t\treturn mpropDOM;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tvar callback = function(){renderer.add(\"edit\")};\r\n\t\tvar disabled = (renderer.cardControlAllows(\"add\") ? false : \"Cardinality Rules Forbid Add\");\r\n\t\treturn HTMLFrameHelper.getActionControl(\"property\", \"add\", \"Add\", callback, disabled);\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getViewValueDOM = function(renderer){\r\n\tvar viewables = renderer.getViewableValues();\r\n\tvar self = this;\r\n\tif(viewables && viewables.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-property-view-value\");\r\n\t\tviewables.unshift({ value: \"\", label: \"View Value\"});\r\n\t\tvar callback = function(val){\r\n\t\t\trenderer.goToValue(val);\r\n\t\t}\r\n\t\tvar sel = HTMLFrameHelper.getSelectionControl(\"view-values\", viewables, \"\", callback);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyDeleteDOM = function(renderer){\r\n\tvar callback = function(){renderer.delete()};\r\n\tvar disabled = (renderer.cardControlAllows(\"delete\") ? false : \"Cardinality Rules Forbid Delete\");\r\n\treturn HTMLFrameHelper.getActionControl(\"property\", \"delete\", \"Delete\", callback, disabled);\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyHideDOM = function(renderer){\r\n\tvar callback = function(){renderer.hide()};\r\n\treturn HTMLFrameHelper.getActionControl(\"property\", \"hide\", \"Hide\", callback);\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyResetDOM = function(renderer){\r\n\tvar callback = function(){renderer.reset()};\r\n\tvar disabled = (renderer.isUpdated() ? false : \"Nothing to reset\");\r\n\treturn HTMLFrameHelper.getActionControl(\"property\", \"reset\", \"Reset\", callback, disabled);\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyShowDOM = function(renderer){\r\n\tvar callback = function(){renderer.show()};\r\n\treturn HTMLFrameHelper.getActionControl(\"property\", \"show\", \"Show\", callback);\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getPropertyUpdateDOM = function(renderer){\r\n\tvar dpropDOM = document.createElement(\"span\");\r\n\tdpropDOM.setAttribute(\"class\", \"terminus-property-update\");\r\n\tvar disabled = (renderer.isUpdated() ? false : \"No Change\");\r\n\tvar saveback = function(){renderer.save()};\r\n\tdpropDOM.appendChild(HTMLFrameHelper.getActionControl(\"property\", \"save\", \"Save\", saveback, disabled));\r\n\treturn dpropDOM;\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.getViewerSelectorDOM = function(renderer){\r\n\tvar viewers = renderer.getAvailableViewers();\r\n\tif(viewers && viewers.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-property-viewer\");\r\n\t\tvar callback = function(viewer){\r\n\t\t\tif(viewer){\r\n\t\t\t\trenderer.setViewer(viewer);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar selected = renderer.currentViewer();\r\n\t\tvar sel = HTMLFrameHelper.getSelectionControl(\"property-viewers\", viewers, selected, callback);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLPropertyHeaderViewer.prototype.showValue = function(renderer, index){\r\n\tvar htmlid = renderer.subject() + \"->\" + renderer.property() + \"_\" + index;\r\n\twindow.location = (\"\"+window.location).replace(/#[A-Za-z0-9_]*$/,'') + \"#\" + htmlid;\r\n}\r\n\r\nfunction HTMLDataViewer(renderer){\r\n\tthis.renderer = renderer;\r\n\tthis.headerViewer = renderer.getValueHeaderViewer();\r\n}\r\n\r\nmodule.exports={HTMLPropertyViewer,HTMLPropertyHeaderViewer}\r\n","/**\r\n * Draws the property as header and body components\r\n */\r\nconst HTMLFrameHelper = require('./HTMLFrameHelper');\r\nconst HTMLStringViewer = require('./viewers/String');\r\n\r\nfunction HTMLDataViewer(renderer){\r\n\tthis.renderer = renderer;\r\n\tthis.headerViewer = renderer.getValueHeaderViewer();\r\n}\r\n\r\nHTMLDataViewer.prototype.render = function(){\r\n\tif(this.valDOM){\r\n\t\tvar nvalDOM = this.getValueDOM();\r\n\t\tthis.valDOM.replaceWith(nvalDOM);\r\n\t\tthis.valDOM = nvalDOM;\r\n\t}\r\n\telse {\r\n\t\tthis.valDOM = this.getValueDOM();\r\n\t}\r\n\tthis.valDOM.appendChild(this.getValueIDMarker(this.renderer));\r\n\tthis.body = this.getValueBodyDOM();\r\n\tif(this.body) this.valDOM.appendChild(this.body);\r\n\tif(this.headerViewer){\r\n\t\tthis.header = this.headerViewer.getAsDOM(this.renderer);\r\n\t\tif(this.renderer.facet == 'page'){ //expert mode\r\n\t\t\tif(this.header && this.expModeMenu) {\r\n\t\t\t\tthis.expModeMenu.appendChild(this.header);\r\n\t\t\t\t//this.valDOM.appendChild(this.expModeMenu);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(this.header) this.valDOM.appendChild(this.header);\r\n\t}\r\n\treturn this.valDOM;\r\n}\r\n\r\nHTMLDataViewer.prototype.getValueDOM = function(){\r\n\tif(this.renderer.currentFacet() == \"page\"){\r\n\t\tvar sp = document.createElement(\"div\");\r\n\t}\r\n\telse {\r\n\t\tvar sp = document.createElement(\"span\");\r\n\t}\r\n\tsp.setAttribute(\"class\", \"terminus-property-value property-value-\" + this.renderer.currentFacet() + \" property-value-\" + this.renderer.mode);\r\n\tif(this.renderer.mode == \"view\"){\r\n\t\tsp.setAttribute('data-value', this.renderer.value());\r\n\t}\r\n\treturn sp;\r\n}\r\n\r\nHTMLDataViewer.prototype.getValueBodyDOM = function(){\r\n\tif(this.renderer.currentFacet() == \"page\"){\r\n\t\tvar vholder = document.createElement(\"div\");\r\n\t}\r\n\telse {\r\n\t\tvar vholder = document.createElement(\"span\");\r\n\t}\r\n    vholder.setAttribute('class', ' terminus-property-body property-value-body property-value-body-'+this.renderer.currentFacet() + ' terminus-property-body-align');\r\n\tvholder.setAttribute('style', 'display: flex;');\r\n\tif(this.renderer.showFeature(\"body\")){\r\n        var valueViewer = this.renderer.getDataValueViewer();\r\n    \tvar vdom = valueViewer.getDOM(this.renderer, this);\r\n    }\r\n    else if(this.renderer.showFeature(\"summary\")){\r\n\t\tvar vdom = this.getSummaryDOM();\r\n    }\r\n    else {\r\n    \treturn false;\r\n    }\r\n    if(vdom) vholder.appendChild(vdom);\r\n\tif(false && this.renderer.currentFacet() == \"page\"){\r\n\t\tvar sControl = HTMLFrameHelper.getSettingsControl('data');\r\n\t\tvar menu = document.createElement('div');\r\n\t\tmenu.setAttribute('class', 'terminus-hide terminus-popup');\r\n\t\tmenu.appendChild(document.createTextNode('Edit property value'));\r\n\t\tmenu.appendChild(document.createElement('BR'));\r\n\t\tsControl.appendChild(menu);\r\n\t\tsControl.addEventListener('click', function(e){\r\n\t\t\tvar target = e.target || e.srcElement,\r\n\t\t\ttext = target.textContent || target.innerText;\r\n\t\t\tif((target.nodeName == 'ICON') || (target.nodeName == 'BUTTON')){\r\n\t\t\t\tif(this.children[0].style.display == 'none') this.children[0].style.display = 'block';\r\n\t\t\t\telse this.children[0].style.display = 'none';\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.expModeMenu = menu;\r\n\t\tvholder.appendChild(sControl);\r\n\t}\r\n\treturn vholder;\r\n}\r\n\r\n/**\r\n * Removes the value from the dom\r\n */\r\nHTMLDataViewer.prototype.remove = function(){\r\n\tthis.valDOM.parentNode.removeChild(this.valDOM);\r\n}\r\n\r\nHTMLDataViewer.prototype.redrawHeader = function(){\r\n\tif(this.headerViewer && this.header) {\r\n\t\tvar nheader = this.headerViewer.getAsDOM(this.renderer);\r\n\t\tthis.header.replaceWith(nheader);\r\n\t\tthis.header = nheader;\r\n\t}\r\n}\r\n\r\nHTMLDataViewer.prototype.redrawBody = function(){\r\n\tif(this.body){\r\n\t\tvar nbody = this.getValueBodyDOM();\r\n\t\tthis.body.replaceWith(nbody);\r\n\t\tthis.body = nbody;\r\n\t}\r\n}\r\n\r\n/**\r\n * Generates a html anchor element to use as a marker to find the property on the page\r\n */\r\nHTMLDataViewer.prototype.getValueIDMarker = function(renderer){\r\n\tvar idm = document.createElement(\"a\");\r\n\tidm.setAttribute(\"class\", \"terminus-value-idmarker\");\r\n\tvar subj = TerminusClient.FrameHelper.getShorthand(renderer.subject());\r\n\tif(!subj ) subj = renderer.subject();\r\n\tvar bits = subj .split(\":\");\r\n\tif(bits.length > 1) subj = bits[1];\r\n\tvar prop = TerminusClient.FrameHelper.getShorthand(renderer.property());\r\n\tif(!prop ) prop = renderer.property();\r\n\tvar bits = prop.split(\":\");\r\n\tif(bits.length > 1) prop = bits[1];\r\n\tidm.setAttribute(\"name\", subj + \"_\" + prop + \"_\" + renderer.index);\r\n\treturn idm;\r\n}\r\n\r\nHTMLDataViewer.prototype.getSummaryDOM = function(){\r\n\tvar sum = this.renderer.getSummary();\r\n\treturn HTMLTerminusClient.FrameHelper.getInfoboxDOM(\"value-summary\", false, sum.long, sum.long);\r\n}\r\n\r\nHTMLDataViewer.prototype.internalLink = function(link, label){\r\n\tvar self = this;\r\n\r\n\tvar onclick = function(e){\r\n\t\te.preventDefault();\r\n\t\tself.renderer.load(link);\r\n\t}\r\n\tvar a = document.createElement(\"a\");\r\n\ta.onClick = onclick;\r\n\ta.href=\"\";\r\n\ta.addEventListener(\"click\", onclick);\r\n\tif(label){\r\n\t\ta.appendChild(document.createTextNode(label));\r\n\t}\r\n\telse {\r\n\t\tvar sh = TerminusClient.FrameHelper.getShorthand(link);\r\n\t\tif(sh){\r\n\t\t\ta.setAttribute(\"title\", link);\r\n\t\t\ta.appendChild(document.createTextNode(sh));\r\n\t\t}\r\n\t\telse {\r\n\t\t\ta.appendChild(document.createTextNode(link));\r\n\t\t}\r\n\t}\r\n\treturn a;\r\n}\r\n\r\nHTMLDataViewer.prototype.clear = function(){\r\n\tTerminusClient.FrameHelper.removeChildren(this.valDOM);\r\n}\r\n\r\n\r\nfunction HTMLDataHeaderViewer(){}\r\n\r\nHTMLDataHeaderViewer.prototype.getAsDOM = function(renderer){\r\n\tif(renderer.currentFacet() == \"page\"){\r\n\t\tvar objDOM = document.createElement(\"div\");\r\n\t}\r\n\telse {\r\n\t\tvar objDOM = document.createElement(\"span\");\r\n\t}\r\n\tobjDOM.setAttribute(\"class\", \"terminus-value-header terminus-value-header-\" + renderer.currentFacet());\r\n\tif(renderer.showFeature(\"facet\")){\r\n\t\tvar facetDOM = this.getValueFacetDOM(renderer);\r\n\t\tif(facetDOM) objDOM.appendChild(facetDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"viewer\")){\r\n\t\tvar hideDOM = this.getViewerSelectorDOM(renderer);\r\n\t\tif(hideDOM) objDOM.appendChild(hideDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"type\")){\r\n\t\tvar typeDOM = this.getValueTypeDOM(renderer);\r\n\t\tif(typeDOM) objDOM.appendChild(typeDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"status\")){\r\n\t\tvar sumDOM = this.getValueStatusDOM(renderer);\r\n\t\tif(sumDOM) objDOM.appendChild(sumDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"control\")){\r\n\t\tvar controlsDOM = this.getValueControlsDOM(renderer);\r\n\t\tif(controlsDOM) objDOM.appendChild(controlsDOM);\r\n\t}\r\n\treturn objDOM;\r\n}\r\n\r\nHTMLDataHeaderViewer.prototype.getValueFacetDOM = function(renderer){\r\n\tvar viewables = renderer.getAvailableFacets();\r\n\tvar self = this;\r\n\tif(viewables && viewables.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-value-facet\");\r\n\t\tvar callback = function(val){\r\n\t\t\tif(val){\r\n\t\t\t\trenderer.setFacet(val);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar sel = HTMLFrameHelper.getSelectionControl(\"value-facet\", viewables, renderer.currentFacet(), callback);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n\r\nHTMLDataHeaderViewer.prototype.getValueTypeDOM = function(renderer){\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"value-type\", \"Type\", renderer.type(), \"All data values have types, identified by a unique URL\");\r\n}\r\n\r\nHTMLDataHeaderViewer.prototype.getValueStatusDOM = function(renderer){\r\n\tvar sum = renderer.getSummary();\r\n\treturn HTMLFrameHelper.getInfoboxDOM(\"status-\"+sum.status, false, sum.status, sum.status);\r\n}\r\n\r\n\r\nHTMLDataHeaderViewer.prototype.getValueControlsDOM = function(renderer){\r\n\tvar controlsDOM = document.createElement(\"span\");\r\n\tcontrolsDOM.setAttribute(\"class\", \"terminus-value-controls\");\r\n\tif(renderer.showFeature(\"mode\")){\r\n\t\tvar viewsDOM = HTMLFrameHelper.getModeSelectorDOM(\"value\", renderer);\r\n\t\tif(viewsDOM) controlsDOM.appendChild(viewsDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"delete\")){\r\n\t\tvar dpropDOM = this.getValueDeleteDOM(renderer);\r\n\t\tif(dpropDOM) controlsDOM.appendChild(dpropDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"clone\")){\r\n\t\tvar cpropDOM = this.getValueCloneDOM(renderer);\r\n\t\tif(cpropDOM) controlsDOM.appendChild(cpropDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"reset\")){\r\n\t\tvar rpropDOM = this.getValueResetDOM(renderer);\r\n\t\tif(rpropDOM) controlsDOM.appendChild(rpropDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"update\")){\r\n\t\tvar upropDOM = this.getValueUpdateDOM(renderer);\r\n\t\tif(upropDOM) controlsDOM.appendChild(upropDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"show\")){\r\n\t\tvar showDOM = this.getValueShowDOM(renderer);\r\n\t\tif(showDOM) controlsDOM.appendChild(showDOM);\r\n\t}\r\n\tif(renderer.showFeature(\"hide\")){\r\n\t\tvar hideDOM = this.getValueHideDOM(renderer);\r\n\t\tif(hideDOM) controlsDOM.appendChild(hideDOM);\r\n\t}\r\n\treturn controlsDOM;\r\n}\r\n\r\nHTMLDataHeaderViewer.prototype.getValueDeleteDOM = function(renderer){\r\n\tvar callback = function(){renderer.delete()};\r\n\tvar disabled = (renderer.cardControlAllows(\"delete\") ? false : \"Cardinality Rules Forbid Delete\");\r\n\treturn HTMLFrameHelper.getActionControl(\"value\", \"delete\", \"Delete\", callback, disabled);\r\n}\r\n\r\nHTMLDataHeaderViewer.prototype.getValueResetDOM = function(renderer){\r\n\tvar callback = function(){renderer.reset()};\r\n\tvar disabled = (renderer.isUpdated() ? false : \"Nothing to reset\");\r\n\treturn HTMLFrameHelper.getActionControl(\"value\", \"reset\", \"Reset\", callback, disabled);\r\n}\r\n\r\nHTMLDataHeaderViewer.prototype.getValueShowDOM = function(renderer){\r\n\tvar callback = function(){renderer.show()};\r\n\treturn HTMLFrameHelper.getActionControl(\"value\", \"show\", \"Show\", callback);\r\n}\r\n\r\nHTMLDataHeaderViewer.prototype.getValueHideDOM = function(renderer){\r\n\tvar callback = function(){renderer.hide()};\r\n\treturn HTMLFrameHelper.getActionControl(\"value\", \"hide\", \"Hide\", callback);\r\n}\r\n\r\nHTMLDataHeaderViewer.prototype.getValueCloneDOM = function(renderer){\r\n\tvar callback = function(){renderer.clone()};\r\n\tvar disabled = (renderer.cardControlAllows(\"clone\") ? false : \"Cardinality Rules Forbid Clone\");\r\n\treturn HTMLFrameHelper.getActionControl(\"value\", \"clone\", \"Clone\", callback, disabled);\r\n}\r\n\r\nHTMLDataHeaderViewer.prototype.getValueUpdateDOM = function(renderer){\r\n\tvar dpropDOM = document.createElement(\"span\");\r\n\tdpropDOM.setAttribute(\"class\", \"terminus-value-update\");\r\n\tvar saveback = function(){renderer.save()};\r\n\tvar disabled = (renderer.isUpdated() ? false : \"Nothing to save - no change\");\r\n\tdpropDOM.appendChild(HTMLFrameHelper.getActionControl(\"value\", \"save\", \"Save\", saveback, disabled));\r\n\treturn dpropDOM;\r\n}\r\n\r\nHTMLDataHeaderViewer.prototype.getViewerSelectorDOM = function(renderer){\r\n\tvar viewers = renderer.getAvailableViewers();\r\n\tif(viewers && viewers.length){\r\n\t\tvar mpropDOM = document.createElement(\"span\");\r\n\t\tmpropDOM.setAttribute(\"class\", \"terminus-value-viewer\");\r\n\t\tvar callback = function(viewer){\r\n\t\t\tif(viewer){\r\n\t\t\t\trenderer.setViewer(viewer);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar selected = renderer.currentViewer();\r\n\t\tvar sel = HTMLFrameHelper.getSelectionControl(\"data-viewer\", viewers, selected, callback);\r\n\t\tmpropDOM.appendChild(sel);\r\n\t\treturn mpropDOM;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction JSONObjectViewer(renderer){\r\n\tthis.renderer = renderer;\r\n\tthis.properties = [];\r\n}\r\n\r\n/**\r\n * Functions for rendering / re-rendering the object as header and body components\r\n */\r\nJSONObjectViewer.prototype.render = function(){\r\n\talert(\"render json tbd\");\r\n}\r\nJSONObjectViewer.prototype.redraw = function(){\r\n\talert('redraw json tbd');\r\n}\r\n\r\nmodule.exports={HTMLDataViewer,HTMLDataHeaderViewer,JSONObjectViewer}\r\n","const WOQLQuery = require('../query/WOQLQuery');\r\nconst TerminusClassChooser = require('./TerminusClassChooser');\r\n/*\r\n * Utility class which allows the user to choose a document by id or by label (if select2 and full text indexing is turned on)\r\n */\r\n\r\nTerminusDocumentChooser = function(ui, root, value, view){\r\n\tthis.ui = ui;\r\n\tthis.root = root;\r\n\tthis.choice = value;\r\n\tthis.view = (view ? view : \"id\");\r\n\tthis.show_button = true;\r\n}\r\n\r\nTerminusDocumentChooser.prototype.setRoot = function(root){\r\n\tthis.root = root;\r\n}\r\n\r\nTerminusDocumentChooser.prototype.setFilter = function(filter){\r\n\tthis.filter = filter;\r\n}\r\n\r\nTerminusDocumentChooser.prototype.change = function(docid){\r\n\talert(\"Need to specify doc chooser function (\" + docid + \")\");\r\n}\r\n\r\nTerminusDocumentChooser.prototype.getAsDOM = function(style){\r\n\tif(this.view == \"label\" && \tthis.ui.client.connectionConfig.platformEndpoint() && this.ui.pluginAvailable(\"select2\")){\r\n\t\treturn this.getS2DOM(style);\r\n\t}\r\n\treturn this.getIDDOM();\r\n}\r\n\r\nTerminusDocumentChooser.prototype.getS2DOM = function(style){\r\n\tvar docchooser = document.createElement(\"span\");\r\n\tdocchooser.setAttribute(\"class\", \"terminus-document-chooser terminus-doc-holder\");\r\n\tvar wq = new WOQLQuery(this.ui.client, {}, this.ui);\r\n\tvar cfilter = wq.getSubclassQueryPattern(\"v:Class\", \"'\"+this.root+\"'\");\r\n\tvar termcc = new TerminusClassChooser(this.ui, cfilter);\r\n\ttermcc.empty_choice = \"Filter by Type\";\r\n\ttermcc.show_single = false;\r\n\tvar self = this;\r\n\ttermcc.change = function(new_class){\r\n\t\tif(new_class){\r\n\t\t\tself.filter = new_class;\r\n\t\t}\r\n\t}\r\n\ttdom = termcc.getAsDOM(style);\r\n\tif(tdom) docchooser.appendChild(tdom);\r\n\tvar holder = document.createElement(\"span\");\r\n\tholder.setAttribute(\"class\", \"terminus-entity-reference-value\");\r\n\tvar sel = document.createElement(\"select\");\r\n\tsel.setAttribute(\"class\", \"terminus-entity-class-input\");\r\n\tholder.appendChild(sel);\r\n\tvar opt = document.createElement(\"option\");\r\n\tvar lookup = function (params) {\r\n\t\tparams.class = self.filter;\r\n\t\treturn JSON.stringify(params);\r\n    }\r\n\tvar searchurl = this.ui.client.dbURL() + \"/search\";\r\n\tvar s2config = {\r\n\t\tajax: {\r\n\t\t    url: searchurl,\r\n\t\t    dataType: 'json',\r\n\t\t    data: lookup,\r\n\t\t    type: \"POST\",\r\n\t\t\tcontentType: \"application/json; charset=utf-8\",\r\n\t\t    delay: 250,\r\n\t\t    cache: true\r\n\t\t},\r\n\t\tplaceholder: \"Enter Document Name\",\r\n\t\twidth: 200\r\n\t};\r\n\tjQuery(sel).select2(s2config).change(function(){\r\n\t\tcallback(this.value);\r\n\t});\r\n\tdocchooser.appendChild(holder);\r\n\treturn docchooser;\r\n}\r\n\r\nTerminusDocumentChooser.prototype.getIDDOM = function(){\r\n\tvar docchooser = document.createElement(\"span\");\r\n\tdocchooser.setAttribute(\"class\", \"terminus-document-chooser terminus-doc-holder\");\r\n\tvar dcip = document.createElement(\"input\");\r\n\tdcip.setAttribute(\"class\", \"terminus-document-chooser terminus-query-text\");\r\n\t//11092019 dcip.setAttribute(\"class\", \"terminus-form-value terminus-document-chooser\");\r\n\tdcip.setAttribute(\"placeholder\", \"Enter Document ID\");\r\n\tdcip.addEventListener('keypress', function(e){\r\n\t\tvar key = e.which || e.keyCode;\r\n\t\t// on enter\r\n\t\tif (key === 13 && dcip.value) {\r\n\t\t\tself.choice = dcip.value;\r\n\t\t\tself.change(dcip.value);\r\n\t\t}\r\n\t});\r\n\tdocchooser.appendChild(dcip);\r\n\tif(this.show_button){\r\n\t\tvar dbut = document.createElement(\"button\");\r\n\t\tdbut.setAttribute(\"class\", \"terminus-control-button terminus-btn\");\r\n\t\tvar self = this;\r\n\t\tdbut.addEventListener(\"click\", function(){\r\n\t\t\tif(dcip.value) {\r\n\t\t\t\tself.choice = dcip.value;\r\n\t\t\t\tself.change(dcip.value);\r\n\t\t\t}\r\n\t\t});\r\n\t\t//11092019 dbut.appendChild(document.createTextNode(\"View Document Properties\"));\r\n\t\tdbut.appendChild(document.createTextNode(\"Go\"));\r\n\t\tdocchooser.appendChild(dbut);\r\n\t}\r\n\treturn docchooser;\r\n}\r\n\r\nTerminusDocumentChooser.prototype.toggleView = function(){\r\n\tif(this.view == \"id\") this.view = \"label\";\r\n\telse this.view = \"id\";\r\n}\r\n\r\nTerminusDocumentChooser.prototype.getChangeViewText = function(){\r\n\tif(this.view == \"id\"){\r\n\t\treturn \"Document Lookup\";\r\n\t}\r\n\treturn \"Load Document ID\";\r\n}\r\n\r\nmodule.exports=TerminusDocumentChooser\r\n","const TerminusUI = require('./TerminusUI');\r\nconst RenderingMap = require('./client/RenderingMap');\r\n\r\nvar terminator = new TerminusUI(TerminusConfig);\r\nvar pconfig = {};\r\npconfig.buttons = {'client'   : document.getElementById(\"terminus-client-btn\"),\r\n\t\t\t\t   'explorer' : document.getElementById(\"terminus-explorer-btn\")}\r\npconfig.controller \t= document.getElementById(\"terminus-control-panel\");\r\npconfig.messages = document.getElementById(\"terminus-user-messages\");\r\npconfig.plugins = document.getElementById(\"terminus-plugin-loader\");\r\npconfig.explorer = document.getElementById(\"terminus-explorer\");\r\npconfig.viewer = document.getElementById(\"terminus-content-viewer\");\r\nvar nlocation = (TerminusConfig && TerminusConfig.location) ? TerminusConfig.location : false;\r\nterminator.draw(pconfig, nlocation);\r\n\r\nfunction showPanel(mode){\r\n\ttoggleHeaders(mode, document.getElementById(\"terminus-content-viewer\"));\r\n}\r\n\r\nmodule.exports={TerminusUI:TerminusUI,\r\n                RenderingMap:RenderingMap}","/**\r\n * Terminus UI object\r\n *\r\n * Traffic control of messages going between different Terminus UI pages and features\r\n *\r\n * @param opts - options array\r\n */\r\nconst ApiExplorer = require('./ApiExplorer');\r\nconst TerminusDocumentViewer = require('./client/TerminusDocument');\r\nconst TerminusDBsdk = require('./client/TerminusDB');\r\nconst TerminusViolations = require('./client/TerminusViolation');\r\nconst TerminusQueryViewer = require('./client/TerminusQuery');\r\nconst TerminusMappingViewer = require('./client/TerminusMapping');\r\nconst TerminusSchemaViewer = require('./client/TerminusSchema');\r\nconst TerminusServersdk = require('./client/TerminusServer');\r\nconst TerminusURLLoader = require('./client/TerminusURL');\r\nconst TerminusPluginManager = require('./plugins/TerminusPlugin');\r\nconst UTILS=require('./Utils');\r\n\r\nfunction TerminusUI(opts){\r\n\tthis.client = new TerminusClient.WOQLClient();\r\n\tthis.controls = [];\r\n\tthis.setOptions(opts);\r\n}\r\n\r\n/*\r\n * Client connects to specified server and specified part\r\n * opts is a json with the following fields:\r\n * server: mandatory URL of the server to connect to\r\n * key: optional client API key\r\n * dbid: id of the database to connect to\r\n * schema: if set, the UI will load the schema page after connecting\r\n * query: if set, the query will be sent to the server and the results will be loaded on the query page\r\n * document: if set, the document page corresponding to this document will be loaded after connecting\r\n *\r\n * (note: schema, query, document are mutually exclusive and must also have a dbid set)\r\n */\r\nTerminusUI.prototype.connect = function(opts){\r\n\tvar self = this;\r\n\tthis.client.connectionConfig.server = false;\r\n\tvar key = ((opts && opts.key) ? opts.key : false);\r\n\tthis.showBusy(\"Connecting to server at \" + opts.server);\r\n\treturn this.client.connect(opts.server, key)\r\n\t.then( function(response) {\r\n\t\tself.clearBusy();\r\n\t\tif(opts && opts.db && self.getDBRecord(opts.db)){\r\n\t\t\tself.connectToDB(opts.db);\r\n\t\t\tif(opts.document && self.showView(\"get_document\")){\r\n\t\t\t\tself.showDocument(opts.document);\r\n\t\t\t}\r\n\t\t\telse if(opts.schema && self.showView(\"get_schema\")){\r\n\t\t\t\tself.showSchemaPage(opts.schema);\r\n\t\t\t}\r\n\t\t\telse if(opts.query && self.showView(\"woql_select\")){\r\n\t\t\t\tself.showQueryPage(opts.query);\r\n\t\t\t}\r\n\t\t\telse if(opts.explorer && self.showView(\"api_explorer\")){\r\n\t\t\t\tself.showExplorer(opts.explorer);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tself.showDBMainPage();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.showServerMainPage();\r\n\t\t}\r\n\t\tself.redraw();\r\n\t})\r\n\t.catch(function(err) {\r\n\t\tself.clearBusy();\r\n\t\tself.showError(err);\r\n\t});\r\n}\r\n\r\n/**\r\n * Sends a request to create a new database to the server and interprets the response\r\n *\r\n * dbdets is a json object with the following fields:\r\n * id: the id of the new database (alphanumeric, no spaces, url friendly) mandatory\r\n * title: the text name of the new database for tables, etc. mandatory\r\n * description: text description of the database (optional)\r\n * key: a API client key for server auth\r\n * schema: the url of another Terminus DB from which to import schema\r\n * instance: the url of another Terminus DB from which to import data\r\n *\r\n */\r\nTerminusUI.prototype.createDatabase = function(dbdets){\r\n\tvar self = this;\r\n\tif(!dbdets.id || !dbdets.title){\r\n        return Promise.reject(new Error(self.getBadArguments(\"createDatabase\", \"ID and title are mandatory fields\")));\r\n\t}\r\n\tvar dbid = dbdets.id;\r\n\tvar myserver = this.client.connectionConfig.server;\r\n\tself.showBusy(\"Creating Database \" + dbdets.title + \" with id \" + dbid);\r\n\tvar dbdoc = this.generateNewDatabaseDocument(dbdets);\r\n\treturn this.client.createDatabase(dbid, dbdoc)\r\n\t.then(function(response){ //import schema into newly created DB\r\n\t\tif(dbdets.schema){\r\n\t\t\tself.showBusy(\"Fetching imported schema from \" + dbdets.schema);\r\n\t\t\tvar opts = (dbdets.key ?  {\"terminus:user_key\": dbdets.key } : {});\r\n\t\t\topts['terminus:encoding'] = \"terminus:turtle\";\r\n\t\t\treturn self.client.getSchema(dbdets.schema, opts)\r\n\t\t\t.then(function(response){\r\n\t\t\t\tself.showBusy(\"Updating database with new schema\");\r\n\t\t\t\tself.client.connectionConfig.server = myserver;\r\n\t\t\t\tself.client.connectionConfig.dbid = dbid;\r\n\t\t\t\tvar nopts = {'terminus:encoding':  \"terminus:turtle\"};\r\n\t\t\t\treturn self.client.updateSchema(false, response, nopts);\r\n\t\t\t})\r\n\t\t\t.then(function(response){\r\n\t\t\t\tself.clearBusy();\r\n\t\t\t\tself.redraw();\r\n\t\t\t\treturn response;\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.clearBusy();\r\n\t\t}\r\n\t\treturn response;\r\n\t})\r\n\t.then(function(response){ //reload list of databases in background..\r\n\t\treturn self.refreshDBList()\r\n\t\t.then(function(response){\r\n\t\t\tif(crec = self.client.connection.getDBRecord(dbid)){\r\n\t\t\t\tself.client.connectionConfig.dbid = dbid;\r\n\t\t\t\tself.showDBMainPage();\r\n\t\t\t\tself.showMessage(\"Successfully Created Database \" + dbid, \"success\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t        return Promise.reject(new Error(self.getCrashString(\"createDatabase\", \"Failed to retrieve record of created database \" + dbid)));\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n\t.catch(function(error){\r\n\t\tself.clearBusy();\r\n\t\tself.showError(error);\r\n\t});\r\n}\r\n\r\n/**\r\n * Deletes the database with the passed id from the currently connected server\r\n */\r\nTerminusUI.prototype.deleteDatabase = function(dbid){\r\n\tvar self = this;\r\n\tvar delrec = this.client.connection.getDBRecord();\r\n\tvar lid = (dbid ? dbid : this.db());\r\n\tvar dbn = (delrec && delrec['rdfs:label'] && delrec['rdfs:label'][\"@value\"] ? delrec['rdfs:label'][\"@value\"] + \" (id: \" + lid + \")\" : lid);\r\n\tthis.showBusy(\"Deleting database \" + dbn);\r\n\treturn this.client.deleteDatabase(dbid)\r\n\t.then(function(response){\r\n\t\tself.clearBusy();\r\n\t\tself.client.connectionConfig.dbid = false;\r\n\t\tself.removeDB(dbid);\r\n\t\tself.showServerMainPage();\r\n\t\tself.showMessage(\"Successfully Deleted Database \" + dbn, \"success\");\r\n\t\tself.refreshDBList();\r\n\t\treturn response;\r\n\t})\r\n\t.catch(function(error){\r\n\t\tself.clearBusy();\r\n\t\tself.showError(error);\r\n\t});\r\n}\r\n\r\n/*\r\n * Transforms a details (id, title, description) array into  json-ld document\r\n */\r\nTerminusUI.prototype.generateNewDatabaseDocument = function(dets){\r\n\tvar doc = {\r\n\t\t\"@context\" : {\r\n\t\t\trdfs: \"http://www.w3.org/2000/01/rdf-schema#\",\r\n\t\t\tterminus: \"http://terminusdb.com/schema/terminus#\"\r\n\t\t},\r\n\t\t\"@type\": \"terminus:Database\"\r\n\t}\r\n\tif(dets.title){\r\n\t\tdoc['rdfs:label'] = {\r\n\t\t\t\"@language\":  \"en\",\r\n\t\t\t\"@value\": dets.title\r\n\t\t};\r\n\t}\r\n\tif(dets.description){\r\n\t\tdoc['rdfs:comment'] = {\r\n\t\t\t\"@language\":  \"en\",\r\n\t\t\t\"@value\": dets.description\r\n\t\t};\r\n\t}\r\n\tdoc['terminus:allow_origin'] = { \"@type\" : \"xsd:string\", \"@value\" : \"*\" };\r\n\treturn doc;\r\n}\r\n\r\nTerminusUI.prototype.getBadArguments = function(fname, str){\r\n\treturn \"Bad arguments to \" + fname + \": \" + str;\r\n}\r\n\r\nTerminusUI.prototype.getCrashString = function(fname, str){\r\n\treturn \"Results from \" + fname + \" indicate the possibility of a system failure \" + str;\r\n}\r\n\r\n/*\r\n * Parses the passed URL and turns it into a call to the connect function - loads the appropriate endpoing\r\n */\r\nTerminusUI.prototype.load = function(url, key){\r\n\tvar args = {};\r\n\tif(url && url.indexOf(\"/document/\") != -1){\r\n\t\turl = url.substring(0, url.indexOf(\"/document/\"));\r\n\t\targs.document = url.substring(url.indexOf(\"/document/\")+10);\r\n\t}\r\n\telse if(url && url.indexOf(\"/schema\") != -1){\r\n\t\turl = url.substring(0, url.indexOf(\"/schema\"));\r\n\t\targs.schema = {};\r\n\t}\r\n\telse if(url && url.indexOf(\"/woql\") != -1){\r\n\t\turl = url.substring(0, url.indexOf(\"/query\"));\r\n\t\targs.query = url.substring(url.indexOf(\"/query\")+7);\r\n\t}\r\n\targs.server = url;\r\n\tif(key) args.key = key;\r\n\treturn this.connect(args);\r\n}\r\n\r\n/**\r\n * Fetches the DB URL from the url by chopping off the extra bits\r\n */\r\nTerminusUI.prototype.getConnectionEndpoint = function(url){\r\n\tif(url && url.lastIndexOf(\"/schema\") != -1){\r\n\t\treturn url.substring(0, url.lastIndexOf(\"/schema\"));\r\n\t}\r\n\tif(url && url.lastIndexOf(\"/document\") != -1){\r\n\t\treturn url.substring(0, url.lastIndexOf(\"/document\"));\r\n\t}\r\n\tif(url && url.lastIndexOf(\"/frame\") != -1){\r\n\t\treturn url.substring(0, url.lastIndexOf(\"/frame\"));\r\n\t}\r\n\tif(url && url.lastIndexOf(\"/woql\") != -1){\r\n\t\treturn url.substring(0, url.lastIndexOf(\"/woql\"));\r\n\t}\r\n\treturn url;\r\n}\r\n\r\nTerminusUI.prototype.server = function(){\r\n\treturn this.client.connectionConfig.server;\r\n}\r\n\r\nTerminusUI.prototype.db = function(){\r\n\treturn this.client.connectionConfig.dbid;\r\n}\r\n\r\nTerminusUI.prototype.clearServer = function(){\r\n\tthis.client.connectionConfig.server = false;\r\n}\r\n\r\nTerminusUI.prototype.connectToDB = function(dbid){\r\n\tthis.client.connectionConfig.dbid = dbid;\r\n\tTerminusClient.FrameHelper.standard_urls['doc'] = this.client.connectionConfig.dbURL() + \"/document/\";\r\n\tTerminusClient.FrameHelper.standard_urls['scm'] = this.client.connectionConfig.dbURL() + \"/schema#\";\r\n}\r\n\r\nTerminusUI.prototype.clearDB = function(){\r\n\tthis.client.connectionConfig.dbid = false;\r\n}\r\n\r\nTerminusUI.prototype.removeDB = function(db, url){\r\n\tthis.client.connection.removeDBFromConnection(db, url);\r\n}\r\n\r\nTerminusUI.prototype.getDBRecord = function(db, url){\r\n\treturn this.client.connection.getDBRecord(db, url);\r\n}\r\n\r\nTerminusUI.prototype.refreshDBList = function(){\r\n\tvar self = this;\r\n\treturn this.client.connect();\r\n}\r\n\r\nTerminusUI.prototype.showServerMainPage = function(){\r\n\tthis.viewer = new TerminusServersdk.TerminusServerViewer(this);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showLoadURLPage = function(val){\r\n\tthis.viewer = new TerminusURLLoader(this, val);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showDBMainPage = function(){\r\n\tthis.viewer = new TerminusDBsdk.TerminusDBViewer(this);\r\n\tthis.redraw();\r\n}\r\n\r\nTerminusUI.prototype.showCreateDBPage = function(){\r\n\tthis.viewer = new TerminusDBsdk.TerminusDBCreator(this);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showSchemaPage = function(durl){\r\n\tthis.viewer = new TerminusSchemaViewer(this);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showQueryPage = function(query){\r\n\tthis.viewer = new TerminusQueryViewer(this, query, this.options);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showMappingPage = function(mapping){\r\n\tthis.viewer = new TerminusMappingViewer(this, mapping, this.options);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showDocument = function(durl){\r\n\tthis.viewer = new TerminusDocumentViewer(this, \"view\", this.getDocViewerOptions());\r\n\tthis.viewer.loadDocument(durl);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.showCreateDocument = function(durl){\r\n\tthis.viewer = new TerminusDocumentViewer(this, \"create\", this.getDocCreatorOptions());\r\n\tthis.viewer.loadCreateDocument(durl);\r\n\tthis.redrawMainPage();\r\n}\r\n\r\nTerminusUI.prototype.redrawMainPage = function(){\r\n\tTerminusClient.FrameHelper.removeChildren(this.main);\r\n\tif(this.viewer){\r\n\t\tthis.main.appendChild(this.viewer.getAsDOM());\r\n\t}\r\n}\r\n\r\nTerminusUI.prototype.showResult = function(response){\r\n\tthis.showMessage(response, \"success\");\r\n};\r\n\r\nTerminusUI.prototype.showError = function(response){\r\n\tthis.showMessage(response, \"error\");\r\n};\r\n\r\nTerminusUI.prototype.clearMessages = function(response){\r\n\tif(this.messages) TerminusClient.FrameHelper.removeChildren(this.messages);\r\n};\r\n\r\nTerminusUI.prototype.clearMainPage = function(){\r\n\tif(this.main) TerminusClient.FrameHelper.removeChildren(this.main);\r\n}\r\n\r\nTerminusUI.prototype.setMessageDOM = function(dom){\r\n\tthis.messages = dom;\r\n}\r\n\r\nTerminusUI.prototype.setbuttonControls = function(dom){\r\n\tthis.buttons = dom;\r\n}\r\n\r\nTerminusUI.prototype.setControllerDOM = function(dom){\r\n\tthis.controller = dom;\r\n}\r\n\r\nTerminusUI.prototype.setExplorerDOM = function(dom){\r\n\tthis.explorer = dom;\r\n}\r\n\r\nTerminusUI.prototype.setPluginsDOM = function(dom){\r\n\tthis.plugins = dom;\r\n}\r\n\r\nTerminusUI.prototype.setViewerDOM = function(dom){\r\n\tthis.main = dom;\r\n}\r\n\r\nTerminusUI.prototype.draw = function(comps, slocation){\r\n\tif(comps && comps.buttons) this.setbuttonControls(comps.buttons);\r\n\tif(comps && comps.messages) this.setMessageDOM(comps.messages);\r\n\tif(comps && comps.controller) this.setControllerDOM(comps.controller);\r\n\tif(comps && comps.explorer) this.setExplorerDOM(comps.explorer);\r\n\tif(comps && comps.viewer) this.setViewerDOM(comps.viewer);\r\n\tif(comps && comps.plugins) this.setPluginsDOM(comps.plugins);\r\n\tif(this.plugins){\r\n\t\tthis.drawPlugins();\r\n\t}\r\n\tvar self = this;\r\n\tvar cdrawn = false;\r\n\tif(slocation && slocation.server){\r\n\t\tif(typeof this.client.connection.connection[slocation.server] == \"undefined\") {\r\n\t\t\tthis.connect(slocation)\r\n\t\t\t.catch(function(error){\r\n\t\t\t\tthis.showLoadURLPage();\r\n\t\t\t\tthis.showError(error);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tif(this.controller){\r\n\t\t\tthis.drawControls();\r\n\t\t}\r\n\t\tthis.showLoadURLPage();\r\n\t};\r\n\tif(this.buttons){\r\n\t\tthis.toggleControl();\r\n\t}\r\n}\r\n\r\n\r\n\r\nTerminusUI.prototype.redraw = function(msg){\r\n\tthis.clearMessages();\r\n\tif(this.controller){\r\n\t\tTerminusClient.FrameHelper.removeChildren(this.controller);\r\n\t\tthis.drawControls();\r\n\t}\r\n\tif(this.explorer){\r\n\t\tTerminusClient.FrameHelper.removeChildren(this.explorer);\r\n\t\t//this.drawExplorer();\r\n\t}\r\n\tif(this.viewer){\r\n\t\tthis.redrawMainPage();\r\n\t}\r\n\tif(msg) this.showMessage(msg);\r\n};\r\n\r\n\r\nTerminusUI.prototype.toggleDashboardWidget = function(widget){\r\n    TerminusClient.FrameHelper.removeChildren(this.controller);\r\n    TerminusClient.FrameHelper.removeChildren(this.explorer);\r\n    UTILS.removeSelectedNavClass('terminus-dashboard-selected');\r\n    widget.classList.add('terminus-dashboard-selected');\r\n}\r\n\r\nTerminusUI.prototype.toggleControl = function(){\r\n  var self = this;\r\n  this.buttons.client.addEventListener('click', function(){\r\n    self.toggleDashboardWidget(this);\r\n    self.drawControls();\r\n    self.showServerMainPage();\r\n  })\r\n  this.buttons.explorer.addEventListener('click', function(){\r\n    self.toggleDashboardWidget(this);\r\n    self.drawExplorer();\r\n  })\r\n}\r\n\r\nTerminusUI.prototype.drawControls = function(){\r\n\tthis.controls = [];\r\n\tthis.loadControls();\r\n\tfor(var i = 0; i<this.controls.length; i++){\r\n\t\tvar ncontrol = this.controls[i];\r\n\t\tif(ncontrol && (nd = ncontrol.getAsDOM())){\r\n\t\t\tthis.controller.appendChild(nd);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusUI.prototype.drawExplorer = function(){\r\n\tif(this.explorer){\r\n\t\tif(this.showControl(\"api_explorer\")){\r\n\t\t\tvar exp = new ApiExplorer(this);\r\n\t\t\tae = exp.getAsDOM();\r\n\t\t\tthis.explorer.appendChild(ae);\r\n\t\t\tthis.explorer.style.display = 'block';\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusUI.prototype.loadControls = function(){\r\n\tif(this.showControl('server')){\r\n\t\tvar sc = new TerminusServersdk.TerminusServerController(this);\r\n\t\tif(sc) {\r\n\t\t\tthis.controls.push(sc);\r\n\t\t}\r\n\t\tif(this.db() && this.showControl(\"db\")){\r\n\t\t\tvar sc = new TerminusDBsdk.TerminusDBController(this);\r\n\t\t\tif(sc) this.controls.push(sc);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusUI.prototype.showControl = function(el){\r\n\tif(this.show_controls.indexOf(el) == -1) return false;\r\n\tif(this.pseudoCapability(el)) return true;\r\n\tif(this.client.connection.capabilitiesPermit(el)) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusUI.prototype.showView = function(el){\r\n\tif(this.show_views.indexOf(el) == -1) return false;\r\n\tif(this.pseudoCapability(el)) return true;\r\n\tif(this.client.connection.capabilitiesPermit(el)) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusUI.prototype.clearBusy = function(response){\r\n\tthis.clearMessages();\r\n\tif(this.viewer && typeof this.viewer.busy == \"function\") this.viewer.busy(false);\r\n}\r\n\r\nTerminusUI.prototype.getBusyLoader = function(bsyDom){\r\n     var pd = document.createElement('div');\r\n     var pbc = document.createElement('div');\r\n     pbc.setAttribute('class', 'term-progress-bar-container');\r\n     pd.appendChild(pbc);\r\n\r\n     var pbsa = document.createElement('div');\r\n     pbsa.setAttribute('class', 'term-progress-bar term-stripes animated reverse slower');\r\n     pbc.appendChild(pbsa);\r\n     var pbia = document.createElement('span');\r\n     pbia.setAttribute('class', 'term-progress-bar-inner');\r\n     pbsa.appendChild(pbia);\r\n\r\n     bsyDom.appendChild(pd);\r\n}\r\n\r\nTerminusUI.prototype.showMessage = function(msg, type){\r\n\tif(this.messages){\r\n\t\tTerminusClient.FrameHelper.removeChildren(this.messages);\r\n\t\tvar md = document.createElement('div');\r\n        switch(type){\r\n            case 'busy':\r\n                var msgHolder = document.createElement('div');\r\n                msgHolder.setAttribute('class', 'terminus-busy-msg')\r\n                msgHolder.appendChild(document.createTextNode(msg));\r\n                md.appendChild(msgHolder);\r\n                this.getBusyLoader(md);\r\n            break;\r\n            case 'success':\r\n                md.setAttribute('class', 'terminus-show-msg-success');\r\n                md.appendChild(document.createTextNode(msg));\r\n            break;\r\n            case 'error':\r\n                md.setAttribute('class', 'terminus-show-msg-error');\r\n                md.appendChild(document.createTextNode(msg));\r\n            break;\r\n        }\r\n\t\tthis.messages.appendChild(md);\r\n\t}\r\n};\r\n\r\nTerminusUI.prototype.showViolations = function(vios, type){\r\n\tvar nvios = new TerminusViolations(vios, this);\r\n\tif(this.messages){\r\n\t\tvar cmsg = (type == \"schema\" ? \" in Schema\" : \" in Document\");\r\n\t\tTerminusClient.FrameHelper.removeChildren(this.messages);\r\n\t\tthis.messages.appendChild(nvios.getAsDOM(cmsg));\r\n\t}\r\n}\r\n\r\nTerminusUI.prototype.showBusy = function(msg){\r\n\tthis.showMessage(msg, \"busy\");\r\n\tif(this.viewer && typeof this.viewer.busy == \"function\") this.viewer.busy(msg);\r\n};\r\n\r\nTerminusUI.prototype.pseudoCapability = function(el){\r\n\tvar pseuds = [\"server\", \"db\", \"change-server\", \"api_explorer\", \"import_schema\", \"schema_format\"];\r\n\tif(pseuds.indexOf(el) == -1) return false;\r\n\treturn true;\r\n}\r\n\r\nTerminusUI.prototype.setOptions = function(opts){\r\n\tthis.show_controls = opts && opts.controls ? opts.controls :\r\n\t\t[\"server\", \"db\", \"change-server\", \"schema_format\",\r\n\t\t\t\"import_schema\", \"class_frame\", \"create_database\",\r\n\t\t\t\"create_document\", \"get_document\", \"update_schema\",\r\n\t\t\t\"get_schema\", \"woql_select\"\r\n\t\t];\r\n\tthis.show_views = opts && opts.views ? opts.views : this.show_controls;\r\n\tif(opts.document){\r\n\t\tthis.document_options = opts.document;\r\n\t}\r\n\tif(opts.schema){\r\n\t\tthis.schema_options = opts.schema;\r\n\t}\r\n\tthis.piman = new TerminusPluginManager();\r\n\tvar self = this;\r\n\tthis.piman.init(opts.plugins, function(){\r\n\t\tself.redraw();\r\n\t});\r\n\tif(opts.css && this.piman){\r\n\t\tthis.piman.loadPageCSS(opts.css);\r\n\t}\r\n\tthis.loadControls();\r\n}\r\n\r\nTerminusUI.prototype.pluginAvailable = function(p){\r\n\treturn this.piman.pluginAvailable(p);\r\n}\r\n\r\nTerminusUI.prototype.drawPlugins = function(){\r\n\tif(!this.piman) {\r\n\t\tconsole.log(new Error(\"No plugin manager initialised in UI object\"));\r\n\t\treturn false;\r\n\t}\r\n\tthis.plugins.appendChild(this.piman.getAsDOM(this));\r\n}\r\n\r\nTerminusUI.prototype.getDocViewerOptions = function(){\r\n\tif(this.document_options && this.document_options['view']){\r\n\t\treturn this.document_options['view'];\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusUI.prototype.getDocCreatorOptions = function(){\r\n\tif(this.document_options && this.document_options['view']){\r\n\t\treturn this.document_options['view'];\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusUI.prototype.getClassFrameOptions = function(){\r\n\treturn this.viewdoc_options;\r\n}\r\n\r\nmodule.exports=TerminusUI\r\n","/**\r\n * @file Javascript Api explorer tool\r\n * @author Kitty Jose\r\n * @license Copyright 2018-2019 Data Chemist Limited, All Rights Reserved. See LICENSE file for more\r\n *\r\n * @summary Displays a demo and description of api calls from WOQLCLient and what happens under the hood of api calls\r\n */\r\nconst TerminusPluginManager = require('./plugins/TerminusPlugin');\r\nconst UTILS = require('./Utils')\r\n\r\nlet apiNavConfig = {\r\n    mainNav: {\r\n        connect: {\r\n    \t\tnavText: 'Connect Server Api',\r\n            action : 'connect',\r\n            icon   : 'link',\r\n            defaultSelected: true\r\n    \t},\r\n        database: {\r\n            navText: 'Database Api',\r\n            action : 'create',\r\n            icon   : 'database'\r\n        },\r\n        schema: {\r\n            navText: 'Schema Api',\r\n            action : 'schema',\r\n            icon   : 'cog'\r\n        },\r\n        document: {\r\n            navText: 'Document Api',\r\n            action : 'document',\r\n            icon   : 'file'\r\n        },\r\n        query: {\r\n            navText: 'Query Api',\r\n            action : 'query',\r\n            icon   : 'search'\r\n        }\r\n    },\r\n    subNav: {\r\n        database: {\r\n            createDatabase: {\r\n                navText: 'Create database',\r\n                action : 'create',\r\n                icon   : 'plus',\r\n                defaultSelected: true\r\n            },\r\n            deleteDatabase: {\r\n                navText: 'Delete database',\r\n                action : 'delete',\r\n                icon   : 'trash-alt'\r\n            }\r\n        },\r\n        schema: {\r\n            getSchema: {\r\n                navText: 'View Schema',\r\n                action : 'getSchema',\r\n                icon   : 'eye',\r\n                defaultSelected: true\r\n            },\r\n            updateSchema: {\r\n                navText: 'Update Schema',\r\n                action : 'updateSchema',\r\n                icon   : 'arrow-up'\r\n            },\r\n            getClassFrames: {\r\n                navText: 'Get Class Frames',\r\n                action : 'getClassFrames',\r\n                icon   : 'share-alt'\r\n            }\r\n        },\r\n        document: {\r\n            viewDocument: {\r\n        \t\tnavText: 'View Document',\r\n                action : 'viewDocument',\r\n                icon   : 'eye',\r\n                defaultSelected: true\r\n        \t},\r\n            createDocument: {\r\n                navText: 'Create Document',\r\n                action : 'createDocument',\r\n                icon   : 'plus'\r\n            },\r\n            updateDocument: {\r\n                navText: 'Update Document',\r\n                action : 'updateDocument',\r\n                icon   : 'arrow-up'\r\n            },\r\n            deleteDocument:{\r\n                navText: 'Delete Document',\r\n                action : 'deleteDocument',\r\n                icon   : 'trash-alt'\r\n            }\r\n        },\r\n        query: {\r\n            select: {\r\n                navText: 'Select',\r\n                action : 'select',\r\n                icon   : 'mouse-pointer',\r\n                defaultSelected: true\r\n            },\r\n            update: {\r\n                navText: 'Update',\r\n                action : 'update',\r\n                icon   : 'arrow-up'\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction ApiExplorer(ui){\r\n    this.ui = ui;\r\n    this.viewer = ui.main;\r\n    this.client = new TerminusClient.WOQLClient();\r\n    this.client.use_fetch = true;\r\n    this.client.return_full_response = true;\r\n    this.pman = new TerminusPluginManager();\r\n}\r\n\r\n// Controller provides access to Api explorer functions\r\nApiExplorer.prototype.getAsDOM = function(){\r\n \tvar aec = document.createElement(\"div\");\r\n    aec.setAttribute(\"class\", \"terminus-db-controller\");\r\n    if(this.ui){\r\n       this.getApiNav(aec, this.viewer); // nav\r\n       this.getApiExplorerDom('connect', this.viewer); // content dom\r\n    } // if this.ui\r\n    return aec;\r\n }\r\n\r\n/***** Api Nav bar *****/\r\n// Toggle selected nav bars\r\nApiExplorer.prototype.setSelectedNavMenu = function(a){\r\n    UTILS.removeSelectedNavClass(\"terminus-selected\");\r\n    a.classList.add(\"terminus-selected\");\r\n}\r\n\r\nApiExplorer.prototype.setSelectedSubMenu = function(a){\r\n    UTILS.removeSelectedNavClass(\"terminus-submenu-selected\");\r\n    a.classList.add(\"terminus-submenu-selected\");\r\n}\r\n\r\nApiExplorer.prototype.navOnSelect = function(action, nav, viewer){\r\n    UTILS.removeSelectedNavClass(\"terminus-selected\");\r\n    nav.classList.add(\"terminus-selected\");\r\n    this.getApiExplorerDom(action, viewer);\r\n}\r\n\r\n// create nav bars\r\nApiExplorer.prototype.createNavs = function(navConfig, viewer, ul){\r\n    var a = document.createElement('a');\r\n    a.setAttribute('class', 'terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n    if(navConfig.defaultSelected) a.classList.add('terminus-selected');\r\n    var self = this;\r\n    a.addEventListener(\"click\", function(){\r\n        self.navOnSelect(navConfig.action, this, viewer);\r\n    })\r\n    var icon = document.createElement('i');\r\n    icon.setAttribute('class', 'terminus-menu-icon fa fa-' + navConfig.icon);\r\n    a.appendChild(icon);\r\n    var txt = document.createTextNode(navConfig.navText);\r\n    a.appendChild(txt);\r\n    ul.appendChild(a);\r\n}\r\n\r\n// gets api nav bar\r\nApiExplorer.prototype.getApiNav = function(navDom, viewer){\r\n    // list view of apis\r\n    var nav = document.createElement('div');\r\n    navDom.appendChild(nav);\r\n    // connect to server api\r\n    var ul = document.createElement('ul');\r\n    ul.setAttribute('class', 'terminus-ul');\r\n    nav.appendChild(ul);\r\n    // loop over apiNavConfig\r\n    for (var key in apiNavConfig.mainNav){\r\n        if (apiNavConfig.mainNav.hasOwnProperty(key)) {\r\n            this.createNavs(apiNavConfig.mainNav[key], viewer, ul);\r\n        }\r\n    } // for apiNavConfig\r\n    return navDom;\r\n} // getApiNav()\r\n\r\n/***** Api sub navs  *****/\r\n// get schema api explorer - nav bar, alert msg, headers ...\r\nApiExplorer.prototype.getApiExplorerDom = function(view, viewer){\r\n    // clear of viewer\r\n    TerminusClient.FrameHelper.removeChildren(viewer);\r\n    // wrapper\r\n    var wrap = document.createElement('div');\r\n    //wrap.setAttribute('class', 'terminus-wrapper terminus-wrapper-height');\r\n    viewer.appendChild(wrap);\r\n    var cont = document.createElement('div');\r\n    cont.setAttribute('class', 'container-fluid');\r\n    wrap.appendChild(cont);\r\n    var row = document.createElement('div');\r\n    row.setAttribute('class', 'row-fluid');\r\n    cont.appendChild(row);\r\n    var body = document.createElement('div');\r\n    body.setAttribute('class', 'terminus-module-body');\r\n    row.appendChild(body);\r\n    var api = document.createElement('div');\r\n    api.setAttribute('class', 'terminus-module-body terminus-module-body-white-bg terminus-module-body-width');\r\n    body.appendChild(api);\r\n    // body\r\n    var cont = document.createElement('div');\r\n    var self = this;\r\n    switch(view){\r\n        case 'connect':\r\n            var apiCont = self.getConnectExplorer(cont);\r\n            api.appendChild(apiCont);\r\n        break;\r\n        case 'create':\r\n            var apiCont = self.getDatabaseExplorer(cont);\r\n            api.appendChild(apiCont);\r\n        break;\r\n        case 'schema':\r\n            var apiCont = self.getSchemaApi(cont);\r\n            api.appendChild(apiCont);\r\n        break;\r\n        case 'document':\r\n            var apiCont = self.getDocumentApi(cont);\r\n            api.appendChild(apiCont);\r\n        break;\r\n        case 'query':\r\n            var apiCont = self.getQueryApi(cont);\r\n            api.appendChild(apiCont);\r\n        break;\r\n    }// switch(api)\r\n    return wrap;\r\n} // getApiExplorerDom\r\n\r\n// on trigger of click event - change dom\r\nApiExplorer.prototype.changeSubApiDom = function(curSubMenu, action, cont, body){\r\n    TerminusClient.FrameHelper.removeChildren(body);\r\n    switch(curSubMenu){\r\n        case 'database':\r\n            var dom = this.getDatabaseDom(action, body);\r\n        break;\r\n        case 'schema':  // getShowApiDom() deals with schema and document\r\n             var dom = this.getShowApiDom(action, body);\r\n        break;\r\n        case 'document': // getShowApiDom() deals with schema and document\r\n             var dom = this.getShowApiDom(action, body);\r\n        break;\r\n        case 'query':\r\n            var dom = this.getQueryApiDom(action, body);\r\n        break;\r\n        default:\r\n            console.log('Invalid Api Config');\r\n        break;\r\n    }\r\n    cont.appendChild(dom);\r\n}\r\n\r\nApiExplorer.prototype.subNavOnSelect = function(curSubMenu, subMenuConfig, subNav, cont, body){\r\n    this.setSelectedSubMenu(subNav);\r\n    this.changeSubApiDom(curSubMenu, subMenuConfig.action, cont, body);\r\n}\r\n\r\n// create sub nav bars\r\nApiExplorer.prototype.createSubNavs = function(curSubMenu, subMenuConfig, cont, body, ul){\r\n    var a = document.createElement('a');\r\n    a.setAttribute('class', 'terminus-a terminus-hz-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n    if(subMenuConfig.defaultSelected) a.classList.add('terminus-submenu-selected');\r\n    var self = this;\r\n    a.addEventListener(\"click\", function() {\r\n        self.subNavOnSelect(curSubMenu, subMenuConfig, this, cont, body);\r\n    })\r\n    var icon = document.createElement('i');\r\n    icon.setAttribute('class', 'terminus-menu-icon fa fa-' + subMenuConfig.icon);\r\n    a.appendChild(icon);\r\n    var txt = document.createTextNode(subMenuConfig.navText);\r\n    a.appendChild(txt);\r\n    ul.appendChild(a);\r\n}\r\n\r\n// get connect to server api calls - on click of connectAPI nav bar\r\nApiExplorer.prototype.getConnectExplorer = function(body){\r\n    var self = this;\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    // get signature\r\n    var b = this.getSignature('connect');\r\n    body.appendChild(b);\r\n    // get header Parameter\r\n    body.appendChild(UTILS.getHeaderDom('Parameters'));\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    //form to get server url\r\n    this.getForm( '', body, true, 'connect', 'URL : server_url');\r\n    //body.appendChild(form);\r\n    return body;\r\n} // getConnectExplorer\r\n\r\n// get database api calls - on click of databaseAPI nav bar - submenus of database Api defined here\r\nApiExplorer.prototype.getDatabaseExplorer = function(cont){\r\n    var body = document.createElement('div');\r\n    // list view of Databse tools\r\n    var ul = document.createElement('ul');\r\n    ul.setAttribute('class','terminus-ul-horizontal');\r\n    // loop over apiNavConfig\r\n    for (var key in apiNavConfig.subNav.database){\r\n        if (apiNavConfig.subNav.database.hasOwnProperty(key))\r\n            this.createSubNavs('database', apiNavConfig.subNav.database[key], cont, body, ul);\r\n    } // for apiNavConfig\r\n    cont.appendChild(ul);\r\n    // landing page\r\n    var dom = this.getDatabaseDom(apiNavConfig.subNav.database.createDatabase.action, body);\r\n    cont.appendChild(dom);\r\n    return cont;\r\n} // getDatabaseExplorer\r\n\r\n// get schema api calls - on click of SchemaAPI nav bar - submenus of schema Api defined here\r\nApiExplorer.prototype.getSchemaApi = function(cont){\r\n    var body = document.createElement('div');\r\n    // list view of Databse tools\r\n    var ul = document.createElement('ul');\r\n    ul.setAttribute('class','terminus-ul-horizontal');\r\n    // loop over apiNavConfig\r\n    for (var key in apiNavConfig.subNav.schema){\r\n        if (apiNavConfig.subNav.schema.hasOwnProperty(key)) {\r\n            this.createSubNavs('schema', apiNavConfig.subNav.schema[key], cont, body, ul);\r\n        }\r\n    } // for apiNavConfig\r\n    cont.appendChild(ul);\r\n    var dom = this.getShowApiDom(apiNavConfig.subNav.schema.getSchema.action, body);\r\n    cont.appendChild(dom);\r\n    return cont;\r\n} // getSchemaApi\r\n\r\n// get document api calls - on click of DocumentAPI nav bar\r\nApiExplorer.prototype.getDocumentApi = function(cont){\r\n    var body = document.createElement('div');\r\n    // list view of Databse tools\r\n    var ul = document.createElement('ul');\r\n    ul.setAttribute('class','terminus-ul-horizontal');\r\n    // loop over apiNavConfig\r\n    for (var key in apiNavConfig.subNav.document){\r\n        if (apiNavConfig.subNav.document.hasOwnProperty(key)) {\r\n            this.createSubNavs('document', apiNavConfig.subNav.document[key], cont, body, ul);\r\n        }\r\n    } // for apiNavConfig\r\n    cont.appendChild(ul);\r\n    var dom = this.getShowApiDom(apiNavConfig.subNav.document.viewDocument.action, body);\r\n    cont.appendChild(dom);\r\n    return cont;\r\n} // getDocumentApi\r\n\r\n// get query api calls - on click of QueryAPI nav bar - submenus of Query Api defined here\r\nApiExplorer.prototype.getQueryApi  = function(cont){\r\n    var body = document.createElement('div');\r\n    // list view of Databse tools\r\n    var ul = document.createElement('ul');\r\n    ul.setAttribute('class','terminus-ul-horizontal');\r\n    // loop over apiNavConfig\r\n    for (var key in apiNavConfig.subNav.query){\r\n        if (apiNavConfig.subNav.query.hasOwnProperty(key)) {\r\n            this.createSubNavs('query', apiNavConfig.subNav.query[key], cont, body, ul);\r\n        }\r\n    } // for apiNavConfig\r\n    cont.appendChild(ul);\r\n    var dom = this.getQueryApiDom(apiNavConfig.subNav.query.select.action, body);\r\n    cont.appendChild(dom);\r\n    return cont;\r\n} //getQueryApi\r\n\r\n/***** Api Content view  *****/\r\n// get database dom\r\nApiExplorer.prototype.getDatabaseDom = function(mode, body){\r\n    var self = this;\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    // get signature\r\n    var b = this.getSignature(mode);\r\n    body.appendChild(b);\r\n    // get header Parameter\r\n    body.appendChild(UTILS.getHeaderDom('Parameters'));\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    //form to get database id\r\n    if(mode == 'create') this.getForm( null, body, false, mode, 'URL : server/database_id');\r\n    else this.getForm( null, body, true, mode, 'URL : server/database_id');\r\n    return body;\r\n} // getConnectExplorer\r\n\r\n//get create & delete db form\r\nApiExplorer.prototype.getServerForm = function(){\r\n  // form\r\n  var form = document.createElement('form');\r\n  form.setAttribute('class', 'terminus-form-horizontal row-fluid');\r\n\r\n  var fd = document.createElement('div');\r\n  fd.setAttribute('class', 'terminus-control-group');\r\n  form.appendChild(fd);\r\n  var inpLabel = document.createElement('label');\r\n  inpLabel.setAttribute('class', 'terminus-control-label');\r\n  inpLabel.setAttribute('for', 'basicinput');\r\n  inpLabel.innerHTML = 'Url:';\r\n  fd.appendChild(inpLabel);\r\n  var cd = document.createElement('div');\r\n  cd.setAttribute('class', 'terminus-controls');\r\n  fd.appendChild(cd);\r\n  var inpId = document.createElement('input');\r\n  inpId.setAttribute('type', 'text');\r\n  inpId.setAttribute('id', 'basicinput');\r\n  inpId.setAttribute('class', 'terminus-input-text');\r\n  inpId.setAttribute('placeholder', 'URL : server_url');\r\n  if(this.val) inpId.value = this.val;\r\n  cd.appendChild(inpId);\r\n\r\n  var fd = document.createElement('div');\r\n  fd.setAttribute('class', 'terminus-control-group');\r\n  form.appendChild(fd);\r\n  var keyLabel = document.createElement('label');\r\n  keyLabel.setAttribute('class', 'terminus-control-label');\r\n  keyLabel.setAttribute('for', 'basicinput');\r\n  keyLabel.innerHTML = 'Key:';\r\n  fd.appendChild(keyLabel);\r\n  var cd = document.createElement('div');\r\n  cd.setAttribute('class', 'terminus-controls');\r\n  fd.appendChild(cd);\r\n  var key = document.createElement('input');\r\n  key.setAttribute('type', 'text');\r\n  key.setAttribute('id', 'basicinput');\r\n  key.setAttribute('class', 'span8 terminus-input-text');\r\n  key.setAttribute('placeholder', 'Key : key');\r\n  if(this.val) key.value = this.val;\r\n  cd.appendChild(key);\r\n\r\n  var button = document.createElement('button');\r\n  button.setAttribute('class', 'terminus-btn terminus-send-api-btn');\r\n  button.setAttribute('type', 'button');\r\n  button.innerHTML = 'Send Api';\r\n  var gatherips = function(){\r\n    var input = {};\r\n    input.url = inpId.value;\r\n    input.key = key.value;\r\n    return input;\r\n  }\r\n  var resd = document.createElement('div');\r\n  form.appendChild(button);\r\n  form.appendChild(resd);\r\n  var self = this;\r\n  button.addEventListener(\"click\", function(){\r\n    var buttonSelf = this;\r\n    //opts = {};\r\n    var input = gatherips();\r\n    self.client.connect(input.url, input.key)\r\n    .then(function(response){\r\n      TerminusClient.FrameHelper.removeChildren(resd);\r\n      var resultDom = UTILS.showHttpResult(response, 'connect', resd, self.ui);\r\n    });\r\n  }) // button click\r\n  return form;\r\n} // getServerForm()\r\n\r\n// get database api calls - on click of databaseAPI nav bar - submenus of database Api defined here\r\nApiExplorer.prototype.getDatabaseExplorer = function(cont){\r\n  var body = document.createElement('div');\r\n  // list view of Databse tools\r\n  var ul = document.createElement('ul');\r\n  ul.setAttribute('class','terminus-ul-horizontal');\r\n  // loop over apiNavConfig\r\n  for (var key in apiNavConfig.subNav.database){\r\n      if (apiNavConfig.subNav.database.hasOwnProperty(key)) {\r\n          this.createSubNavs('database', apiNavConfig.subNav.database[key], cont, body, ul);\r\n      }\r\n  } // for apiNavConfig\r\n  cont.appendChild(ul);\r\n  // landing page\r\n  var dom = this.getDatabaseDom(apiNavConfig.subNav.database.createDatabase.action, body);\r\n  cont.appendChild(dom);\r\n  return cont;\r\n} // getDatabaseExplorer\r\n\r\n\r\n// get schema & document dom\r\nApiExplorer.prototype.getShowApiDom = function(action, body){\r\n    var self = this;\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    // signature\r\n    var b = this.getSignature(action);\r\n    body.appendChild(b);\r\n    // get header Parameter\r\n    body.appendChild(UTILS.getHeaderDom('Parameters'));\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    // get input\r\n    switch(action){\r\n        case 'getSchema':\r\n            this.getForm( 'schema', body, true, action, 'URL : server/database_id');\r\n        break;\r\n        case 'getClassFrames':\r\n            this.getForm( 'getClassFrames', body, true, action, 'URL : server/database_id');\r\n        break;\r\n        case 'updateSchema':\r\n            this.getForm( 'schema', body, false, action, 'URL : server/database_id');\r\n        break;\r\n        case 'viewDocument':\r\n            this.getForm('document', body, true, action, 'URL : server/database_id/document/document_id');\r\n        break;\r\n        case 'deleteDocument':\r\n            this.getForm('document', body, true, action, 'URL : server/database_id/document/document_id');\r\n        break;\r\n        case 'createDocument':\r\n            this.getForm('document', body, false, action, 'URL : server/database_id/document/document_id');\r\n        break;\r\n        case 'updateDocument':\r\n            this.getForm('document', body, false, action, 'URL : server/database_id/document/document_id');\r\n        break;\r\n        default:\r\n            console.log('Invalid Api Call on form');\r\n        break;\r\n   }// switch(action)\r\n\r\n   return body;\r\n } // getShowApiDom()\r\n\r\n// get query api dom\r\nApiExplorer.prototype.getQueryApiDom = function(action, body){\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    // signature\r\n    var b = this.getSignature(action);\r\n    body.appendChild(b);\r\n    // get header Parameter\r\n    body.appendChild(UTILS.getHeaderDom('Parameters'));\r\n    var br = document.createElement('BR');\r\n    body.appendChild(br);\r\n    this.getForm( 'query', body, false, action, 'URL : server/database_id');\r\n    return body;\r\n} // getQueryApiDom\r\n\r\n/*ApiExplorer.prototype.getClassFramesForm = function(){\r\n    // form\r\n    var form = document.createElement('form');\r\n    form.setAttribute('class', 'terminus-form-horizontal row-fluid');\r\n    var fd = document.createElement('div');\r\n    fd.setAttribute('class', 'terminus-control-group');\r\n    form.appendChild(fd);\r\n    var inpLabel = document.createElement('label');\r\n    inpLabel.setAttribute('class', 'terminus-control-label');\r\n    inpLabel.setAttribute('for', 'basicinput');\r\n    inpLabel.innerHTML = 'Url:';\r\n    fd.appendChild(inpLabel);\r\n    var cd = document.createElement('div');\r\n    cd.setAttribute('class', 'terminus-controls');\r\n    fd.appendChild(cd);\r\n    var inpUrl = document.createElement('input');\r\n    inpUrl.setAttribute('type', 'text');\r\n    inpUrl.setAttribute('id', 'basicinput');\r\n    inpUrl.setAttribute('class', 'span8 terminus-input-text');\r\n    inpUrl.setAttribute('placeholder', 'URL : database_url');\r\n    if(this.val) inpUrl.value = this.val;\r\n    cd.appendChild(inpUrl);\r\n    var fd = document.createElement('div');\r\n    fd.setAttribute('class', 'terminus-control-group');\r\n    form.appendChild(fd);\r\n    var inpLabel = document.createElement('label');\r\n    inpLabel.setAttribute('class', 'terminus-control-label');\r\n    inpLabel.setAttribute('for', 'basicinput');\r\n    inpLabel.innerHTML = 'Url/ ID:';\r\n    fd.appendChild(inpLabel);\r\n    var cd = document.createElement('div');\r\n    cd.setAttribute('class', 'terminus-controls');\r\n    fd.appendChild(cd);\r\n    var inpDocUrl = document.createElement('input');\r\n    inpDocUrl.setAttribute('type', 'text');\r\n    inpDocUrl.setAttribute('id', 'basicinput');\r\n    inpDocUrl.setAttribute('class', 'span8 terminus-input-text');\r\n    inpDocUrl.setAttribute('placeholder', 'Url or ID of document class');\r\n    cd.appendChild(inpDocUrl);\r\n    var fd = document.createElement('div');\r\n    fd.setAttribute('class', 'terminus-control-group');\r\n    form.appendChild(fd);\r\n    var optLabel = document.createElement('label');\r\n    optLabel.setAttribute('class', 'terminus-control-label');\r\n    optLabel.setAttribute('for', 'basicinput');\r\n    optLabel.innerHTML = 'Options:';\r\n    fd.appendChild(optLabel);\r\n    var cd = document.createElement('div');\r\n    cd.setAttribute('class', 'terminus-controls');\r\n    fd.appendChild(cd);\r\n    var optInp = document.createElement('input');\r\n    optInp.setAttribute('type', 'text');\r\n    optInp.setAttribute('id', 'basicinput');\r\n    optInp.setAttribute('class', 'span8 terminus-input-text');\r\n    optInp.setAttribute('placeholder', 'options');\r\n    cd.appendChild(optInp);\r\n    var button = document.createElement('button');\r\n    button.setAttribute('class', 'terminus-btn terminus-send-api-btn');\r\n    button.setAttribute('type', 'button');\r\n    button.innerHTML = 'Send Api';\r\n    var gatherips = function(){\r\n        var input = {};\r\n        input.url = inpUrl.value;\r\n        input.docUrl = inpDocUrl.value;\r\n        input.options = optInp.value;\r\n        return input;\r\n    }\r\n    var self = this;\r\n    button.addEventListener(\"click\", function(form){\r\n      var input = gatherips();\r\n      var buttonSelf = this;\r\n      opts = {};\r\n      opts.explorer = true;\r\n      self.client.getClassFrame(input.url, input.docUrl, opts)\r\n      .then(function(response){\r\n          var currForm = buttonSelf.parentNode;\r\n          var resultDom = UTILS.showHttpResult(response, 'getClassFrames', currForm, self.ui);\r\n      });\r\n    }) // button click\r\n    form.appendChild(button);\r\n    return form;\r\n}   */\r\n\r\n// get form for all Apis\r\nApiExplorer.prototype.getForm = function(curApi, body, view, action, urlPlaceholder){\r\n    // form\r\n    var formDoc = document.createElement('form');\r\n    formDoc.setAttribute('class', 'terminus-form-horizontal row-fluid');\r\n    var fd = document.createElement('div');\r\n    fd.setAttribute('class', 'terminus-control-group');\r\n    formDoc.appendChild(fd);\r\n    var urlLabel = document.createElement('label');\r\n    urlLabel.setAttribute('class', 'terminus-control-label');\r\n    urlLabel.setAttribute('for', 'basicinput');\r\n    urlLabel.innerHTML = 'Url:';\r\n    fd.appendChild(urlLabel);\r\n    var cd = document.createElement('div');\r\n    cd.setAttribute('class', 'terminus-controls');\r\n    fd.appendChild(cd);\r\n    var inpUrl = document.createElement('input');\r\n    inpUrl.setAttribute('type', 'text');\r\n    inpUrl.setAttribute('id', 'basicinput');\r\n    inpUrl.setAttribute('class', 'span8 terminus-input-text');\r\n    inpUrl.setAttribute('placeholder', urlPlaceholder);\r\n    cd.appendChild(inpUrl);\r\n    // add extra form fields based on current api chosen\r\n    switch(curApi){\r\n        case 'getClassFrames':\r\n            var fd = document.createElement('div');\r\n            fd.setAttribute('class', 'terminus-control-group');\r\n            formDoc.appendChild(fd);\r\n            var docUrlLabel = document.createElement('label');\r\n            docUrlLabel.setAttribute('class', 'terminus-control-label');\r\n            docUrlLabel.setAttribute('for', 'basicinput');\r\n            docUrlLabel.innerHTML = 'Url/ ID:';\r\n            fd.appendChild(docUrlLabel);\r\n            var cd = document.createElement('div');\r\n            cd.setAttribute('class', 'terminus-controls');\r\n            fd.appendChild(cd);\r\n            var inpDocUrl = document.createElement('input');\r\n            inpDocUrl.setAttribute('type', 'text');\r\n            inpDocUrl.setAttribute('id', 'basicinput');\r\n            inpDocUrl.setAttribute('class', 'span8 terminus-input-text');\r\n            inpDocUrl.setAttribute('placeholder', 'Url or ID of document class');\r\n            cd.appendChild(inpDocUrl);\r\n        break;\r\n        case 'schema':\r\n            //encoding\r\n            var fd = document.createElement('div');\r\n            fd.setAttribute('class', 'terminus-control-group');\r\n            formDoc.appendChild(fd);\r\n            var encLabel = document.createElement('label');\r\n            encLabel.setAttribute('class', 'terminus-control-label');\r\n            encLabel.setAttribute('for', 'basicinput');\r\n            encLabel.innerHTML = 'Encoding:';\r\n            fd.appendChild(encLabel);\r\n            var cd = document.createElement('div');\r\n            cd.setAttribute('class', 'terminus-controls');\r\n            fd.appendChild(cd);\r\n            var inpEnc = document.createElement('select');\r\n            inpEnc.setAttribute('style', 'height: 50px;width: 300px;padding: 10px;');\r\n            inpEnc.setAttribute('placeholder', 'turtle');\r\n            var optTurt = document.createElement('option');\r\n            optTurt.setAttribute('value', 'terminus:turtle');\r\n            optTurt.appendChild(document.createTextNode('turtle'));\r\n            inpEnc.appendChild(optTurt);\r\n            var optJld = document.createElement('option');\r\n            optJld.setAttribute('value', 'terminus:jsonld');\r\n            optJld.appendChild(document.createTextNode('jsonLD'));\r\n            inpEnc.appendChild(optJld);\r\n            cd.appendChild(inpEnc);\r\n        break;\r\n    }\r\n    var fd = document.createElement('div');\r\n    fd.setAttribute('class', 'terminus-control-group');\r\n    formDoc.appendChild(fd);\r\n    var keyLabel = document.createElement('label');\r\n    keyLabel.setAttribute('class', 'terminus-control-label');\r\n    keyLabel.setAttribute('for', 'basicinput');\r\n    keyLabel.innerHTML = 'Key:';\r\n    fd.appendChild(keyLabel);\r\n    var cd = document.createElement('div');\r\n    cd.setAttribute('class', 'terminus-controls');\r\n    fd.appendChild(cd);\r\n    var inpKey = document.createElement('input');\r\n    inpKey.setAttribute('type', 'text');\r\n    inpKey.setAttribute('id', 'basicinput');\r\n    inpKey.setAttribute('class', 'span8 terminus-input-text');\r\n    inpKey.setAttribute('placeholder', 'Key');\r\n    cd.appendChild(inpKey);\r\n    if(!view){\r\n        // include text area only if call is type post\r\n        var fd = document.createElement('div');\r\n        fd.setAttribute('class', 'terminus-control-group');\r\n        formDoc.appendChild(fd);\r\n        var docLabel = document.createElement('label');\r\n        docLabel.setAttribute('class', 'terminus-control-label');\r\n        docLabel.setAttribute('for', 'basicinput');\r\n        if(curApi == 'query') docLabel.innerHTML = 'Query:';\r\n        docLabel.innerHTML = 'Document:';\r\n        fd.appendChild(docLabel);\r\n        var cd = document.createElement('div');\r\n        cd.setAttribute('class', 'terminus-controls');\r\n        fd.appendChild(cd);\r\n        var inpDoc = document.createElement('textarea');\r\n        cd.appendChild(inpDoc);\r\n        inpDoc.setAttribute('class', 'terminus-api-explorer-text-area');\r\n        UTILS.stylizeEditor(this.ui, inpDoc, 'document', 'javascript');\r\n    }\r\n    body.appendChild(formDoc);\r\n    // gather inputs\r\n    var inp ={};\r\n    inp.url = inpUrl;\r\n    inp.key = inpKey;\r\n    if(curApi == 'getClassFrames') inp.docUrl = inpDocUrl;\r\n    if(curApi == 'schema') inp.enc = inpEnc;\r\n    if(!view) inp.doc = inpDoc;\r\n    var form = this.getApiSendButton(action, inp);\r\n    body.appendChild(form);\r\n}\r\n\r\n// define event listeners on send api of schema & documents\r\n\r\nApiExplorer.prototype.getApiForm = function(action, input){\r\n  // form\r\n  var form = document.createElement('form');\r\n  form.setAttribute('class', 'terminus-form-horizontal row-fluid');\r\n\r\n  var button = document.createElement('button');\r\n  button.setAttribute('class', 'terminus-btn terminus-send-api-btn');\r\n  button.setAttribute('type', 'button');\r\n  button.innerHTML = 'Send Api';\r\n  form.appendChild(button);\r\n  var resd = document.createElement('div');\r\n  form.appendChild(resd);\r\n  var self = this;\r\n  switch(action){\r\n    case 'getSchema':\r\n      button.addEventListener(\"click\", function(){\r\n        var opts = {};\r\n        opts['terminus:encoding'] = input.enc.value;\r\n        opts['terminus:user_key'] = input.key.value;\r\n        var schurl = input.url.value;\r\n        var buttonSelf = this;\r\n        self.client.getSchema(schurl, opts)\r\n        .then(function(response){\r\n          TerminusClient.FrameHelper.removeChildren(resd);\r\n          var resultDom = UTILS.showHttpResult(response, 'getSchema', resd, self.ui);\r\n        });\r\n      }) // button click\r\n    break;\r\n    case 'updateSchema':\r\n      button.addEventListener(\"click\", function(){\r\n        var buttonSelf = this;\r\n        opts = {};\r\n        opts['terminus:encoding'] = input.enc.value;\r\n        opts['terminus:user_key'] = input.key.value;\r\n        var schurl = input.url.value;\r\n        self.client.connectionConfig.connected_mode = false;\r\n        self.client.updateSchema(schurl, input.doc.value, opts)\r\n        .then(function(response){\r\n          var gtxtar = document.createElement('textarea');\r\n          gtxtar.setAttribute('readonly', true);\r\n          gtxtar.innerHTML = response;\r\n          var currForm = buttonSelf.parentNode;\r\n          currForm.appendChild(gtxtar);\r\n          UTILS.stylizeEditor(this.ui, txtar, 'schema', 'turtle');\r\n        });\r\n      }) // button click\r\n    break;\r\n    case 'viewDocument':\r\n      button.addEventListener(\"click\", function(){\r\n      var dcurl = input.value;\r\n      var buttonSelf = this;\r\n      var opts = {};\r\n      opts.format = 'turtle';\r\n      self.client.getDocument(dcurl, opts)\r\n      .then(function(response){\r\n        TerminusClient.FrameHelper.removeChildren(resd);\r\n        var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n      });\r\n    }) // button click\r\n    break;\r\n    case 'deleteDocument':\r\n      button.addEventListener(\"click\", function(){\r\n      var dcurl = input.value;\r\n      var buttonSelf = this;\r\n      var opts = {};\r\n      self.client.deleteDocument(dcurl, opts)\r\n      .then(function(response){\r\n        TerminusClient.FrameHelper.removeChildren(resd);\r\n        var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n      });\r\n    }) // button click\r\n    break;\r\n    case 'createDocument':\r\n      button.addEventListener(\"click\", function(){\r\n        var dcurl = input.schemaUrlDom.value;\r\n        var payload = input.htmlEditor.getValue();\r\n        var buttonSelf = this;\r\n        opts = {};\r\n        self.client.createDocument(dcurl, payload, opts)\r\n        .then(function(response){\r\n          TerminusClient.FrameHelper.removeChildren(resd);\r\n          var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n        });\r\n      }) // button click\r\n    break;\r\n    case 'updateDocument':\r\n      button.addEventListener(\"click\", function(){\r\n        var dcurl = input.schemaUrlDom.value;\r\n        var payload = input.htmlEditor.getValue();\r\n        var buttonSelf = this;\r\n        opts = {};\r\n        opts.editmode = 'replace';\r\n        opts.format = 'json';\r\n        self.client.updateDocument(dcurl, payload, opts)\r\n        .then(function(response){\r\n          TerminusClient.FrameHelper.removeChildren(resd);\r\n          var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n        });\r\n      }) // button click\r\n    break;\r\n  } // switch(action)\r\n\r\n  var br = document.createElement('BR');\r\n  form.appendChild(br);\r\n  var br = document.createElement('BR');\r\n  form.appendChild(br);\r\n\r\n  return form;\r\n} // getApiForm()\r\n// define event listeners on send api of schema & documents\r\nApiExplorer.prototype.getApiSendButton = function(action, input){\r\n    // form\r\n    var form = document.createElement('form');\r\n    form.setAttribute('class', 'terminus-form-horizontal row-fluid');\r\n    var button = document.createElement('button');\r\n    button.setAttribute('class', 'terminus-btn terminus-send-api-btn');\r\n    button.setAttribute('type', 'button');\r\n    button.innerHTML = 'Send Api';\r\n    form.appendChild(button);\r\n    var resd = document.createElement('div');\r\n    form.appendChild(resd);\r\n    var self = this;\r\n    switch(action){\r\n        case 'connect':\r\n            button.addEventListener(\"click\", function(){\r\n                self.client.connect(input.url.value, input.key.value)\r\n                .then(function(response){\r\n                \tTerminusClient.FrameHelper.removeChildren(resd);\r\n                    var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n               });\r\n            }) // button click\r\n        break;\r\n        case 'create':\r\n            button.addEventListener(\"click\", function(form){\r\n               console.log('typeof() create', typeof(input.doc.value));\r\n               console.log('input.doc.value', input.doc.value);\r\n              self.client.createDatabase(input.url.value, JSON.parse(input.doc.value), input.key.value)\r\n              .then(function(response){\r\n            \t  TerminusClient.FrameHelper.removeChildren(resd);\r\n                var resultDom = UTILS.showHttpResult(response, action, currForm, self.ui);\r\n              });\r\n            }) // button click\r\n        break;\r\n        case 'delete':\r\n            button.addEventListener(\"click\", function(){\r\n              opts = {};\r\n              opts.key = input.key.value;\r\n              self.client.deleteDatabase(input.url.value, opts)\r\n              .then(function(response){\r\n            \t  TerminusClient.FrameHelper.removeChildren(resd);\r\n                  var resultDom = UTILS.showHttpResult(response, action, currForm, self.ui);\r\n              });\r\n            }) // button click\r\n        break\r\n        case 'getSchema':\r\n            button.addEventListener(\"click\", function(){\r\n                var opts = {};\r\n                opts['terminus:encoding'] = input.enc.value;\r\n                opts['terminus:user_key'] = input.key.value;\r\n                var schurl = input.url.value;\r\n                self.client.getSchema(schurl, opts)\r\n                .then(function(response){\r\n                \tTerminusClient.FrameHelper.removeChildren(resd);\r\n                    var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n                });\r\n            }) // button click\r\n        break;\r\n        case 'updateSchema':\r\n            button.addEventListener(\"click\", function(){\r\n                opts = {};\r\n                opts['terminus:encoding'] = input.enc.value;\r\n                opts['terminus:user_key'] = input.key.value;\r\n                var payload = input.doc.value;\r\n                var schurl = input.url.value;\r\n                self.client.connectionConfig.connected_mode = false;\r\n                self.client.updateSchema(schurl, JSON.parse(input.doc.value), opts)\r\n                //self.client.updateSchema(schurl, input.doc.value, opts)\r\n                .then(function(response){\r\n                \tTerminusClient.FrameHelper.removeChildren(resd);\r\n                    var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n                });\r\n            }) // button click\r\n        break;\r\n        case 'getClassFrames':\r\n            button.addEventListener(\"click\", function(form){\r\n                var schurl = input.url.value;\r\n                opts = {};\r\n                opts.explorer = true;\r\n                self.client.getClassFrame(input.url, JSON.parse(input.docUrl.value), opts)\r\n                .then(function(response){\r\n                    var currForm = buttonSelf.parentNode;\r\n                    var resultDom = UTILS.showHttpResult(response, action, currForm, self.ui);\r\n                });\r\n            }) // button click\r\n        break;\r\n        case 'viewDocument':\r\n          button.addEventListener(\"click\", function(){\r\n              var dcurl = input.url.value;\r\n              var opts = {};\r\n              opts.key = input.key.value\r\n              self.client.getDocument(dcurl, opts)\r\n              .then(function(response){\r\n            \t    TerminusClient.FrameHelper.removeChildren(resd);\r\n                    var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n              });\r\n        }) // button click\r\n        break;\r\n        case 'deleteDocument':\r\n          button.addEventListener(\"click\", function(){\r\n              var dcurl = input.value;\r\n              var buttonSelf = this;\r\n              var opts = {};\r\n              self.client.deleteDocument(dcurl, opts)\r\n              .then(function(response){\r\n            \t  TerminusClient.FrameHelper.removeChildren(resd);\r\n                  var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n              });\r\n          }) // button click\r\n        break;\r\n        case 'createDocument':\r\n          button.addEventListener(\"click\", function(){\r\n              var dcurl = input.url.value;\r\n              var payload = input.doc.value;\r\n              opts = {};\r\n              opts.key = input.key.value;\r\n              self.client.createDocument(dcurl, JSON.parse(payload), opts)\r\n              .then(function(response){\r\n            \t   TerminusClient.FrameHelper.removeChildren(resd);\r\n                   var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n               });\r\n          }) // button click\r\n        break;\r\n        case 'updateDocument':\r\n          button.addEventListener(\"click\", function(){\r\n            var dcurl = input.url.value;\r\n            var payload = input.doc.value;\r\n            var buttonSelf = this;\r\n            opts = {};\r\n            opts.editmode = 'replace';\r\n            opts.format = 'json';\r\n            opts.key = input.key.value;\r\n            self.client.updateDocument(dcurl, JSON.parse(payload), opts)\r\n            .then(function(response){\r\n            \tTerminusClient.FrameHelper.removeChildren(resd);\r\n                var resultDom = UTILS.showHttpResult(response, action, resd, self.ui);\r\n            });\r\n          }) // button click\r\n        break;\r\n        case 'select':\r\n            button.addEventListener(\"click\", function(){\r\n                var opts = {};\r\n                opts.key = input.key.value;\r\n                self.client.select(input.url.value, JSON.parse(input.doc.value), opts)\r\n                .then(function(response){\r\n                \tTerminusClient.FrameHelper.removeChildren(resd);\r\n                    var resultDom = UTILS.showHttpResult(response, action, currForm, self.ui);\r\n                });\r\n            }) // button click\r\n        break;\r\n        case 'update':\r\n            button.addEventListener(\"click\", function(){\r\n              var opts = {};\r\n              opts.key = input.key.value;\r\n              self.client.update(input.url.value, JSON.parse(input.doc.value), opts)\r\n              .then(function(response){\r\n            \t  TerminusClient.FrameHelper.removeChildren(resd);\r\n                  var resultDom = UTILS.showHttpResult(response, action, currForm, self.ui);\r\n              });\r\n            }) // button click\r\n        break;\r\n        default:\r\n            console.log('Invalid Api call on button');\r\n        break;\r\n    } // switch(action)\r\n    var br = document.createElement('BR');\r\n    form.appendChild(br);\r\n    var br = document.createElement('BR');\r\n    form.appendChild(br);\r\n    return form;\r\n} // getApiSendButton()\r\n\r\n// get signature of api calls\r\nApiExplorer.prototype.getSignature = function(action){\r\n    var api = document.createElement('div');\r\n    // get header signature\r\n    var sg = document.createElement('button');\r\n    sg.appendChild(document.createTextNode('Click to read Api Signature'));\r\n    sg.setAttribute('class', 'terminus-collapsible');\r\n    ic = document.createElement('i');\r\n    ic.setAttribute('class', 'terminus-cheveron-float fa fa-chevron-down');\r\n    sg.appendChild(ic);\r\n    api.appendChild(sg);\r\n    var br = document.createElement('BR');\r\n    api.appendChild(br);\r\n    var cl = document.createElement('div');\r\n    cl.setAttribute('class', 'terminus-collapsible-content content');\r\n    var sig = UTILS.getFunctionSignature(action);\r\n    var txt = document.createTextNode(sig.spec);\r\n    var pre = document.createElement('pre');\r\n    pre.setAttribute('class', 'terminus-api-signature-pre');\r\n    pre.appendChild(txt);\r\n    var txt =  document.createTextNode(sig.descr);\r\n    pre.appendChild(txt);\r\n    var br = document.createElement('BR');\r\n    pre.appendChild(br);\r\n    var br = document.createElement('BR');\r\n    pre.appendChild(br);\r\n    var txt = document.createTextNode(sig.result);\r\n    pre.appendChild(txt);\r\n    cl.appendChild(pre);\r\n    api.appendChild(cl);\r\n    var br = document.createElement('BR');\r\n    api.appendChild(br);\r\n    sg.addEventListener('click', function(){\r\n        UTILS.tolggleContent(ic, cl);\r\n    });\r\n    return api;\r\n} // getSignature()\r\n\r\n// displays signature only on click\r\nfunction tolggleSignatureContent(content){\r\n    if (content.style.display === \"block\")\r\n        content.style.display = \"none\";\r\n    else content.style.display = \"block\";\r\n}\r\n\r\nmodule.exports=ApiExplorer\r\n","function Codemirror(text, format, config){\r\n  this.textdom = text;\r\n  this.mode = format;\r\n  this.darkMode = config.darkMode;\r\n  if(this.jsonldCheck(format)) this.mode = 'javascript';\r\n}\r\n\r\n/*\r\ntxtar    : editor is attached to textar\r\nmode     : format for highlighting, ex: json, html etc.\r\neditable : readOnly false/ nocursor is special value in code editor to set readonly true */\r\nCodemirror.prototype.colorizeTextArea = function(mode){\r\n  //initize auto complete\r\n  /*CodeMirror.commands.autocomplete = function(cm) {\r\n    cm.showHint({hint: CodeMirror.hint.anyword});\r\n  }*/\r\n\r\n  // initialise code editor on text area\r\n  var editor = CodeMirror.fromTextArea(this.textdom, {\r\n    mode                : this.mode,\r\n    firstLineNumber     : 1,\r\n    lineNumbers         : true,\r\n    styleActiveLine     : true,\r\n    lineWrapping        : true,\r\n    smartIndent         : true,\r\n    indentWithTabs      : true,\r\n    newlineAndIndent    : true,\r\n    autoCloseBrackets   : true,\r\n    matchBrackets       : {afterCursor: true},\r\n    extraKeys           : {\"Ctrl-F\": \"find\", \"Tab\": \"autocomplete\" },\r\n    refresh             : true\r\n   });\r\n\r\n   this.setCodemirrorSize(editor, mode);\r\n   editor.defaultCharWidth('20px');\r\n   if(this.darkMode) editor.setOption(\"theme\", 'erlang-dark');\r\n   else editor.setOption(\"theme\", 'neo');\r\n\r\n   return editor;\r\n} // colorizeTextArea()\r\n\r\n/*\r\n  set editor size according to screens\r\n  editor : code mirror editor Object\r\n  mode   : editor being viewed from schema/ doc/ query page*/\r\nCodemirror.prototype.setCodemirrorSize = function(editor, mode){\r\n  switch(mode){\r\n    case 'query':\r\n      editor.setSize('800', '300');\r\n    break;\r\n    case 'schema':\r\n      editor.setSize('1200', '1550');\r\n    break;\r\n    case 'document':\r\n     editor.setSize('765', 'auto');\r\n    break;\r\n    case 'api-doc':\r\n        editor.setSize('800', 'auto');\r\n    break;\r\n  } // switch(mode)\r\n} // setCodemirrorSize()\r\n\r\n// updateTextArea(): highlights new changes on editor\r\nCodemirror.prototype.updateTextArea = function(editor){\r\n  editor.save();\r\n  setTimeout(function() {\r\n      editor.refresh();\r\n  },1);\r\n  // save changes of code mirror editor\r\n  editor.on('change', function(){\r\n    editor.save();\r\n  });\r\n} //updateTextArea()\r\n\r\n/*\r\ncolorizePre() to colorise pre tags (read only mode)\r\ntext (string)    : The document to run through the highlighter.\r\nmode (mode spec) : format to highlight color\r\noutput (DOM node): The tokens will be converted to spans as in an editor,\r\n                   and inserted into the node (through innerHTML).*/\r\nCodemirror.prototype.colorizePre = function(){\r\n  CodeMirror.runMode(this.textdom.innerText, this.mode, this.textdom);\r\n  if(this.darkMode)\r\n      var theme = 'cm-s-erlang-dark';\r\n  else var theme = 'cm-s-neo';\r\n  this.textdom.setAttribute('class', 'CodeMirror CodeMirror-wrap ' + theme + ' terminus-wrap-text terminus-wrapper-height ');\r\n  return this.textdom;\r\n} // colorizePre()\r\n\r\nCodemirror.prototype.jsonldCheck = function(format){\r\n  if(format == 'jsonld') return true;\r\n}\r\n\r\nmodule.exports=Codemirror\r\n","/**\r\n * object renderer binds to object frame - provides filters, sorts and manipulations of underlying object frame\r\n * and coordinates viewer to draw updates\r\n\r\n * Object Renderer - provides sorting / filtering / state management of objects\r\n * @param obj ObjectFrame object - contains underlying data and frame structure\r\n * @param parent PropertyRenderer - property that owns this object (if any)\r\n * @param options options json\r\n * @returns\r\n */\r\n\r\nconst RenderingMap = require('./RenderingMap');\r\nconst ValueRenderer = require('./ValueRenderer');\r\nconst ObjectViewer = require('./ObjectViewer');\r\nconst PropertyViewer = require('./PropertyViewer');\r\nconst HTMLDataViewer = require('./DataViewer');\r\n\r\nfunction PropertyRenderer(prop, parent, options){\r\n\tthis.predicate = prop;\r\n\tthis.parent = parent;\r\n\tthis.cframe = this.parent.objframe.getPropertyClassFrame(this.predicate);\r\n\tthis.originalValues = false;\r\n\tthis.changed = false;\r\n\tthis.values = [];\r\n\tthis.renderer_type = \"property\";\r\n\tthis.options = this.setOptions(options);\r\n}\r\n\r\nPropertyRenderer.prototype.setOptions = function(options){\r\n\treturn TerminusDashboard.RenderingMap.decorateRenderer(options, this);\r\n}\r\n\r\nPropertyRenderer.prototype.getOptionsForChild = function(){\r\n\tvar opts = {};\r\n\tif(this.options.features){ opts.features = this.options.features };\r\n\tif(this.options.controls){ opts.controls = this.options.controls};\r\n\treturn this.options;\r\n}\r\n\r\nPropertyRenderer.prototype.getOptionsForValue = function(df, index){\r\n\treturn this.getOptionsForChild();\r\n}\r\n\r\nPropertyRenderer.prototype.getOptionsForObject = function(objframe){\r\n\treturn this.getOptionsForChild();\r\n}\r\n\r\n\r\nPropertyRenderer.prototype.render = function(viewer, x){\r\n \tthis.buildValueRenderers();\r\n \tif(this.cframe && this.cframe.property){\r\n \t\tthis.viewer = (viewer ? viewer : this.getViewerForProperty());\r\n \t\tfor(var i = 0; i<this.values.length; i++){\r\n \t\t\tvar renderedval = this.values[i].render();\r\n \t\t\tif(renderedval && this.showFeature(\"body\")) this.viewer.addRenderedValue(renderedval);\r\n \t\t}\r\n \t\treturn this.viewer.render(x);\r\n \t}\r\n} \r\n\r\n/*\r\n * Creates the array of object renderer or value renderer objects corresponding to the property values. \r\n */\r\nPropertyRenderer.prototype.buildValueRenderers = function(){\r\n \tvar adorig = (this.originalValues === false ? true : false);\r\n \tthis.cframe = this.parent.objframe.getPropertyClassFrame(this.predicate);\r\n \tif(!this.cframe){\r\n \t\tconsole.error(\"No frame for \" + this.property() + \" id: \" + this.subject());\r\n \t\treturn false;\r\n \t}\r\n \tif(this.cframe && this.cframe.isData()){\r\n \t\tvar dataframes = this.getDataFramesToRender();\r\n \t\tif(dataframes.length == 0){\r\n \t\t\talert(this.predicate);\r\n \t\t}\r\n \t\tvar vals = [];\r\n \t\tfor(var i = this.values.length; i<dataframes.length; i++){\r\n \t\t\tvar vr = new ValueRenderer(dataframes[i], i, this, this.getOptionsForValue(dataframes[i], i));\r\n \t\t\tthis.values.push(vr);\r\n \t\t\tvals.push(vr.value());\r\n \t\t}\r\n \t\tif(adorig) this.originalValues = vals;\r\n \t}\r\n \telse {\r\n \t\tif(adorig) this.originalValues = [];\r\n \t\tvar kids = this.getChildrenToRender();\r\n \t\tif(kids && kids.length){\r\n \t\t\tfor(var i = this.values.length; i<kids.length; i++){\r\n \t\t\t\tvar kidf = new ObjectRenderer(kids[i], this, this.getOptionsForObject(kids[i]));\r\n \t\t\t\tif(adorig) this.originalValues.push(kidf.subject());\r\n \t\t\t\tthis.values.push(kidf);\r\n \t\t\t}\r\n \t\t}\r\n \t}\r\n}\r\n\r\n/*\r\n * Returns the array of values that should be rendered (enables value filtering)\r\n */\r\nPropertyRenderer.prototype.getDataFramesToRender = function(options){\r\n \tvar allvals = this.parent.objframe.getDataFrames(this.property());\r\n \treturn allvals;\r\n}\r\n\r\n/*\r\n * Returns the array of child / objects that should be rendered (enables value filtering)\r\n */\r\nPropertyRenderer.prototype.getChildrenToRender = function(options){\r\n \tif(TerminusClient.FrameHelper.viewIncludesChildren(this.view, \"property\")){\r\n \t\tvar allkids = this.parent.objframe.getChildren(this.property());\r\n \t}\r\n \telse {\r\n \t\tvar allkids = [];\r\n \t}\r\n \treturn allkids;\r\n}\r\n\r\nPropertyRenderer.prototype.redraw = function(){\r\n \tthis.viewer.clear();\r\n \tthis.render(this.viewer, \"x\");\r\n \t//alert(this.values.length);\r\n}\r\n\r\nPropertyRenderer.prototype.extract = function(){\r\n \tvar extracts = [];\r\n \tfor(var i = 0; i<this.values.length; i++){\r\n \t\tvar val = this.values[i].extract();\r\n \t\tif(val !== \"\" && val !== false && typeof val != \"undefined\") extracts.push(val);\r\n \t}\r\n \tif(this.cframe.isData()){\r\n \t\treturn extracts;\r\n \t}\r\n \telse {\r\n \t\treturn extracts;\r\n \t\tvar extr = {};\r\n \t\tfor(var i = 0; i<extracts.length; i++){\r\n \t\t\tfor(var subjid in extracts[i]){\r\n \t\t\t\textr[subjid] = extracts[i][subjid];\r\n \t\t\t}\r\n \t\t}\r\n \t\treturn extr;\r\n \t}\r\n}\r\n\r\n/*\r\n * simple wrapper functions\r\n */\r\nPropertyRenderer.prototype.currentViewer = function(){return this.viewerType;}\r\nPropertyRenderer.prototype.property = function(){return this.predicate;}\r\nPropertyRenderer.prototype.subject = function(){return (this.parent ? this.parent.subject() : false);};\r\nPropertyRenderer.prototype.depth = function(){return (this.parent ? this.parent.depth() : false);};\r\nPropertyRenderer.prototype.subjectClass = function(){return (this.parent ? this.parent.subjectClass() : false);};\r\nPropertyRenderer.prototype.updated = function(){ return (this.parent ? this.parent.childUpdated() : false);};\r\nPropertyRenderer.prototype.range = function(){\treturn (this.cframe ? this.cframe.range : \"\");};\r\nPropertyRenderer.prototype.getLabel = function(){ return (this.cframe ? this.cframe.getLabel() : \"\" );};\r\nPropertyRenderer.prototype.getComment = function(){ return (this.cframe ? this.cframe.getComment() : false);}\r\nPropertyRenderer.prototype.load = function(link){ return (this.parent ? this.parent.load(link) : false);}\r\nPropertyRenderer.prototype.hasCardinalityRestriction = function(){return (this.cframe ? this.cframe.hasRestriction() : false);};\r\nPropertyRenderer.prototype.getRestriction = function(){return (this.cframe ? this.cframe.restriction : false);};\r\nPropertyRenderer.prototype.isClassChoice = function(){\treturn (this.cframe ? this.cframe.isClassChoice() : false);};\r\nPropertyRenderer.prototype.currentFacet = function(){\treturn this.facet;} ;\r\nPropertyRenderer.prototype.save = function(){ return (this.parent ? this.parent.save() : false);};\r\n\r\nPropertyRenderer.prototype.cancel = function(){\r\n\tthis.reset();\r\n\tthis.setMode(\"view\");\r\n}\r\n\r\nPropertyRenderer.prototype.getAvailableClassChoices = function(){ \r\n\tif(this.cframe){\r\n\t\tvar cf = this.cframe.getClassChoices();\r\n\t\tif(this.parent){\r\n\t\t\tvar choices = [];\r\n\t\t\tfor(var i = 0; i < cf.length; i++){\r\n\t\t\t\tvar clsmeta = this.parent.getClassMeta(cf[i]);\r\n\t\t\t\tvar lab = ((clsmeta && clsmeta.Label && clsmeta.Label[\"@value\"]) ? clsmeta.Label[\"@value\"] : TerminusClient.FrameHelper.labelFromURL(cf[i]));\r\n\t\t\t\tchoices.push({value: cf[i], label: lab});\r\n\t\t\t}\r\n\t\t\treturn choices;\r\n\t\t}\r\n\t\treturn cf;\r\n\t\t\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n\r\nPropertyRenderer.prototype.delete = function(){\r\n\tvar prop = this.predicate;\r\n\tif(prop){\r\n\t\tthis.reset();\r\n\t\tthis.parent.deleteProperty(prop);\t\r\n\t\tthis.parent.redraw();\r\n\t}\r\n}\r\n\r\nPropertyRenderer.prototype.add = function(view){\r\n\tthis.parent.addProperty(this.property(), view);\r\n\tthis.updated();\r\n\tif(view) {\r\n\t\tthis.values[this.values.length-1].setMode(view);\r\n\t\tthis.values[this.values.length-1].setNew();\r\n\t}\r\n\tthis.redraw();\r\n}\r\n\r\nPropertyRenderer.prototype.goToValue = function(index){\r\n\tthis.viewer.goTo(this.subject(), this.property(), index);\r\n}\r\n\r\nPropertyRenderer.prototype.addClass = function(cls){\r\n\tthis.parent.addPropertyClass(this.property(), cls);\r\n\tthis.updated();\r\n\tvar newb = this.values[this.values.length-1];\r\n\tif(newb){\r\n\t\tnewb.setNew();\r\n\t\tnewb.setMode(\"edit\");\r\n\t}\r\n\tthis.redraw();\r\n\tif(newb) this.viewer.goTo(newb.subject());\r\n}\r\n\r\nPropertyRenderer.prototype.reset = function(){\r\n\tthis.parent.objframe.reset(this.predicate);\r\n\tif(this.cframe && this.cframe.isData()){\r\n\t\tfor(var i = 0; i<this.values.length; i++){\r\n\t\t\tthis.values[i].reset();\r\n\t\t}\r\n\t\tthis.values = [];\r\n\t}\r\n\telse {\r\n\t\tvar nvals = [];\r\n\t\tfor(var i = 0; i<this.originalValues.length; i++){\r\n\t\t\tfor(var j = 0; j<this.values.length; j++){\r\n\t\t\t\tthis.values[j].reset();\r\n\t\t\t\tif(this.values[j].subject() == this.originalValues[i]){\r\n\t\t\t\t\tnvals.push(this.values[j]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.values = nvals;\r\n\t}\r\n\tthis.redraw();\t\r\n\tthis.parent.childUpdated();\r\n}\r\n\r\nPropertyRenderer.prototype.deletePropertyValue = function(value, index){\r\n\tthis.parent.objframe.removePropertyValue(this.property(), value, index);\r\n\tvar nvals = [];\r\n\tfor(var i = 0; i<this.values.length; i++){\r\n\t\tif(typeof index == \"undefined\"){\r\n\t\t\tif(this.values[i].subject() == value){\r\n\t\t\t\tthis.values[i].reset();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnvals.push(this.values[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(i != index){\r\n\t\t\tthis.values[i].index = nvals.length;\r\n\t\t\tnvals.push(this.values[i]);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.values[i].reset();\r\n\t\t}\r\n\t}\r\n\tthis.values = nvals;\r\n\tthis.parent.childUpdated();\r\n\tthis.parent.redraw();\r\n}\r\n\r\nPropertyRenderer.prototype.addPropertyValue = function(value){\r\n\tthis.updated();\r\n\treturn this.parent.objframe.addPropertyValue(this.property(), value);\r\n}\r\n\r\n/*\r\n * Checks to see if an action (add, clone, delete) which affects the cardinality of the property is allowed by cardinality rules.\r\n */\r\nPropertyRenderer.prototype.cardControlAllows = function(action){\r\n\tif(this.cframe.hasRestriction()){\r\n\t\tvar rest = this.cframe.restriction;\r\n\t\tvar currentnum = this.values.length;\r\n\t\tif(action == \"add\" || action == \"clone\"){\r\n\t\t\tif(rest.max && currentnum >= rest.max){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(action == \"delete\" && (rest.min)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nPropertyRenderer.prototype.isNew = function(){\r\n\tif(this.new_property){\r\n\t\treturn true;\r\n\t}\r\n\treturn this.parent.isNew();\r\n}\r\n\r\nPropertyRenderer.prototype.setNew = function(){\r\n\tthis.new_property = true;\r\n}\r\n\r\n\r\nPropertyRenderer.prototype.isUpdated = function(){\r\n\tif(this.values.length != this.originalValues.length) return true;\r\n\tfor(var i = 0 ; i < this.values.length; i++){\r\n\t\tif(this.cframe && this.cframe.isData()){\r\n\t\t\tif(this.values[i].value() != this.originalValues[i]){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(this.values[i].subject() != this.originalValues[i]) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif(this.values[i].isUpdated()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nPropertyRenderer.prototype.childUpdated = function(){\r\n\tthis.viewer.redrawHeader();\r\n\tif(this.parent) this.parent.childUpdated();\r\n}\r\n\r\n\r\n/**\r\n * Sets mode of viewer to either \"view\" or \"edit\"\r\n */\r\nPropertyRenderer.prototype.setMode = function(mode){\r\n\tthis.mode = mode;\r\n\tfor(var i = 0; i<this.values.length; i++){\r\n\t\tthis.values[i].setMode(mode);\r\n\t}\r\n\tthis.redraw();\r\n}\r\n\r\n/*\r\n * Jump to property value\r\n */\r\nPropertyRenderer.prototype.getViewableValues = function(){\r\n\tvar viewables = [];\r\n\tif(this.cframe && this.cframe.isData())\r\n\tfor(var i = 0; i<this.values.length; i++){\r\n\t\tvar sum = this.values[i].getSummary();\r\n\t\tvar lab = sum.long;\r\n\t\tviewables.push({label: lab, value: i});\r\n\t}\r\n\treturn viewables;\r\n}\r\n\r\nPropertyRenderer.prototype.hideDisabledControls = function(){\r\n\treturn this.hide_disabled_controls;\r\n}\r\n\r\nPropertyRenderer.prototype.setFacet = function(facet, nocascade){\r\n\tthis.facet = facet;\r\n\tif(!nocascade){\r\n\t\tfor(var i = 0; i<this.values.length; i++){\r\n\t\t\tthis.values[i].parentFacetChange(facet);\r\n\t\t}\r\n\t}\r\n\tthis.redraw();\r\n}\r\n\r\nPropertyRenderer.prototype.parentFacetChange = function(facet){\r\n\tif(facet == 'page'){\r\n\t\tif(!(this.facet == \"page\" || this.facet == \"multiline\")){\r\n\t\t\tthis.setFacet('multiline');\r\n\t\t}\r\n\t}\r\n\tif(facet == 'line'){\r\n\t\tthis.setFacet(\"label\");\r\n\t}\r\n\t\t\r\n}\r\n\r\n\r\n\r\nPropertyRenderer.prototype.getDefaultFacets = function(){\r\n\tvar defs = {\r\n\t\tpage: {\r\n\t\t\tlabel: \"Full Page\", value: \"page\", \r\n\t\t\tfeatures: [\"facet\", \"label\", \"comment\", \"id\", \"control\", \"type\", \"cardinality\", \"body\", \"status\", \"facet\", \"view\", \"viewer\"], \r\n\t\t\tcontrols: [\"delete\", \"clone\", \"add\", \"reset\", \"cancel\", \"update\", \"mode\", \"show\", \"hide\"]\r\n\t\t},\r\n\t\tmultiline: {\r\n\t\t\tlabel: \"Multiple Lines\", value: \"multiline\",\r\n\t\t\tfeatures: [\"facet\", \"label\", \"comment\", \"id\", \"control\", \"type\", \"cardinality\", \"body\", \"status\", \"facet\", \"view\", \"viewer\"], \r\n\t\t\tcontrols: [\"delete\", \"clone\", \"add\", \"reset\", \"cancel\", \"update\", \"mode\", \"show\", \"hide\"]\r\n\t\t},\r\n\t\tline: {\r\n\t\t\tlabel: \"Single Line\", value: \"line\",\r\n\t\t\tfeatures: [\"facet\", \"label\", \"comment\", \"id\", \"control\", \"type\", \"cardinality\", \"body\", \"status\", \"facet\", \"viewer\"], \r\n\t\t\tcontrols: [\"delete\", \"clone\", \"add\", \"reset\", \"cancel\", \"update\", \"mode\", \"show\", \"hide\"]\r\n\t\t},\r\n\t\tsummary: {\r\n\t\t\tlabel: \"Summary\", value: \"summary\",\r\n\t\t\tfeatures: [\"facet\", \"satus\", \"label\", \"type\", \"cardinality\", \"body\", \"status\", \"facet\", \"viewer\"], \r\n\t\t\tcontrols: [] \r\n\t\t},\r\n\t\tlabel: {\r\n\t\t\tlabel: \"Label\", value: \"label\",\r\n\t\t\tfeatures: [\"facet\", \"status\", \"label\", \"summary\"],\r\n\t\t\tcontrols: []\r\n\t\t},\r\n\t\ticon: {\r\n\t\t\tlabel: \"Snippet\", value: \"icon\",\r\n\t\t\tfeatures: [\"facet\", \"summary\"],\r\n\t\t\tcontrols: []\r\n\t\t}\r\n\t}\r\n\treturn defs;\t\r\n}\r\n\r\nPropertyRenderer.prototype.getAvailableFacets = function(){\r\n\treturn Object.values(this.facets);\r\n\tvar facets = [];\r\n\tfacets.push({label: \"Full Page\", value: \"page\"});\r\n\tfacets.push({label: \"Multiple Lines\", value: \"multiline\"});\r\n\tfacets.push({label: \"Single Line\", value: \"line\"});\r\n\tfacets.push({label: \"Summary\", value: \"summary\"});\r\n\tfacets.push({label: \"Label\", value: \"label\"});\r\n\tfacets.push({label: \"Snippet\", value: \"icon\"});\r\n\treturn facets;\r\n}\r\n\r\nPropertyRenderer.prototype.getContentOrientation = function(facet){\r\n\tif(this.currentFacet() == \"page\" || this.containsPage()){\r\n\t\treturn \"page\";\r\n\t}\r\n\tif(this.currentFacet() == \"line\" || this.currentFacet() == \"multiline\" || this.currentFacet() == \"summary\"){\r\n\t\treturn \"line\";\r\n\t}\r\n\treturn \"label\";\r\n}\r\n\r\n\r\nPropertyRenderer.prototype.getDefaultFacet = function(){\r\n\tif(this.cframe && this.cframe.isObject()){\r\n\t\treturn \"page\";\r\n\t}\r\n\treturn \"multiline\";\r\n}\r\n\r\n/*\r\n * Viewers for specific properties\r\n */\r\n\r\nPropertyRenderer.prototype.hide = function(){\r\n\tthis.setView(\"hidden\");\r\n}\r\n\r\nPropertyRenderer.prototype.show = function(){\r\n\tthis.setView(\"full\");\r\n}\r\n\r\nPropertyRenderer.prototype.setView = function(view){\r\n\tthis.view = view;\r\n\tthis.redraw();\r\n}\r\n\r\nPropertyRenderer.prototype.getAvailableViewers = function(){\r\n\tif(this.mode == \"view\"){\r\n\t\treturn TerminusDashboard.RenderingMap.getAvailablePropertyViewers(this);\t\t\r\n\t}\r\n\treturn TerminusDashboard.RenderingMap.getAvailablePropertyEditors(this);\t\t\t\t\r\n}\r\n\r\nPropertyRenderer.prototype.nukeViewer = function(){\r\n\tthis.viewer.remove();\r\n}\r\n\r\nPropertyRenderer.prototype.containsPage = function(){\r\n\t//collapsed facets do not show their values\r\n\tif(this.currentFacet() == \"icon\" || this.currentFacet() == \"label\") return false;\r\n\tfor(var i = 0; i<this.values.length; i++){\r\n\t\tif(this.values[i].facet == \"page\") {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nPropertyRenderer.prototype.getViewerForProperty = function(ptype){\r\n\tif(this.mode == \"edit\"){\r\n\t\treturn new PropertyViewer.HTMLPropertyViewer(this);\r\n\t}\r\n\treturn new PropertyViewer.HTMLPropertyViewer(this);\r\n}\r\n\r\nPropertyRenderer.prototype.getPropertyHeaderViewer = function(){\r\n\treturn new PropertyViewer.HTMLPropertyHeaderViewer();\r\n}\r\n\r\nPropertyRenderer.prototype.getSummary = function(){\r\n\tvar status = \"ok\";\r\n\tif(this.isNew()) status = \"new\";\r\n\telse if(this.isUpdated()) status = \"updated\";\r\n\tvar ret = {\r\n\t\tstatus: status,\r\n\t\tvalcount: this.values.length\r\n\t};\r\n\tret.long = ((ret.valcount != 1) ? \"(\" + ret.valcount + \") \" : \"\");\r\n\tfor(var i = 0; i<this.values.length; i++){\r\n\t\tvsum = this.values[i].getSummary();\r\n\t\tret.long += vsum.long;\r\n\t\tif(i < this.values.length-1) ret.long += \", \";\r\n\t}\r\n\treturn ret;\t\r\n}\r\n\r\nPropertyRenderer.prototype.getFeaturesForFacet = function(facet){\r\n\treturn this.facets[facet].features.concat(this.facets[facet].controls);\r\n}\r\n \r\nPropertyRenderer.prototype.showFeature = function(which){\r\n\tif(this.features.indexOf(which) == -1 && this.controls.indexOf(which) == -1) {\r\n\t\treturn false;\r\n\t}\r\n\tvar cardcontrols = [\"delete\", \"clone\", \"add\"];\r\n\tif(cardcontrols.indexOf(which) != -1){\r\n\t\tif(!this.cardControlAllows(which)) return false;\r\n\t}\r\n\tvar updcontrols = [\"update\", \"reset\"];\r\n\tif(this.hideDisabledControls() && updcontrols.indexOf(which) != -1 ){\r\n\t\tif(!this.isUpdated()){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\tif(which == 'hide' && this.view == \"hidden\") return false;\r\n\tif(which == 'show' && this.view != \"hidden\") return false;\r\n\tvar fets = this.getFeaturesForFacet(this.facet);\r\n\treturn (fets.indexOf(which) != -1);\r\n}\r\n\r\nfunction ObjectRenderer(obj, parent, options){\r\n\tthis.objframe = obj;\r\n\tthis.parent = parent;\r\n\tthis.properties = {};\r\n\tthis.originalProperties = false;\r\n\tthis.newProperties = [];\r\n\tthis.renderer_type = \"object\";\r\n\tthis.options = this.setOptions(options);\r\n}\r\n\r\n//options has to include mode, viewer, facet, controls, features, hide_disabled_controls\r\n\r\nObjectRenderer.prototype.setOptions = function(options){\r\n\treturn TerminusDashboard.RenderingMap.decorateRenderer(options, this);\r\n}\r\n\r\nObjectRenderer.prototype.getOptionsForProperty = function(prop){\r\n\treturn this.options;\r\n}\r\n\r\nObjectRenderer.prototype.render = function(viewer){\r\n\tthis.buildPropertyRenderers();\r\n\tthis.viewer = (viewer ? viewer: this.getViewerForObject());\r\n\tfor(var prop in this.properties){\r\n\t\tvar renderedprop = this.properties[prop].render();\r\n\t\tif(renderedprop && this.showFeature(\"body\")) this.viewer.addRenderedProperty(prop, renderedprop);\r\n\t}\r\n\treturn this.viewer.render(this.view);\r\n}\r\n\r\nObjectRenderer.prototype.buildPropertyRenderers = function(){\r\n\tvar props = this.getPropertiesToRender();\r\n\tif(this.originalProperties === false) this.originalProperties = props;\r\n\tvar renders = {};\r\n\tfor(var j = 0; j<props.length; j++){\r\n\t\tif(typeof this.properties[props[j]] == \"undefined\"){\r\n\t\t\trenders[props[j]] = new PropertyRenderer(props[j], this, this.getOptionsForProperty(props[j]));\r\n\t\t}\r\n\t\telse {\r\n\t\t\trenders[props[j]] = this.properties[props[j]];\r\n\t\t}\r\n\t\tif(this.newProperties.indexOf(props[j]) != -1) {\r\n\t\t\trenders[props[j]].setNew(); \r\n\t\t\trenders[props[j]].mode = \"edit\"; \r\n\t\t}\r\n\t}\r\n\tthis.properties = renders;\r\n}\r\n\r\nObjectRenderer.prototype.subject = function(){\r\n\tif(this.objframe) return this.objframe.subjid;\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.subjectClass = function(){\r\n\tif(this.objframe) return this.objframe.cls;\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.getAvailableViewers = function(){\r\n\t//if(this.mode == \"view\"){\r\n\t//\treturn RenderingMap.getAvailableObjectViewers(this);\t\t\r\n\t//}\r\n\t//return RenderingMap.getAvailableObjectEditors(this);\t\t\t\t\r\n\treturn [\"html\", \"json\"];\r\n}\r\n\r\nObjectRenderer.prototype.depth = function(){\r\n\tif(this.parent) return (this.parent.depth() + 1);\r\n\treturn 0;\r\n}\r\n\r\n\r\nObjectRenderer.prototype.property = function(){\r\n\tif(this.parent) return this.parent.property();\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.parentObject = function(){\r\n\tif(this.parent && this.parent.parent && this.parent.parent.objframe){\r\n\t\treturn this.parent.parent.objframe;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.root = function(){\r\n\tif(this.parent) return false;\r\n\treturn true;\r\n}\r\n\r\nObjectRenderer.prototype.load = function(link){\r\n\tvar self = this;\r\n\tif(this.controller){\r\n\t\tthis.controller.ui.showDocument(link);\r\n\t}\r\n\telse if(this.parent) {\r\n\t\tthis.parent.load(link);\r\n\t}\r\n}\r\n\r\nObjectRenderer.prototype.copy = function(nkid){\r\n\tnkid = (nkid ? nkid : this.objframe);\r\n\tvar other = new ObjectRenderer(nkid, this.parent, this.options);\r\n\treturn other;\r\n}\r\n\r\nObjectRenderer.prototype.clone = function(){\r\n\tif(this.root()){\r\n\t\tthis.objframe = this.objframe.clone(\"_:\");\r\n\t\tthis.objframe.newDoc = true;\r\n\t\tthis.setMode(\"edit\");\r\n\t}\r\n\telse {\r\n\t\tvar nkid = this.objframe.clone(TerminusClient.FrameHelper.genBNID());\r\n\t\tvar parentobj = this.parentObject();\r\n\t\tvar prop = this.property();\r\n\t\tif(parentobj && prop){\r\n\t\t\tif(typeof parentobj.children[prop] == \"undefined\"){\r\n\t\t\t\tparentobj.children[prop] = [];\r\n\t\t\t}\r\n\t\t\tparentobj.children[prop].push(nkid);\r\n\t\t\tvar newrend = this.copy(nkid);\r\n\t\t\tthis.parent.values.push(newrend);\r\n\t\t}\r\n\t\tthis.parent.redraw();\r\n\t}\r\n}\r\n\r\nObjectRenderer.prototype.cancel = function(){\r\n\tthis.reset();\r\n\tthis.setMode(\"view\");\r\n}\r\n\r\nObjectRenderer.prototype.save = function(){\r\n\tif(this.controller){\r\n\t\tif(this.isNewDocument()){\r\n\t\t\tvar demandid = this.inputID();\r\n\t\t\tif(demandid == \"_:\") demandid = \"\";\r\n\t\t\tthis.controller.createDocument(demandid);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.controller.updateDocument();\r\n\t\t}\r\n\t}\r\n\telse if(this.parent) {\r\n\t\tthis.parent.save();\r\n\t}\r\n}\r\n\r\nObjectRenderer.prototype.delete = function(){\r\n\tvar dval = this.subject();\r\n\tif(this.controller && this.root()){\r\n\t\tif(!this.isNewDocument()){\r\n\t\t\tthis.controller.deleteDocument(dval);\r\n\t\t}\r\n\t\tthis.nukeViewer();\r\n\t}\r\n\telse {\r\n\t\tif(this.parent){\r\n\t\t\tthis.parent.deletePropertyValue(dval);\t\t\r\n\t\t\tthis.parent.redraw();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nObjectRenderer.prototype.reset = function(){\r\n\tthis.objframe.reset();\r\n\tvar nprops = {};\r\n\tfor(var i = 0; i<this.originalProperties.length; i++){\r\n\t\tvar prop = this.originalProperties[i];\r\n\t\tif(typeof this.properties[prop] == \"object\"){\r\n\t\t\tthis.properties[prop].reset();\r\n\t\t\tnprops[prop] = this.properties[prop];\r\n\t\t}\r\n\t}\r\n\tthis.properties = nprops;\r\n\tthis.redraw();\r\n}\r\n\r\nObjectRenderer.prototype.deleteProperty = function(prop){\r\n\tthis.objframe.removeProperty(prop);\r\n\tdelete(this.properties[prop]);\r\n\tthis.updated();\r\n}\r\n\r\nObjectRenderer.prototype.addProperty = function(prop){\r\n\tthis.objframe.addProperty(prop);\r\n\tthis.updated();\r\n\tthis.redraw();\r\n}\r\n\r\nObjectRenderer.prototype.addNewProperty = function(prop){\r\n\tthis.objframe.addProperty(prop);\r\n\tthis.updated();\r\n\tthis.newProperties.push(prop);\r\n\tthis.redraw();\r\n\tthis.goToProperty(prop);\r\n}\r\n\r\nObjectRenderer.prototype.addPropertyClass = function(prop, cls){\r\n\tthis.objframe.addProperty(prop, cls);\r\n\tthis.updated();\r\n}\r\n\r\nObjectRenderer.prototype.changeClass = function(cls){\r\n\tif(this.parent){\r\n\t\tthis.parent.addClass(cls);\t\t\r\n\t\tthis.parent.deletePropertyValue(this.subject());\t\t\r\n\t}\r\n}\r\n\r\nObjectRenderer.prototype.getClassMeta = function(cls){\r\n\tvar ctl = this.getController();\r\n\tif(ctl && ctl.classmeta && ctl.classmeta[cls]){\r\n\t\treturn ctl.classmeta[cls];\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.getController = function(){\r\n\tif(this.controller){\r\n\t\treturn this.controller;\r\n\t}\r\n\tif(this.parent && this.parent.parent){\r\n\t\treturn this.parent.parent.getController();\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.getClient = function(){\r\n\tif(this.controller){\r\n\t\treturn this.controller.getClient();\r\n\t}\r\n\telse {\r\n\t\tif(this.parent && this.parent.parent){\r\n\t\t\treturn(this.parent.parent.getClient())\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.inputID = function(){\r\n\tif(this.idDOM){\r\n\t\treturn this.idDOM.value;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.isNew = function(){\r\n\tif(this.new_object){\r\n\t\treturn true;\r\n\t}\r\n\tif(this.isPartOfNewDocument()){\r\n\t\treturn true;\r\n\t}\r\n\tif(this.parent) return this.parent.isNew();\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.setNew = function(){\r\n\tthis.new_object = true;\r\n}\r\n\r\nObjectRenderer.prototype.isUpdated = function(){\r\n\tvar i = 0;\r\n\tfor(var prop in this.properties){\r\n\t\tif(this.originalProperties[i] != prop) return true;\r\n\t\tif(this.properties[prop].isUpdated()) return true;\r\n\t\ti++;\t\t\r\n\t}\r\n\tif(i != this.originalProperties.length) return true;\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.childUpdated = function(){\r\n\tthis.viewer.redrawHeader();\r\n\tif(this.parent) this.parent.childUpdated();\r\n}\r\n\r\nObjectRenderer.prototype.updated = ObjectRenderer.prototype.childUpdated;\r\n\r\nObjectRenderer.prototype.isNewDocument = function(){\r\n\tif(this.root() && this.objframe.isnew()) return true;\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.isPartOfNewDocument = function(){\r\n\tif(this.isNewDocument()) return true;\r\n\tif(this.parent && this.parent.parent){\r\n\t\treturn this.parent.parent.isPartOfNewDocument();\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.setFacet = function(facet, nocascade){\r\n\tthis.facet = facet;\r\n\tif(!nocascade){\r\n\t\tfor(var prop in this.properties){\r\n\t\t\tthis.properties[prop].parentFacetChange(facet);\r\n\t\t}\r\n\t}\r\n\tif(this.parent){\r\n\t\tthis.parent.redraw();\r\n\t}\r\n\telse {\r\n\t\tthis.redraw();\r\n\t}\r\n}\r\n\r\nObjectRenderer.prototype.getDefaultFacets = function(){\r\n\tvar defs = {\r\n\t\tpage: {\r\n\t\t\tlabel: \"Full Page\", value: \"page\", \r\n\t\t\tfeatures: [\"facet\", \"label\", \"comment\", \"id\", \"control\", \"type\", \"body\", \"status\", \"facet\", \"view\", \"viewer\"],\r\n\t\t\tcontrols: [\"delete\", \"clone\", \"add\", \"reset\", \"cancel\", \"update\", \"mode\", \"show\", \"hide\"] \r\n\t\t},\r\n\t\tline: {\r\n\t\t\tlabel: \"Single Line\", value: \"line\",\r\n\t\t\tfeatures: [\"facet\", \"label\", \"comment\", \"id\", \"type\", \"body\", \"status\", \"facet\"], \r\n\t\t\tcontrols: [] \r\n\t\t},\r\n\t\tsummary: {\r\n\t\t\tlabel: \"Summary\", value: \"summary\",\r\n\t\t\tfeatures: [\"facet\", \"satus\", \"label\", \"type\", \"summary\", \"status\", \"facet\"], \r\n\t\t\tcontrols: [] \r\n\t\t},\r\n\t\tlabel: {\r\n\t\t\tlabel: \"Label\", value: \"label\",\r\n\t\t\tfeatures: [\"facet\", \"status\", \"label\"],\r\n\t\t\tcontrols: []\r\n\t\t}\r\n\t}\r\n\treturn defs;\r\n}\r\n\r\nObjectRenderer.prototype.getAvailableFacets = function(){\r\n\treturn Object.keys(this.facets);\r\n}\r\n\r\nObjectRenderer.prototype.currentFacet = function(){\r\n\treturn this.facet;\r\n}\r\n\r\nObjectRenderer.prototype.getDefaultFacet = function(){\r\n\tif(!this.parent) return \"page\";\r\n\tvar pfacet = this.parent.currentFacet();\r\n\tif(pfacet == \"page\"){\r\n\t\treturn \"page\";\r\n\t}\r\n\tif(pfacet == \"multiline\") return \"line\";\r\n\tif(pfacet == \"line\") return \"summary\";\r\n\treturn \"label\";\r\n}\r\n\r\nObjectRenderer.prototype.parentFacetChange = function(pfacet){\r\n\tif(pfacet == \"page\") this.setFacet(\"page\");\r\n\tif(pfacet == \"multiline\") this.setFacet(\"summary\");\r\n\tif(pfacet == \"line\") this.setFacet(\"summary\");\r\n\tif(pfacet == \"summary\") this.setFacet(\"summary\");\r\n}\r\n\r\nObjectRenderer.prototype.getContentOrientation = function(){\r\n\tif(this.currentFacet() == \"page\"){\r\n\t\treturn \"page\";\r\n\t}\r\n\tif(this.currentFacet() == \"line\"){\r\n\t\treturn \"line\";\r\n\t}\r\n\treturn \"label\";\r\n}\r\n\r\nObjectRenderer.prototype.getLabel = function(){\r\n\tfor(var prop in this.properties){\r\n\t\tif(TerminusClient.FrameHelper.getShorthand(prop) == \"rdfs:label\"){\r\n\t\t\tvar prend = this.properties[prop];\r\n\t\t\tvar vrend = prend.values[0];\r\n\t\t\tif(vrend){\r\n\t\t\t\tvar sum = vrend.getSummary();\r\n\t\t\t\tif(sum.long != \"empty\") return sum.long;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tvar s = this.subject();\r\n\tif(s && s.substring(0, 2) == \"_:\"){\r\n\t\tvar ty = this.subjectClass();\r\n\t\tvar sh = TerminusClient.FrameHelper.getShorthand(ty);\r\n\t\tif(sh){\r\n\t\t\tvar b = sh.split(\":\");\r\n\t\t\tif(b.length > 1){\r\n\t\t\t\treturn \"New \" + b[1];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"New Object\";\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.getSummary = function(){\r\n\tvar ret = { status: \"ok\" };\r\n\tif(this.isUpdated()) ret.status = \"updated\";\r\n\tif(this.isNew()) ret.status = \"new\";\r\n\tret.propcount = 0;\r\n\tfor(var prop in this.properties){\r\n\t\tret.propcount++;\r\n\t}\r\n\tret.long = ret.propcount + \" properties\";\r\n\treturn ret;\t\r\n}\r\n\r\nObjectRenderer.prototype.getObjectHeaderViewer = function(){\r\n\treturn this.header_viewer;\r\n}\r\n\r\nObjectRenderer.prototype.getViewerForObject = function(format){\r\n\tif(format == \"json\"){\r\n\t\treturn new ObjectViewer.JSONObjectViewer(this);\r\n\t}\r\n\treturn new ObjectViewer.HTMLObjectViewer(this);\r\n}\r\n\r\nObjectRenderer.prototype.getFeaturesForFacet = function(facet){\r\n\treturn this.facets[facet].features.concat(this.facets[facet].controls);\r\n}\r\n \r\nObjectRenderer.prototype.hideDisabledControls = function(){\r\n\treturn this.hide_disabled_controls;\r\n}\r\n\r\nObjectRenderer.prototype.showFeature = function(which){\r\n\tif(this.features.indexOf(which) == -1 && this.controls.indexOf(which) == -1) {\r\n\t\treturn false;\r\n\t}\r\n\tvar cardcontrols = [\"delete\", \"clone\", \"add\"];\r\n\tif(cardcontrols.indexOf(which) != -1){\r\n\t\tif(!this.cardControlAllows(which)) return false;\r\n\t}\r\n\tvar updcontrols = [\"update\", \"reset\"];\r\n\tif(this.hideDisabledControls() && updcontrols.indexOf(which) != -1 ){\r\n\t\tif(!this.isUpdated()){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\tif(this.isNewDocument() && which == \"clone\") return false;\r\n\tif(which == 'hide' && this.view == \"hidden\") return false;\r\n\tif(which == 'show' && this.view != \"hidden\") return false;\r\n\tvar fets = this.getFeaturesForFacet(this.facet);\r\n\tif (fets.indexOf(which) != -1){\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nObjectRenderer.prototype.cardControlAllows = function(action){\r\n\tif(!this.parent) return true;\r\n\tif(this.parent.cframe.hasRestriction()){\r\n\t\tvar rest = this.parent.cframe.restriction;\r\n\t\tvar currentnum = this.parent.values.length;\r\n\t\tif(action == \"add\" || action == \"clone\"){\r\n\t\t\tif(rest.max && currentnum >= rest.max){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(action == \"delete\" && (rest.min && currentnum <= rest.min)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nObjectRenderer.prototype.goToProperty = function(prop){\r\n\tthis.viewer.goTo(this.subject(), prop);\r\n}\r\n\r\nObjectRenderer.prototype.setMode = function(mode){\r\n\tthis.mode = mode;\r\n\tfor(var prop in this.properties){\r\n\t\tthis.properties[prop].setMode(mode);\r\n\t}\r\n\tthis.viewer.redraw();\r\n}\r\n\r\nObjectRenderer.prototype.currentViewer = function(){return this.viewerType;}\r\n\r\n\r\nObjectRenderer.prototype.setViewer = function(viewer){\r\n\tvar nviewer = this.getViewerForObject(viewer);\r\n\tif(nviewer){\r\n\t\tthis.viewerType = viewer;\r\n\t\tthis.viewer = nviewer;\r\n\t\tthis.viewer.redraw();\r\n\t}\r\n}\r\n\r\n\r\nObjectRenderer.prototype.setView = function(view){\r\n\tvar views = {\r\n\t\t\"full\": {\r\n\t\t\t\r\n\t\t},\r\n\t\t\"hidden\": {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\tthis.view = view;\r\n\tthis.viewer.redraw();\r\n}\r\n\r\n\r\nObjectRenderer.prototype.hide = function(){\r\n\tthis.setView(\"hidden\");\r\n}\r\n\r\nObjectRenderer.prototype.show = function(){\r\n\tthis.setView(\"full\");\r\n}\r\n\r\nObjectRenderer.prototype.nukeViewer = function(){\r\n\tthis.viewer.remove();\r\n}\r\n\r\nObjectRenderer.prototype.getViewableProperties = function(){\r\n\treturn this.objframe.getFilledPropertyList();\t\r\n}\r\n\r\nObjectRenderer.prototype.getAddableProperties = function(){\r\n\tvar props = this.objframe.getMissingPropertyList();\t\r\n\treturn props;\r\n}\r\n\r\nObjectRenderer.prototype.getPropertiesToRender = function(options){\r\n\tvar sort = this.standardSort;\r\n\tvar filter = function(){return true};\r\n\tif(options && options.map && options.map.patterns){\r\n\t\t/*for(var i = 0; i<options.map.patterns.length; i++){\r\n\t\t\tif(this.objframe.matchesPattern({property: this.property(), action: \"sort\"}, options.map.patterns[i])){\r\n\t\t\t\tsort = options.map.patterns[i].sort;\r\n\t\t\t}\r\n\t\t\tif(this.objframe.matchesPattern({property: this.property(), action: \"filter\"}, options.map.patterns[i])){\r\n\t\t\t\tfilter = options.map.patterns[i].filter;\r\n\t\t\t}\r\n\t\t}*/\r\n\t}\r\n\treturn sort(this.objframe, filter);\r\n}\r\n\r\nObjectRenderer.prototype.standardSort = function(objframe, filter){\r\n\tvar sorted = [];\r\n\tvar rdft = TerminusClient.FrameHelper.getStdURL(\"rdfs\", \"label\");\r\n\tif(objframe.dataframes[rdft] && filter(objframe, rdft, objframe.dataframes[rdft])){\r\n\t\tsorted.push(rdft);\r\n\t}\r\n\tvar rdfc = TerminusClient.FrameHelper.getStdURL(\"rdfs\", \"comment\");\r\n\tif(objframe.dataframes[rdfc]){\r\n\t\tsorted.push(rdfc);\r\n\t}\r\n\tfor(var prop in objframe.dataframes){\r\n\t\tif(sorted.indexOf(prop) == -1) sorted.push(prop);\r\n\t}\r\n\tfor(var prop in objframe.children){\r\n\t\tif(sorted.indexOf(prop) == -1) sorted.push(prop);\t\t\r\n\t}\r\n\treturn sorted;\r\n}\r\n\r\n\r\nObjectRenderer.prototype.redraw = function(){\r\n\tthis.viewer.clear();\r\n\tthis.render(this.viewer);\r\n}\r\n\r\nObjectRenderer.prototype.extractLDO = function(extracts){\r\n\textracts[\"rdf:type\"] = this.objframe.cls;\r\n\tvar full = {};\r\n\tfull[this.subject()] = extracts;\r\n\treturn full;\t\r\n}\r\n\r\nObjectRenderer.prototype.extractJSONLD = function(extracts){\r\n\textracts[\"@type\"] = this.objframe.cls;\r\n\tif(this.subject() != \"_:\")\textracts[\"@id\"] = this.subject();\r\n\tif(this.objframe.jsonld_context) extracts['@context'] = this.objframe.jsonld_context;\r\n\treturn extracts;\r\n}\r\n\r\nObjectRenderer.prototype.extract = function(){\r\n\tvar extracts = {};\r\n\tfor(var i in this.properties){\r\n\t\tvar extracted = this.properties[i].extract();\r\n\t\tif(!TerminusClient.FrameHelper.empty(extracted)){\r\n\t\t\textracts[i] = extracted;\r\n\t\t}\r\n\t}\r\n\tif(TerminusClient.FrameHelper.empty(extracts) && this.parent){\r\n\t\treturn false;\r\n\t}\r\n\telse {\r\n\t\tvar ext = this.extractJSONLD(extracts);\r\n\t\treturn ext;\r\n\t\t//return this.extractLDO(extracts);\r\n\t}\r\n}\r\n\r\nmodule.exports={ObjectRenderer,PropertyRenderer}\r\n\r\n","\r\n\r\nfunction HTMLStringEditor(options){\r\n\tthis.css = ((options && options.css) ? \"terminus-literal-value \" + options.css : \"terminus-literal-value\");\r\n\tthis.options = options; \r\n}\r\n\r\nHTMLStringEditor.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar ty = TerminusClient.FrameHelper.getShorthand(renderer.frame.range);\r\n\tvar value = renderer.value();\r\n\tvar big = ((this.options && typeof this.options.big != \"undefined\") ? this.options.big : this.isBigType(ty, value));\r\n\tif(big){\r\n\t\tvar input = document.createElement(\"textarea\");\r\n\t\tthis.css += \" terminus-literal-big-value\";\t\t\r\n\t}\r\n\telse {\r\n\t\tvar size = ((this.options && typeof this.options.size != \"undefined\") ? this.options.size : this.getTypeSize(ty, value));\r\n\t\tvar input = document.createElement(\"input\");\r\n\t\tinput.setAttribute('type', \"text\");\r\n\t\tinput.setAttribute('size', size);\r\n\t}\r\n\tinput.setAttribute('class', this.css);\r\n\tinput.value = value;\r\n\tvar self = this;\r\n\tinput.addEventListener(\"input\", function(){\r\n\t\trenderer.set(this.value);\r\n\t});\r\n\treturn input;\r\n}\r\n\r\nHTMLStringEditor.prototype.isBigType = function(ty, value){\r\n\tif(value && value.length && value.length > 100) return true;\r\n\tvar longs = [\"xdd:coordinatePolyline\", \"xdd:coordinatePolygon\", \"xsd:base64Binary\", \"xdd:html\", \"xdd:json\", \"rdf:XMLLiteral\"];\r\n\tif(longs.indexOf(ty) == -1) return false;\r\n\treturn true;\r\n}\r\n\r\nHTMLStringEditor.prototype.getTypeSize = function(ty, value){\r\n\tif(value && value.length && value.length > 40) return 80;\r\n\tvar bigs = [\"xdd:url\", \"xdd:coordinate\", \"xsd:anyURI\"];\r\n\tvar smalls = [\"xsd:gYearMonth\", \"xdd:gYearRange\", \"xsd:decimal\", \"xsd:float\", \"xsd:time\", \"xsd:date\", \r\n\t\t\"xsd:dateTimeStamp\",\"xsd:gYearMonth\", \"xsd:gMonthDay\", \"xsd:duration\", \"xsd:yearMonthDuration\", \"xsd:dayTimeDuration\", \r\n\t\t\"xsd:nonNegativeInteger\", \"xsd:positiveInteger\", \"xsd:negativeInteger\",\t\"xsd:nonPositiveInteger\", \"xsd:integer\",\"xsd:unsignedInt\"];\r\n\tvar tinys = [\"xsd:boolean\", \"xsd:gYear\", \"xsd:gMonth\", \"xsd:gDay\", \"xsd:byte\", \"xsd:short\", \"xsd:unsignedByte\", \"xsd:language\"];\r\n\tif(bigs.indexOf(ty) != -1) return 80;\r\n\tif(smalls.indexOf(ty) != -1) return 16;\r\n\tif(tinys.indexOf(ty) != -1) return 8;\r\n\treturn 32;\r\n}\r\n\r\nmodule.exports={HTMLStringEditor}\r\n\r\n\r\n","function HTMLBooleanViewer(options){\r\n\tthis.css = \"terminus-literal-value terminus-literal-value-range \" + ((options && options.css) ?  options.css : \"\");\r\n}\r\n\r\nHTMLBooleanViewer.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', this.css);\r\n\tif(value){\r\n\t\tvar vallab = document.createTextNode(value);\r\n\t\tinput.appendChild(vallab);\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLBooleanViewer}\r\n\r\n","function HTMLBooleanEditor(options){\r\n\tthis.css = \"terminus-literal-value terminus-literal-value-range \" + ((options && options.css) ?  options.css : \"\");\r\n}\r\n\r\nHTMLBooleanEditor.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar input = document.createElement(\"input\");\r\n\tinput.setAttribute('type', \"checkbox\");\r\n\tif(value){\r\n\t\tinput.setAttribute(\"checked\", \"checked\");\t\t\t\t\t\r\n\t}\r\n\tinput.addEventListener(\"change\", function(){\r\n\t\tif(value){\r\n\t\t\trenderer.set(\"\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\trenderer.set(\"true\");\r\n\t\t}\r\n\t});\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLBooleanEditor}\r\n\r\n","function HTMLChoiceViewer(options){};\r\n\r\nHTMLChoiceViewer.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-choice-value\");\r\n\tinput.setAttribute('data-value', value);\r\n\tif(value){\r\n\t\tvar els = renderer.frame.frame.elements;\r\n\t\tfor(var i = 0; i<els.length; i++){\r\n\t\t\tif(els[i].class == value){\r\n\t\t\t\tif(els[i].label && els[i].label[\"@value\"]){\r\n\t\t\t\t\tvar lab = els[i].label[\"@value\"];\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlab = TerminusClient.FrameHelper.labelFromURL(value);\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\tinput.appendChild(document.createTextNode(lab));\r\n\t\t\t\tcontinue;\r\n\t\t\t}\t\t\t\t\r\n\t\t}\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLChoiceViewer}\r\n\r\n\r\n","const HTMLFrameHelper = require('../HTMLFrameHelper');\r\nconst RenderingMap = require('../RenderingMap');\r\n\r\nfunction HTMLChoiceEditor(options){};\r\n\r\nHTMLChoiceEditor.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar optInput = document.createElement(\"select\");\r\n\toptInput.setAttribute('class', \"terminus-choice-picker\");\r\n\tvar foptions = renderer.frame.getChoiceOptions();\r\n\tfoptions.unshift({ value: \"\", label: \"Not Specified\"});\r\n\tvar callback = function(val){\r\n\t\trenderer.set(val);\r\n\t}\r\n\tvar sel = HTMLFrameHelper.getSelectionControl(\"select-choice\", foptions, value, callback);\r\n\treturn sel;\r\n}\r\n\r\nmodule.exports={HTMLChoiceEditor}\r\n\r\n","\r\nfunction HTMLCoordinateViewer(options){\r\n\tthis.inputs = [];\r\n}\r\n\r\nHTMLCoordinateViewer.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar ty = TerminusClient.FrameHelper.getShorthand(renderer.frame.range);\r\n\tvar value = renderer.value();\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-coordinate\");\r\n\tinput.setAttribute('data-value', value);\r\n\ttry {\r\n\t\tvar parsed = (value ? JSON.parse(value) : false);\r\n\t}\r\n\tcatch(e){\r\n\t\trenderer.badData(ty + \" failed to parse as json\", e.toString());\r\n\t\tvar parsed = false;\r\n\t\tvalue = false;\r\n\t}\r\n\tif(value){\r\n\t\tif(ty == \"xdd:coordinate\"){\r\n\t\t\tparsed = [parsed];\r\n\t\t}\r\n\t\tfor(var i = 0; i < parsed.length; i++){\r\n\t\t\tvar lldom = document.createElement(\"span\");\r\n\t\t\tlldom.setAttribute(\"class\", \"latlong\");\r\n\t\t\tlldom.appendChild(document.createTextNode(\"Latitude: \"));\r\n\t\t\tlldom.appendChild(document.createTextNode(parsed[i][0] + \" °\" + \" \"));\r\n\t\t\tlldom.appendChild(document.createTextNode(\"Longitude: \"));\r\n\t\t\tlldom.appendChild(document.createTextNode(parsed[i][1] + \" °\" ));\r\n\t\t\tinput.appendChild(lldom);\r\n\t\t}\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLCoordinateViewer}\r\n\r\n","function HTMLCoordinateEditor(options){\r\n\tthis.inputs = [];\r\n}\r\n\r\nHTMLCoordinateEditor.prototype.getInputDOMs = function(lat, long, change){\r\n\tvar latdom = document.createElement(\"input\");\r\n\tlatdom.setAttribute(\"type\", \"text\");\r\n\tlatdom.value = lat;\r\n\tvar longdom = document.createElement(\"input\");\r\n\tlongdom.setAttribute(\"type\", \"text\");\r\n\tlongdom.value = long;\r\n\tlatdom.addEventListener(\"change\", change);\r\n\tlongdom.addEventListener(\"change\", change);\r\n\treturn [latdom, longdom];\r\n}\r\n\r\nHTMLCoordinateEditor.prototype.getLatLongDOM = function(lat, long, ty, index, parent){\r\n\tvar lldom = document.createElement(\"span\");\r\n\tlldom.setAttribute(\"class\", \"terminus-lat-long\");\r\n\tvar firstcol = document.createElement(\"span\");\r\n\tfirstcol.setAttribute(\"class\", \"terminus-lat-long-col\");\r\n\tlldom.appendChild(firstcol);\r\n\tif(index > 2 || (ty == \"xdd:coordinatePolyline\" && index > 1)){\r\n\t\tvar delbut = document.createElement(\"button\");\r\n\t\tdelbut.setAttribute(\"class\", \"delete-coordinate\");\r\n\t\tdelbut.appendChild(document.createTextNode(\"Remove\"));\r\n\t\tdelbut.addEventListener(\"click\", function(){\r\n\t\t\tlong.value = \"\";\r\n\t\t\tlat.value = \"\";\r\n\t\t\tparent.removeChild(lldom);\r\n\t\t});\r\n\t\tfirstcol.appendChild(delbut);\r\n\t}\r\n\tlldom.appendChild(document.createTextNode(\"Latitude: \"));\r\n\tlldom.appendChild(lat);\r\n\tlldom.appendChild(document.createTextNode(\" °\" + \" \"));\r\n\tlldom.appendChild(document.createTextNode(\"  Longitude: \"));\r\n\tlldom.appendChild(long);\r\n\tlldom.appendChild(document.createTextNode(\" ° \" ));\r\n\treturn lldom;\r\n}\r\n\r\n\r\nHTMLCoordinateEditor.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar ty = TerminusClient.FrameHelper.getShorthand(renderer.frame.range);\r\n\tvar value = renderer.value();\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-coordinate\");\r\n\tinput.setAttribute('data-value', value);\r\n\ttry {\r\n\t\tvar parsed = (value ? JSON.parse(value) : false);\r\n\t}\r\n\tcatch(e){\r\n\t\trenderer.badData(ty + \" failed to parse as json\", e.toString());\r\n\t\tvar parsed = false;\r\n\t\tvalue = false;\r\n\t}\r\n\tvar self = this;\r\n\tvar updateValueFromForm = function(){\r\n\t\tvar vals = [];\r\n\t\tfor(var i = 0; i<self.inputs.length; i++){\r\n\t\t\tif(self.inputs[i][0].value && self.inputs[i][1].value){\r\n\t\t\t\tvar val = \"[\" + self.inputs[i][0].value + \",\" + self.inputs[i][1].value + \"]\";\r\n\t\t\t\tvals.push(val);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(vals.length == 0){\r\n\t\t\trenderer.set(\"\");\r\n\t\t}\r\n\t\telse if(ty == \"xdd:coordinate\"){\r\n\t\t\trenderer.set(vals[0]);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar op = \"[\";\r\n\t\t\tfor(var i = 0; i<vals.length; i++){\r\n\t\t\t\top += vals[i];\r\n\t\t\t\tif(i+1 < vals.length) op += \",\";\r\n\t\t\t}\r\n\t\t\top += \"]\";\r\n\t\t\trenderer.set(op);\r\n\t\t}\r\n\t};\r\n\tif(!parsed){\r\n\t\tif(ty == \"xdd:coordinate\") parsed = [\"\",\"\"];\r\n\t\telse {\r\n\t\t\tparsed = [[\"\",\"\"],[\"\",\"\"]];\r\n\t\t\tif(ty == \"xdd:coordinatePolygon\") parsed.push([\"\",\"\"]);\r\n\t\t}\r\n\t}\r\n\tif(ty == \"xdd:coordinate\"){\r\n\t\tparsed = [parsed];\r\n\t}\r\n\tfor(var i = 0; i < parsed.length; i++){\r\n\t\tthis.inputs.push(this.getInputDOMs(parsed[i][0], parsed[i][1], updateValueFromForm))\r\n\t}\r\n\tvar lldoms = document.createElement(\"span\");\r\n\tfor(var i = 0; i < this.inputs.length; i++){\r\n\t\tvar lldom = this.getLatLongDOM(this.inputs[i][0], this.inputs[i][1], ty, i, lldoms);\r\n\t\tlldoms.appendChild(lldom);\r\n\t}\r\n\tinput.appendChild(lldoms);\r\n\tvar self = this;\r\n\tif(ty != \"xdd:coordinate\"){\r\n\t\tvar butspan = document.createElement(\"span\");\r\n\t\tbutspan.setAttribute(\"class\", \"terminus-add-coordinate\")\r\n\t\tvar addbut = document.createElement(\"button\");\r\n\t\taddbut.setAttribute(\"class\", \"terminus-add-coordinate\");\r\n\t\taddbut.appendChild(document.createTextNode(\"Add\"));\r\n\t\taddbut.addEventListener(\"click\", function(){\r\n\t\t\tvar ipdoms = self.getInputDOMs(\"\", \"\", updateValueFromForm);\r\n\t\t\tvar lldom = self.getLatLongDOM(ipdoms[0], ipdoms[1], ty, self.inputs.length, lldoms);\r\n\t\t\tlldoms.appendChild(lldom);\r\n\t\t\tself.inputs.push(ipdoms);\r\n\t\t});\r\n\t\tbutspan.appendChild(addbut);\r\n\t\tinput.appendChild(butspan);\t\t\t\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLCoordinateEditor}","const DateHelper = require('./DateHelper');\r\n\r\nfunction HTMLDateViewer(options){\r\n\tthis.max = (options && options.max ? options.max : false);\r\n\tthis.min = (options && options.min ? options.min : false);\r\n\tthis.allowbce = (options && options.allowbce ? options.allowbce : false);\r\n\tthis.date_spacer = \"/\";\r\n\tthis.time_spacer = \":\";\r\n\tthis.datetime_separator = \", \";\r\n\tthis.helper = new DateHelper.HTMLDateHelper();\r\n}\r\n\r\nHTMLDateViewer.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar ty = TerminusClient.FrameHelper.getShorthand(renderer.frame.range);\r\n\tvar value = renderer.value();\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-date\");\r\n\tinput.setAttribute('data-value', value);\r\n\tif(value){\r\n\t\tvar parsed = TerminusClient.FrameHelper.parseDate(ty, value);\r\n\t\tvar datepart = this.getDateComponentDOM(parsed);\r\n\t\tvar timepart = this.getTimeComponentDOM(parsed);\r\n\t\tif(timepart) input.appendChild(timepart);\r\n\t\tif(timepart && datepart) input.appendChild(document.createTextNode(this.datetime_separator));\r\n\t\tif(datepart) input.appendChild(datepart);\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nHTMLDateViewer.prototype.getTimeComponentDOM = function(parsed, ty){\r\n\tvar hdom = (parsed.hour ? document.createElement(\"span\") : false);\r\n\tif(hdom){\r\n\t\thdom.setAttribute(\"class\", \"terminus-time-hour\");\r\n\t\thdom.appendChild(document.createTextNode(parsed.hour));\r\n\t}\r\n\tvar mdom = (typeof parsed.minute != \"undefined\" ? document.createElement(\"span\") : false);\r\n\tif(mdom){\r\n\t\tmdom.setAttribute(\"class\", \"terminus-time-minute\");\r\n\t\tvar mlab = (parsed.minute < 10 ? \"0\" + parsed.minute : parsed.minute);\r\n\t\tmdom.appendChild(document.createTextNode(mlab));\r\n\t}\r\n\tvar sdom = (typeof parsed.second != \"undefined\" ? document.createElement(\"span\") : false);\r\n\tif(sdom){\r\n\t\tsdom.setAttribute(\"class\", \"terminus-time-second\");\r\n\t\tvar slab = (parsed.second < 10 ? \"0\" + parsed.second : parsed.second);\r\n\t\tsdom.appendChild(document.createTextNode(slab));\r\n\t}\r\n\tvar tz = (parsed.timezone ? document.createElement(\"span\") : false);\r\n\tif(tz){\r\n\t\tsdom.setAttribute(\"class\", \"terminus-time-timezone\");\r\n\t\tsdom.appendChild(document.createTextNode(parsed.timezone));\r\n\t}\r\n\tif(hdom || mdom || sdom || tz){\r\n\t\tvar dadom = document.createElement(\"span\");\r\n\t\tdadom.setAttribute(\"class\", \"terminus-time-components time-\"+ty);\r\n\t\tif(hdom) dadom.appendChild(hdom); \r\n\t\tif(mdom) {\r\n\t\t\tif(hdom) dadom.appendChild(document.createTextNode(this.time_spacer));\r\n\t\t\tdadom.appendChild(mdom); \r\n\t\t}\r\n\t\tif(sdom) {\r\n\t\t\tif(mdom || hdom) dadom.appendChild(document.createTextNode(this.time_spacer));\r\n\t\t\tdadom.appendChild(sdom); \r\n\t\t}\r\n\t\tif(tz){\r\n\t\t\tdadom.appendChild(document.createTextNode(\" (Timezone: \")); \r\n\t\t\tdadom.appendChild(sdom); \r\n\t\t\tdadom.appendChild(document.createTextNode(\")\")); \t\t\t\r\n\t\t}\r\n\t\treturn dadom;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nHTMLDateViewer.prototype.getDateComponentDOM = function(parsed, ty){\r\n\tvar ydom = (parsed.year ? document.createElement(\"span\") : false);\r\n\tif(ydom){\r\n\t\tydom.setAttribute(\"class\", \"terminus-date-year\");\r\n\t\tydom.appendChild(document.createTextNode(parsed.year));\r\n\t}\r\n\tvar mdom = (parsed.month ? document.createElement(\"span\") : false);\r\n\tif(mdom){\r\n\t\tmdom.setAttribute(\"class\", \"terminus-date-month\");\r\n\t\tmdom.appendChild(document.createTextNode(this.helper.getMonthName(parsed.month)));\t\t\r\n\t}\r\n\tvar ddom = (parsed.day ? document.createElement(\"span\") : false );\r\n\tif(ddom){\r\n\t\tddom.setAttribute(\"class\", \"terminus-date-day\");\r\n\t\tddom.appendChild(document.createTextNode(parsed.day));\t\t\r\n\t}\r\n\tif(ydom || mdom || ddom){\r\n\t\tvar dadom = document.createElement(\"span\");\r\n\t\tif(ddom) dadom.appendChild(ddom); \r\n\t\tif(mdom) {\r\n\t\t\tif(ddom) dadom.appendChild(document.createTextNode(this.date_spacer));\r\n\t\t\tdadom.appendChild(mdom); \r\n\t\t}\r\n\t\tif(ydom) {\r\n\t\t\tif(mdom || ddom) dadom.appendChild(document.createTextNode(this.date_spacer));\r\n\t\t\tdadom.appendChild(ydom); \r\n\t\t}\r\n\t\treturn dadom;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nmodule.exports={HTMLDateViewer}","const DateHelper = require('./DateHelper');\r\n\r\nfunction HTMLDateEditor(options){\r\n\tthis.max = (options && options.max ? options.max : false);\r\n\tthis.min = (options && options.min ? options.min : false);\r\n\tthis.allowbce = (options && options.allowbce ? options.allowbce : false);\r\n\tthis.date_spacer = \"/\";\r\n\tthis.time_spacer = \":\";\r\n\tthis.datetime_separator = \", \";\r\n\tthis.helper = new DateHelper.HTMLDateHelper();\r\n}\r\n\r\nHTMLDateEditor.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar ty = TerminusClient.FrameHelper.getShorthand(renderer.frame.range);\r\n\tvar value = renderer.value();\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-date\");\r\n\tinput.setAttribute('data-value', value);\r\n\tif(value){\r\n\t\tthis.parsed = TerminusClient.FrameHelper.parseDate(ty, value);\r\n\t}\r\n\telse this.parsed = {};\r\n\tvar datepart = this.getDateComponentDOM(this.parsed, ty, renderer);\r\n\tvar timepart = this.getTimeComponentDOM(this.parsed, ty, renderer);\r\n\tif(timepart) input.appendChild(timepart);\r\n\tif(timepart && datepart) input.appendChild(document.createTextNode(this.datetime_separator));\r\n\tif(datepart) input.appendChild(datepart);\r\n\treturn input;\r\n}\r\n\r\nHTMLDateEditor.prototype.set = function(part, val, renderer, ty){\r\n\tthis.parsed[part] = val;\r\n\tvar xsd = TerminusClient.FrameHelper.xsdFromParsed(this.parsed, ty);\r\n\tif(xsd){\r\n\t\trenderer.set(xsd);\r\n\t}\r\n}\r\n\r\nHTMLDateEditor.prototype.getTimeComponentDOM = function(parsed, ty, renderer){\r\n\t\r\n}\r\n\r\nHTMLDateEditor.prototype.getDateComponentDOM = function(parsed, ty, renderer){\r\n\tvar self = this;\r\n\tif([\"xsd:date\", \"xsd:dateTime\", \"xsd:gYear\", \"xsd:gYearMonth\", \"xsd:dateTimeStamp\"].indexOf(ty) != -1){\r\n\t\tvar ydom = document.createElement(\"input\");\r\n\t\tydom.setAttribute(\"class\", \"terminus-year-input terminus-year-\"+ty);\r\n\t\tydom.setAttribute(\"size\", 6);\r\n\t\tydom.setAttribute(\"placeholder\", \"YYYY\");\r\n\t\tydom.value = (parsed.year ? parsed.year : \"\");\r\n\t\tydom.addEventListener(\"input\", function(){\r\n\t\t\tself.set(\"year\", this.value, renderer, ty);\r\n\t\t})\r\n\t}\r\n\tif([\"xsd:date\", \"xsd:dateTime\", \"xsd:gYearMonth\", \"xsd:dateTimeStamp\", \"xsd:gMonth\", \"xsd:gMonthDay\"].indexOf(ty) != -1){\r\n\t\tvar mdom = document.createElement(\"select\");\r\n\t\tmdom.setAttribute(\"class\", \"terminus-month-input terminus-month-\"+ty);\r\n\t\tfor(var i = 0; i<this.helper.months.length; i++){\r\n\t\t\tvar opdom = document.createElement(\"option\");\r\n\t\t\topdom.value = i+1;\r\n\t\t\topdom.appendChild(document.createTextNode(this.helper.months[i]));\r\n\t\t\tif(parsed.month && parsed.month == i+1){\r\n\t\t\t\topdom.selected = true;\r\n\t\t\t}\r\n\t\t\tmdom.appendChild(opdom);\r\n\t\t}\r\n\t\tmdom.addEventListener(\"change\", function(){\r\n\t\t\tself.set(\"month\", this.value, renderer, ty);\r\n\t\t})\r\n\t}\t\r\n\tif([\"xsd:date\", \"xsd:dateTime\", \"xsd:dateTimeStamp\", \"xsd:gMonth\", \"xsd:gDay\", \"xsd:gMonthDay\"].indexOf(ty) != -1){\r\n\t\tvar ddom = document.createElement(\"input\");\r\n\t\tddom.setAttribute(\"class\", \"terminus-day-input terminus-day-\"+ty);\r\n\t\tddom.setAttribute(\"size\", 2);\r\n\t\tddom.setAttribute(\"placeholder\", \"DD\");\r\n\t\tddom.value = (parsed.day ? parsed.day : \"\");\t\r\n\t\tddom.addEventListener(\"input\", function(){\r\n\t\t\tself.set(\"day\", this.value, renderer, ty);\r\n\t\t})\r\n\t}\t\r\n\tif(ydom || mdom || ddom){\r\n\t\tvar dadom = document.createElement(\"span\");\r\n\t\tif(ddom) dadom.appendChild(ddom); \r\n\t\tif(mdom) {\r\n\t\t\tif(ddom) dadom.appendChild(document.createTextNode(this.date_spacer));\r\n\t\t\tdadom.appendChild(mdom); \r\n\t\t}\r\n\t\tif(ydom) {\r\n\t\t\tif(mdom || ddom) dadom.appendChild(document.createTextNode(this.date_spacer));\r\n\t\t\tdadom.appendChild(ydom); \r\n\t\t}\r\n\t\treturn dadom;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nmodule.exports={HTMLDateEditor}","function HTMLEntityViewer(options){}\r\nHTMLEntityViewer.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar value = TerminusClient.FrameHelper.unshorten(value);\r\n\tvar holder = document.createElement(\"span\");\r\n\tholder.setAttribute(\"class\", \"terminus-literal-value terminus-entity-reference-value\");\r\n\tvar self = this;\r\n\tif(this.holder){\r\n\t\treturn this.holder;\r\n\t}\r\n\tif(value){\r\n\t\tvar dom = this.getEntityViewHTML(value, renderer, dataviewer);\t\t\r\n\t\tholder.appendChild(dom);\r\n\t}\r\n\treturn holder;\r\n}\r\n\r\nHTMLEntityViewer.prototype.getEntityViewHTML = function(value, renderer, dataviewer){\r\n\tvar span = document.createElement(\"span\");\r\n\tvar self = this;\r\n\tspan.setAttribute(\"class\", \"terminus-internal-link\");\r\n\tspan.appendChild(dataviewer.internalLink(value));\r\n\tif(controller = renderer.getController()){\r\n\t\tcontroller.getInstanceMeta(value).then(function(response){\r\n\t\t\tvar lab = self.getEntityLabel(value, response, dataviewer);\r\n\t\t\tif(lab){ \r\n\t\t\t\tTerminusClient.FrameHelper.removeChildren(span);\r\n\t\t\t\tspan.appendChild(lab);\r\n\t\t\t}\t\r\n\t\t});\r\n\t}\r\n\treturn span;\r\n}\r\n\r\nHTMLEntityViewer.prototype.getEntityLabel = function(url, response, dv){\r\n\tvar nspan = document.createElement(\"span\");\r\n\tif(response && typeof response.InstanceLabel == \"object\" && response.InstanceLabel[\"@value\"]){\r\n\t\tnspan.appendChild(dv.internalLink(url, response.InstanceLabel[\"@value\"]));\r\n\t\tvar tit = url + \" Type: \" + response.InstanceType;\r\n\t\tif(typeof response.InstanceComment == \"object\" && response.InstanceComment[\"@value\"]){\r\n\t\t\ttit += \" \" + response.InstanceComment[\"@value\"];\r\n\t\t}\r\n\t\tnspan.setAttribute(\"title\", tit);\r\n\t\treturn nspan;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nmodule.exports={HTMLEntityViewer}","function HTMLEntityEditor(options){}\r\nHTMLEntityEditor.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar input = document.createElement(\"input\");\r\n\tinput.setAttribute(\"class\", \"terminus-literal-value terminus-entity-reference-value\");\r\n\tinput.setAttribute(\"type\", \"text\");\r\n\tinput.setAttribute('size', 80);\r\n\tinput.value = value;\r\n\tvar self = this;\r\n\tinput.addEventListener(\"change\", function(){\r\n\t\tvar url = this.value;\r\n\t\tif(url.indexOf(\"/\") == -1 && url.indexOf(\":\") == -1){\r\n\t\t\turl = \"doc:\" + url;\r\n\t\t}\r\n\t\trenderer.set(url);\r\n\t});\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLEntityEditor}","function HTMLImageViewer(options){}\r\nHTMLImageViewer.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar ty = TerminusClient.FrameHelper.getShorthand(renderer.frame.range);\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-image-value\");\r\n\tinput.setAttribute('data-value', value);\r\n\tif(value){\r\n\t\tvar img = document.createElement(\"a\");\r\n\t\timg.setAttribute('src', value);\r\n\t\tinput.appendChild(img);\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLImageViewer}\r\n\r\n\r\n","\r\n\r\nfunction HTMLImageEditor(options){}\r\nHTMLImageEditor.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar ty = TerminusClient.FrameHelper.getShorthand(renderer.frame.range);\r\n\tif(ty == \"xsd:base64Binary\"){\r\n\t\tvar input = document.createElement(\"textarea\");\r\n\t\tinput.setAttribute('class', \"terminus-literal-value terminus-literal-b64image-value\");\r\n\t\tinput.value = value;\r\n\t\tinput.addEventListener(\"change\", function(){\r\n\t\t\trenderer.set(this.value);\r\n\t\t});\r\n\t\treturn input;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nmodule.exports={HTMLImageEditor}","function HTMLLinkViewer(options){\r\n\tthis.css = \"terminus-literal-value terminus-literal-value-range \" + ((options && options.css) ?  options.css : \"\");\r\n}\r\n\r\nHTMLLinkViewer.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', this.css);\r\n\tinput.setAttribute('size', 80);\r\n\tinput.setAttribute('data-value', value);\r\n\tif(value){\r\n\t\tvar a = document.createElement(\"a\");\r\n\t\ta.setAttribute('href', value);\r\n\t\ta.appendChild(document.createTextNode(value));\r\n\t\tinput.appendChild(a);\r\n\t}\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLLinkViewer}\r\n\r\n","function HTMLNumberViewer(options){\r\n\tthis.commas = (options && options.commas ? options.commas : true);\r\n}\r\n\r\nHTMLNumberViewer.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tif(value === 0) value = \"0\";\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', 'terminus-number-value terminus-literal-value');\r\n\tinput.setAttribute('data-value', value);\r\n\tvalue = (this.commas ? TerminusClient.FrameHelper.numberWithCommas(value) : value);\r\n\tinput.appendChild(document.createTextNode(value));\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={HTMLNumberViewer}\r\n","function HTMLRangeViewer(options){\r\n\tthis.commas = (options && options.commas ? options.commas : true);\r\n\tthis.css = \"terminus-literal-value terminus-literal-value-range \" + ((options && options.css) ?  options.css : \"\");\r\n\tthis.delimiter = (options && options.delimiter ? options.delimiter : false);\r\n}\r\n\r\nHTMLRangeViewer.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar vals = TerminusClient.FrameHelper.parseRangeValue(value, this.delimiter);\r\n\tvar d = document.createElement(\"span\");\r\n\td.setAttribute(\"class\", this.css);\r\n\tvar rvals = document.createElement(\"span\");\r\n\trvals.setAttribute(\"class\", \"terminus-range-value-left\");\r\n\tvar svals = document.createElement(\"span\");\r\n\tsvals.setAttribute(\"class\", \"terminus-range-value-right\");\r\n\tvar x = (this.commas ? TerminusClient.FrameHelper.numberWithCommas(vals[0]) : vals[0]);\r\n\tvar tnode = document.createTextNode(x);\r\n\trvals.appendChild(tnode);\r\n\td.appendChild(rvals);\t\r\n\tif(vals.length == 2){\r\n\t\td.appendChild(getRangeSymbolDOM());\r\n\t\tvar x2 = (this.commas ? TerminusClient.FrameHelper.numberWithCommas(vals[1]) : vals[1]);\r\n\t\tvar t2node = document.createTextNode(x2);\r\n\t\tsvals.appendChild(t2node);\r\n\t\td.appendChild(svals);\t\r\n\t}\r\n\treturn d;\r\n}\r\n\r\nfunction getRangeSymbolDOM(){\r\n\tvar d = document.createElement(\"span\");\r\n\td.setAttribute(\"class\", \"terminus-range-indicator\");\r\n\td.setAttribute(\"title\", \"The value is uncertain, it lies somewhere in this range\");\r\n\td.appendChild(document.createTextNode(\" ... \"));\r\n\treturn d;\r\n}\r\n\r\nmodule.exports={HTMLRangeViewer}\r\n","function HTMLRangeEditor(options){\r\n\tthis.commas = (options && options.commas ? options.commas : true);\r\n\tthis.css = \"terminus-literal-value terminus-literal-value-range \" + ((options && options.css) ?  options.css : \"\");\r\n\tthis.delimiter = (options && options.delimiter ? options.delimiter : false);\r\n}\r\n\r\nHTMLRangeEditor.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar value = renderer.value();\r\n\tvar vals = TerminusClient.FrameHelper.parseRangeValue(value, this.delimiter);\r\n\tvar d = document.createElement(\"span\");\r\n\td.setAttribute(\"class\", this.css);\r\n\tvar rvals = document.createElement(\"span\");\r\n\tvar svals = document.createElement(\"span\");\r\n\tvar data1 = (vals.length > 0 ? vals[0] : \"\");\r\n\tvar data2 = (vals.length > 1 ? vals[1] : \"\");\r\n\tvar firstip = document.createElement(\"input\");\r\n\tfirstip.setAttribute('type', \"text\");\r\n\tfirstip.setAttribute('size', 16);\r\n\tif(data1){\r\n\t\tfirstip.value = data1;\r\n\t}\r\n\tvar secondip = document.createElement(\"input\");\r\n\tsecondip.setAttribute('type', \"text\");\r\n\tsecondip.setAttribute('size', 16);\r\n\tif(data2){\r\n\t\tthis.showing_range = true;\r\n\t\tsecondip.value = data2;\r\n\t}\r\n\trvals.appendChild(firstip);\r\n\td.appendChild(rvals);\t\r\n\tif(this.showing_range){\r\n\t\tsvals.appendChild(getRangeSymbolDOM());\r\n\t\tsvals.appendChild(secondip);\r\n\t}\r\n\td.appendChild(svals);\t\r\n\tvar but = document.createElement(\"button\");\r\n\tbut.setAttribute(\"class\", \"terminus-change-range\");\r\n\tvar txt = this.showing_range ? \"Change to Simple Value\" : \"Change to Uncertain Range\";\r\n\tbut.appendChild(document.createTextNode(txt));\r\n\td.appendChild(but);\t\r\n\tvar self = this;\r\n\tbut.addEventListener(\"click\", function(){\r\n\t\tif(self.showing_range){\r\n\t\t\tself.showing_range = false;\r\n\t\t\tsecondip.value = \"\";\t\t\t\t\r\n\t\t\tTerminusClient.FrameHelper.removeChildren(svals);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.showing_range = true;\r\n\t\t\tsecondip.value = \"\";\t\t\t\t\r\n\t\t\tsvals.appendChild(getRangeSymbolDOM());\r\n\t\t\tsvals.appendChild(secondip);\r\n\t\t}\r\n\t\tvar txt = self.showing_range ? \"Change to Simple Value\" : \"Change to Uncertain Range\";\r\n\t\tbut.innerText = txt;\r\n\t\tchangeHandler();\r\n\t});\r\n\tvar changeHandler = function(){\r\n\t\tif(self.showing_range && secondip.value){\r\n\t\t\tif(firstip.value) renderer.set(\"[\" + firstip.value + \",\" + secondip.value + \"]\");\t\t\t\t\r\n\t\t\telse renderer.set(secondip.value);\t\t\t\t\r\n\t\t}\r\n\t\telse {\r\n\t\t\trenderer.set(firstip.value);\r\n\t\t}\r\n\t}\r\n\tfirstip.addEventListener(\"change\", changeHandler);\r\n\tsecondip.addEventListener(\"change\", changeHandler);\r\n\treturn d;\r\n}\r\n\r\nfunction getRangeSymbolDOM(){\r\n\tvar d = document.createElement(\"span\");\r\n\td.setAttribute(\"class\", \"terminus-range-indicator\");\r\n\td.setAttribute(\"title\", \"The value is uncertain, it lies somewhere in this range\");\r\n\td.appendChild(document.createTextNode(\" ... \"));\r\n\treturn d;\r\n}\r\n\r\nmodule.exports={HTMLRangeEditor}\r\n","function SantizedHTMLViewer(options){\r\n\tthis.css = ((options && options.css) ? \"literal-value \" + options.css : \"literal-value\");\r\n}\r\n\r\nSantizedHTMLViewer.prototype.getDOM = function(renderer, dataviewer){\r\n\tvar val = renderer.value();\r\n\tvar input = document.createElement(\"span\");\r\n\tinput.setAttribute('class', this.css);\r\n\tinput.setAttribute('data-value', val);\r\n\tinput.innerHTML = val;\r\n\treturn input;\r\n}\r\n\r\nmodule.exports={SantizedHTMLViewer}\r\n","const HTMLPropertyViewer = require('./PropertyViewer');\r\nconst RenderingMap = require('./RenderingMap');\r\nconst HTMLDataViewer = require('./DataViewer');\r\n\r\nfunction ValueRenderer(dataframe, index, parent, options){\r\n\tthis.frame = dataframe;\r\n\tthis.index = index;\r\n\tthis.parent = parent;\r\n\tthis.originalValue = this.value();\r\n\tthis.renderer_type = \"value\";\r\n\tthis.options = this.setOptions(options);\r\n}\r\n\r\nValueRenderer.prototype.depth = function(){return (this.parent ? this.parent.depth() : false);};\r\nValueRenderer.prototype.property = function(){ return (this.parent ? this.parent.property() : false);};\r\nValueRenderer.prototype.subject = function(){ return (this.parent ? this.parent.subject() : false);};\r\nValueRenderer.prototype.subjectClass = function(){ return (this.parent ? this.parent.subjectClass() : false);};\r\nValueRenderer.prototype.type = function(){\treturn (this.frame ? this.frame.range : false);};\r\nValueRenderer.prototype.range = function(){\treturn (this.frame ? this.frame.range : false);};\r\nValueRenderer.prototype.value = function(){\treturn (this.frame ? this.frame.get() : false);};\r\nValueRenderer.prototype.isDocument = function(){\treturn (this.frame ? this.frame.isDocument() : false);};\r\nValueRenderer.prototype.currentViewer = function(){\treturn this.viewerType;}\r\n\r\nValueRenderer.prototype.copy = function(nf){\r\n\tvar nvr = new ValueRenderer(nf, false, this.parent, this.options);\r\n\tnvr.mode = this.mode;\r\n\tnvr.view = this.view;\r\n\treturn nvr;\r\n}\r\n\r\nValueRenderer.prototype.setFacet = function(facet){\r\n\tthis.facet = facet;\r\n\tthis.parent.redraw();\r\n}\r\n\r\nValueRenderer.prototype.parentFacetChange = function(pfacet){\r\n\tif(pfacet == \"page\") this.setFacet(\"page\");\r\n\tif(pfacet == \"multiline\") this.setFacet(\"line\");\r\n\tif(pfacet == \"line\") this.setFacet(\"inline\");\r\n\tif(pfacet == \"summary\") this.setFacet(\"icon\");\r\n}\r\n\r\nValueRenderer.prototype.getDefaultFacet = function(){\r\n\tif(this.parent.currentFacet() == \"page\" || this.parent.currentFacet() == \"multiline\"){\r\n\t\treturn \"line\";\r\n\t}\r\n\treturn \"inline\";\r\n}\r\n\r\nValueRenderer.prototype.getAvailableFacets = function(){\r\n\treturn Object.values(this.facets);\r\n}\r\n\r\nValueRenderer.prototype.getDefaultFacets = function(){\r\n\tvar defs = {\r\n\t\tpage: {\r\n\t\t\tlabel: \"Full Page\", value: \"page\",\r\n\t\t\tfeatures: [\"facet\", \"type\", \"cardinality\", \"body\", \"status\", \"facet\", \"viewer\", \"control\"],\r\n\t\t\tcontrols: [\"delete\", \"clone\", \"add\", \"reset\", \"cancel\", \"update\", \"mode\", \"show\", \"hide\"]\r\n\t\t},\r\n\t\tline: {\r\n\t\t\tlabel: \"Single Line\", value: \"line\",\r\n\t\t\tfeatures: [\"facet\", \"type\", \"cardinality\", \"body\", \"status\", \"facet\", \"viewer\", \"control\"],\r\n\t\t\tcontrols: [\"delete\", \"clone\", \"add\", \"reset\", \"cancel\", \"update\", \"mode\", \"show\", \"hide\"]\r\n\t\t},\r\n\t\tinline: {\r\n\t\t\tlabel: \"Inline\", value: \"inline\",\r\n\t\t\tfeatures: [\"facet\", \"type\", \"cardinality\", \"body\", \"status\", \"facet\", \"viewer\", \"control\"],\r\n\t\t\tcontrols: [\"delete\", \"clone\", \"add\", \"reset\", \"cancel\", \"update\", \"mode\", \"show\", \"hide\"]\r\n\t\t},\r\n\t\tlabel: {\r\n\t\t\tlabel: \"Label\", value: \"label\",\r\n\t\t\tfeatures: [\"facet\", \"status\", \"body\"],\r\n\t\t\tcontrols: []\r\n\t\t},\r\n\t\ticon: {\r\n\t\t\tlabel: \"Snippet\", value: \"icon\",\r\n\t\t\tfeatures: [\"facet\", \"summary\"],\r\n\t\t\tcontrols: []\r\n\t\t}\r\n\t}\r\n\treturn defs;\r\n}\r\n\r\nValueRenderer.prototype.currentFacet = function(){\r\n\treturn this.facet;\r\n}\r\n\r\nValueRenderer.prototype.setOptions = function(options){\r\n\treturn TerminusDashboard.RenderingMap.decorateRenderer(options, this);\r\n}\r\n\r\nValueRenderer.prototype.hideDisabledControls = function(){\r\n\treturn this.hide_disabled_controls;\r\n}\r\n\r\nValueRenderer.prototype.setMode = function(mode){\r\n\tthis.mode = mode;\r\n\tthis.options.mode = mode;\r\n\tthis.viewerType = false;\r\n\tthis.redraw();\r\n}\r\n\r\nValueRenderer.prototype.setView = function(view){\r\n\tthis.view = view;\r\n\tthis.options.view = view;\r\n\tthis.redraw();\r\n}\r\n\r\nValueRenderer.prototype.getAPIURL = function(a, b){\r\n\tif(this.parent && this.parent.parent){\r\n\t\tif(client = this.parent.parent.getClient()){\r\n\t\t\tvar apiurl = client.dbURL() + a + \"/\" + b;\r\n\t\t\treturn apiurl;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nValueRenderer.prototype.getClient = function(){\r\n\tif(this.parent && this.parent.parent){\r\n\t\treturn this.parent.parent.getClient();\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nValueRenderer.prototype.getController = function(){\r\n\tif(this.parent && this.parent.parent){\r\n\t\treturn this.parent.parent.getController();\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nValueRenderer.prototype.DBURL = function(){\r\n\tif(this.parent && this.parent.parent){\r\n\t\tif(client = this.parent.parent.getClient()){\r\n\t\t\treturn client.dbURL();\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nValueRenderer.prototype.getEntityReference = function(url, cls, entities, opts){\r\n\tif(this.parent && this.parent.parent){\r\n\t\tif(client = this.parent.parent.getClient()){\r\n\t\t\treturn client.getEntityReference(url, cls, entities, opts);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nValueRenderer.prototype.badData = function(bd){\r\n\talert(\"bad data \" + bd);\r\n}\r\n\r\nValueRenderer.prototype.setNew = function(){\r\n\tthis.new_value = true;\r\n}\r\n\r\nValueRenderer.prototype.isNew = function(){\r\n\tif(this.new_value){\r\n\t\treturn true;\r\n\t}\r\n\treturn this.parent.isNew();\r\n}\r\n\r\n\r\nValueRenderer.prototype.isUpdated = function(){\r\n\tif(this.frame.get() != this.originalValue){\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nValueRenderer.prototype.getSummary = function(){\r\n\tvar ret = { status: \"ok\" };\r\n\tif(this.isNew()) ret.status = \"new\";\r\n\telse if(this.isUpdated()) ret.status = \"updated\";\r\n\tvar val = this.frame.get();\r\n\tif(val){\r\n\t\tif(val.length && val.length > this.text_summary_length){\r\n\t\t\tret.long = val.substring(0, this.text_summary_length) + \"...\" + \" (\" + val.length + \" characters)\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tret.long = val;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tret.long = \"empty\";\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nValueRenderer.prototype.cardControlAllows = function(action){\r\n\tif(this.parent.cframe.hasRestriction()){\r\n\t\tvar rest = this.parent.cframe.restriction;\r\n\t\tvar currentnum = this.parent.values.length;\r\n\t\tif(action == \"add\" || action == \"clone\"){\r\n\t\t\tif(rest.max && currentnum >= rest.max){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(action == \"delete\" && (rest.min && currentnum <= rest.min)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nValueRenderer.prototype.set = function(v){\r\n\tthis.frame.set(v);\r\n\tthis.viewer.redrawHeader();\r\n\tthis.parent.childUpdated();\r\n}\r\n\r\nValueRenderer.prototype.delete = function(){\r\n\tthis.parent.deletePropertyValue(this.value(), this.index);\r\n\tthis.parent.parent.redraw();\r\n}\r\n\r\nValueRenderer.prototype.load = function(link){\r\n\tthis.parent.load(link);\r\n}\r\n\r\nValueRenderer.prototype.hide = function(){\r\n\tthis.setView(\"hidden\");\r\n}\r\n\r\nValueRenderer.prototype.show = function(){\r\n\tthis.setView(\"full\");\r\n}\r\n\r\nValueRenderer.prototype.cancel = function(){\r\n\tthis.reset();\r\n\tthis.setMode(\"view\");\r\n}\r\n\r\nValueRenderer.prototype.save = function(){\r\n\tif(this.parent) {\r\n\t\tthis.parent.save();\r\n\t}\r\n}\r\n\r\nValueRenderer.prototype.reset = function(){\r\n\tthis.set(this.originalValue);\r\n\tthis.redraw();\r\n}\r\n\r\nValueRenderer.prototype.clone = function(){\r\n\tvar newb = this.parent.addPropertyValue(this.value());\r\n\tvar nrend = this.copy(newb);\r\n\tnrend.setNew();\r\n\tnrend.mode = \"edit\";\r\n\tnrend.index = this.parent.values.length;\r\n\tthis.parent.values.push(nrend);\r\n\tthis.parent.childUpdated();\r\n\tthis.parent.redraw();\r\n\tthis.parent.goToValue(this.parent.values.length-1);\r\n}\r\n\r\nValueRenderer.prototype.getViewerForValue = function(){\r\n\treturn new HTMLDataViewer.HTMLDataViewer(this);\r\n}\r\n\r\nValueRenderer.prototype.getFeaturesForFacet = function(facet){\r\n\treturn this.facets[facet].features.concat(this.facets[facet].controls);\r\n}\r\n\r\nValueRenderer.prototype.showFeature = function(which){\r\n\tif(this.features.indexOf(which) == -1 && this.controls.indexOf(which) == -1) {\r\n\t\treturn false;\r\n\t}\r\n\tvar cardcontrols = [\"delete\", \"clone\", \"add\"];\r\n\tif(cardcontrols.indexOf(which) != -1){\r\n\t\tif(!this.cardControlAllows(which)) return false;\r\n\t}\r\n\tvar updcontrols = [\"update\", \"reset\"];\r\n\tif(this.hideDisabledControls() && updcontrols.indexOf(which) != -1 ){\r\n\t\tif(!this.isUpdated()){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\tif(which == 'hide' && this.view == \"hidden\") return false;\r\n\tif(which == 'show' && this.view != \"hidden\") return false;\r\n\tvar fets = this.getFeaturesForFacet(this.facet);\r\n\treturn (fets.indexOf(which) != -1);\r\n}\r\n\r\n\r\nValueRenderer.prototype.render = function(viewer){\r\n\tthis.viewer = (viewer ? viewer : this.getViewerForValue());\r\n\treturn this.viewer.render();\r\n}\r\n\r\nValueRenderer.prototype.extract = function(){\r\n\tvar val = this.value();\r\n\tif(val !== \"\" && val !== false){\r\n\t\tif(this.frame.isDatatypeProperty()){\r\n\t\t\tvar objlit = { \"@value\": this.value()}\r\n\t\t\t//var objlit = { data: this.value()}\r\n\t\t\tif(this.frame.isString()) objlit[\"@language\"] = this.frame.lang();\r\n\t\t\telse objlit[\"@type\"] = this.type();\r\n\t\t\treturn objlit;\r\n\t\t}\r\n\t\telse if(this.frame.isChoice() || this.frame.isDocument()){\r\n\t\t\treturn {\"@id\": val}\r\n\t\t}\r\n\t}\r\n\telse return val;\r\n}\r\n\r\nValueRenderer.prototype.getValueHeaderViewer = function(){\r\n\treturn new HTMLDataViewer.HTMLDataHeaderViewer();\r\n}\r\n\r\nValueRenderer.prototype.getDataValueViewer = function(){\r\n\tif(!this.viewerType) {\r\n\t\tthis.viewerType = this.getViewerForDataValue();\r\n\t}\r\n\treturn TerminusDashboard.RenderingMap.getViewer(this.viewerType, this.viewerOptions);\r\n}\r\n\r\nValueRenderer.prototype.getAvailableViewers = function(){\r\n\tvar dt = this.frame.getTypeShorthand();\r\n\tif(!dt){\r\n\t\t//alert(\"here\");\r\n\t}\r\n\tvar ft = this.frame.ftype();\r\n\tif(this.mode == \"view\"){\r\n\t\treturn TerminusDashboard.RenderingMap.getAvailableDataViewers(dt, ft);\r\n\t}\r\n\treturn TerminusDashboard.RenderingMap.getAvailableDataEditors(dt, ft);\r\n}\r\n\r\nValueRenderer.prototype.setViewer = function(viewer){\r\n\tthis.viewerType = viewer;\r\n\tthis.redraw();\r\n}\r\n\r\nValueRenderer.prototype.getViewerForDataValue = function(){\r\n\tvar dt = this.frame.getTypeShorthand();\r\n\tvar ft = this.frame.ftype();\r\n\tif(this.mode == \"edit\"){\r\n\t\treturn TerminusDashboard.RenderingMap.getEditorForDataFrame(dt, ft);\r\n\t}\r\n\treturn TerminusDashboard.RenderingMap.getViewerForDataFrame(dt, ft);\r\n}\r\n\r\nValueRenderer.prototype.redraw = function(){\r\n\tthis.viewer.clear();\r\n\tthis.render(this.viewer);\r\n}\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports=ValueRenderer\r\n","/*\r\n * User Interface elements dealing with database level functions - view, delete, create, db\r\n * view document etc\r\n */\r\nconst WOQLResultsViewer = require('../query/WOQLResultsViewer');\r\nconst TerminusClassChooser = require('./TerminusClassChooser');\r\nconst TerminusDocumentChooser = require('./TerminusDocumentChooser');\r\nconst WOQLQuery=require('../query/WOQLQuery')\r\nconst UTILS=require('../Utils')\r\n\r\n/*\r\n * User Interface elements dealing with database level functions - view, delete, create, db\r\n * view document etc\r\n */\r\nfunction TerminusDBController(ui){\r\n\t this.ui = ui;\r\n}\r\n\r\n/*\r\n * Controller provides access to the server level functions (create/delete db) and db-level functions (schema, query, document)\r\n */\r\nTerminusDBController.prototype.getAsDOM = function(){\r\n\tvar self = this;\r\n\tvar dbc = document.createElement(\"div\");\r\n\tdbc.setAttribute(\"class\", \"terminus-db-controller\");\r\n\tif(this.ui && this.ui.db()){\r\n\t\tvar scd = document.createElement(\"div\");\r\n\t\tscd.setAttribute(\"class\", \"terminus-field terminus-db-connection\");\r\n\t\tvar lab = document.createElement(\"span\");\r\n\t\tlab.setAttribute(\"class\", \"terminus-label terminus-db-label terminus-control-panel-label\");\r\n\t\tlab.appendChild(document.createTextNode(\"DB \"));\r\n\t\tvar val = document.createElement(\"span\");\r\n\t\tval.setAttribute(\"class\", \"terminus-value terminus-db-value terminus-control-panel-value\");\r\n\t\tvar dbrec = this.ui.client.connection.getDBRecord();\r\n\t\tvar nm = (dbrec && dbrec[\"rdfs:label\"] && dbrec[\"rdfs:label\"][\"@value\"] ? dbrec[\"rdfs:label\"][\"@value\"] : this.ui.db());\r\n\t\tval.appendChild(document.createTextNode(nm));\r\n\t\tscd.appendChild(lab);\r\n\t\tscd.appendChild(val);\r\n\t\t//dbc.appendChild(scd);\r\n\t\tvar nav = document.createElement('div');\r\n\t\tnav.setAttribute('class', 'span3');\r\n\t\tdbc.appendChild(nav);\r\n\t\tvar ul = document.createElement('ul');\r\n\t\tul.setAttribute('class','terminus-ul' );\r\n\t\tnav.appendChild(ul);\r\n\t\t// connected to db\r\n\t\tvar a = document.createElement('a');\r\n        a.setAttribute('class', 'terminus-dashboard-info terminus-list-group-a terminus-nav-width');\r\n        var txt = 'Database: ' + nm;\r\n        a.appendChild(document.createTextNode(txt));\r\n        ul.appendChild(a);\r\n\t\tif(this.ui.showControl(\"db\")){\r\n\t\t\tvar item = this.getControlHTML(\"Database Home\", \"fa-home\");\r\n\t\t\titem.classList.add(\"terminus-selected\");\r\n\t\t    item.addEventListener(\"click\", function(){\r\n\t\t\t\tUTILS.activateSelectedNav(this, self);\r\n\t\t\t\tself.ui.showDBMainPage();\r\n\t\t\t });\r\n\t        ul.appendChild(item);\r\n\t    }\r\n\t\tif(this.ui.showControl(\"delete_database\")){\r\n\t\t\tvar item = this.getControlHTML(\"Delete Database\", \"fa-trash-alt\");\r\n\t\t    item.addEventListener(\"click\", function(){\r\n\t\t\t\tUTILS.activateSelectedNav(this, self);\r\n\t\t\t\tself.ui.deleteDatabase();\r\n\t\t\t });\r\n\t        ul.appendChild(item);\r\n\t\t}\r\n\t\tif(this.ui.showControl(\"woql_select\")){\r\n\t\t\tvar item = this.getControlHTML(\"Query\", \"fa-search\");\r\n\t\t    item.addEventListener(\"click\", function(){\r\n\t\t\t\tUTILS.activateSelectedNav(this, self);\r\n\t\t\t\tself.ui.showQueryPage();\r\n\t\t\t});\r\n\t        ul.appendChild(item);\r\n\t\t}\r\n\t\tif(this.ui.showControl(\"woql_update\")){\r\n\t\t\tvar item = this.getControlHTML(\"Mapping\", \"fa-file-import\");\r\n\t        item.addEventListener(\"click\", function(){\r\n\t\t\t\tUTILS.activateSelectedNav(this, self);\r\n\t\t\t\tself.ui.showMappingPage();\r\n\t\t\t})\r\n\t        ul.appendChild(item);\r\n\t\t}\r\n\t\tif(this.ui.showControl(\"get_schema\")){\r\n\t\t\tvar item = this.getControlHTML(\"Schema\", \"fa-cog\");\r\n\t        item.addEventListener(\"click\", function(){\r\n\t\t\t\tUTILS.activateSelectedNav(this, self);\r\n\t\t\t\tself.ui.showSchemaPage();\r\n\t\t\t})\r\n\t        ul.appendChild(item);\r\n\t\t}\r\n\t\tif((this.ui.showControl(\"get_document\") || this.ui.showControl(\"create_document\"))){\r\n\t\t\tvar item = this.getControlHTML(\"Document\", \"fa-book\");\r\n\t        item.addEventListener(\"click\", function(){\r\n\t\t\t\tUTILS.removeSelectedNavClass(\"terminus-selected\");\r\n                this.classList.add(\"terminus-selected\");\r\n\t\t\t\tself.displayDocumentSubMenus();\r\n\t\t\t})\r\n\t        ul.appendChild(item);\r\n\t\t}\r\n\t\t// hidden submenus\r\n\t\tif(this.ui.showControl(\"get_document\")) {\r\n\t\t\tvar a = document.createElement('a');\r\n\t\t\ta.setAttribute('class', 'terminus-hide terminus-get-doc');\r\n\t\t\ta.appendChild(self.getDocumentChooserDOM());\r\n\t\t\ta.classList.add();\r\n\t\t\tul.appendChild(a);\r\n\t\t}\r\n\t\t// hidden submenus\r\n\t\tif(this.ui.showControl(\"create_document\")) {\r\n\t\t\tvar a = document.createElement('a');\r\n\t\t\ta.setAttribute('class', 'terminus-hide terminus-create-doc');\r\n\t\t\ta.appendChild(self.getDocumentCreatorDOM());\r\n\t\t\tul.appendChild(a);\r\n\t\t}\r\n\t}\r\n\treturn dbc;\r\n}\r\n\r\n\r\nTerminusDBController.prototype.getControlHTML = function(text, ic, css){\r\n    var self = this;\r\n    var a = document.createElement('a');\r\n\ta.setAttribute('class', 'terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n    var icon = document.createElement('i');\r\n    icon.setAttribute('class', 'terminus-menu-icon fa ' + ic);\r\n    a.appendChild(icon);\r\n    var txt = document.createTextNode(text);\r\n    a.appendChild(txt);\r\n    return a;\r\n}\r\n\r\nTerminusDBController.prototype.showSubMenus = function(el){\r\n\tel.classList.remove('terminus-hide');\r\n\tel.classList.add('terminus-display');\r\n}\r\n\r\nTerminusDBController.prototype.displayDocumentSubMenus = function(){\r\n\t//display submenus on click of documents\r\n\tif(this.ui.showControl(\"get_document\")) {\r\n\t\tvar gd = document.getElementsByClassName('terminus-get-doc');\r\n\t\tthis.showSubMenus(gd[0]);\r\n\t}\r\n\tif(this.ui.showControl(\"create_document\")) {\r\n\t\tvar cd = document.getElementsByClassName('terminus-create-doc');\r\n\t\tthis.showSubMenus(cd[0]);\r\n\t}\r\n}\r\n\r\n\r\nTerminusDBController.prototype.getDocumentChooserDOM = function(){\r\n\tvar self = this;\r\n\tvar scd = document.createElement(\"span\");\r\n\tscd.setAttribute(\"class\", \"terminus-document-chooser terminus-form-horizontal terminus-control-group terminus-choose-by-id\");\r\n\tvar lab = document.createElement(\"span\");\r\n\tlab.setAttribute(\"class\", \"terminus-document-chooser-label terminus-control-label terminus-control-label-padding\");\r\n\t//lab.appendChild(document.createTextNode(\"ID \"));\r\n\tvar dcip = document.createElement(\"input\");\r\n\tdcip.setAttribute(\"class\", \"terminus-form-doc-value terminus-document-chooser terminus-doc-input-text\");\r\n\tdcip.setAttribute(\"placeholder\", \"Enter Document ID\");\r\n\tvar nbut = document.createElement(\"button\");\r\n\tnbut.setAttribute('class', \"terminus-control-button terminus-document-button terminus-doc-btn\")\r\n\tnbut.appendChild(document.createTextNode(\"View\"));\r\n\tnbut.addEventListener(\"click\", function(){\r\n\t\tif(dcip.value) self.ui.showDocument(dcip.value);\r\n\t})\r\n\tif(this.ui.client.connectionConfig.platformEndpoint() && this.ui.pluginAvailable(\"select2\")){\r\n\r\n\t\tvar mcls = TerminusClient.FrameHelper.unshorten(\"tcs:Document\");\r\n\t\tvar d2ch = new TerminusDocumentChooser(this.ui, mcls);\r\n\t\td2ch.change = function(val){\r\n\t\t\tself.ui.showDocument(val);\r\n\t\t}\r\n\t\td2ch.view = \"label\";\r\n\t\tvar sdom = d2ch.getAsDOM('terminus-class-select');\r\n\t\tjQuery(dcip).hide();\r\n\t\tjQuery(nbut).hide();\r\n\t\tvar nlab = document.createElement(\"a\");\r\n\t\tnlab.setAttribute(\"href\", \"#\");\r\n\t\tnlab.setAttribute(\"class\", \"terminus-document-which-chooser\");\r\n\t\tnlab.appendChild(document.createTextNode(\"Choose by ID\"));\r\n\t\tvar show = \"label\";\r\n\t\tjQuery(nlab).click(function(){\r\n\t\t\tif(show == \"label\"){\r\n\t\t\t\tshow = \"id\";\r\n\t\t\t\tjQuery(dcip).show();\r\n\t\t\t\tjQuery(nbut).show();\r\n\t\t\t\tjQuery(sdom).hide();\r\n\t\t\t\tjQuery(nlab).text(\"Choose by Label\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tshow = \"label\";\r\n\t\t\t\tjQuery(dcip).hide();\r\n\t\t\t\tjQuery(nbut).hide();\r\n\t\t\t\tjQuery(sdom).show();\r\n\t\t\t\tjQuery(nlab).text(\"Choose by ID\");\r\n\t\t\t}\r\n\t\t})\r\n\t\tscd.appendChild(sdom);\r\n\t\tscd.prepend(nlab);\r\n\t}\r\n\tvar nbuts = document.createElement(\"span\");\r\n\tnbuts.setAttribute(\"class\", \"terminus-control-buttons terminus-document-chooser-buttons\");\r\n\tnbuts.appendChild(nbut);\r\n\tscd.appendChild(lab);\r\n\tscd.appendChild(dcip);\r\n\tscd.appendChild(nbuts);\r\n\treturn scd;\r\n};\r\n\r\nTerminusDBController.prototype.getDocumentCreatorDOM = function(){\r\n\tvar self = this;\r\n\tvar scd = document.createElement(\"div\");\r\n\tscd.setAttribute(\"class\", \"terminus-document-creator terminus-form-horizontal terminus-control-group terminus-choose-by-id\");\r\n\r\n\tvar dcip = document.createElement(\"input\");\r\n\tdcip.setAttribute(\"class\", \"terminus-form-doc-value terminus-document-creator terminus-doc-input-text\");\r\n\tdcip.setAttribute(\"placeholder\", \"Enter Document Type\");\r\n\tvar nbut = document.createElement(\"button\");\r\n\tvar lab = document.createElement(\"span\");\r\n\tlab.setAttribute(\"class\", \"document-creator-label terminus-control-label terminus-control-label-padding\");\r\n\t//lab.appendChild(document.createTextNode(\"Type \"));\r\n\tnbut.setAttribute('class', \"terminus-control-button create-document-button terminus-doc-btn\")\r\n\tnbut.appendChild(document.createTextNode(\"Create\"));\r\n\tnbut.addEventListener(\"click\", function(){\r\n\t\tif(dcip.value) self.ui.showCreateDocument(dcip.value);\r\n\t})\r\n\tvar nbuts = document.createElement(\"div\");\r\n\tnbuts.setAttribute(\"class\", \"terminus-control-buttons terminus-document-creator-buttons\");\r\n\tvar wq = new WOQLQuery(this.ui.client, {}, this.ui);\r\n\tvar filter = wq.getConcreteDocumentClassPattern(\"v:Element\");\r\n\tvar termcc = new TerminusClassChooser(this.ui, filter);\r\n\ttermcc.empty_choice = \"Create Document of Type\";\r\n\tvar self = this;\r\n\ttermcc.change = function(new_class){\r\n\t\tif(new_class){\r\n\t\t\tself.ui.showCreateDocument(new_class);\r\n\t\t\ttermcc.choice = false;\r\n\t\t}\r\n\t}\r\n\tvar tcdom = termcc.getAsDOM('terminus-class-select');\r\n\r\n\tvar gb = document.createElement('div');\r\n\tgb.setAttribute('class', 'terminus-doc-btn-group');\r\n\tvar bi = document.createElement('button');\r\n\tbi.setAttribute('class', 'terminus-doc-btn-selected');\r\n\tbi.appendChild((document.createTextNode('D')));\r\n\tvar bt = document.createElement('button');\r\n\tbt.appendChild((document.createTextNode('T')));\r\n\tgb.appendChild(bt);\r\n\tgb.appendChild(bi);\r\n\tvar nlabs = document.createElement(\"div\");\r\n\tnlabs.setAttribute('class', 'terminus-doc-btn-gp-align');\r\n\tnlabs.appendChild(gb);\r\n\tscd.appendChild(nlabs);\r\n\tvar ccDOM = document.createElement(\"span\");\r\n\tnlabs.appendChild(ccDOM);\r\n\tccDOM.setAttribute(\"class\", \"create-document-list\");\r\n\tccDOM.appendChild(tcdom);\r\n\tvar which = \"select\";\r\n\tbt.addEventListener(\"click\", function(){\r\n\t\t// create document of TerminusClient.FrameHelper.removeChildren(nlabs);\r\n\t\tTerminusClient.FrameHelper.removeChildren(ccDOM);\r\n\t\tUTILS.removeSelectedNavClass(\"terminus-doc-btn-selected\");\r\n\t\tthis.classList.add(\"terminus-doc-btn-selected\");\r\n\t\tccDOM.appendChild(dcip);\r\n\t\tccDOM.appendChild(nbut);\r\n\t});\r\n\r\n\tbi.addEventListener(\"click\", function(){\r\n\t\t// create document from dropdown\r\n\t\tTerminusClient.FrameHelper.removeChildren(ccDOM);\r\n\t\tUTILS.removeSelectedNavClass(\"terminus-doc-btn-selected\");\r\n\t\tthis.classList.add(\"terminus-doc-btn-selected\");\r\n\t\tccDOM.appendChild(tcdom);\r\n\t});\r\n\treturn scd;\r\n};\r\n\r\nfunction TerminusDBViewer(ui){\r\n\tthis.ui = ui;\r\n\tthis.wquery = new WOQLQuery(ui.client, this.options, ui);\r\n}\r\n\r\nTerminusDBViewer.prototype.getAsDOM = function(selected){\r\n\tvar pd = document.createElement(\"span\");\r\n\tpd.setAttribute(\"class\", \"terminus-db-home-page\");\r\n\tvar sth = document.createElement('div');\r\n\tvar banner = document.createElement('div');\r\n\t//pd.appendChild(banner);\r\n\tbanner.setAttribute('class', 'terminus-banner');\r\n\tvar dhp = document.createElement(\"span\");\r\n\tdhp.setAttribute('class', 'terminus-home-heading');\r\n\tdhp.appendChild(document.createTextNode(\"DB Home Page - \"));\r\n\tsth.appendChild(dhp);\r\n\tvar scd = document.createElement(\"span\");\r\n\tscd.setAttribute(\"class\", \"terminus-db-details\");\r\n\tvar scs = document.createElement(\"span\");\r\n\tscs.setAttribute(\"class\", \"terminus-db-details-value \");\r\n\tvar dbrec = this.ui.getDBRecord();\r\n\tif(dbrec){\r\n\t\tvar nm = (dbrec[\"rdfs:label\"] && dbrec[\"rdfs:label\"][\"@value\"] ? dbrec[\"rdfs:label\"][\"@value\"] : this.db);\r\n\t\tscs.appendChild(document.createTextNode(nm));\r\n\t\tscs.setAttribute('class', 'terminus-home-heading');\r\n\t}\r\n\tscd.appendChild(scs);\r\n\tsth.appendChild(scd);\r\n\tbanner.appendChild(sth);\r\n\t//pd.appendChild(sth);\r\n\t//pd.appendChild(UTILS.getHeaderDom('Summary'));\r\n\tthis.getDeleteOnHomePage(pd);\r\n\tthis.getDBSummary(pd);\r\n\tpd.appendChild(pd.appendChild(UTILS.getHeaderDom('List of Documents')));\r\n\tthis.getClassesDOM(pd);\r\n\treturn pd;\r\n}\r\n\r\nTerminusDBViewer.prototype.getDbInfoBox = function(r, module){\r\n\tvar sp = document.createElement('span');\r\n    sp.setAttribute('class', 'terminus-db-info-box');\r\n\tvar info = document.createElement('div');\r\n\tinfo.appendChild(document.createTextNode(module.charAt(0).toUpperCase() + module.slice(1)));\r\n\tinfo.setAttribute('class', 'terminus-db-info');\r\n\tsp.appendChild(info);\r\n\r\n    var i = document.createElement('i');\r\n\tswitch(module){\r\n\t\tcase 'size':\r\n\t\t\ti.setAttribute('class', 'terminus-icon fa fa-balance-scale');\r\n\t\t    var txt = document.createTextNode('2 Gb');\r\n\t\tbreak;\r\n\t\tcase 'created':\r\n\t\t\ti.setAttribute('class', 'terminus-icon fa fa-calendar');\r\n\t\t    var txt = document.createTextNode('16 July 2015');\r\n\t\tbreak;\r\n\t\tcase 'modified':\r\n\t\t\ti.setAttribute('class', 'terminus-icon fa fa-clock');\r\n\t\t    var txt = document.createTextNode('22 Dec 2019');\r\n\t\tbreak;\r\n\t}\r\n    sp.appendChild(i);\r\n\tif(txt) sp.appendChild(txt);\r\n    r.appendChild(sp);\r\n}\r\n\r\nTerminusDBViewer.prototype.getDeleteOnHomePage = function(d){\r\n\t// delete database\r\n    var del = document.createElement('button');\r\n    del.setAttribute('class', 'terminus-del-btn');\r\n    del.setAttribute('type', 'button');\r\n    del.innerHTML = 'Delete Database';\r\n\tvar dbrec = this.ui.getDBRecord();\r\n\tif(dbrec)\r\n\t\tvar nm = (dbrec[\"rdfs:label\"] && dbrec[\"rdfs:label\"][\"@value\"] ? dbrec[\"rdfs:label\"][\"@value\"] : this.db);\r\n    var self = this;\r\n    del.addEventListener(\"click\", function(){\r\n      self.ui.deleteDatabase(nm);\r\n    });\r\n    d.appendChild(del);\r\n}\r\n\r\nTerminusDBViewer.prototype.getDBSummary = function(d){\r\n    var r = document.createElement('span');\r\n    r.setAttribute('class', 'terminus-db-info-box-display');\r\n    d.appendChild(r);\r\n\r\n    /* getDbInfoBox() calls can change according to further requirments */\r\n    this.getDbInfoBox(r, 'size');\r\n    this.getDbInfoBox(r, 'created');\r\n    this.getDbInfoBox(r, 'modified');\r\n}\r\n\r\nTerminusDBViewer.prototype.getClassesDOM = function(d){\r\n\tvar q = this.wquery.getClassesQuery();\r\n\tvar self = this;\r\n\tthis.wquery.execute(q)\r\n\t.then(function(result){\r\n\t\tself.result = new WOQLResultsViewer.WOQLResultsViewer(self.ui, result, {}, {});\r\n\t\tif(self.result){\r\n\t\t\tvar nd = self.result.getAsDOM(d, false);\r\n\t\t\tif(nd){\r\n\t\t\t\tnd.setAttribute('class', 'terminus-margin-box');\r\n\t        }\r\n\t\t\telse d.appendChild(document.createTextNode(\"No results returned\"));\r\n\t\t}\r\n\t})\r\n\t.catch(function(err){\r\n\t\tconsole.error(err);\r\n\t\tself.ui.showError(err);\r\n\t});\r\n\treturn d;\r\n}\r\n\r\n\r\nfunction TerminusDBCreator(ui){\r\n\tthis.ui = ui;\r\n}\r\n\r\nTerminusDBCreator.prototype.getAsDOM = function(selected){\r\n\tvar scd = document.createElement(\"div\");\r\n\t/* test delete when over var txtHolder = document.createElement(\"div\");\r\n\ttxtHolder.appendChild(document.createTextNode('expecting laoder herer'));\r\n\tscd.appendChild(txtHolder);\r\n\tthis.ui.getLoader(scd);*/\r\n\tscd.setAttribute(\"class\", \"terminus-db-creator\");\r\n\tvar sct = document.createElement(\"h3\");\r\n\tsct.setAttribute(\"class\", \"terminus-db-creator-title terminus-module-head\");\r\n\tsct.appendChild(document.createTextNode(\"Create New Database\"));\r\n\tscd.appendChild(sct);\r\n\tvar mfd = document.createElement('div');\r\n\tmfd.setAttribute('class', 'terminus-form-border');\r\n\tscd.appendChild(mfd);\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-form-field-spacing terminus-form-horizontal terminus-control-group\");\r\n\tvar slab = document.createElement(\"span\");\r\n\tslab.setAttribute(\"class\", \"terminus-id-label terminus-form-label terminus-control-label\");\r\n\tslab.appendChild(document.createTextNode(\"ID\"));\r\n\tsci.appendChild(slab);\r\n\tvar idip = document.createElement(\"input\");\r\n\tidip.setAttribute(\"type\", \"text\");\r\n\tidip.setAttribute(\"class\", \"terminus-form-value terminus-input-text\");\r\n\tidip.setAttribute(\"placeholder\", \"No spaces or special characters allowed in IDs\");\r\n\tsci.appendChild(idip);\r\n\tmfd.appendChild(sci);\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-form-field-spacing terminus-form-horizontal terminus-control-group\");\r\n\tvar slab = document.createElement(\"span\");\r\n\tslab.setAttribute(\"class\", \"terminus-title-label terminus-form-label terminus-control-label\");\r\n\tslab.appendChild(document.createTextNode(\"Title\"));\r\n\tvar titip = document.createElement(\"input\");\r\n\ttitip.setAttribute(\"type\", \"text\");\r\n\ttitip.setAttribute(\"placeholder\", \"A brief title for the Database\");\r\n\ttitip.setAttribute(\"class\", \"terminus-form-value terminus-input-text\");\r\n\tsci.appendChild(slab);\r\n\tsci.appendChild(titip);\r\n\tmfd.appendChild(sci);\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-form-field-spacing terminus-form-horizontal terminus-control-group\");\r\n\tvar slab = document.createElement(\"span\");\r\n\tslab.setAttribute(\"class\", \"terminus-title-label terminus-form-label terminus-control-label\");\r\n\tslab.appendChild(document.createTextNode(\"Description\"));\r\n\tsci.appendChild(slab);\r\n\tvar descip = document.createElement(\"textarea\");\r\n\tdescip.setAttribute(\"class\", \"terminus-textarea terminus-db-description terminus-textarea \");\r\n\tdescip.setAttribute(\"placeholder\", \"A short text describing the database and its purpose\");\r\n\tsci.appendChild(descip);\r\n\tmfd.appendChild(sci);\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-form-field-spacing terminus-form-horizontal terminus-control-group\");\r\n\tvar slab = document.createElement(\"span\");\r\n\tslab.setAttribute(\"class\", \"terminus-schema-label terminus-form-label terminus-control-label\");\r\n\tslab.appendChild(document.createTextNode(\"Import Schema\"));\r\n\tsci.appendChild(slab);\r\n\tvar schem = document.createElement(\"input\");\r\n\tschem.setAttribute(\"placeholder\", \"Terminus DB URL\");\r\n\tschem.setAttribute(\"type\", \"text\");\r\n\tschem.setAttribute(\"class\", \"terminus-form-value terminus-form-url terminus-input-text\");\r\n\r\n\tsci.appendChild(schem);\r\n\tmfd.appendChild(sci);\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-form-field-spacing terminus-form-horizontal terminus-control-group\");\r\n\tvar slab = document.createElement(\"span\");\r\n\tslab.setAttribute(\"class\", \"terminus-data-label terminus-form-label terminus-control-label\");\r\n\tslab.appendChild(document.createTextNode(\"Import Data\"));\r\n\tsci.appendChild(slab);\r\n\tvar datip = document.createElement(\"input\");\r\n\tdatip.setAttribute(\"type\", \"text\");\r\n\tdatip.setAttribute(\"placeholder\", \"Terminus DB URL\");\r\n\tdatip.setAttribute(\"class\", \"terminus-form-value terminus-form-url terminus-input-text\");\r\n\tsci.appendChild(datip);\r\n\t//mfd.appendChild(sci);\r\n\tvar butfield = document.createElement(\"div\");\r\n\tbutfield.setAttribute(\"class\", \"terminus-control-buttons\");\r\n\tvar cancbut = document.createElement(\"button\");\r\n\tcancbut.setAttribute(\"class\", \"terminus-control-button terminus-cancel-db-button terminus-btn\");\r\n\tcancbut.appendChild(document.createTextNode(\"Cancel\"));\r\n\tvar loadbut = document.createElement(\"button\");\r\n\tloadbut.setAttribute(\"class\", \"terminus-control-button terminus-create-db-button terminus-btn\");\r\n\tloadbut.appendChild(document.createTextNode(\"Create\"));\r\n\tvar self = this;\r\n\tvar gatherips = function(){\r\n\t\tvar input = {};\r\n\t\tinput.id = idip.value;\r\n\t\tinput.title = titip.value;\r\n\t\tinput.description = descip.value;\r\n\t\tinput.schema = schem.value;\r\n\t\tinput.data = datip.value;\r\n\t\treturn input;\r\n\t}\r\n\tvar self = this;\r\n\tloadbut.addEventListener(\"click\", function(){\r\n\t\tvar input = gatherips();\r\n\t\tself.ui.createDatabase(input);\r\n\t})\r\n\tcancbut.addEventListener(\"click\", function(){\r\n\t\tself.ui.showServerMainPage();\r\n\t})\r\n\tbutfield.appendChild(cancbut);\r\n\tbutfield.appendChild(loadbut);\r\n\tmfd.appendChild(butfield);\r\n\r\n\treturn scd;\r\n}\r\nmodule.exports={TerminusDBViewer:TerminusDBViewer,\r\n\t            TerminusDBController:TerminusDBController,\r\n\t            TerminusDBCreator:TerminusDBCreator}\r\n","function TerminusViolations(vios, ui){\r\n\tthis.ui = ui;\r\n\tthis.vios = [];\r\n\tvar nvios = [];\r\n\tfor(var i = 0; i<vios.length; i++){\r\n\t\tfor(var j = 0; j<nvios.length; j++){\r\n\t\t\tif(JSON.stringify(vios[i]) == JSON.stringify(nvios[j])) continue;\r\n\t\t}\r\n\t\tnvios.push(vios[i]);\r\n\t}\r\n\tfor(var i = 0; i<nvios.length; i++){\r\n\t\tthis.vios.push(new TerminusViolation(nvios[i], this.ui));\r\n\t}\t\r\n} \r\n\r\nTerminusViolations.prototype.getAsDOM = function(context_msg){\r\n\tvar vdom = document.createElement(\"div\");\r\n\tvdom.setAttribute(\"class\", \"terminus-violations\");\r\n\tvar msg = this.vios.length + (this.vios.length > 1 ? \" Violations Detected\" : \" Violation Detected\");\r\n\tif(context_msg) msg += \" \" + context_msg;\r\n\tvdom.appendChild(document.createTextNode(msg));\r\n\tfor(var i = 0; i<this.vios.length; i++){\r\n\t\tvdom.appendChild(this.vios[i].getAsDOM());\r\n\t}\r\n\treturn vdom;\r\n}\r\n\r\n/*\r\n * Class for displaying violation reports as HTML\r\n */\r\nfunction TerminusViolation(vio, ui){\r\n\tthis.ui = ui;\r\n\tthis.vio = vio;\r\n} \r\n\r\nTerminusViolation.prototype.getAsDOM = function(){\r\n\tvar vdom = document.createElement(\"div\");\r\n\tvdom.setAttribute(\"class\", \"terminus-violation\");\r\n\tif(this.vio['@type']){\r\n\t\tvar msg = this.vio['vio:message'] || {\"@value\": \"\"};\r\n\t\tvdom.appendChild(this.getPropertyAsDOM(this.vio[\"@type\"], msg));\r\n\t}\r\n\tfor(var prop in this.vio){\r\n\t\tif(prop != \"vio:message\" && prop != \"@type\"){\r\n\t\t\tvdom.appendChild(this.getPropertyAsDOM(prop, this.vio[prop]));\r\n\t\t}\r\n\t}\r\n\treturn vdom;\r\n}\r\n\r\nTerminusViolation.prototype.getPropertyAsDOM = function(prop, val){\r\n\tvar pdom = document.createElement(\"div\");\r\n\tpdom.setAttribute(\"class\", \"terminus-violation-property\");\r\n\tvar ldom = document.createElement(\"span\");\r\n\tldom.setAttribute(\"class\", \"terminus-label terminus-violation-property-label\");\r\n\tldom.appendChild(document.createTextNode(prop));\r\n\tvar vdom = document.createElement(\"span\");\r\n\tvdom.setAttribute(\"class\", \"terminus-violation-property-value\");\r\n\tvdom.appendChild(document.createTextNode(val[\"@value\"]));\r\n\tpdom.appendChild(ldom);\r\n\tpdom.appendChild(vdom);\r\n\treturn pdom;\r\n}\r\n\r\nmodule.exports=TerminusViolations\r\n","const WOQLQuery = require('../query/WOQLQuery');\r\nconst WOQLResultsViewer = require('../query/WOQLResultsViewer');\r\nconst WOQLTextboxGenerator = require('../query/WOQLTextboxGenerator');\r\nconst WOQLGraphBrowserGenerator = require('../query/WOQLGraphBrowserGenerator');\r\nconst TerminusPluginManager = require('../plugins/TerminusPlugin');\r\n\r\nfunction TerminusQueryViewer(ui, options){\r\n\tthis.ui = ui;\r\n\tthis.options = options;\r\n\tthis.meta = {};\r\n\tthis.init();\r\n\tthis.generator = false;\r\n\tthis.result = false;\r\n\tthis.wquery = new WOQLQuery(ui.client, this.options, this.ui);\r\n\tthis.pman = new TerminusPluginManager();\r\n\tthis.gentype = (options && options.generator ? options.generator : \"textbox\");\r\n\tthis.generators = {\r\n\t\t\"textbox\" : { label: \"Simple Text Box\", value: \"textbox\"},\r\n\t}\r\n\tif(ui.pluginAvailable(\"jqueryui\")){\r\n\t\tthis.generators.gbrowse = { label: \"Graph Browser\", value: \"gbrowse\"};\r\n\t}\r\n\tthis.loadGenerator();\r\n}\r\n\r\nTerminusQueryViewer.prototype.hasGeneratorOptions = function(){\r\n\treturn false;\r\n\tvar yup = false;\r\n\tfor(var gen in this.generators){\r\n\t\tif(yup) return true;\r\n\t\telse yup = true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nTerminusQueryViewer.prototype.changeGenerator = function(ng){\r\n\tif(this.gentype != ng){\r\n\t\tthis.gentype = ng;\r\n\t\tthis.loadGenerator();\r\n\t\tthis.redrawGenerator();\r\n\t}\r\n}\r\nTerminusQueryViewer.prototype.redrawGenerator = function(q){\r\n\tTerminusClient.FrameHelper.removeChildren(this.inputDOM);\r\n\tthis.inputDOM.appendChild(this.getQueryButtonsDOM(q));\r\n}\r\n\r\nTerminusQueryViewer.prototype.loadGenerator = function(){\r\n\tvar self = this;\r\n\tvar nquery = function(q, settings){\r\n\t\tself.query(q, settings)\r\n\t}\r\n\tif(this.gentype == \"textbox\"){\r\n\t\tthis.generator = new WOQLTextboxGenerator(nquery, this, this.ui);\r\n\t}\r\n\telse if(this.gentype == \"gbrowse\"){\r\n\t\tthis.generator = new WOQLGraphBrowserGenerator(nquery, this, this.ui);\r\n\t}\r\n}\r\n\r\nTerminusQueryViewer.prototype.init = function(){\r\n\tvar wq = new WOQLQuery(this.ui.client, this.options, this.ui);\r\n\tvar woql = wq.getElementMetaDataQuery();\r\n\tvar self = this;\r\n\tself.meta = {};\r\n\twq.execute(woql).then(function(wresult){\r\n\t\tvar wqlR = new WOQLResultsViewer.WOQLResult(wresult, null ,null, self.ui);\r\n\t\tif(wqlR.hasBindings(wresult)){\r\n\t\t\tfor(var i = 0; i<wresult.bindings.length; i++){\r\n\t\t\t\tvar el = wresult.bindings[i].Element;\r\n\t\t\t\tif(el && typeof self.meta[el] == \"undefined\"){\r\n\t\t\t\t\tself.meta[el] = wresult.bindings[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\t.catch(function(e){\r\n\t\tconsole.error(e);\r\n\t});\r\n}\r\n\r\n\r\nTerminusQueryViewer.prototype.query = function(val, settings, tab){\r\n\tvar self = this;\r\n\tTerminusClient.FrameHelper.removeChildren(this.resultDOM);\r\n\tthis.wquery.execute(val)\r\n\t.then(function(result){\r\n\t\tconsole.log(' this.ui term qu /////////////' ,  self.ui);\r\n\t\tself.result = new WOQLResultsViewer.WOQLResultsViewer(self.ui, result, self.options, settings);\r\n\t\tvar nd = self.result.getAsDOM(self.resultDOM, true);\r\n\t\tif(nd){\r\n\t\t\t self.resultDOM.appendChild(nd);\r\n\t\t}\r\n\t})\r\n\t.catch(function(err){\r\n\t\tself.ui.showError(err);\r\n\t});\r\n}\r\n\r\nTerminusQueryViewer.prototype.getResultViewDom = function(){\r\n\tthis.resultDOM = document.createElement(\"div\");\r\n\tthis.resultDOM.setAttribute(\"class\", \"terminus-query-results\");\r\n}\r\n\r\nTerminusQueryViewer.prototype.getAsDOM = function(q){\r\n\tvar qbox = document.createElement(\"div\");\r\n\tqbox.setAttribute(\"class\", \"terminus-query-page\");\r\n\tif(this.hasGeneratorOptions()){\r\n\t\tqbox.appendChild(this.getQueryCreatorChoiceDOM(q));\r\n\t}\r\n\tthis.resultDOM = document.createElement(\"div\");\r\n\tthis.resultDOM.setAttribute(\"class\", \"terminus-query-results terminus-query-section\");\r\n\r\n\tvar qtHolder = document.createElement('span');\r\n\tqtHolder.setAttribute('style', 'display: flex;');\r\n\r\n\tthis.qTextBox = this.getQueryTextAreaDOM(q, qtHolder);\r\n\tthis.buttonsDOM = document.createElement(\"span\");\r\n\tthis.buttonsDOM.setAttribute(\"class\", \"terminus-query-input\");\r\n\tthis.buttonsDOM.appendChild(this.getQueryButtonsDOM(q, this.qTextBox));\r\n\r\n\tqtHolder.appendChild(this.buttonsDOM);\r\n\r\n\tqbox.appendChild(qtHolder);\r\n\tqbox.appendChild(this.resultDOM);\r\n\treturn qbox;\r\n}\r\n\r\nTerminusQueryViewer.prototype.getQueryCreatorChoiceDOM = function(){\r\n\tvar qcc = document.createElement(\"select\");\r\n\tqcc.setAttribute(\"class\", \"terminus-query-generator-selector\");\r\n\tfor(var c in this.generators){\r\n\t\tvar gen = this.generators[c];\r\n\t\tvar opt = document.createElement(\"option\");\r\n\t\topt.value = (gen.value ? gen.value : c);\r\n\t\tvar lab = (gen.label ? gen.label : c);\r\n\t\topt.appendChild(document.createTextNode(lab));\r\n\t\tqcc.appendChild(opt);\r\n\t}\r\n\tvar self = this;\r\n\tqcc.addEventListener(\"change\", function(){\r\n\t\tself.changeGenerator(this.value);\r\n\t});\r\n\treturn qcc;\r\n}\r\n\r\nTerminusQueryViewer.prototype.getQueryButtonsDOM = function(q, qip){\r\n\treturn this.generator.getAsDOM(q, qip);\r\n}\r\n\r\nTerminusQueryViewer.prototype.getQueryTextAreaDOM = function(q, box){\r\n\treturn this.generator.getQueryTextAreaDOM(q, box);\r\n}\r\n\r\nmodule.exports=TerminusQueryViewer\r\n","const TerminusClassChooser = require('../client/TerminusClassChooser');\r\nconst TerminusPropertyChooser = require('../client/TerminusPropertyChooser');\r\nconst TerminusDocumentChooser = require('../client/TerminusDocumentChooser');\r\nconst UTILS= require('../Utils')\r\n\r\nfunction WOQLTextboxGenerator(tq, qman, ui){\r\n\tthis.query = tq;\r\n\tthis.wquery = qman.wquery;\r\n\tthis.ui = ui;\r\n\t// default datatable settings if datatable plug in available\r\n\tthis.datatable = {};\r\n\tthis.datatable.pageLength = 25;\r\n\tthis.datatable.start = 0;\r\n}\r\n\r\nWOQLTextboxGenerator.prototype.gatherDatatableSettings = function(txtArea, queryName){\r\n\tthis.datatable.qTextDom =  txtArea;\r\n\tthis.datatable.query =  queryName;\r\n\tthis.datatable.chosenValue = null;\r\n}\r\n\r\nWOQLTextboxGenerator.prototype.getQueryButtonGroups = function(qbox){\r\n\tvar row = document.createElement('div');\r\n\trow.setAttribute('class', 'terminus-query-group-row');\r\n\tqbox.appendChild(row);\r\n\treturn row;\r\n}\r\n\r\nWOQLTextboxGenerator.prototype.qGroupQueries = function(qrow, header, descr){\r\n\tvar g = document.createElement('button');\r\n\tvar self = this;\r\n\tg.addEventListener('click', function(e){\r\n\t\tself.ui.clearMessages();\r\n\t\tif(header == 'Data Queries'){ // to ensure click event is not on button but on select instead so no need to hide\r\n\t\t\tvar target = e.target || e.srcElement,\r\n        \ttext = target.textContent || target.innerText;\r\n\t\t\tif((target.nodeName == 'SELECT')) return;\r\n\t\t}\r\n\t\telse if(header == 'Document Queries'){\r\n\t\t\tvar target = e.target || e.srcElement,\r\n        \ttext = target.textContent || target.innerText;\r\n\t\t\tif((target.nodeName == 'INPUT')) return;\r\n\t\t}\r\n\t\tfor(var i=0; i<this.children.length ; i++){\r\n\t\t\tUTILS.toggleVisibility(this.children[i]);\r\n\t\t}\r\n\t\tvar qeb = document.getElementsByClassName('query-example-buttons');\r\n\t\tfor(var i=0; i<qeb.length ; i++){\r\n\t\t\tif(this != qeb[i]){\r\n\t\t\t\tfor(var j=0; j<qeb[i].children.length ; j++){\r\n\t\t\t\t\tif(qeb[i].children[j].classList.contains('terminus-display')){\r\n\t\t\t\t\t\tqeb[i].children[j].classList.remove('terminus-display');\r\n\t\t\t\t\t\tqeb[i].children[j].classList.add('terminus-hide');\r\n\t\t\t\t    }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\tg.setAttribute('class', 'terminus-group-box terminus-pointer query-example-buttons');\r\n\r\n\tvar cd = document.createElement('div');\r\n\tcd.setAttribute('class', 'terminus-group');\r\n\tg.appendChild(cd);\r\n\r\n\tvar ch = document.createElement('div');\r\n\tch.setAttribute('class', 'terminus-group-header');\r\n\tcd.appendChild(ch);\r\n\r\n\tvar d = document.createElement('div');\r\n\td.setAttribute('class', 'terminus-query-block-headers')\r\n\td.appendChild(document.createTextNode(header));\r\n\tch.appendChild(d);\r\n\tic = document.createElement('i');\r\n    ic.setAttribute('class', 'terminus-hand-pointer-float fa fa-hand-pointer');\r\n\td.appendChild(ic);\r\n\r\n\tvar t = document.createElement('h5');\r\n\tt.setAttribute('class', 'terminus-group-sub-title terminus-hide');\r\n\tt.appendChild(document.createTextNode(descr));\r\n\tg.appendChild(t);\r\n\r\n\tqrow.appendChild(g);\r\n\r\n\treturn g;\r\n}\r\n\r\nWOQLTextboxGenerator.prototype.setDatatableSettings = function(query){\r\n\tif(query.limit){\r\n\t\tthis.datatable.pageLength = query.limit[0];\r\n\t\tthis.datatable.start = query.limit[1].start[0];\r\n\t}\r\n\t/*\r\n\tvar newQuery = query.replace(/\\s/g,'');  // remove spaces\r\n\tvar searchStr = 'limit(';\r\n\tif(newQuery.indexOf(searchStr) !== -1){\r\n\t\tvar remString = newQuery.substring(searchStr.length, newQuery.length);\r\n\t\tvar limit = remString.substr(0, remString.indexOf(','));\r\n\t\tthis.datatable.pageLength = limit;\r\n\t\tthis.datatable.start = 0;\r\n\t}*/\r\n}\r\n\r\nWOQLTextboxGenerator.prototype.getQueryTextAreaDOM = function(q, box){\r\n\tvar qbox = document.createElement(\"span\");\r\n\tqbox.setAttribute(\"class\", \"terminus-query-textbox-input terminus-query-section\");\r\n\r\n\tvar eqh = document.createElement(\"H3\");\r\n\teqh.appendChild(document.createTextNode(\"Enter Query\"));\r\n\teqh.setAttribute('class', 'terminus-full-css-margin-top terminus-module-head');\r\n\tqbox.appendChild(eqh);\r\n\r\n\tvar qip = document.createElement(\"textarea\");\r\n\tqip.setAttribute(\"class\", \"terminus-query-box\");\r\n\tqip.setAttribute(\"placeholder\", \"Enter new query or load queries from example buttons provided below ...\");\r\n\tqip.setAttribute(\"style\", \"min-width: 400px; min-height: 60px;\");\r\n\tif(q) qip.value = JSON.stringify(q);\r\n\tqbox.appendChild(qip);\r\n\tUTILS.stylizeEditor(this.ui, qip, 'query', 'javascript');\r\n\tvar self = this;\r\n\tvar qbut = document.createElement(\"button\");\r\n\tqbut.setAttribute(\"class\", \"terminus-control-button terminus-btn\")\r\n\tqbut.appendChild(document.createTextNode(\"Send Query\"));\r\n\tqbut.addEventListener(\"click\", function(){\r\n\t\tself.ui.clearMessages();\r\n\t\ttry {\r\n\t\t\tvar qval = JSON.parse(qip.value);\r\n\t\t\tif(self.ui.pluginAvailable(\"datatables\")){\r\n\t\t\t\t// pass current Example query scope while editing the text editor\r\n\t\t\t\tself.gatherDatatableSettings(qip, self.datatable.query);\r\n\t\t\t\tself.setDatatableSettings(qval);\r\n\t\t\t\tself.query(qval, self.datatable);\r\n\t\t\t}\r\n\t\t\telse self.query(qval);\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\talert(\"Failed to parse Query \" + e.toString());\r\n\t\t}\r\n\t})\r\n\tqbox.appendChild(qbut);\r\n\tbox.appendChild(qbox);\r\n\treturn qip;\r\n}\r\n\r\nWOQLTextboxGenerator.prototype.getAsDOM = function(q, qip){\r\n\tvar qbox = document.createElement(\"div\");\r\n\tqbox.setAttribute(\"class\", \"terminus-query-textbox-input\");\r\n\tvar qbuts = document.createElement(\"div\");\r\n\tqbuts.setAttribute(\"class\", \"terminus-control-buttons\");\r\n\t//qbuts.appendChild(qbut);\r\n\tqbox.appendChild(qbuts);\r\n\tvar qexs = document.createElement(\"div\");\r\n\tqexs.setAttribute(\"class\", \"terminus-query-examples terminus-db-list-title\");\r\n\tvar qh = document.createElement(\"H3\");\r\n\tqh.appendChild(document.createTextNode(\"Saved Queries\"));\r\n\tqh.setAttribute('class', 'terminus-full-css-margin-top terminus-module-head');\r\n\tqexs.appendChild(qh);\r\n\r\n\tvar qrow = this.getQueryButtonGroups(qexs);\r\n\tqexs.appendChild(qrow);\r\n\r\n\t/* grouping class queries */\r\n\tvar qcGroup = this.qGroupQueries(qrow, 'Schema Queries', '');\r\n\r\n\tvar nqbut = document.createElement(\"button\");\r\n\tnqbut.appendChild(document.createTextNode(\"Show All Classes\"));\r\n\tnqbut.setAttribute(\"class\", \"terminus-control-button terminus-q-btn\");\r\n\tnqbut.addEventListener(\"click\", function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tUTILS.deleteStylizedEditor(self.ui, qip);\r\n\t\tvar qval = self.wquery.getClassMetaDataQuery(null, self.datatable.pageLength, self.datatable.start);\r\n\t\tqip.value = JSON.stringify(qval);\r\n\t\tUTILS.stylizeEditor(self.ui, qip, 'query', 'javascript');\r\n\t\tif(self.ui.pluginAvailable(\"datatables\")){\r\n\t\t\tself.gatherDatatableSettings(qip, 'Show_All_Classes');\r\n\t\t\tself.query(qval, self.datatable);\r\n\t\t}\r\n\t\telse self.query(qval);\r\n\t})\r\n\r\n\tvar aqbut = document.createElement(\"button\");\r\n\taqbut.appendChild(document.createTextNode(\"Show Document Classes\"));\r\n\taqbut.setAttribute(\"class\", \"terminus-control-button terminus-q-btn\");\r\n\taqbut.addEventListener(\"click\", function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tUTILS.deleteStylizedEditor(self.ui, qip);\r\n\t\tvar qvalue = self.wquery.getClassMetaDataQuery(self.wquery.getConcreteDocumentClassPattern(),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.datatable.pageLength, self.datatable.start);\r\n\t\tqip.value = JSON.stringify(qvalue);\r\n\t\tUTILS.stylizeEditor(self.ui, qip, 'query', 'javascript');\r\n\t\tif(self.ui.pluginAvailable(\"datatables\")){\r\n\t\t\tself.gatherDatatableSettings(qip, 'Show_Document_Classes');\r\n\t\t\tself.query(qvalue, self.datatable);\r\n\t\t}\r\n\t\telse self.query(qvalue);\r\n\t})\r\n\r\n\tvar ebut = document.createElement(\"button\");\r\n\tebut.appendChild(document.createTextNode(\"Show All Schema Elements\"));\r\n\tebut.setAttribute(\"class\", \"terminus-control-button terminus-q-btn\");\r\n\tvar self = this;\r\n\tebut.addEventListener(\"click\", function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tUTILS.deleteStylizedEditor(self.ui, qip);\r\n\t\tvar qval = self.wquery.getElementMetaDataQuery(null, self.datatable.pageLength, self.datatable.start);\r\n\t\tqip.value = JSON.stringify(qval);\r\n\t\tUTILS.stylizeEditor(self.ui, qip, 'query', 'javascript');\r\n\t\tif(self.ui.pluginAvailable(\"datatables\")){\r\n\t\t\tself.gatherDatatableSettings(qip, 'Show_All_Schema_Elements');\r\n\t\t\tself.query(qval, self.datatable);\r\n\t\t}\r\n\t\telse self.query(qval);\r\n\t})\r\n\tvar dbut = document.createElement(\"button\");\r\n\tdbut.appendChild(document.createTextNode(\"Show All Documents\"));\r\n\tdbut.setAttribute(\"class\", \"terminus-control-button terminus-q-btn\");\r\n\tdbut.addEventListener(\"click\", function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tUTILS.deleteStylizedEditor(self.ui, qip);\r\n\t\tvar qvalue = self.wquery.getAllDocumentQuery(null, self.datatable.pageLength, self.datatable.start);\r\n\t\tqip.value = JSON.stringify(qvalue);\r\n\t\tUTILS.stylizeEditor(self.ui, qip, 'query', 'javascript');\r\n\t\tif(self.ui.pluginAvailable(\"datatables\")){\r\n\t\t\tself.gatherDatatableSettings(qip, 'Show_All_Documents');\r\n\t\t\tself.query(qvalue, self.datatable);\r\n\t\t}\r\n\t\telse self.query(qvalue);\r\n\t})\r\n\tvar pbut = document.createElement(\"button\");\r\n\tpbut.appendChild(document.createTextNode(\"Show All Data\"));\r\n\tpbut.setAttribute(\"class\", \"terminus-control-button terminus-q-btn\");\r\n\tpbut.addEventListener(\"click\", function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tUTILS.deleteStylizedEditor(self.ui, qip);\r\n\t\tvar qvalue = self.wquery.getEverythingQuery(null, self.datatable.pageLength, self.datatable.start);\r\n\t\tqip.value = JSON.stringify(qvalue);\r\n\t\tUTILS.stylizeEditor(self.ui, qip, 'query', 'javascript');\r\n\t\tif(self.ui.pluginAvailable(\"datatables\")){\r\n\t\t\tself.gatherDatatableSettings(qip, 'Show_All_Data');\r\n\t\t\tself.query(qvalue, self.datatable);\r\n\t\t}\r\n\t\telse self.query(qvalue);\r\n\t})\r\n\r\n\tvar prbut = document.createElement(\"button\");\r\n\tprbut.appendChild(document.createTextNode(\"Show All Properties\"));\r\n\tprbut.setAttribute(\"class\", \"terminus-control-button terminus-q-btn\");\r\n\tprbut.addEventListener(\"click\", function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tUTILS.deleteStylizedEditor(self.ui, qip);\r\n\t\tvar qvalue = self.wquery.getPropertyListQuery(null, self.datatable.pageLength, self.datatable.start);\r\n\t\tqip.value = JSON.stringify(qvalue);\r\n\t\tUTILS.stylizeEditor(self.ui, qip, 'query', 'javascript');\r\n\t\tif(self.ui.pluginAvailable(\"datatables\")){\r\n\t\t\tself.gatherDatatableSettings(qip, 'Show_All_Properties');\r\n\t\t\tself.query(qvalue, self.datatable);\r\n\t\t}\r\n\t\telse self.query(qvalue);\r\n\t})\r\n\r\n\t/* grouping data queries */\r\n\tvar qdGroup = this.qGroupQueries(qrow, 'Data Queries', '');\r\n\r\n\tvar termcc = new TerminusClassChooser(this.ui);\r\n\ttermcc.empty_choice = \"Show data of type\";\r\n\tvar self = this;\r\n\ttermcc.change = function(new_class){\r\n\t\tself.ui.clearMessages();\r\n\t\tif(new_class){\r\n\t\t\tUTILS.deleteStylizedEditor(self.ui, qip);\r\n\t\t\tvar qvalue = self.wquery.getDataOfChosenClassQuery(new_class, self.datatable.pageLength, self.datatable.start);\r\n\t\t\tqip.value = JSON.stringify(qvalue);\r\n\t\t\tUTILS.stylizeEditor(self.ui, qip, 'query', 'javascript');\r\n\t\t\tif(self.ui.pluginAvailable(\"datatables\")){\r\n\t\t\t\tself.gatherDatatableSettings(qip, 'Show_Data_Class');\r\n\t\t\t\tself.datatable.chosenValue = new_class; // set chosen val from drop down\r\n\t\t\t\tself.query(qvalue, self.datatable);\r\n\t\t\t}\r\n\t\t\telse self.query(qvalue);\r\n\t\t}\r\n\t}\r\n\tvar tcdom = termcc.getAsDOM('terminus-query-select');\r\n\r\n\tvar termpc = new TerminusPropertyChooser(this.ui);\r\n\ttermpc.empty_choice = \"Show property data\";\r\n\tvar self = this;\r\n\ttermpc.change = function(new_property){\r\n\t\tif(new_property){\r\n\t\t\tUTILS.deleteStylizedEditor(self.ui, qip);\r\n\t\t\tvar qvalue = self.wquery.getDataOfChosenPropertyQuery(new_property, self.datatable.pageLength, self.datatable.start);\r\n\t\t\tqip.value = JSON.stringify(qvalue);\r\n\t\t\tUTILS.stylizeEditor(self.ui, qip, 'query', 'javascript');\r\n\t\t\tif(self.ui.pluginAvailable(\"datatables\")){\r\n\t\t\t\tself.gatherDatatableSettings(qip, 'Show_Property_Class');\r\n\t\t\t\tself.datatable.chosenValue = new_property; // set chosen val from drop down\r\n\t\t\t\tself.query(qvalue, self.datatable);\r\n\t\t\t}\r\n\t\t\telse self.query(qvalue);\r\n\t\t}\r\n\t}\r\n\r\n\t/* grouping document queries */\r\n\tvar qdocGroup = this.qGroupQueries(qrow, 'Document Queries', '');\r\n\r\n\tvar pdom = termpc.getAsDOM();\r\n\r\n\tvar docch = new TerminusDocumentChooser(this.ui);\r\n\tdocch.change = function(val){\r\n\t\tself.ui.clearMessages();\r\n\t\tUTILS.deleteStylizedEditor(self.ui, qip);\r\n\t\tvar qvalue = self.wquery.getDocumentQuery(val, self.datatable.pageLength, self.datatable.start);\r\n\t\tqip.value = JSON.stringify(qvalue);\r\n\t\tUTILS.stylizeEditor(self.ui, qip, 'query', 'javascript');\r\n\t\tif(self.ui.pluginAvailable(\"datatables\")){\r\n\t\t\tself.gatherDatatableSettings(qip, 'Show_Document_Info_by_Id');\r\n\t\t\tself.datatable.chosenValue = val;\r\n\t\t\tself.query(qvalue, self.datatable);\r\n\t\t}\r\n\t\telse self.query(qvalue);\r\n\t}\r\n\tvar docdom = docch.getAsDOM('terminus-query-select');\r\n\r\n\tvar d2ch = new TerminusDocumentChooser(this.ui, TerminusClient.FrameHelper.unshorten(\"tcs:Document\"));\r\n\td2ch.view = \"label\";\r\n\td2ch.change = docch.change;\r\n\tvar d2dom = d2ch.getAsDOM('terminus-query-select');\r\n\tvar p = document.createElement(\"p\");\r\n\tp.appendChild(d2dom);\r\n\r\n\t/* class queries */\r\n\tvar clGroup = document.createElement('div');\r\n\tclGroup.setAttribute('class', 'terminus-hide ');\r\n\tclGroup.appendChild(ebut);\r\n\tvar br = document.createElement('BR');\r\n\tclGroup.appendChild(br);\r\n\tclGroup.appendChild(nqbut);\r\n\tvar br = document.createElement('BR');\r\n\tclGroup.appendChild(br);\r\n\tclGroup.appendChild(aqbut);\r\n\tvar br = document.createElement('BR');\r\n\tclGroup.appendChild(br);\r\n\tclGroup.appendChild(prbut);\r\n\tvar br = document.createElement('BR');\r\n\tclGroup.appendChild(br);\r\n\tqcGroup.appendChild(clGroup);\r\n\r\n\tqbox.appendChild(qexs);\r\n\r\n\t/* data queries */\r\n\tvar dtGroup = document.createElement('div');\r\n\tdtGroup.setAttribute('class', 'terminus-hide');\r\n\tdtGroup.appendChild(tcdom);\r\n\tdtGroup.appendChild(pdom);\r\n\r\n\tvar br = document.createElement('BR');\r\n\tdtGroup.appendChild(br);\r\n\tdtGroup.appendChild(pbut);\r\n\tqdGroup.appendChild(dtGroup);\r\n\r\n\r\n\t/* document queries */\r\n\tvar docGroup = document.createElement('div');\r\n\tdocGroup.setAttribute('class', 'terminus-hide');\r\n\tdocGroup.appendChild(docdom);\r\n\tdocGroup.appendChild(dbut);\r\n\t//docGroup.appendChild(p);\r\n\tqdocGroup.appendChild(docGroup);\r\n\r\n\treturn qbox;\r\n}\r\n\r\nmodule.exports=WOQLTextboxGenerator\r\n","/*\r\n * Utility Property which runs a query against the schema and presents the returned Propertyes as a drop-down / Property filter list\r\n */\r\nconst WOQLQuery = require('../query/WOQLQuery');\r\n\r\nTerminusPropertyChooser = function(ui, filter){\r\n\tthis.ui = ui;\r\n\tthis.choice = false;\r\n\tthis.filter = filter;\r\n}\r\n\r\nTerminusPropertyChooser.prototype.setRoot = function(root){\r\n\tthis.root = root;\r\n}\r\n\r\nTerminusPropertyChooser.prototype.setFilter = function(filter){\r\n\tthis.filter = filter;\r\n}\r\n\r\nTerminusPropertyChooser.prototype.change = function(cls){\r\n\talert(\"Need to specify Property chooser function (\" + cls + \")\");\r\n}\r\n\r\nTerminusPropertyChooser.prototype.getAsDOM = function(){\r\n\tvar ccdom = document.createElement(\"span\");\r\n\tccdom.setAttribute(\"Class\", \"terminus-Class-chooser\");\r\n\tvar ccsel = document.createElement(\"select\");\r\n\tccsel.setAttribute(\"Class\", \" terminus-type-select terminus-query-select\");\r\n\tvar self = this;\r\n\tccsel.addEventListener(\"change\", function(){\r\n\t\tif(this.value != this.choice){\r\n\t\t\tthis.choice = this.value;\r\n\t\t\tself.change(this.value);\r\n\t\t}\r\n\t});\r\n\tccdom.appendChild(ccsel);\r\n\tvar wq = new WOQLQuery(this.ui.client, false, this.ui);\r\n\tvar woql = wq.getPropertyListQuery(this.filter);\r\n\tvar self = this;\r\n\twq.execute(woql)\r\n\t.then(function(response){\r\n\t\tvar opts = self.getResultsAsOptions(response);\r\n\t\tfor(var i = 0; i<opts.length; i++){\r\n\t\t\tccsel.appendChild(opts[i]);\r\n\t\t}\r\n\t});\r\n\treturn ccdom;\r\n}\r\n\r\nTerminusPropertyChooser.prototype.getResultsAsOptions = function(clist){\r\n\tvar choices = [];\r\n\tif(this.empty_choice){\r\n\t\tvar opt1 = document.createElement(\"option\");\r\n\t\topt1.setAttribute(\"Class\", \"terminus-class-choice terminus-empty-choice\");\r\n\t\topt1.value = \"\";\r\n\t\topt1.appendChild(document.createTextNode(this.empty_choice));\r\n\t\tchoices.push(opt1);\r\n\t}\r\n\tif(clist.bindings){\r\n\t\tvar added = [];\r\n\t\tfor(var i = 0; i<clist.bindings.length; i++){\r\n\t\t\tvar cprop = this.getVariableValueFromBinding(\"Property\", clist.bindings[i]);\r\n\t\t\tif(cprop && added.indexOf(cprop) == -1){\r\n\t\t\t\tadded.push(cprop);\r\n\t\t\t\tvar opt = document.createElement(\"option\");\r\n\t\t\t\topt.setAttribute(\"Class\", \"terminus-class-choice\");\r\n\t\t\t\topt.value = cprop;\r\n\t\t\t\tvar lab = this.getVariableValueFromBinding(\"Label\", clist.bindings[i]);\r\n\t\t\t\tif(!lab || lab == \"unknown\"){\r\n\t\t\t\t\tlab = TerminusClient.FrameHelper.labelFromURL(clist.bindings[i].Property);\r\n\t\t\t\t}\r\n\t\t\t\tif(lab[\"@value\"]) lab = lab[\"@value\"];\r\n\t\t\t\topt.appendChild(document.createTextNode(lab));\r\n\t\t\t\tchoices.push(opt);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn choices;\r\n}\r\n\r\nTerminusPropertyChooser.prototype.getVariableValueFromBinding = function(varname, bind){\r\n\tfor(var key in bind){\r\n\t\tvar skey = key.substring(key.lastIndexOf(\"/\")+1);\r\n\t\tif(skey == varname){\r\n\t\t\treturn bind[key];\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n\r\nmodule.exports=TerminusPropertyChooser\r\n","const WOQLQuery = require('./WOQLQuery');\r\nconst WOQLTimePicker = require('./WOQLTimePicker');\r\n\r\nfunction WOQLGraphBrowserGenerator(tq, qman, ui){\r\n\tthis.query = tq;\r\n\tthis.wquery = qman.wquery;\r\n\t//this.filter = new WOQLQueryFilter(this);\r\n\tthis.slider = new WOQLTimePicker();\r\n}\r\n\r\nWOQLGraphBrowserGenerator.prototype.getAsDOM = function(q){\r\n\tvar qbox = document.createElement(\"div\");\r\n\tqbox.setAttribute(\"class\", \"terminus-query-textbox-input\");\r\n\tqbox.appendChild(document.createTextNode(\"afsdfa\"));\r\n\tqbox.appendChild(this.slider.getSliderDOM());\r\n\treturn qbox;\r\n}\r\n\r\n\r\nfunction DCOGBrowser(controller, model, config){\r\n\tthis.myowner = controller;\r\n\tthis.model = model;\r\n\tthis.config = config;\r\n\tthis.default_viewport = (config && config.view ? config.view : \"graph\");\r\n\tthis.current_viewport = false;\r\n\r\n\t//internal state\r\n\tthis.viewports = {};\r\n\tthis.viewportDOMs = {};\r\n\tthis.browserid = randomString(8);\r\n\tthis.query_timeslice = false;\r\n\tthis.current_result = false;\r\n\tthis.focus_node = false;\r\n\tthis.show_filter = false;\r\n\t//this.relationships = model.mgraphs['main'].elements.relationships;\r\n\t//this.entities = model.mgraphs['main'].elements.entities;\r\n\t\t\r\n\t//this.setUpIPGSpecials();\r\n\t\r\n\tthis.entity_count = false;\r\n\r\n\tthis.config.default_display = {\r\n\t\ticon: \"fas fa-question\",\r\n\t\ticon_unicode: \"\\uf128\",\r\n\t\tcolor: [255,125,125],\r\n\t\tforward: \"Unknown\",\r\n\t\tbackward: \"Unknown\",\r\n\t\ttext: \"Unknown\"\r\n\t};\r\n}\r\n\r\n\r\nDCOGBrowser.prototype.init = function(){\r\n\tthis.filter = new DCOGQueryFilter(this, this.config, this.model);\r\n\tthis.slider = new DCOGTimePicker(this, this.config);\r\n\t//this.viewports['graph'] = new DCOGGVis(this, this.config);\r\n\t//this.viewports['table'] = new DCOGTable(this, this.config);\r\n\t//this.viewports['map'] = new DCOGMap(this, this.config);\r\n\t//this.viewports['api'] = new DCOGAPIView(this, this.config);\r\n\t//this.viewports['timeline'] = new DCOGTimeline(this, this.config);\r\n};\r\n\r\nDCOGBrowser.prototype.getViewportAsDOM = function(){\r\n\tvar vpdom = document.createElement(\"div\");\r\n\tvpdom.setAttribute(\"class\", \"dcog-viewport\");\r\n\tfor(var k in this.viewports){\r\n\t\tif(typeof this.viewportDOMs[k] == \"undefined\"){\r\n\t\t\tthis.viewportDOMs[k] = this.viewports[k].getAsDOM();\r\n\t\t}\r\n\t\tvpdom.appendChild(this.viewportDOMs[k]);\r\n\t}\r\n\treturn vpdom;\r\n}\r\n\r\nDCOGBrowser.prototype.newQuery = function(query, success, error){\r\n\tquery = (query ? query : this.getQuery());\r\n\tvar self = this;\r\n\tvar busy = this.setBusy(\"Fetching Results from Data Chemist Server\");\r\n\tvar handle = function(data){\r\n\t\tself.clearBusy(busy);\r\n\t\tself.current_result = new DCOGQueryResult(data, query);\r\n\t\tif(self.current_result.containsData()){\r\n\t\t\tself.setViewportData(self.current_result);\r\n\t\t\tif(self.focus_node){\r\n\t\t\t\tvar node = self.current_result.getNodeOrFringe(query.focus_node);\r\n\t\t\t}\r\n\t\t\telse if(query.from_node){\r\n\t\t\t\tvar node = self.current_result.getNodeOrFringe(query.from_node);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tself.entity_count = data.nodeCount;\r\n\t\t\t\tself.myowner.fillInfoBoxes();\r\n\t\t\t}\r\n\t\t\tif(node){\r\n\t\t\t\tself.nodeSelected(node);\r\n\t\t\t}\r\n\t\t\tself.rebuildController();\t\t\t\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.tellUser(\"No results returned\", \"warning\");\r\n\t\t}\r\n\t\tif(typeof success == \"function\") {\r\n\t\t\tsuccess(self.current_result);\r\n\t\t}\r\n\t};\r\n\tvar ehandle = function(a){\r\n\t\tvar msg = {title: \"Results Overload\", body: \"Your query was terminated because it would have returned too many records - please reduce the depth of your search or add extra constraints and try again\"};\r\n\t\tself.tellUser(msg, \"error\");\r\n\t\tself.clearBusy(busy);\r\n\t}\r\n\tthis.untell();\r\n\tthis.model.client.query(query, handle, ehandle);\r\n}\r\n\r\nDCOGBrowser.prototype.moreResults = function(nfocus, success){\r\n\tvar busy = this.setBusy(\"Fetching Results from Data Chemist Server\");\r\n\tvar ehandle = function(a){\r\n\t\tvar msg = {title: \"Results Overload\", body: \"Your query was terminated because it would have returned too many records - please reduce the depth of your search or add extra constraints and try again\"};\r\n\t\tself.tellUser(msg, \"error\");\r\n\t\tself.clearBusy(busy);\r\n\t}\r\n\tthis.focus_node = nfocus;\r\n\tvar self = this;\r\n\tvar handle = function(data){\r\n\t\tself.clearBusy(busy);\r\n\t\tself.current_result.addMoreResults(data, self.getQuery());\r\n\t\tself.updateViewportData(self.current_result);\r\n\t\tself.rebuildController();\r\n\t\tif(typeof success == \"function\"){\r\n\t\t\tsuccess(self.current_result);\r\n\t\t}\r\n\t};\r\n\tthis.untell();\r\n\tthis.model.client.query(this.getQuery(), handle, ehandle);\r\n}\r\n\r\nDCOGBrowser.prototype.setBusy = function(msg){\r\n\tvar busy = showBusyOverlay(this.myowner.insert_patterns.browser, msg);\r\n\tthis.busy = busy;\r\n\treturn busy;\r\n}\r\n\r\nDCOGBrowser.prototype.getQuery = function(dqr){\r\n\tvar qstruct = {};\r\n\tif(this.focus_node){\r\n\t\tqstruct.focus_node = this.focus_node;\r\n\t}\r\n\telse if(this.from_node && this.to_node){\r\n\t\tqstruct.source_node = this.from_node;\r\n\t\tqstruct.target_node = this.to_node;\r\n\t}\r\n\tif(this.filter && this.filter.current_relationships){\r\n\t\tqstruct.relationships = this.filter.current_relationships;\r\n\t}\r\n\tif(this.filter && this.filter.current_depth){\r\n\t\tqstruct.max_path_length = this.filter.current_depth;\r\n\t}\r\n\tif(this.filter && this.filter.current_threshold && this.filter.current_threshold > 0 && qstruct.relationships.indexOf(\"share\") != -1){\r\n\t\tqstruct.filters = {shareholding_threshold: this.filter.current_threshold};\r\n\t}\r\n\tif(this.slider && this.slider.server_side && this.slider.timeslice){\r\n\t\tthis.query_timeslice = this.slider.timeslice;\r\n\t}\r\n\telse {\r\n\t\tthis.query_timeslice = false;\r\n\t}\r\n\tif(this.query_timeslice){\r\n\t\tqstruct.date = this.query_timeslice;\r\n\t}\r\n\treturn qstruct;\r\n}\r\n\r\nDCOGBrowser.prototype.setView = function(which){\r\n\tif(which != this.current_viewport){\r\n\t\tthis.current_viewport = which;\r\n\t\tfor(var k in this.viewports){\r\n\t\t\tif(k != this.current_viewport) {\r\n\t\t\t\tif(typeof this.viewports[k][\"hibernate\"] == \"function\"){\r\n\t\t\t\t\t//this.viewports[k].hiberate();\r\n\t\t\t\t}\r\n\t\t\t\tjQuery(this.viewportDOMs[k]).hide();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif(typeof this.viewports[k][\"wake\"] == \"function\"){\r\n\t\t\t\t\tthis.viewports[k].wake();\r\n\t\t\t\t}\r\n\t\t\t\tjQuery(this.viewportDOMs[k]).show();\r\n\t\t\t}\r\n\t\t\tthis.rebuildController();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * @summary Initialises the viewports by firing off a starter query and loading it into the contained viewports\r\n */\r\nDCOGBrowser.prototype.initData = function(which){\r\n\tthis.current_viewport = (which ? which : this.default_viewport);\r\n\tvar self = this;\r\n\tvar setInitNodes = function(dqr){\r\n\t\tif(self.focus_node){\r\n\t\t\tvar node = dqr.getNodeOrFringe(self.focus_node);\r\n\t\t\tif(node && node.groupID){\r\n\t\t\t\tself.nodeSelected(node);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\t\r\n\t\t}\r\n\t\tfor(var k in self.viewports){\r\n\t\t\tif(typeof self.viewports[k].initDOM == \"function\"){\r\n\t\t\t\tself.viewports[k].initDOM(self.viewportDOMs[k]);\r\n\t\t\t}\r\n\t\t\tif(k != self.current_viewport) jQuery(self.viewportDOMs[k]).hide();\r\n\t\t\telse if(typeof self.viewportDOMs[k].wake == \"function\") self.viewportDOMs[k].wake()\r\n\t\t}\r\n\t}\r\n\tvar qstr = this.getQuery();\r\n\tif(qstr){\r\n\t\tthis.newQuery(qstr, setInitNodes);\r\n\t}\r\n\telse {\r\n\t\talert(\"No query string - must set filter and focus node before initialisation\");\r\n\t}\r\n}\r\n\r\nDCOGBrowser.prototype.setViewportData = function(dqr){\r\n\tfor(var k in this.viewports){\r\n\t\tthis.viewports[k].setData(dqr, k == this.current_viewport);\r\n\t}\r\n}\r\n\r\nDCOGBrowser.prototype.updateViewportData = function(dqr){\r\n\tfor(var k in this.viewports){\r\n\t\tthis.viewports[k].updateData(dqr, k == this.current_viewport);\r\n\t}\r\n}\r\nDCOGBrowser.prototype.setViewportFilter = function(dqr){\r\n\tfor(var k in this.viewports){\r\n\t\tif(typeof this.viewports[k].setFilter == \"function\"){\r\n\t\t\tthis.viewports[k].setFilter(dqr, k == this.current_viewport);\r\n\t\t}\r\n\t\telse {\r\n\t\t\talert(k + \" does not implement set filter browser function\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\nDCOGBrowser.prototype.nodeSelected = function(node){\r\n\tif(this.focus_node != node.id){\r\n\t\tthis.focus_node = node.id;\r\n\t}\r\n\tvar sections = this.getNodeInfoSections(node);\r\n\tthis.myowner.nodeSelected(node, sections);\r\n}\r\n\r\nDCOGBrowser.prototype.getNodeInfoSections = function(node){\r\n\treturn [];\r\n}\r\n\r\nDCOGBrowser.prototype.followNode = function(node, success){\r\n\tthis.moreResults(node.id, success);\r\n}\r\n\r\nDCOGBrowser.prototype.setFocusNode = function(id){\r\n\tvar self = this;\r\n\tthis.focus_node = id;\r\n\tthis.newQuery(this.getQuery());\r\n}\r\n\r\nDCOGBrowser.prototype.setPathSearch = function(node_from, node_to){\r\n\tthis.focus_node = false;\r\n\tthis.from_node = node_from;\r\n\tthis.to_node = node_to;\r\n\tthis.newQuery(this.getQuery());\r\n}\r\n\r\nDCOGBrowser.prototype.changeTimeSlice = function(val, valto, force){\r\n\tif(this.current_result){\r\n\t\tif(!this.current_result.isTemporalSuperset(this.query_timeslice, val, valto)){\r\n\t\t\tthis.current_result.setQueryTimeslice(val, valto);\r\n\t\t\tthis.query_timeslice = this.current_result.getTimeslice()\r\n\t\t\tthis.newQuery(this.getQuery());\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.current_result.setFilterTimeslice(val, valto);\r\n\t\t\tthis.setViewportFilter(this.current_result);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nDCOGBrowser.prototype.getControllerAsDOM = function(){\r\n\tvar cdom = document.createElement(\"div\");\r\n\tcdom.setAttribute(\"class\", \"dcog-browser-controller-wrapper\");\r\n\tcdom.appendChild(this.getControllerViewButtonsAsDOM());\r\n\tcdom.appendChild(this.slider.getSliderDOM());\r\n\tthis.toolboxDOM = this.getUserToolboxDOM();\r\n\tcdom.appendChild(this.toolboxDOM);\r\n\tthis.rebuildController();\r\n\tcdom.appendChild(this.filterDOM);\r\n\tcdom.appendChild(this.legendDOM);\r\n\treturn cdom;\r\n}\r\n\r\nDCOGBrowser.prototype.getControllerFilterAsDOM = function(){\r\n\tif(this.filterDOM) {\r\n\t\tjQuery(this.filterDOM).empty();\r\n\t}\r\n\telse {\r\n\t\tvar cdom = document.createElement(\"div\");\r\n\t\tcdom.setAttribute(\"class\", \"dcog-browser-controller-filter\");\r\n\t\tthis.filterDOM = cdom;\r\n\t}\r\n\tvar fdom = this.filter.getRelationshipFilterAsDOM();\r\n\tvar ndom = this.filter.getQueryParameterDOM();\r\n\tvar ipfield = this.slider.getSliderTypeDOM();\r\n\tndom.appendChild(ipfield);\r\n\tvar self = this;\r\n\tvar gobut = document.createElement(\"button\");\r\n\tgobut.setAttribute(\"class\", \"dcog-filter-submit dcog-dashboard-button\");\r\n\tgobut.appendChild(document.createTextNode(\"Go\"));\r\n\tgobut.addEventListener(\"click\", function(){\r\n\t\tself.newQuery();\r\n\t});\r\n\t\r\n\tthis.filterDOM.appendChild(fdom);\r\n\tthis.filterDOM.appendChild(ndom);\r\n\tndom.appendChild(gobut);\r\n\t\r\n\tif(!this.show_filter){\r\n\t\tjQuery(this.filterDOM).hide();\r\n\t}\r\n\treturn this.filterDOM;\r\n}\r\n\r\nDCOGBrowser.prototype.toggleFilterVisibility = function(){\r\n\tif(this.show_filter){\r\n\t\tjQuery(this.filterDOM).hide();\r\n\t}\r\n\telse {\r\n\t\tjQuery(this.filterDOM).show();\r\n\t}\r\n\tthis.show_filter = !this.show_filter;\r\n}\r\n\r\n\r\nDCOGBrowser.prototype.rebuildController = function(){\r\n\tthis.getControllerFilterAsDOM();\r\n\tthis.legendDOM = this.getLegendAsDOM();\r\n}\r\n\r\nDCOGBrowser.prototype.untell = function(){\r\n\tjQuery(this.userMessageDOM).empty(); \r\n}\r\n\r\n\r\nDCOGBrowser.prototype.tellUser = function(msg, type){\r\n\tif(typeof msg == \"undefined\") {\r\n\t\tjQuery(this.userMessageDOM).empty(); \r\n\t}\r\n\telse {\r\n\t\ttype = (type ? type : \"info\");\r\n\t\tvar msgdom = document.createElement(\"span\");\r\n\t\tmsgdom.setAttribute(\"class\", \"dcog-browser-message dcog-message-\" + type);\r\n\t\tif(typeof msg == \"object\"){\r\n\t\t\tmsg = \"<b>\" + msg.title + \"</b> \" + msg.body;\r\n\t\t}\r\n\t\tmsgdom.innerHTML = msg;\r\n\t\tjQuery(this.userMessageDOM).html(msgdom);\r\n\t}\r\n}\r\n\r\nDCOGBrowser.prototype.clearBusy = function(busy){\r\n\tbusy = (busy ? busy : this.busy);\r\n\tif(busy){\t\r\n\t\tjQuery(busy).remove();\r\n\t}\r\n}\r\n\r\nDCOGBrowser.prototype.getUserToolboxDOM = function(){\r\n\tvar cdom = document.createElement(\"div\");\r\n\tcdom.setAttribute(\"class\", \"dcog-browser-toolbox\");\r\n\tvar msgdom = document.createElement(\"span\");\r\n\tmsgdom.setAttribute(\"class\", \"dcog-browser-message-container\");\r\n\tthis.userMessageDOM = msgdom;\r\n\tcdom.appendChild(msgdom);\r\n\tvar tdom = document.createElement(\"span\");\r\n\ttdom.setAttribute(\"class\", \"dcog-browser-tools\");\r\n\t//var dld = document.createElement(\"i\");\r\n\t//dld.setAttribute(\"class\", \"fas fa-download dcog-browser-tool-icon\");\r\n\tvar self = this;\r\n\t/*dld.addEventListener(\"click\", function(){\r\n\t\tif(typeof told == \"undefined\" || !told){\r\n\t\t\tself.tellUser(\"this is the user dialogue box - it will tell the user how to download the data\");\r\n\t\t\ttold = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttold = false;\r\n\t\t\tself.tellUser();\r\n\t\t}\r\n\t});*/\r\n\t//tdom.appendChild(dld);\r\n\tvar dlc = document.createElement(\"i\");\r\n\tdlc.setAttribute(\"class\", \"fas fa-cog dcog-browser-tool-icon\");\r\n\tdlc.addEventListener(\"click\", function(){\r\n\t\tself.toggleFilterVisibility();\r\n\t});\r\n\ttdom.appendChild(dlc);\r\n\tcdom.appendChild(tdom);\r\n\treturn cdom;\r\n}\r\n\r\nDCOGBrowser.prototype.getControllerViewButtonsAsDOM = function(){\r\n\tvar self = this;\r\n\tvar bdoms = [];\r\n\tvar cdom = document.createElement(\"div\");\r\n\tcdom.setAttribute(\"class\", \"dcog-browser-view-buttons\");\r\n\tfor(var k in this.viewports){\r\n\t\tvar bdom = document.createElement(\"button\");\r\n\t\tbdom.appendChild(document.createTextNode(k));\r\n\t\tvar i = document.createElement(\"i\");\r\n\t\tif(k == \"graph\"){\r\n\t\t\ti.setAttribute(\"class\", \"dcog-viewer-icon fas fa-code-branch\")\r\n\t\t}\r\n\t\telse if(k == \"map\"){\r\n\t\t\ti.setAttribute(\"class\", \"dcog-viewer-icon fas fa-globe\")\t\t\t\r\n\t\t}\r\n\t\telse if(k == \"table\"){\r\n\t\t\ti.setAttribute(\"class\", \"dcog-viewer-icon fas fa-list\")\t\t\t\r\n\t\t}\r\n\t\telse if(k == \"api\"){\r\n\t\t\ti.setAttribute(\"class\", \"dcog-viewer-icon fas fa-robot\")\t\t\t\r\n\t\t}\r\n\t\tbdom.appendChild(i);\r\n\t\tbdom.setAttribute(\"id\", this.browserid + k);\r\n\t\tif(k == this.current_viewport){\r\n\t\t\tbdom.setAttribute(\"class\", \"selected\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tbdom.setAttribute(\"class\", \"not-selected\");\r\n\t\t}\r\n\t\tbdom.addEventListener(\"click\", function(){\r\n\t\t\tfor(var i=0; i<bdoms.length; i++){\r\n\t\t\t\tbdoms[i].setAttribute(\"class\", \"not-selected\");\r\n\t\t\t}\r\n\t\t\tthis.setAttribute(\"class\", \"selected\");\r\n\t\t\tself.setView(this.id.substring(self.browserid.length));\r\n\t\t});\r\n\t\tbdoms.push(bdom);\r\n\t\tcdom.appendChild(bdom);\r\n\t}\r\n\treturn cdom;\t\r\n}\r\n\r\nDCOGBrowser.prototype.getLegendAsDOM = function(){\r\n\tif(this.legendDOM) {\r\n\t\tjQuery(this.legendDOM).empty();\r\n\t}\r\n\telse {\r\n\t\tthis.legendDOM = document.createElement(\"div\");\r\n\t\tthis.legendDOM.setAttribute(\"class\", \"dcog-viewport-legend\");\r\n\t}\r\n\tif(typeof this.viewports[this.current_viewport].legend == \"function\"){\r\n\t\tvar dom = this.viewports[this.current_viewport].legend();\r\n\t\tif(dom){\r\n\t\t\tthis.legendDOM.appendChild(dom);\r\n\t\t\tjQuery(this.legendDOM).show();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tjQuery(this.legendDOM).hide();\r\n\t\t}\r\n\t}\r\n\treturn this.legendDOM;\r\n}\r\n\r\n/*\r\n * Display settings for shared look and field between different views - eventually to be kicked back to model \r\n */\r\n\r\nDCOGBrowser.prototype.getNodeRelativeSize = function(node){\r\n\tvar nconf = this.getNodeDisplaySettings(node);\r\n\tif(nconf.size) return nconf.size;\r\n\treturn 1;\r\n}\r\n\r\nDCOGBrowser.prototype.getLineWidth = function(node){\r\n\tvar nconf = this.getNodeDisplaySettings(node);\r\n\tif(nconf.size) return nconf.size;\r\n\treturn 4;\r\n}\r\n\r\nDCOGBrowser.prototype.getModelElementDisplaySettings = function(elt){\r\n\tif(typeof this.config.modeldisplay[elt] != \"undefined\"){\r\n\t\treturn jQuery.extend(true, {}, this.config.modeldisplay[elt]);\r\n\t}\r\n\talert(elt);\r\n\treturn jQuery.extend(true, {}, this.config.default_display);\r\n}\r\n\r\nDCOGBrowser.prototype.isBidirectional = function(edge){\r\n\tif(edge.typeID){\r\n\t\tvar conf = this.config.modeldisplay[edge.typeID];\r\n\t\tif(!conf){\r\n\t\t\t//jpr(edge);\r\n\t\t}\r\n\t\telse if(conf.forward && conf.backward){\r\n\t\t\tvar s = this.current_result.getNodeOrFringe(edge.source);\r\n\t\t\tvar t = this.current_result.getNodeOrFringe(edge.target);\r\n\t\t\tif((t && s && t.groupID && s.groupID) && (s.groupID.indexOf(\"Person\") == -1 && t.groupID.indexOf(\"Person\") == -1) )\r\n\t\t\t\treturn true;\t\t\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n\r\nDCOGBrowser.prototype.getRelationshipClass = function(nick){\r\n\treturn nick;\r\n\t//if(this.config.cmap[nick]) return this.config.cmap[nick];\r\n\t//return false;\r\n}\r\n\r\nDCOGBrowser.prototype.getGraphElementDisplaySettings = function(node){\r\n\tif(node){\r\n\t\tvar nds = this.getNodeDisplaySettings(node);\r\n\t\tif(!nds){\r\n\t\t\tnds = this.getLinkDisplaySettings(node);\r\n\t\t}\r\n\t\treturn nds;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nDCOGBrowser.prototype.getNodeDisplaySettings = function(node){\r\n\tif(typeof node.groupID != \"undefined\"){\r\n\t\treturn this.getModelElementDisplaySettings(node.groupID);\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nDCOGBrowser.prototype.getLinkDisplaySettings = function(link){\r\n\tif(typeof link.typeID != \"undefined\"){\r\n\t\treturn this.getModelElementDisplaySettings(link.typeID);\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nDCOGBrowser.prototype.getElementIcon = function(elt){\r\n\tvar settings = this.getGraphElementDisplaySettings(elt);\r\n\tif(!settings) settings = this.config.default_display;\r\n\treturn settings.icon;\r\n}\r\n\r\nDCOGBrowser.prototype.getClassIcon = function(cls){\r\n\tvar settings = this.getModelElementDisplaySettings(cls);\r\n\tif(!settings) settings = this.config.default_display;\r\n\treturn settings.icon;\r\n}\r\n\r\nDCOGBrowser.prototype.getElementIconUnicode = function(elt){\r\n\tvar settings = this.getGraphElementDisplaySettings(elt);\r\n\tif(!settings) settings = this.config.default_display;\r\n\treturn settings.icon_unicode;\r\n}\r\n\r\nDCOGBrowser.prototype.getElementColour = function(elt){\r\n\tvar settings = this.getGraphElementDisplaySettings(elt);\r\n\tif(!settings) settings = this.config.default_display;\r\n\treturn jQuery.extend(true, [], settings.color);\r\n}\r\n\r\n\r\nDCOGBrowser.prototype.setUpIPGSpecials = function(){\r\n\tthis.config.modeldisplay = {};\r\n\tvar reldisptypes = [\r\n\t\t{\r\n\t\t\ticon: \"fas fa-caret-right\",\r\n\t\t\ticon_unicode: \"\\uf0d6\",\r\n\t\t\tsize: 6,\r\n\t\t\tcolor: [125,125,255],\r\n\t\t},\r\n\t\t{\r\n\t\t\ticon: \"fab fa-creative-commons-by\",\r\n\t\t\ticon_unicode: \"\\uf4e7\",\r\n\t\t\tsize: 5,\r\n\t\t\tcolor: [255,125,125],\r\n\t\t},\r\n\t\t{\r\n\t\t\ticon: \"fas fa-handshake\",\r\n\t\t\tcolor: [125,255,125],\r\n\t\t\tsize: 7,\r\n\t\t\ticon_unicode: \"\\uf2b5\",\r\n\t\t},\r\n\t\t{\r\n\t\t\ticon: \"fas fa-creative-commons-nc-eu\",\r\n\t\t\ticon_unicode: \"\\uf4e9\",\r\n\t\t\tsize: 4,\r\n\t\t\tcolor: [50,50,50],\r\n\t\t},\r\n\t\t{\r\n\t\t\ticon: \"fas fa-sitemap\",\r\n\t\t\ticon_unicode: \"\\uf0e8\",\r\n\t\t\tsize: 8,\r\n\t\t\tcolor: [125,255,255],\r\n\t\t}\r\n\t];\r\n\tvar entdisptypes = [ \r\n\t\t {\r\n\t\t    \ticon: \"fas fa-users\",\r\n\t\t\t\tsize: 1,\r\n\t\t\t\ticon_unicode: \"\\uf0c0\",\r\n\t\t\t\tcolor: [255,125,125],\r\n\t\t\t},\r\n\t\t{\r\n\t\t\ticon: \"fas fa-industry\",\r\n\t\t\tsize: 1.5,\r\n\t\t\ticon_unicode: \"\\uf275\",\r\n\t\t\tcolor: [100,125,255],\r\n\t    },\r\n\t\t{\r\n\t\t\ticon: \"fas fa-user\",\r\n\t\t\tsize: 0.9,\r\n\t\t\ticon_unicode: \"\\uf007\",\r\n\t\t\tcolor: [125,255,125],\r\n\t\t},\r\n\t   {\r\n\t\t\ticon: \"fas fa-building\",\r\n\t\t\ticon_unicode: \"\\uf1ad\",\r\n\t\t\tsize: 1.4,\r\n\t\t\tcolor: [125,125,225],\r\n\t\t},\r\n\t\t{\r\n\t\t\ticon: \"fas fa-briefcase\",\r\n\t\t\ticon_unicode: \"\\uf0b1\",\r\n\t\t\tcolor: [125,125,200],\r\n\t\t\tsize: 1.2,\r\n\t\t},\r\n\t\t{\r\n\t\t\ticon: \"fas fa-user-astronaut\",\r\n\t\t\ticon_unicode: \"\\uf4fb\",\r\n\t\t\tsize: 0.9,\r\n\t\t\tcolor: [125,220,125],\r\n\t\t}\r\n\t];\r\n\t\r\n\tvar i = 0;\r\n\tfor(var rid in this.relationships){\r\n\t\tif(i >= reldisptypes.length) i = 0;\r\n\t\tvar disptype = reldisptypes[i];\r\n\t\tdisptype['forward'] = this.relationships[rid].label;\r\n\t\tthis.config.modeldisplay[rid] = disptype;\r\n\t\ti++;\r\n\t}\r\n\ti = 0;\r\n\tfor(var eid in this.entities){\r\n\t\tif(i >= reldisptypes.length) i = 0;\r\n\t\tvar disptype = entdisptypes[i];\r\n\t\tdisptype['text'] = this.entities[eid].label;\r\n\t\tthis.config.modeldisplay[eid] = disptype;\r\n\t\ti++;\r\n\t}\r\n}\r\n\r\nmodule.exports=WOQLGraphBrowserGenerator\r\n\r\n","WOQLTimePicker = function(config){\r\n\tthis.type = (config && config.slidertype ? config.slidertype : \"range\");\r\n\tthis.timeslice = false;\r\n\tvar defch = function(from, to, ss){\r\n\t\talert(\"changed to: (from) \" + from + \" ... (to) \" + to + \" (\" + ss + \")\");\r\n\t};\r\n\tthis.change = config && config.change ? config.change : defch;  \r\n\tthis.years = (config && config.years ? config.years : 20);\r\n\tthis.server_side = false;\r\n}\r\n\r\nWOQLTimePicker.prototype.toggleServerSideFiltering = function(val){\r\n\tthis.server_side = !this.server_side;\r\n}\r\n\r\nWOQLTimePicker.prototype.getSliderParameters = function(val){\r\n\tstart = 0;\r\n\tend = this.years;\r\n\tvar self = this;\r\n\tvar pointInit = {\r\n\t\t\tmin: start, \r\n\t\t\tmax: end, \r\n\t\t\tvalue: val,\r\n\t\t\tslide: function(event, ui){\r\n\t\t\t\tvar tt = self.tickToTime(ui.value);\r\n\t\t\t\tself.changeTimeSlice(tt);\r\n\t\t\t}\r\n\t}\r\n\tvar rangeInit = {\r\n\t\t\trange: true,\r\n\t\t\tmin: start, \r\n\t\t\tmax: end, \r\n\t\t\tvalues: val,\r\n\t\t\tslide: function(event, ui){\r\n\t\t\t\tself.changeTimeSlice(self.tickToTime(ui.values[0]), self.tickToTime(ui.values[1]));\r\n\t\t\t}\r\n\t}\r\n\tvar sconfig = (this.type == \"range\" ? rangeInit : pointInit);\r\n\treturn sconfig;\r\n}\r\n\r\nWOQLTimePicker.prototype.changeTimeSlice = function(val, val2, noshow){\r\n\tif(this.type == \"range\"){\r\n\t\tthis.timeslice = {};\r\n\t\tthis.timeslice.from = val;\r\n\t\tthis.timeslice.to = val2;\r\n\t\tthis.change(val, val2, this.server_side);\r\n\t}\r\n\telse {\r\n\t\tthis.timeslice = val;\r\n\t\tthis.change(val, false, this.server_side);\r\n\t}\r\n\tif(!noshow){\t\r\n\t\tthis.showCurrentPick();\r\n\t}\r\n}\r\n\r\nWOQLTimePicker.prototype.tickToTime = function(ticknum){\r\n\tif(ticknum == 0){\r\n\t\tvar nval = 0;\r\n\t}\r\n\telse {\r\n\t\tvar year = 31622400 ;\r\n\t\tvar seconds_ago = year * (this.years - ticknum);\r\n\t\tvar now = new Date().getTime()/1000;\r\n\t\tvar nval = now - seconds_ago;\r\n\t}\r\n\treturn nval;\r\n}\r\n\r\n\r\nWOQLTimePicker.prototype.timeToTick = function(timeval){\r\n\tif(timeval){\r\n\t\tvar y = (new Date(timeval * 1000)).getFullYear();\r\n\t\tvar thisy = (new Date()).getFullYear();\r\n\t\treturn this.years - (thisy -y);\r\n\t}\r\n\treturn 0;\r\n}\r\n\r\nWOQLTimePicker.prototype.changeSliderType = function(ntype){\r\n\tvar val, val2;\r\n\tif(this.type == \"point\" && ntype == \"range\"){\r\n\t\tif(this.timeslice){\r\n\t\t\tval = this.timeslice\r\n\t\t\tval2 = this.timeslice;\r\n\t\t}\r\n\t}\r\n\telse if(this.type == \"range\" && ntype == \"point\"){\r\n\t\tif(this.timeslice){\r\n\t\t\tif(this.timeslice.from == 0 && this.timeslice.to == 0) val = false;\r\n\t\t\telse if(this.timeslice.from == 0) val = this.timeslice.to;\r\n\t\t\telse if(this.timeslice.to == 0) val = this.timeslice.from;\r\n\t\t\telse val = (this.timeslice.from + this.timeslice.to) / 2;\r\n\t\t\tval2 = false;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tval = 0;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tthis.type = ntype;\r\n\tthis.changeTimeSlice(val, val2, true);\r\n\tthis.updateSliderDOM();\r\n}\r\n\r\nWOQLTimePicker.prototype.getSliderTypeDOM = function(){\r\n\tvar dcd = document.createElement(\"span\");\r\n\tdcd.setAttribute(\"class\", \"terminus-parameter\");\r\n\tvar lab = document.createElement(\"label\");\r\n\tlab.appendChild(document.createTextNode(\"Dates\"));\r\n\tdcd.appendChild(lab);\r\n\tvar self = this;\r\n\tvar sel = document.createElement(\"select\");\r\n\tvar opt = document.createElement(\"option\");\r\n\topt.value = \"\";\r\n\topt.appendChild(document.createTextNode(\"None\"));\r\n\tif(this.type == \"\"){\r\n\t\topt.setAttribute(\"selected\", \"selected\");\r\n\t}\r\n\tsel.appendChild(opt);\r\n\topt = document.createElement(\"option\");\r\n\topt.value = \"point\";\r\n\topt.appendChild(document.createTextNode(\"Point\"));\r\n\tif(this.type == \"point\"){\r\n\t\topt.setAttribute(\"selected\", \"selected\");\r\n\t}\r\n\tsel.appendChild(opt);\r\n\topt = document.createElement(\"option\");\r\n\topt.value = \"range\";\r\n\topt.appendChild(document.createTextNode(\"Range\"));\r\n\tif(this.type == \"range\"){\r\n\t\topt.setAttribute(\"selected\", \"selected\");\r\n\t}\r\n\tsel.appendChild(opt);\r\n\tvar self = this;\r\n\tsel.addEventListener(\"change\", function(){\r\n\t\tif(this.value != self.type){\r\n\t\t\tself.changeSliderType(this.value);\r\n\t\t}\r\n\t});\r\n\tdcd.appendChild(sel);\r\n\t\r\n\tvar cb = document.createElement(\"input\");\r\n\tcb.setAttribute(\"type\", \"checkbox\");\r\n\tvar elid = this.browserid + \"-ssp\";\r\n\tif(this.server_side){\r\n\t\tcb.setAttribute(\"checked\", true);\r\n\t}\r\n\tvar self = this;\r\n\tcb.addEventListener(\"change\", function(){\r\n\t\tself.toggleServerSideFiltering();\r\n\t});\r\n\tvar lb = document.createElement(\"label\");\r\n\tlb.setAttribute(\"for\", elid);\r\n\tlb.appendChild(document.createTextNode(\"Server Side\"));\r\n\tdcd.appendChild(lb);\r\n\tdcd.appendChild(cb);\r\n\treturn dcd;\r\n\t\r\n}\r\n\r\nWOQLTimePicker.prototype.updateSliderDOM = function(){\r\n\tthis.slideDOM = this.getSliderDOM();\r\n}\r\n\r\nWOQLTimePicker.prototype.getSliderDOM = function(start, end){\r\n\tif(this.slideDOM){\r\n\t\tjQuery(this.slideDOM).empty();\r\n\t}\r\n\telse {\r\n\t\tthis.slideDOM = document.createElement(\"div\");\r\n\t\tthis.slideDOM.setAttribute(\"class\", \"terminus-controller-slider\");\r\n\t}\r\n\tif(this.type == \"\"){\r\n\t\tthis.changeTimeSlice(false);\r\n\t\treturn this.slideDOM;\r\n\t}\r\n\tvar TopAxisDOM = document.createElement(\"div\");\r\n\tTopAxisDOM.setAttribute(\"class\", \"terminus-controller-slider-panel terminus-controller-slider-topaxis\");\r\n\tif(this.type == \"point\"){\r\n\t\tthis.curdate = document.createElement(\"span\");\r\n\t\tthis.curdate.setAttribute(\"class\", \"terminus-slider-current terminus-slider-current-date\");\r\n\t\tTopAxisDOM.appendChild(this.curdate);\r\n\t}\r\n\telse if(this.type == \"range\") {\r\n\t\tthis.cursdate = document.createElement(\"span\");\r\n\t\tthis.cursdate.setAttribute(\"class\", \"terminus-slider-current terminus-slider-current-date-start\");\r\n\t\tTopAxisDOM.appendChild(this.cursdate);\r\n\t\tthis.curedate = document.createElement(\"span\");\t\t\r\n\t\tthis.curedate.setAttribute(\"class\", \"terminus-slider-current terminus-slider-current-date-end\");\r\n\t\tTopAxisDOM.appendChild(this.curedate);\r\n\t}\r\n\tthis.slideDOM.appendChild(TopAxisDOM);\r\n\tthis.showCurrentPick();\r\n\tvar LabelDOM = document.createElement(\"span\");\r\n\tLabelDOM.setAttribute(\"class\", \"terminus-controller-slider-label terminus-controller-slider-startlabel\");\r\n\tthis.slideDOM.appendChild(LabelDOM);\r\n\tvar PayloadDOM = document.createElement(\"div\");\r\n\tPayloadDOM.setAttribute(\"class\", \"terminus-controller-slider-payload\");\r\n\tthis.slideDOM.appendChild(PayloadDOM);\r\n\tvar L2DOM = document.createElement(\"span\");\r\n\tL2DOM.setAttribute(\"class\", \"terminus-controller-slider-label terminus-controller-slider-endlabel\");\r\n\tthis.slideDOM.appendChild(L2DOM);\r\n\tL2DOM.appendChild(this.getSliderAxisDOM());\r\n\tvar sconfig = this.getSliderParameters(this.getTimesliceAsTicks());\r\n\tjQuery(PayloadDOM).slider(sconfig);\r\n\treturn this.slideDOM;\r\n}\r\n\r\nWOQLTimePicker.prototype.getTimesliceAsTicks = function(){\r\n\tif(this.timeslice){\r\n\t\tif(this.type == \"range\"){\r\n\t\t\tvtf = (this.timeslice.from ? this.timeToTick(this.timeslice.from) : 0);\r\n\t\t\tvtt = (this.timeslice.to ? this.timeToTick(this.timeslice.to) : 0);\r\n\t\t\tvar val = [vtf, vtt];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar val = this.timeToTick(this.timeslice)\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tvar val = (this.type == \"range\" ? [0, this.years] : 0);\r\n\t}\r\n\treturn val;\r\n}\r\n\r\nWOQLTimePicker.prototype.showCurrentPick = function(){\r\n\tif(this.type == \"range\"){\r\n\t\tif(!this.timeslice.from) {\r\n\t\t\tvar nd  = new Date();\r\n\t\t\tvar fy = nd.getFullYear() - this.years;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar nd = new Date(this.timeslice.from * 1000);\r\n\t\t\tvar fy = nd.getFullYear(); \r\n\t\t}\r\n\t\tthis.cursdate.innerHTML = fy;\r\n\t\tthis.adjustOffset(this.cursdate, this.timeslice.from);\r\n\t\tif(!this.timeslice.to) {\r\n\t\t\tvar ty = new Date().getFullYear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar ty = new Date(this.timeslice.to * 1000).getFullYear(); \r\n\t\t}\r\n\t\tif(ty != fy){\r\n\t\t\tthis.curedate.innerHTML = ty;\r\n\t\t\tthis.adjustOffset(this.curedate, this.timeslice.to, true);\r\n\t\t\t//jQuery(this.curedate).show();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.curedate.innerHTML = \"\";\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tif(this.timeslice){\r\n\t\t\tvar nd = new Date(this.timeslice * 1000);\r\n\t\t\tfy = nd.getFullYear(); \r\n\t\t}\r\n\t\telse {\r\n\t\t\tfy = \"off\";\r\n\t\t}\r\n\t\tthis.curdate.innerHTML = fy;\r\n\t\tthis.adjustOffset(this.curdate, this.timeslice);\r\n\t}\r\n}\r\n\r\nWOQLTimePicker.prototype.adjustOffset = function(dom, tval, r){\r\n\tvar tick = this.timeToTick(tval);\r\n\tvar totwidth = 50 + (this.slideDOM.offsetWidth ? this.slideDOM.offsetWidth : 0);\r\n\tvar unit = totwidth / (this.years + 1);\r\n\tvar box = -25;\r\n\tvar which = (r ? \"margin-right\" : \"margin-left\");\r\n\tif(r){\r\n\t\tif(tick){\r\n\t\t\tvar off = ((this.years - tick) * unit) + box;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar off = box;\r\n\t\t}\r\n\t\tdom.setAttribute(\"style\", \"margin-right: \" + off + \"px\");\r\n\t}\r\n\telse {\r\n\t\tvar off = unit * tick + box;\r\n\t\tdom.setAttribute(\"style\", \"margin-left: \" + off + \"px\");\r\n\t}\r\n}\r\n\r\nWOQLTimePicker.prototype.getSliderAxisDOM = function(){\r\n\tvar cdom = document.createElement(\"div\");\r\n\tcdom.setAttribute(\"class\", \"terminus-slider-axis-wrapper\");\r\n\tvar fy = new Date().getFullYear();\r\n\tvar sd = fy%5;\r\n\tvar vals = [];\r\n\tfor(var i = this.years; i>0; i-=5){\r\n\t\tvar val = (fy-i) - sd + 5;\r\n\t\tvals.push(val);\r\n\t}\r\n\tfor(var i = 0; i<vals.length; i++){\r\n\t\tvar ldom = document.createElement(\"label\");\r\n\t\tldom.setAttribute(\"class\", \"terminus-axis-label\");\r\n\t\tldom.innerHTML = \"<div class='terminus-tick'>|</div>\"+ vals[i];\r\n\t\tcdom.appendChild(ldom);\r\n\t}\r\n\tndom = document.createElement(\"label\");\r\n\tndom.setAttribute(\"class\", \"terminus-axis-label terminus-axis-now-label\");\r\n\tcdom.appendChild(ndom);\r\n\treturn cdom;\r\n}\r\n\r\nWOQLTimePicker.prototype.Y2Time = function(y){\r\n\treturn (new Date(y+ \"-12-31T12:00:00.000Z\").getTime() / 1000);\r\n}\r\n\r\nmodule.exports=WOQLTimePicker\r\n","function TerminusMappingViewer(ui, mode){\r\n\tthis.ui = ui;\r\n\tthis.mode = (mode ? mode : \"data\");\r\n}\r\n\r\nTerminusMappingViewer.prototype.getAsDOM = function(){\r\n\tvar scd = document.createElement(\"div\");\r\n\tscd.setAttribute(\"class\", \"terminus-mapping-page terminus-page\");\r\n\tvar tsel = document.createElement(\"select\");\r\n\tvar o1 = document.createElement(\"option\");\r\n\to1.value = \"data\";\r\n\to1.appendChild(document.createTextNode(\"Data Map\"))\r\n\ttsel.appendChild(o1);\r\n\tvar o2 = document.createElement(\"option\");\r\n\to2.value = \"model\";\r\n\to2.appendChild(document.createTextNode(\"Model Map\"))\r\n\ttsel.appendChild(o2);\r\n\tvar ff = this.getFormFieldDOM(\"Map Type\");\r\n\tff.appendChild(tsel);\r\n\tscd.appendChild(ff);\r\n\tvar source = this.getFormField(scd, \"Map Source\");\r\n\tvar target = this.getFormField(scd, \"Map Target\");\r\n\tvar queries = this.getFormField(scd, \"Queries\");\r\n\tvar options = this.getFormField(scd, \"Options\");\r\n\t\r\n\tvar mdom = this.getFormFieldDOM(\"Existing Mapping\");\r\n\tvar mapping = document.createElement(\"input\");\r\n\tmapping.setAttribute(\"type\", \"text\");\r\n\tmapping.setAttribute(\"size\", 80);\r\n\tmdom.appendChild(mapping);\r\n\tscd.appendChild(mdom);\r\n\t\r\n\tvar submit = document.createElement(\"button\");\r\n\tsubmit.setAttribute(\"class\", \"terminus-btn terminus-control-button\");\r\n\tsubmit.appendChild(document.createTextNode(\"Execute Mapping\"));\r\n\tvar self = this;\r\n\tsubmit.addEventListener(\"click\", function(){\r\n\t\tvar jsonip = {\r\n\t\t\tmap_source: JSON.parse(source.value),\r\n\t\t};\r\n\t\tif(tsel.value == \"data\"){\r\n\t\t\tjsonip[\"rdf:type\"] = \"dcogmodel:DataMap\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tjsonip[\"rdf:type\"] = \"dcogmodel:ModelMap\";\t\t\t\r\n\t\t}\r\n\t\tif(target.value) jsonip.map_target = target.value;\r\n\t\tif(queries.value) jsonip.queries = queries.value;\r\n\t\tif(options.value) jsonip.options = options.value;\r\n\t\tif(mapping.value) jsonip.mapping = mapping.value;\r\n\t\tself.ui.client.update(false, jsonip);\r\n\t})\r\n\tscd.appendChild(submit);\r\n\treturn scd;\r\n}\r\n\r\nTerminusMappingViewer.prototype.getFormFieldDOM = function(label){\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-mapping-field\");\r\n\tvar lab = document.createElement(\"span\");\r\n\tlab.setAttribute(\"class\", \"terminus-form-label terminus-mapping-label\");\r\n\tlab.appendChild(document.createTextNode(label));\r\n\tsci.appendChild(lab);\r\n\treturn sci;\r\n}\r\n\r\nTerminusMappingViewer.prototype.getFormField = function(holder, label){\r\n\tvar ff = this.getFormFieldDOM(label);\r\n\tvar source = document.createElement(\"textarea\");\r\n\tsource.setAttribute(\"class\", \"terminus-form-value terminus-textarea\");\r\n\tff.appendChild(source);\r\n\tholder.appendChild(ff);\r\n\treturn source;\r\n}\r\n\r\nmodule.exports=TerminusMappingViewer\r\n","/*\r\n * Draws the screen for viewing and updating the schema\r\n * and provides wrappers around the client's schema API\r\n */\r\nconst TerminusClassChooser = require('./TerminusClassChooser');\r\nconst TerminusDocumentViewer = require('./TerminusDocument');\r\nconst UTILS=require('../Utils')\r\n\r\nfunction TerminusSchemaViewer(ui){\r\n\tthis.ui = ui;\r\n\tthis.mode = \"view\";\r\n\tthis.format = \"turtle\";\r\n\tthis.confirm_before_update = true;\r\n}\r\n\r\n/*\r\n * Retrieves schema from API and writes the response into the page\r\n */\r\nTerminusSchemaViewer.prototype.getAsDOM = function(){\r\n\tthis.holder = document.createElement(\"div\");\r\n\tthis.controldom = document.createElement(\"div\");\r\n\tthis.controldom.setAttribute(\"class\", \"terminus-schema-controls\");\r\n\tthis.pagedom = document.createElement(\"div\");\r\n\tthis.pagedom.setAttribute(\"class\", \"terminus-schema-viewer\");\r\n\tthis.loadSchema();\r\n\tthis.holder.appendChild(this.controldom);\r\n\tthis.holder.appendChild(this.pagedom);\r\n\treturn this.holder;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.loadSchema = function(msg, msgtype){\r\n\tvar self = this;\r\n\tthis.ui.showBusy(\"Fetching Database Schema\");\r\n\tthis.ui.client.getSchema(false, {\"terminus:encoding\": \"terminus:\" + this.format})\r\n\t.then(function(response){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.schema = response;\r\n\t\tself.refreshPage(msg, msgtype);\r\n\t})\r\n\t.catch(function(error){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.ui.showError(error);\r\n\t});\r\n}\r\n\r\nTerminusSchemaViewer.prototype.resetControlDOM = function(){\r\n\tTerminusClient.FrameHelper.removeChildren(this.controldom);\r\n\tif(this.mode == \"edit\"){\r\n\t\tthis.controldom.appendChild(this.getSchemaSaveButtons());\r\n\t}\r\n\telse if(this.mode == \"import\"){\r\n\t\tthis.controldom.appendChild(this.getSchemaImportActionButtons());\r\n\t}\r\n\telse if(this.mode == \"class_frame\"){\r\n\t\tif(this.ui.showControl(\"get_schema\")){\r\n\t\t\tthis.controldom.appendChild(this.getShowSchemaButton());\r\n\t\t}\r\n\t\tif(this.ui.showControl(\"class_frame\")){\r\n\t\t\tthis.controldom.appendChild(this.getClassFrameChooser());\r\n\t\t}\r\n\t}\r\n\telse if(this.mode == \"view\"){\r\n\t\tif(this.ui.showControl(\"update_schema\")){\r\n\t\t\tthis.controldom.appendChild(this.getSchemaEditButton());\r\n\t\t}\r\n\t\tif(this.ui.showControl(\"import_schema\")){\r\n\t\t\tthis.controldom.appendChild(this.getImportButton());\r\n\t\t}\r\n\t\tif(this.ui.showControl(\"schema_format\")){\r\n\t\t\tthis.controldom.appendChild(this.getFormatChoices());\r\n\t\t}\r\n\t\tif(this.ui.showControl(\"class_frame\")){\r\n\t\t\tthis.controldom.appendChild(this.getClassFrameChooser());\r\n\t\t}\r\n\t}\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getFormatChoices = function(){\r\n\tvar fc = document.createElement(\"select\");\r\n\tfc.setAttribute(\"class\", \"terminus-form-select terminus-schema-format terminus-type-select\");\r\n\tvar tc = document.createElement(\"option\");\r\n\ttc.setAttribute(\"class\", \"terminus-schema-turtle\");\r\n\ttc.value = \"turtle\";\r\n\ttc.appendChild(document.createTextNode(\"Turtle\"));\r\n\tif(this.format == \"turtle\") tc.selected = true;\r\n\tfc.appendChild(tc);\r\n\tvar tj = document.createElement(\"option\");\r\n\ttj.setAttribute(\"class\", \"terminus-schema-jsonld\");\r\n\ttj.value = \"jsonld\";\r\n\ttj.appendChild(document.createTextNode(\"Json LD\"));\r\n\tif(this.format == \"jsonld\") tj.selected = true;\r\n\tfc.appendChild(tj);\r\n\tvar self = this;\r\n\tfc.addEventListener(\"change\", function(e){\r\n\t\tself.format = this.value;\r\n\t\tself.loadSchema();\r\n\t});\r\n\treturn fc;\r\n}\r\n\r\n\r\nTerminusSchemaViewer.prototype.refreshPage = function(msg, msgtype){\r\n\tif(this.controldom) this.resetControlDOM();\r\n\tif(this.pagedom) this.refreshMainPage(msg, msgtype);\r\n}\r\n\r\nTerminusSchemaViewer.prototype.refreshMainPage = function(msg, msgtype){\r\n\tTerminusClient.FrameHelper.removeChildren(this.pagedom);\r\n\tif(this.mode == 'view'){\r\n\t\tthis.pagedom.appendChild(this.getSchemaViewDOM());\r\n\t}\r\n\telse if(this.mode == \"edit\"){\r\n\t\tthis.pagedom.appendChild(this.getSchemaEditDOM());\r\n\t}\r\n\telse if(this.mode == \"import\"){\r\n\t\tthis.pagedom.appendChild(this.getSchemaImportDOM());\r\n\t}\r\n\telse if(this.mode == \"class_frame\"){\r\n\t\tthis.pagedom.appendChild(this.getClassFrameDOM());\r\n\t}\r\n\tif(msg){\r\n\t\tthis.ui.showMessage(msg, msgtype);\r\n\t}\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaSaveButtons = function(){\r\n\tvar ssb = document.createElement(\"span\");\r\n\tssb.setAttribute(\"class\", \"terminus-schema-save-buttons\");\r\n\tssb.appendChild(this.getCancelButton());\r\n\tssb.appendChild(this.getSaveButton());\r\n\treturn ssb;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaImportActionButtons = function(){\r\n\tvar ssb = document.createElement(\"span\");\r\n\tssb.setAttribute(\"class\", \"terminus-schema-import-buttons\");\r\n\tssb.appendChild(this.getCancelButton());\r\n\t//ssb.appendChild(this.getImportPreviewButton());\r\n\tssb.appendChild(this.getImportSaveButton());\r\n\treturn ssb;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getShowSchemaButton = function(){\r\n\tvar self = this;\r\n\tvar func = function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tself.mode = \"view\";\r\n\t\tself.refreshPage();\r\n\t}\r\n\treturn this.getSchemaButton(\"View Schema\", \"get_schema\", func);\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getImportPreviewButton = function(){\r\n\tvar self = this;\r\n\tvar func = function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tself.mode = \"preview\";\r\n\t\tself.refreshPage();\r\n\t}\r\n\treturn this.getSchemaButton(\"Preview\", \"preview\", func);\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getCancelButton = function(){\r\n\tvar self = this;\r\n\tvar func = function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tself.mode = \"view\";\r\n\t\tself.refreshPage();\r\n\t}\r\n\treturn this.getSchemaButton(\"Cancel\", \"cancel_update\", func);\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getImportSaveButton = function(){\r\n\tvar self = this;\r\n\tvar func = function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tif(typeof self.doImport == \"function\"){\r\n\t\t\tself.doImport();\r\n\t\t}\r\n\t}\r\n\treturn this.getSchemaButton(\"Import\", \"import_schema\", func)\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSaveButton = function(){\r\n\tvar self = this;\r\n\tvar func = function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tvar text = self.schema_edit_dom.value;\r\n\t\tif(typeof(self.schema) == \"object\"){\r\n\t\t\ttext = JSON.parse(text);\r\n\t\t}\r\n\t\treturn self.updateSchema(text, {\"terminus:encoding\": \"terminus:\" + self.format});\r\n\t}\r\n\treturn this.getSchemaButton(\"Save\", \"update_schema\", func);\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaEditButton = function(){\r\n\tvar self = this;\r\n\tvar func = function(){\r\n\t\tself.mode = \"edit\";\r\n\t\tself.refreshPage();\r\n\t}\r\n\treturn this.getSchemaButton(\"Edit\", \"update_schema\", func);\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getImportButton = function(){\r\n\tvar self = this;\r\n\tvar func = function(){\r\n\t\tself.ui.clearMessages();\r\n\t\tself.mode = \"import\";\r\n\t\tself.refreshPage();\r\n\t}\r\n\treturn this.getSchemaButton(\"Import New Schema\", \"import_schema\", func);\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaButton = function(label, action, func){\r\n\tvar opt = document.createElement(\"button\");\r\n\topt.appendChild(document.createTextNode(label));\r\n\topt.setAttribute(\"class\", \"terminus-btn terminus-control-button terminus-schema-\" + action);\r\n\topt.addEventListener(\"click\", func);\r\n\treturn opt;\r\n}\r\n\r\n/*\r\n * Updates schema, then fetches updated version and updates the page with it\r\n */\r\nTerminusSchemaViewer.prototype.updateSchema  = function(text, opts){\r\n\tthis.ui.showBusy(\"Updating Database Schema\");\r\n\tvar self = this;\r\n\treturn this.ui.client.updateSchema(false, text, opts)\r\n\t.then(function(response){\r\n\t\tif(response['terminus:status'] && response['terminus:status'] == \"terminus:success\"){\r\n\t\t\tself.ui.showBusy(\"Retrieving updated schema\");\r\n\t\t\tself.mode = \"view\";\r\n\t\t\tself.loadSchema(\"Successfully Updated Schema\");\r\n\t\t}\r\n\t\telse if(response['terminus:status'] && response['terminus:status'] == \"terminus:failure\"){\r\n\t\t\tself.ui.clearBusy();\r\n\t\t\tself.ui.showViolations(response['terminus:witnesses'], \"schema\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error(\"Update Schema returned no terminus:status code\");\r\n\t\t}\r\n\t})\r\n\t.catch(function(error){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.ui.showError(error);\r\n\t});\r\n}\r\n\r\n/*\r\n * Imports a schema from the passed url\r\n * mode: replace | append\r\n */\r\nTerminusSchemaViewer.prototype.load  = function(url, key, mode){\r\n\tvar self = this;\r\n\tmode = (mode ? mode : \"replace\");\r\n\tthis.ui.showBusy(\"Loading schema from \" + url);\r\n\treturn this.ui.client.getSchema(url, {\"terminus:user_key\": key, \"terminus:encoding\" : \"terminus:\" + this.format})\r\n\t.then(function(response){\r\n\t\tvar newschema = (mode == \"append\") ? self.appendSchema(response) : response;\r\n\t\tif(self.confirm_before_update){\r\n\t\t\tself.showConfirmPage(newschema);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.ui.showBusy(\"Updating schema\");\r\n\t\t\tself.updateSchema(false, newschema).then(function(response){\r\n\t\t\t\tself.ui.clearBusy();\r\n\t\t\t\tself.ui.redraw();\r\n\t\t\t\tself.ui.showResult(\"Successfully deployed new schema from \" + url);\r\n\t\t\t\treturn response;\r\n\t\t\t});\r\n\t\t}\r\n\t}).catch(function(error){\r\n\t\tself.ui.clearBusy();\r\n\t\tself.ui.showError(error);\r\n\t});\r\n}\r\n\r\nTerminusSchemaViewer.prototype.appendSchema = function(s2){\r\n\tvar nschema = this.schema;\r\n\tif(this.format == 'turtle'){\r\n\t\tnschema = this.schema + s2;\r\n\t}\r\n\telse if(this.format == 'jsonld'){\r\n\t\tfor(var i in s2){\r\n\t\t\tnschema[i] = s2[i];\r\n\t\t}\r\n\t}\r\n\treturn nschema;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getClassFrameChooser = function(){\r\n\tvar np = document.createElement(\"span\");\r\n\tnp.setAttribute(\"class\", \"terminus-class frame-chooser\");\r\n\tvar termcc = new TerminusClassChooser(this.ui);\r\n\ttermcc.empty_choice = \"View Individual Class Frames\";\r\n\tvar self = this;\r\n\ttermcc.change = function(new_class){\r\n\t\tif(new_class){\r\n\t\t\tself.cls = new_class;\r\n\t\t\tif(self.mode != \"class_frame\"){\r\n\t\t\t\tself.mode = \"class_frame\";\r\n\t\t\t\tself.refreshPage();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tself.refreshMainPage();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tvar tcdom = termcc.getAsDOM();\r\n\tnp.appendChild(tcdom);\r\n\treturn np;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getClassFrameDOM = function(){\r\n\tvar np = document.createElement(\"div\");\r\n\tnp.setAttribute(\"class\", \"terminus-schema-page terminus-schema-classframe-page\");\r\n\tvar docviewer = new TerminusDocumentViewer(this.ui, \"model\");\r\n\tdocviewer.loadCreateDocument(this.cls);\r\n\tdocviewer.page_config = \"model\";\r\n\tnp.appendChild(docviewer.getAsDOM());\r\n\treturn np;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.showConfirmPage = function(newschema){\r\n\tthis.schema = newschema;\r\n\tthis.confirm_before_update = false;\r\n\tthis.mode = \"edit\";\r\n\tthis.refreshPage(\"Confirm new schema\");\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaEditDOM = function(){\r\n\tvar np = document.createElement(\"div\");\r\n\tnp.setAttribute(\"class\", \"terminus-schema-page terminus-schema-edit-page\");\r\n\tvar ipval = document.createElement(\"textarea\");\r\n\tipval.setAttribute(\"class\", \"terminus-schema-edit terminus-schema-textarea\");\r\n\tipval.setAttribute(\"width\", \"100%\");\r\n\tipval.setAttribute(\"style\", \"min-width: 400px; min-height: 400px;\");\r\n\tif(typeof(this.schema) == \"string\"){\r\n\t\tipval.innerHTML = this.schema;\r\n\t}\r\n\telse if(typeof (this.schema) == \"object\") {\r\n\t\tipval.innerHTML = JSON.stringify(this.schema, 0, 4);\r\n\t}\r\n\tthis.schema_edit_dom = ipval;\r\n\tnp.appendChild(ipval);\r\n\tUTILS.stylizeEditor(this.ui, ipval, 'schema', 'turtle');\r\n\treturn np;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaViewDOM = function(){\r\n\tvar self = this;\r\n\tvar np = document.createElement(\"div\");\r\n\tnp.setAttribute(\"class\", \"terminus-schema-page terminus-schema-view-page\");\r\n\tvar ipval = document.createElement(\"pre\");\r\n\tipval.setAttribute(\"class\", \"terminus-schema-view terminus-scheme-pre\");\r\n\tif(typeof(this.schema) == \"string\"){\r\n\t\tvar txt = this.schema.replace(/&/g, \"&amp;\")\r\n         .replace(/</g, \"&lt;\")\r\n         .replace(/>/g, \"&gt;\")\r\n         .replace(/\"/g, \"&quot;\")\r\n         .replace(/'/g, \"&#039;\");\r\n\t\tipval.innerHTML = txt;\r\n\t}\r\n\telse if(typeof (this.schema) == \"object\") {\r\n\t\tipval.innerHTML = JSON.stringify(this.schema, 0, 4);\r\n\t}\r\n\tvar cm = UTILS.stylizeCodeDisplay(this.ui, ipval, np, 'turtle');\r\n\tif(!cm) np.appendChild(ipval);\r\n\treturn np;\r\n}\r\n\r\nTerminusSchemaViewer.prototype.getSchemaImportDOM = function(){\r\n\tvar scd = document.createElement(\"div\");\r\n\tscd.setAttribute(\"class\", \"terminus-form-border terminus-schema-page terminus-schema-import-page\");\r\n\r\n\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-form-field-spacing terminus-form-horizontal terminus-control-group\");\r\n\tvar slab = document.createElement(\"span\");\r\n\tslab.setAttribute(\"class\", \"terminus-url-loader-input terminus-form-label terminus-control-label\");\r\n\tslab.appendChild(document.createTextNode(\"URL\"));\r\n\tsci.appendChild(slab);\r\n\tvar inpUrl  = document.createElement(\"input\");\r\n\tinpUrl.setAttribute(\"type\", \"text\");\r\n\tinpUrl.setAttribute(\"class\", \"terminus-form-value terminus-input-text terminus-form-url terminus-url-connect\");\r\n\tinpUrl.setAttribute(\"placeholder\", \"Enter url to import schema from\");\r\n\tsci.appendChild(inpUrl);\r\n\tscd.appendChild(sci);\r\n\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-form-field-spacing terminus-form-horizontal terminus-control-group\");\r\n\tvar klab = document.createElement(\"span\");\r\n\tklab.setAttribute(\"class\", \"terminus-url-loader-input terminus-form-label  terminus-control-label terminus-import_mode-input\");\r\n\tklab.appendChild(document.createTextNode(\"Import Mode\"));\r\n\tsci.appendChild(klab);\r\n\tvar modes = document.createElement(\"select\");\r\n\tmodes.setAttribute(\"class\", \"terminus-form-select\");\r\n\r\n\tvar overwrite = document.createElement(\"option\");\r\n\toverwrite.value = \"replace\";\r\n\toverwrite.appendChild(document.createTextNode(\"Replace Mode\"))\r\n\tmodes.appendChild(overwrite);\r\n\tvar append = document.createElement(\"option\");\r\n\tappend.value = \"append\";\r\n\tappend.appendChild(document.createTextNode(\"Append Mode\"))\r\n\tmodes.appendChild(append);\r\n\tmodes.setAttribute(\"class\", \"terminus-form-select terminus-import-mode\");\r\n\tsci.appendChild(klab);\r\n\tsci.appendChild(modes);\r\n\tscd.appendChild(sci);\r\n\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-field terminus-form-field-spacing terminus-form-horizontal terminus-control-group\");\r\n\tvar klab = document.createElement(\"span\");\r\n\tklab.setAttribute(\"class\", \"terminus-form-label terminus-url-key-input terminus-control-label\");\r\n\tklab.appendChild(document.createTextNode(\"Key\"))\r\n\tvar key = document.createElement(\"input\");\r\n\tkey.setAttribute(\"type\", \"text\");\r\n\tkey.setAttribute(\"class\", \"terminus-form-value terminus-input-text terminus-url-key\");\r\n\tsci.appendChild(klab);\r\n\tsci.appendChild(key);\r\n\tscd.appendChild(sci);\r\n\tvar self = this;\r\n\tthis.doImport = function(){\r\n\t\tif(inpUrl.value){\r\n\t\t\tself.load(inpUrl.value, key.value, modes.value);\r\n\t\t}\r\n\t}\r\n\treturn scd;\r\n}\r\n\r\nmodule.exports=TerminusSchemaViewer\r\n","/**\r\n * User interface elements that relate to server context\r\n *\r\n * TerminusServerController is a control widget that invokes server actions\r\n * TerminusServerViewer is a window that displays server actions and server screens\r\n *\r\n */\r\n const Datatables = require('../plugins/datatables.terminus');\r\n const UTILS =require('../Utils')\r\n function TerminusServerController(ui){\r\n\t this.ui = ui;\r\n }\r\n\r\nTerminusServerController.prototype.getAsDOM = function(){\r\n\tvar rsc = document.createElement(\"div\");\r\n\trsc.setAttribute(\"class\", \"terminus-server-controller\");\r\n\tvar self = this;\r\n\tif(this.ui && this.ui.server()){\r\n\t\tvar scd = document.createElement(\"div\");\r\n\t\tscd.setAttribute(\"class\", \"terminus-server-connection\");\r\n        var nav = document.createElement('div');\r\n        nav.setAttribute('class', 'span3');\r\n        var ul = document.createElement('ul');\r\n        ul.setAttribute('class', 'terminus-ul');\r\n        nav.appendChild(ul);\r\n        rsc.appendChild(nav);\r\n        // connected to server\r\n        var a = document.createElement('a');\r\n        a.setAttribute('class', 'terminus-dashboard-info terminus-list-group-a terminus-nav-width');\r\n        var txt = 'Server: ' + this.ui.server();\r\n        a.appendChild(document.createTextNode(txt));\r\n        ul.appendChild(a);\r\n        // change server\r\n        if(this.ui.showControl(\"change-server\")){\r\n            var a = document.createElement('a');\r\n            a.setAttribute('class', 'terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n            var self = this;\r\n            a.addEventListener(\"click\", function(){\r\n                UTILS.activateSelectedNav(this, self);\r\n                self.ui.showLoadURLPage();\r\n            })\r\n            var icon = document.createElement('i');\r\n            icon.setAttribute('class', 'terminus-menu-icon fa fa-link');\r\n            a.appendChild(icon);\r\n            var txt = document.createTextNode('Change Server');\r\n            a.appendChild(txt);\r\n            ul.appendChild(a);\r\n        }\r\n        // view databases\r\n        if(this.ui.showControl(\"db\")){\r\n            var a = document.createElement('a');\r\n            a.setAttribute('class', 'terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n            var self = this;\r\n            a.addEventListener(\"click\", function(){\r\n                UTILS.activateSelectedNav(this, self);\r\n                if(self.ui.db()){\r\n                    //self.ui.clearDB();\r\n                }\r\n                self.ui.showServerMainPage();\r\n            })\r\n            var icon = document.createElement('i');\r\n            icon.setAttribute('class', 'terminus-menu-icon fa fa-eye');\r\n            a.appendChild(icon);\r\n            var txt = document.createTextNode('View Databases');\r\n            a.appendChild(txt);\r\n            ul.appendChild(a);\r\n        }\r\n        if(this.ui.showControl(\"create_database\")){\r\n            var a = document.createElement('a');\r\n            a.setAttribute('class', 'terminus-a terminus-list-group-a terminus-list-group-a-action terminus-nav-width terminus-pointer');\r\n            var self = this;\r\n            a.addEventListener(\"click\", function(){\r\n               UTILS.activateSelectedNav(this, self);\r\n                if(self.ui.db()){\r\n                    //self.ui.clearDB();\r\n                }\r\n                self.ui.showCreateDBPage();\r\n            })\r\n            var icon = document.createElement('i');\r\n            icon.setAttribute('class', 'terminus-menu-icon fa fa-plus');\r\n            a.appendChild(icon);\r\n            var txt = document.createTextNode('Create New Database');\r\n            a.appendChild(txt);\r\n            ul.appendChild(a);\r\n        }\r\n\t}\r\n\treturn rsc;\r\n}\r\n\r\nTerminusServerController.prototype.getServerLabelDOM = function(){\r\n\tvar srec = this.ui.client.connection.getServerRecord();\r\n\tvar lab = (srec && srec['rdfs:label'] && srec['rdfs:label'][\"@value\"] ? srec['rdfs:label'][\"@value\"] : this.ui.server());\r\n\tvar desc = (srec && srec['rdfs:comment'] && srec['rdfs:comment'][\"@value\"] ? srec['rdfs:comment'][\"@value\"] : \"\");\r\n\tdesc += \" Server URL: \"+ this.ui.server();\r\n\tvar val = document.createElement(\"span\");\r\n\tval.setAttribute(\"class\", \"terminus-server-value\");\r\n\tval.setAttribute(\"title\", desc);\r\n\tval.appendChild(document.createTextNode(lab));\r\n    val =  document.createElement('div');\r\n\treturn val;\r\n}\r\n\r\nfunction TerminusServerViewer(ui){\r\n\tthis.ui = ui;\r\n\tthis.server = this.ui.server();\r\n}\r\n\r\nTerminusServerViewer.prototype.getAsDOM = function(selected){\r\n\tvar self = this;\r\n\tvar pd = document.createElement(\"span\");\r\n\tpd.setAttribute(\"class\", \"terminus-server-home-page\");\r\n\tif(this.ui.server()){\r\n\t\tvar scd = document.createElement(\"span\");\r\n\t\tscd.setAttribute(\"class\", \"terminus-server-home\");\r\n\t\tif(this.ui.showView(\"server\")){\r\n\t\t\t// 11092019 scd.appendChild(this.getServerDetailsDOM());\r\n\t\t}\r\n\t\tif(this.ui.showView(\"change-server\")){\r\n\t\t\tvar csbut = document.createElement(\"button\");\r\n\t\t\tcsbut.setAttribute(\"class\", \"terminus-control-button terminus-change-server-button terminus-btn\")\r\n\t\t\tcsbut.appendChild(document.createTextNode(\"Disconnect\"));\r\n\t\t\tcsbut.addEventListener(\"click\", function(){\r\n\t\t\t\t//self.ui.clearDB();\r\n\t\t\t\t//self.ui.clearServer();\r\n\t\t\t\tself.ui.showLoadURLPage();\r\n\t\t\t})\r\n\t\t\t// 11092019 scd.appendChild(csbut);\r\n\t\t}\r\n\t\tif(this.ui.showView(\"create_database\")){\r\n\t\t\tvar crbut = document.createElement(\"button\");\r\n\t\t\tcrbut.setAttribute(\"class\", \"terminus-control-button terminus-create-db-button terminus-btn\")\r\n\t\t\tcrbut.appendChild(document.createTextNode(\"Create New Database\"));\r\n\t\t\tcrbut.addEventListener(\"click\", function(){\r\n\t\t\t\tif(self.ui.db()){\r\n\t\t\t\t\t//self.ui.clearDB();\r\n\t\t\t\t}\r\n\t\t\t\tself.ui.clearMessages();\r\n\t\t\t\tself.ui.showCreateDBPage();\r\n\t\t\t})\r\n\t\t\t// 11092019 scd.appendChild(crbut);\r\n\t\t}\r\n\t\tif(this.ui.showView(\"db\")){\r\n\t\t\tscd.appendChild(this.getDBListDOM());\r\n\t\t}\r\n\t\tpd.appendChild(scd);\r\n\t}\r\n\telse {\r\n\t\tself.ui.showLoadURLPage();\r\n\r\n\t\t//pd.appendChild(this.getLoadURLPage());\r\n\t}\r\n\treturn pd;\r\n}\r\n\r\nTerminusServerViewer.prototype.getServerDetailsDOM = function(){\r\n\tvar scd = document.createElement(\"span\");\r\n\tscd.setAttribute(\"class\", \"terminus-server-details terminus-server-banner\");\r\n\tvar scl = document.createElement(\"span\");\r\n\tscl.setAttribute(\"class\", \"terminus-label terminus-server-info\");\r\n\tscl.appendChild(document.createTextNode(\"Connected to Server - \"))\r\n\tvar scs = document.createElement(\"span\");\r\n\tscs.setAttribute(\"class\", \"terminus-value terminus-server-info\");\r\n\tscs.appendChild(document.createTextNode(this.ui.server()))\r\n\tscd.appendChild(scl);\r\n\tscd.appendChild(scs);\r\n\treturn scd;\r\n}\r\n\r\nTerminusServerViewer.prototype.wrapTableLinkCell = function(dbid, text){\r\n\tvar self = this;\r\n\tvar wrap = document.createElement(\"a\");\r\n\twrap.setAttribute(\"href\", \"#\");\r\n\twrap.setAttribute(\"class\", \"terminus-table-content\");\r\n\twrap.appendChild(document.createTextNode(text));\r\n\twrap.addEventListener(\"click\", function(){\r\n\t\tself.ui.connectToDB(dbid);\r\n\t\tself.ui.showDBMainPage();\r\n\t});\r\n\treturn wrap;\r\n}\r\n\r\nTerminusServerViewer.prototype.getDBListDOM = function(){\r\n\tvar self = this;\r\n\tvar sec = document.createElement(\"div\");\r\n\tvar lihed = document.createElement(\"h3\");\r\n\tlihed.setAttribute(\"class\", \"terminus-db-list-title terminus-module-head\");\r\n\tlihed.appendChild(document.createTextNode(\"Available Databases\"));\r\n\tsec.appendChild(lihed);\r\n\tvar scd = document.createElement(\"table\");\r\n\tscd.setAttribute(\"class\", \"terminus-db-list terminus-db-size\");\r\n\tvar thead = document.createElement(\"thead\");\r\n\tvar thr = document.createElement(\"tr\");\r\n\tvar th1 = document.createElement(\"th\");\r\n\tth1.appendChild(document.createTextNode(\"ID\"));\r\n\tth1.setAttribute(\"class\", \"terminus-db-id terminus-table-th\");\r\n\tvar th2 = document.createElement(\"th\");\r\n\tth2.appendChild(document.createTextNode(\"Title\"));\r\n\tth2.setAttribute(\"class\", \"terminus-db-title terminus-table-th\");\r\n\tvar th3 = document.createElement(\"th\");\r\n\tth3.appendChild(document.createTextNode(\"Description\"));\r\n\tth3.setAttribute(\"class\", \"terminus-db-description terminus-table-th\");\r\n\tvar th4 = document.createElement(\"th\");\r\n\tth4.setAttribute(\"class\", \"terminus-db-size terminus-table-th\");\r\n\tth4.appendChild(document.createTextNode(\"Size\"));\r\n\tvar th5 = document.createElement(\"th\");\r\n\tth5.setAttribute(\"class\", \"terminus-db-created terminus-table-th\");\r\n\tth5.appendChild(document.createTextNode(\"Created\"));\r\n\tvar th6 = document.createElement(\"th\");\r\n\tth6.appendChild(document.createTextNode(\"Delete\"));\r\n\tth6.setAttribute(\"class\", \"terminus-db-delete terminus-table-th\");\r\n\tthr.appendChild(th1);\r\n\tthr.appendChild(th2);\r\n\tthr.appendChild(th3);\r\n\tthr.appendChild(th4);\r\n\tthr.appendChild(th5);\r\n\tthr.appendChild(th6);\r\n\tthead.appendChild(thr);\r\n\tscd.appendChild(thead);\r\n\tvar tbody = document.createElement(\"tbody\");\r\n\tvar dbrecs = this.ui.client.connection.getServerDBRecords();\r\n\tfor(var fullid in dbrecs){\r\n\t\tvar dbrec = dbrecs[fullid];\r\n\t\tvar dbid = fullid.split(\":\")[1];\r\n\t\tvar tr = document.createElement(\"tr\");\r\n\t\tvar td1 = document.createElement(\"td\");\r\n\t\ttd1.appendChild(this.wrapTableLinkCell(dbid, dbid));\r\n\t\ttd1.setAttribute(\"class\", \"terminus-db-id\");\r\n\t\tvar td2 = document.createElement(\"td\");\r\n\t\ttd2.setAttribute(\"class\", \"terminus-db-title\");\r\n\t\tvar txt = (dbrec && dbrec['rdfs:label'] && dbrec['rdfs:label']['@value'] ? dbrec['rdfs:label']['@value'] : \"\");\r\n\t\ttd2.appendChild(this.wrapTableLinkCell(dbid, txt));\r\n\t\tvar td3 = document.createElement(\"td\");\r\n\t\ttd3.setAttribute(\"class\", \"terminus-db-description\");\r\n\t\tvar txt = (dbrec && dbrec['rdfs:comment'] && dbrec['rdfs:comment']['@value'] ? dbrec['rdfs:comment']['@value'] : \"\");\r\n\t\ttd3.appendChild(this.wrapTableLinkCell(dbid, txt));\r\n\t\tvar td4 = document.createElement(\"td\");\r\n\t\ttd4.setAttribute(\"class\", \"terminus-db-size\");\r\n\t\tvar txt = (dbrec && dbrec['terminus:size'] && dbrec['terminus:size']['@value'] ? dbrec['terminus:size']['@value'] : \"\");\r\n\t\ttd4.appendChild(this.wrapTableLinkCell(dbid, txt));\r\n\t\tvar td5 = document.createElement(\"td\");\r\n\t\ttd5.setAttribute(\"class\", \"terminus-db-created\");\r\n\t\tvar txt = (dbrec && dbrec['terminus:last_updated'] && dbrec['terminus:last_updated']['@value'] ? dbrec['terminus:last_updated']['@value'] : \"\");\r\n\t\ttd5.appendChild(this.wrapTableLinkCell(dbid, txt));\r\n\t\tvar td6 = document.createElement(\"td\");\r\n\t\ttd6.setAttribute(\"class\", \"db-delete\");\r\n\t\tif(this.deleteDBPermitted(dbid)){\r\n            if(this.ui.pluginAvailable(\"font-awesome\")){\r\n                var delbut = document.createElement('i');\r\n        \t\tdelbut.setAttribute(\"class\", \"terminus-db-list-del-icon fa fa-times-circle\");\r\n        \t}\r\n            else{\r\n                var delbut = document.createElement(\"button\");\r\n    \t\t\tdelbut.appendChild(document.createTextNode(\"Delete\"));\r\n    \t\t\tdelbut.setAttribute(\"class\", \"terminus-control-button terminus-delete-db-button\");\r\n            }\r\n\t\t\t// function to fix db in a closure\r\n\t\t\tvar delDB = function(db){ return function(){self.ui.deleteDatabase(db);}};\r\n\t\t\tdelbut.addEventListener(\"click\", delDB(dbid));\r\n\t\t\ttd6.appendChild(delbut);\r\n\t\t}\r\n\t\ttr.appendChild(td1);\r\n\t\ttr.appendChild(td2);\r\n\t\ttr.appendChild(td3);\r\n\t\ttr.appendChild(td4);\r\n\t\ttr.appendChild(td5);\r\n\t\ttr.appendChild(td6);\r\n\t\ttbody.appendChild(tr);\r\n\t}\r\n\tscd.appendChild(tbody);\r\n\tsec.appendChild(scd);\r\n\r\n\tif(this.ui.pluginAvailable(\"datatables\")){\r\n        var dt = new Datatables();\r\n\t\tvar tab = dt.draw(false, scd, null, this.ui, null);\r\n\t}\r\n\treturn sec;\r\n}\r\n\r\nTerminusServerViewer.prototype.deleteDBPermitted = function(dbid){\r\n\tif(this.ui.client.connection.capabilitiesPermit(\"delete_database\", dbid)) return true;\r\n\treturn false;\r\n}\r\n\r\nmodule.exports = {TerminusServerViewer,TerminusServerController}\r\n","function TerminusURLLoader(ui, val){\r\n\tthis.ui = ui;\r\n\tthis.val = val;\r\n\tthis.url_input = false;\r\n\tthis.key_input = false;\r\n}\r\n\r\nTerminusURLLoader.prototype.getLabelDOM = function(){\r\n\treturn document.createTextNode(\"Connect\");\r\n}\r\n\r\nTerminusURLLoader.prototype.getFormFieldDOM = function(ip, fname, ltxt, pholder){\r\n\tvar sci = document.createElement(\"div\");\r\n\tsci.setAttribute(\"class\", \"terminus-form-horizontal terminus-control-group terminus-form-field-spacing terminus-form-field terminus-field-\"+fname);\r\n\tvar lab = document.createElement(\"span\");\r\n\tlab.setAttribute(\"class\", \"terminus-control-label terminus-form-label terminus-form-field-label terminus-label-\"+fname);\r\n\tlab.appendChild(document.createTextNode(ltxt))\r\n\tip.setAttribute(\"type\", \"text\");\r\n\tip.setAttribute(\"placeholder\", pholder);\r\n\tsci.appendChild(lab);\r\n\tsci.appendChild(ip);\r\n\treturn sci;\r\n}\r\n\r\nTerminusURLLoader.prototype.getAsDOM = function(){\r\n\tvar scd = document.createElement(\"div\");\r\n\tscd.setAttribute(\"class\", \"terminus-form terminus-url-loader\");\r\n\tvar stit = document.createElement(\"h3\");\r\n\tstit.setAttribute(\"class\", \"terminus-form-header terminus-connect-header terminus-module-head\");\r\n\tstit.appendChild(document.createTextNode(\"Connect To Terminus Server\"));\r\n\tscd.appendChild(stit);\r\n\tvar mfd = document.createElement('div');\r\n\tmfd.setAttribute('class', 'terminus-form-border');\r\n\tscd.appendChild(mfd);\r\n\tthis.url_input = document.createElement(\"input\");\r\n\tthis.url_input.setAttribute(\"class\", \"terminus-form-value terminus-form-url terminus-form-field-input terminus-input-text\");\r\n\tif(this.val){\r\n\t\tthis.url_input.value = this.val;\r\n\t}\r\n\tmfd.appendChild(this.getFormFieldDOM(this.url_input, \"connect\", \"URL\", \"Terminus DB URL\"));\r\n\tthis.key_input = document.createElement(\"input\");\r\n\tthis.key_input.setAttribute(\"class\", \"terminus-form-value terminus-value terminus-input-text\");\r\n\tmfd.appendChild(this.getFormFieldDOM(this.key_input, \"connect\", \"Key\", \"Server API Key\"));\r\n\tvar loadbuts = document.createElement(\"div\");\r\n\tloadbuts.setAttribute(\"class\", \"terminus-control-buttons\");\r\n\tvar loadbut = document.createElement(\"button\");\r\n\tloadbut.setAttribute(\"class\", \"terminus-control-button terminus-url-load terminus-btn\");\r\n\tloadbut.appendChild(document.createTextNode(\"Connect\"));\r\n\tvar self = this;\r\n\tloadbut.addEventListener(\"click\", function(){\r\n\t\tif(self.url_input.value){\r\n\t\t\tself.ui.load(self.url_input.value, self.key_input.value);\r\n\t\t}\r\n\t});\r\n\tloadbuts.appendChild(loadbut);\r\n\tmfd.appendChild(loadbuts);\r\n\treturn scd;\r\n}\r\n\r\n\r\nmodule.exports=TerminusURLLoader\r\n"],"sourceRoot":""}